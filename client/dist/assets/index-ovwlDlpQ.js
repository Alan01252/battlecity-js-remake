(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}})();var _i=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mi(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Zv(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var t=i.default;if(typeof t=="function"){var e=function r(){var n=!1;try{n=this instanceof r}catch{}return n?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),e}var Bn={},Sc;function Jv(){return Sc||(Sc=1,(function(i){(function(t){var e=t.Promise,r=e&&"resolve"in e&&"reject"in e&&"all"in e&&"race"in e&&(function(){var M;return new e(function(N){M=N}),typeof M=="function"})();i?(i.Promise=r?e:H,i.Polyfill=H):r||(t.Promise=H);var n="pending",s="sealed",o="fulfilled",a="rejected",l=function(){};function u(M){return Object.prototype.toString.call(M)==="[object Array]"}var c=typeof setImmediate<"u"?setImmediate:setTimeout,h=[],f;function d(){for(var M=0;M<h.length;M++)h[M][0](h[M][1]);h=[],f=!1}function p(M,N){h.push([M,N]),f||(f=!0,c(d,0))}function v(M,N){function Y(Z){E(N,Z)}function D(Z){R(N,Z)}try{M(Y,D)}catch(Z){D(Z)}}function y(M){var N=M.owner,Y=N.state_,D=N.data_,Z=M[Y],Q=M.then;if(typeof Z=="function"){Y=o;try{D=Z(D)}catch($){R(Q,$)}}g(Q,D)||(Y===o&&E(Q,D),Y===a&&R(Q,D))}function g(M,N){var Y;try{if(M===N)throw new TypeError("A promises callback cannot return that same promise.");if(N&&(typeof N=="function"||typeof N=="object")){var D=N.then;if(typeof D=="function")return D.call(N,function(Z){Y||(Y=!0,N!==Z?E(M,Z):T(M,Z))},function(Z){Y||(Y=!0,R(M,Z))}),!0}}catch(Z){return Y||R(M,Z),!0}return!1}function E(M,N){(M===N||!g(M,N))&&T(M,N)}function T(M,N){M.state_===n&&(M.state_=s,M.data_=N,p(F,M))}function R(M,N){M.state_===n&&(M.state_=s,M.data_=N,p(P,M))}function _(M){var N=M.then_;M.then_=void 0;for(var Y=0;Y<N.length;Y++)y(N[Y])}function F(M){M.state_=o,_(M)}function P(M){M.state_=a,_(M)}function H(M){if(typeof M!="function")throw new TypeError("Promise constructor takes a function argument");if(!(this instanceof H))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],v(M,this)}H.prototype={constructor:H,state_:n,then_:null,data_:void 0,then:function(M,N){var Y={owner:this,then:new this.constructor(l),fulfilled:M,rejected:N};return this.state_===o||this.state_===a?p(y,Y):this.then_.push(Y),Y.then},catch:function(M){return this.then(null,M)}},H.all=function(M){var N=this;if(!u(M))throw new TypeError("You must pass an array to Promise.all().");return new N(function(Y,D){var Z=[],Q=0;function $(m){return Q++,function(x){Z[m]=x,--Q||Y(Z)}}for(var C=0,O;C<M.length;C++)O=M[C],O&&typeof O.then=="function"?O.then($(C),D):Z[C]=O;Q||Y(Z)})},H.race=function(M){var N=this;if(!u(M))throw new TypeError("You must pass an array to Promise.race().");return new N(function(Y,D){for(var Z=0,Q;Z<M.length;Z++)Q=M[Z],Q&&typeof Q.then=="function"?Q.then(Y,D):Y(Q)})},H.resolve=function(M){var N=this;return M&&typeof M=="object"&&M.constructor===N?M:new N(function(Y){Y(M)})},H.reject=function(M){var N=this;return new N(function(Y,D){D(M)})}})(typeof window<"u"?window:typeof _i<"u"?_i:typeof self<"u"?self:Bn)})(Bn)),Bn}var Qv=Jv();/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var bo,Cc;function eg(){if(Cc)return bo;Cc=1;var i=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable;function r(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function n(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var l=Object.getOwnPropertyNames(o).map(function(c){return o[c]});if(l.join("")!=="0123456789")return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(c){u[c]=c}),Object.keys(Object.assign({},u)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return bo=n()?Object.assign:function(s,o){for(var a,l=r(s),u,c=1;c<arguments.length;c++){a=Object(arguments[c]);for(var h in a)t.call(a,h)&&(l[h]=a[h]);if(i){u=i(a);for(var f=0;f<u.length;f++)e.call(a,u[f])&&(l[u[f]]=a[u[f]])}}return l},bo}var tg=eg();const rg=Mi(tg);/*!
 * @pixi/polyfill - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/polyfill is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */window.Promise||(window.Promise=Qv.Polyfill);Object.assign||(Object.assign=rg);var ig=16;Date.now&&Date.prototype.getTime||(Date.now=function(){return new Date().getTime()});if(!(window.performance&&window.performance.now)){var ng=Date.now();window.performance||(window.performance={}),window.performance.now=function(){return Date.now()-ng}}var _o=Date.now(),Ac=["ms","moz","webkit","o"];for(var xo=0;xo<Ac.length&&!window.requestAnimationFrame;++xo){var wo=Ac[xo];window.requestAnimationFrame=window[wo+"RequestAnimationFrame"],window.cancelAnimationFrame=window[wo+"CancelAnimationFrame"]||window[wo+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(i){if(typeof i!="function")throw new TypeError(i+"is not a function");var t=Date.now(),e=ig+_o-t;return e<0&&(e=0),_o=t,window.setTimeout(function(){_o=Date.now(),i(performance.now())},e)});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(i){return clearTimeout(i)});Math.sign||(Math.sign=function(t){return t=Number(t),t===0||isNaN(t)?t:t>0?1:-1});Number.isInteger||(Number.isInteger=function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t});window.ArrayBuffer||(window.ArrayBuffer=Array);window.Float32Array||(window.Float32Array=Array);window.Uint32Array||(window.Uint32Array=Array);window.Uint16Array||(window.Uint16Array=Array);window.Uint8Array||(window.Uint8Array=Array);window.Int32Array||(window.Int32Array=Array);var To=/iPhone/i,Pc=/iPod/i,Oc=/iPad/i,Fc=/\biOS-universal(?:.+)Mac\b/i,Io=/\bAndroid(?:.+)Mobile\b/i,Mc=/Android/i,ei=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Dn=/Silk/i,Ut=/Windows Phone/i,Rc=/\bWindows(?:.+)ARM\b/i,Lc=/BlackBerry/i,Nc=/BB10/i,Bc=/Opera Mini/i,Dc=/\b(CriOS|Chrome)(?:.+)Mobile/i,kc=/Mobile(?:.+)Firefox\b/i,Uc=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function sg(i){return function(t){return t.test(i)}}function og(i){var t={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?t.userAgent=i:i&&i.userAgent&&(t={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var e=t.userAgent,r=e.split("[FBAN");typeof r[1]<"u"&&(e=r[0]),r=e.split("Twitter"),typeof r[1]<"u"&&(e=r[0]);var n=sg(e),s={apple:{phone:n(To)&&!n(Ut),ipod:n(Pc),tablet:!n(To)&&(n(Oc)||Uc(t))&&!n(Ut),universal:n(Fc),device:(n(To)||n(Pc)||n(Oc)||n(Fc)||Uc(t))&&!n(Ut)},amazon:{phone:n(ei),tablet:!n(ei)&&n(Dn),device:n(ei)||n(Dn)},android:{phone:!n(Ut)&&n(ei)||!n(Ut)&&n(Io),tablet:!n(Ut)&&!n(ei)&&!n(Io)&&(n(Dn)||n(Mc)),device:!n(Ut)&&(n(ei)||n(Dn)||n(Io)||n(Mc))||n(/\bokhttp\b/i)},windows:{phone:n(Ut),tablet:n(Rc),device:n(Ut)||n(Rc)},other:{blackberry:n(Lc),blackberry10:n(Nc),opera:n(Bc),firefox:n(kc),chrome:n(Dc),device:n(Lc)||n(Nc)||n(Bc)||n(kc)||n(Dc)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}/*!
 * @pixi/settings - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var _t=og(window.navigator);function ag(i){var t=!0;if(_t.tablet||_t.phone){if(_t.apple.device){var e=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(e){var r=parseInt(e[1],10);r<11&&(t=!1)}}if(_t.android.device){var e=navigator.userAgent.match(/Android\s([0-9.]*)/);if(e){var r=parseInt(e[1],10);r<7&&(t=!1)}}}return t?i:4}function lg(){return!_t.apple.device}var ne={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:ag(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:_t.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:lg(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},Eo={exports:{}},Xc;function ug(){return Xc||(Xc=1,(function(i){var t=Object.prototype.hasOwnProperty,e="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(e=!1));function n(l,u,c){this.fn=l,this.context=u,this.once=c||!1}function s(l,u,c,h,f){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new n(c,h||l,f),p=e?e+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],d]:l._events[p].push(d):(l._events[p]=d,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],c,h;if(this._eventsCount===0)return u;for(h in c=this._events)t.call(c,h)&&u.push(e?h.slice(1):h);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(c)):u},a.prototype.listeners=function(u){var c=e?e+u:u,h=this._events[c];if(!h)return[];if(h.fn)return[h.fn];for(var f=0,d=h.length,p=new Array(d);f<d;f++)p[f]=h[f].fn;return p},a.prototype.listenerCount=function(u){var c=e?e+u:u,h=this._events[c];return h?h.fn?1:h.length:0},a.prototype.emit=function(u,c,h,f,d,p){var v=e?e+u:u;if(!this._events[v])return!1;var y=this._events[v],g=arguments.length,E,T;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),g){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,c),!0;case 3:return y.fn.call(y.context,c,h),!0;case 4:return y.fn.call(y.context,c,h,f),!0;case 5:return y.fn.call(y.context,c,h,f,d),!0;case 6:return y.fn.call(y.context,c,h,f,d,p),!0}for(T=1,E=new Array(g-1);T<g;T++)E[T-1]=arguments[T];y.fn.apply(y.context,E)}else{var R=y.length,_;for(T=0;T<R;T++)switch(y[T].once&&this.removeListener(u,y[T].fn,void 0,!0),g){case 1:y[T].fn.call(y[T].context);break;case 2:y[T].fn.call(y[T].context,c);break;case 3:y[T].fn.call(y[T].context,c,h);break;case 4:y[T].fn.call(y[T].context,c,h,f);break;default:if(!E)for(_=1,E=new Array(g-1);_<g;_++)E[_-1]=arguments[_];y[T].fn.apply(y[T].context,E)}}return!0},a.prototype.on=function(u,c,h){return s(this,u,c,h,!1)},a.prototype.once=function(u,c,h){return s(this,u,c,h,!0)},a.prototype.removeListener=function(u,c,h,f){var d=e?e+u:u;if(!this._events[d])return this;if(!c)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===c&&(!f||p.once)&&(!h||p.context===h)&&o(this,d);else{for(var v=0,y=[],g=p.length;v<g;v++)(p[v].fn!==c||f&&!p[v].once||h&&p[v].context!==h)&&y.push(p[v]);y.length?this._events[d]=y.length===1?y[0]:y:o(this,d)}return this},a.prototype.removeAllListeners=function(u){var c;return u?(c=e?e+u:u,this._events[c]&&o(this,c)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(Eo)),Eo.exports}var cg=ug();const Ri=Mi(cg);var kn={exports:{}},Hc;function hg(){if(Hc)return kn.exports;Hc=1,kn.exports=i,kn.exports.default=i;function i(C,O,m){m=m||2;var x=O&&O.length,w=x?O[0]*m:C.length,I=t(C,0,w,m,!0),S=[];if(!I||I.next===I.prev)return S;var A,L,B,k,U,V,j;if(x&&(I=l(C,O,I,m)),C.length>80*m){A=B=C[0],L=k=C[1];for(var z=m;z<w;z+=m)U=C[z],V=C[z+1],U<A&&(A=U),V<L&&(L=V),U>B&&(B=U),V>k&&(k=V);j=Math.max(B-A,k-L),j=j!==0?32767/j:0}return r(I,S,m,A,L,j,0),S}function t(C,O,m,x,w){var I,S;if(w===$(C,O,m,x)>0)for(I=O;I<m;I+=x)S=D(I,C[I],C[I+1],S);else for(I=m-x;I>=O;I-=x)S=D(I,C[I],C[I+1],S);return S&&R(S,S.next)&&(Z(S),S=S.next),S}function e(C,O){if(!C)return C;O||(O=C);var m=C,x;do if(x=!1,!m.steiner&&(R(m,m.next)||T(m.prev,m,m.next)===0)){if(Z(m),m=O=m.prev,m===m.next)break;x=!0}else m=m.next;while(x||m!==O);return O}function r(C,O,m,x,w,I,S){if(C){!S&&I&&d(C,x,w,I);for(var A=C,L,B;C.prev!==C.next;){if(L=C.prev,B=C.next,I?s(C,x,w,I):n(C)){O.push(L.i/m|0),O.push(C.i/m|0),O.push(B.i/m|0),Z(C),C=B.next,A=B.next;continue}if(C=B,C===A){S?S===1?(C=o(e(C),O,m),r(C,O,m,x,w,I,2)):S===2&&a(C,O,m,x,w,I):r(e(C),O,m,x,w,I,1);break}}}}function n(C){var O=C.prev,m=C,x=C.next;if(T(O,m,x)>=0)return!1;for(var w=O.x,I=m.x,S=x.x,A=O.y,L=m.y,B=x.y,k=w<I?w<S?w:S:I<S?I:S,U=A<L?A<B?A:B:L<B?L:B,V=w>I?w>S?w:S:I>S?I:S,j=A>L?A>B?A:B:L>B?L:B,z=x.next;z!==O;){if(z.x>=k&&z.x<=V&&z.y>=U&&z.y<=j&&g(w,A,I,L,S,B,z.x,z.y)&&T(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function s(C,O,m,x){var w=C.prev,I=C,S=C.next;if(T(w,I,S)>=0)return!1;for(var A=w.x,L=I.x,B=S.x,k=w.y,U=I.y,V=S.y,j=A<L?A<B?A:B:L<B?L:B,z=k<U?k<V?k:V:U<V?U:V,K=A>L?A>B?A:B:L>B?L:B,q=k>U?k>V?k:V:U>V?U:V,ie=v(j,z,O,m,x),ae=v(K,q,O,m,x),te=C.prevZ,re=C.nextZ;te&&te.z>=ie&&re&&re.z<=ae;){if(te.x>=j&&te.x<=K&&te.y>=z&&te.y<=q&&te!==w&&te!==S&&g(A,k,L,U,B,V,te.x,te.y)&&T(te.prev,te,te.next)>=0||(te=te.prevZ,re.x>=j&&re.x<=K&&re.y>=z&&re.y<=q&&re!==w&&re!==S&&g(A,k,L,U,B,V,re.x,re.y)&&T(re.prev,re,re.next)>=0))return!1;re=re.nextZ}for(;te&&te.z>=ie;){if(te.x>=j&&te.x<=K&&te.y>=z&&te.y<=q&&te!==w&&te!==S&&g(A,k,L,U,B,V,te.x,te.y)&&T(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;re&&re.z<=ae;){if(re.x>=j&&re.x<=K&&re.y>=z&&re.y<=q&&re!==w&&re!==S&&g(A,k,L,U,B,V,re.x,re.y)&&T(re.prev,re,re.next)>=0)return!1;re=re.nextZ}return!0}function o(C,O,m){var x=C;do{var w=x.prev,I=x.next.next;!R(w,I)&&_(w,x,x.next,I)&&M(w,I)&&M(I,w)&&(O.push(w.i/m|0),O.push(x.i/m|0),O.push(I.i/m|0),Z(x),Z(x.next),x=C=I),x=x.next}while(x!==C);return e(x)}function a(C,O,m,x,w,I){var S=C;do{for(var A=S.next.next;A!==S.prev;){if(S.i!==A.i&&E(S,A)){var L=Y(S,A);S=e(S,S.next),L=e(L,L.next),r(S,O,m,x,w,I,0),r(L,O,m,x,w,I,0);return}A=A.next}S=S.next}while(S!==C)}function l(C,O,m,x){var w=[],I,S,A,L,B;for(I=0,S=O.length;I<S;I++)A=O[I]*x,L=I<S-1?O[I+1]*x:C.length,B=t(C,A,L,x,!1),B===B.next&&(B.steiner=!0),w.push(y(B));for(w.sort(u),I=0;I<w.length;I++)m=c(w[I],m);return m}function u(C,O){return C.x-O.x}function c(C,O){var m=h(C,O);if(!m)return O;var x=Y(m,C);return e(x,x.next),e(m,m.next)}function h(C,O){var m=O,x=C.x,w=C.y,I=-1/0,S;do{if(w<=m.y&&w>=m.next.y&&m.next.y!==m.y){var A=m.x+(w-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(A<=x&&A>I&&(I=A,S=m.x<m.next.x?m:m.next,A===x))return S}m=m.next}while(m!==O);if(!S)return null;var L=S,B=S.x,k=S.y,U=1/0,V;m=S;do x>=m.x&&m.x>=B&&x!==m.x&&g(w<k?x:I,w,B,k,w<k?I:x,w,m.x,m.y)&&(V=Math.abs(w-m.y)/(x-m.x),M(m,C)&&(V<U||V===U&&(m.x>S.x||m.x===S.x&&f(S,m)))&&(S=m,U=V)),m=m.next;while(m!==L);return S}function f(C,O){return T(C.prev,C,O.prev)<0&&T(O.next,C,C.next)<0}function d(C,O,m,x){var w=C;do w.z===0&&(w.z=v(w.x,w.y,O,m,x)),w.prevZ=w.prev,w.nextZ=w.next,w=w.next;while(w!==C);w.prevZ.nextZ=null,w.prevZ=null,p(w)}function p(C){var O,m,x,w,I,S,A,L,B=1;do{for(m=C,C=null,I=null,S=0;m;){for(S++,x=m,A=0,O=0;O<B&&(A++,x=x.nextZ,!!x);O++);for(L=B;A>0||L>0&&x;)A!==0&&(L===0||!x||m.z<=x.z)?(w=m,m=m.nextZ,A--):(w=x,x=x.nextZ,L--),I?I.nextZ=w:C=w,w.prevZ=I,I=w;m=x}I.nextZ=null,B*=2}while(S>1);return C}function v(C,O,m,x,w){return C=(C-m)*w|0,O=(O-x)*w|0,C=(C|C<<8)&16711935,C=(C|C<<4)&252645135,C=(C|C<<2)&858993459,C=(C|C<<1)&1431655765,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,C|O<<1}function y(C){var O=C,m=C;do(O.x<m.x||O.x===m.x&&O.y<m.y)&&(m=O),O=O.next;while(O!==C);return m}function g(C,O,m,x,w,I,S,A){return(w-S)*(O-A)>=(C-S)*(I-A)&&(C-S)*(x-A)>=(m-S)*(O-A)&&(m-S)*(I-A)>=(w-S)*(x-A)}function E(C,O){return C.next.i!==O.i&&C.prev.i!==O.i&&!H(C,O)&&(M(C,O)&&M(O,C)&&N(C,O)&&(T(C.prev,C,O.prev)||T(C,O.prev,O))||R(C,O)&&T(C.prev,C,C.next)>0&&T(O.prev,O,O.next)>0)}function T(C,O,m){return(O.y-C.y)*(m.x-O.x)-(O.x-C.x)*(m.y-O.y)}function R(C,O){return C.x===O.x&&C.y===O.y}function _(C,O,m,x){var w=P(T(C,O,m)),I=P(T(C,O,x)),S=P(T(m,x,C)),A=P(T(m,x,O));return!!(w!==I&&S!==A||w===0&&F(C,m,O)||I===0&&F(C,x,O)||S===0&&F(m,C,x)||A===0&&F(m,O,x))}function F(C,O,m){return O.x<=Math.max(C.x,m.x)&&O.x>=Math.min(C.x,m.x)&&O.y<=Math.max(C.y,m.y)&&O.y>=Math.min(C.y,m.y)}function P(C){return C>0?1:C<0?-1:0}function H(C,O){var m=C;do{if(m.i!==C.i&&m.next.i!==C.i&&m.i!==O.i&&m.next.i!==O.i&&_(m,m.next,C,O))return!0;m=m.next}while(m!==C);return!1}function M(C,O){return T(C.prev,C,C.next)<0?T(C,O,C.next)>=0&&T(C,C.prev,O)>=0:T(C,O,C.prev)<0||T(C,C.next,O)<0}function N(C,O){var m=C,x=!1,w=(C.x+O.x)/2,I=(C.y+O.y)/2;do m.y>I!=m.next.y>I&&m.next.y!==m.y&&w<(m.next.x-m.x)*(I-m.y)/(m.next.y-m.y)+m.x&&(x=!x),m=m.next;while(m!==C);return x}function Y(C,O){var m=new Q(C.i,C.x,C.y),x=new Q(O.i,O.x,O.y),w=C.next,I=O.prev;return C.next=O,O.prev=C,m.next=w,w.prev=m,x.next=m,m.prev=x,I.next=x,x.prev=I,x}function D(C,O,m,x){var w=new Q(C,O,m);return x?(w.next=x.next,w.prev=x,x.next.prev=w,x.next=w):(w.prev=w,w.next=w),w}function Z(C){C.next.prev=C.prev,C.prev.next=C.next,C.prevZ&&(C.prevZ.nextZ=C.nextZ),C.nextZ&&(C.nextZ.prevZ=C.prevZ)}function Q(C,O,m){this.i=C,this.x=O,this.y=m,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(C,O,m,x){var w=O&&O.length,I=w?O[0]*m:C.length,S=Math.abs($(C,0,I,m));if(w)for(var A=0,L=O.length;A<L;A++){var B=O[A]*m,k=A<L-1?O[A+1]*m:C.length;S-=Math.abs($(C,B,k,m))}var U=0;for(A=0;A<x.length;A+=3){var V=x[A]*m,j=x[A+1]*m,z=x[A+2]*m;U+=Math.abs((C[V]-C[z])*(C[j+1]-C[V+1])-(C[V]-C[j])*(C[z+1]-C[V+1]))}return S===0&&U===0?0:Math.abs((U-S)/S)};function $(C,O,m,x){for(var w=0,I=O,S=m-x;I<m;I+=x)w+=(C[S]-C[I])*(C[I+1]+C[S+1]),S=I;return w}return i.flatten=function(C){for(var O=C[0][0].length,m={vertices:[],holes:[],dimensions:O},x=0,w=0;w<C.length;w++){for(var I=0;I<C[w].length;I++)for(var S=0;S<O;S++)m.vertices.push(C[w][I][S]);w>0&&(x+=C[w-1].length,m.holes.push(x))}return m},kn.exports}var fg=hg();const pu=Mi(fg);var br={},Qi={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var dg=Qi.exports,Gc;function pg(){return Gc||(Gc=1,(function(i,t){(function(e){var r=t&&!t.nodeType&&t,n=i&&!i.nodeType&&i,s=typeof _i=="object"&&_i;(s.global===s||s.window===s||s.self===s)&&(e=s);var o,a=2147483647,l=36,u=1,c=26,h=38,f=700,d=72,p=128,v="-",y=/^xn--/,g=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,T={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},R=l-u,_=Math.floor,F=String.fromCharCode,P;function H(w){throw new RangeError(T[w])}function M(w,I){for(var S=w.length,A=[];S--;)A[S]=I(w[S]);return A}function N(w,I){var S=w.split("@"),A="";S.length>1&&(A=S[0]+"@",w=S[1]),w=w.replace(E,".");var L=w.split("."),B=M(L,I).join(".");return A+B}function Y(w){for(var I=[],S=0,A=w.length,L,B;S<A;)L=w.charCodeAt(S++),L>=55296&&L<=56319&&S<A?(B=w.charCodeAt(S++),(B&64512)==56320?I.push(((L&1023)<<10)+(B&1023)+65536):(I.push(L),S--)):I.push(L);return I}function D(w){return M(w,function(I){var S="";return I>65535&&(I-=65536,S+=F(I>>>10&1023|55296),I=56320|I&1023),S+=F(I),S}).join("")}function Z(w){return w-48<10?w-22:w-65<26?w-65:w-97<26?w-97:l}function Q(w,I){return w+22+75*(w<26)-((I!=0)<<5)}function $(w,I,S){var A=0;for(w=S?_(w/f):w>>1,w+=_(w/I);w>R*c>>1;A+=l)w=_(w/R);return _(A+(R+1)*w/(w+h))}function C(w){var I=[],S=w.length,A,L=0,B=p,k=d,U,V,j,z,K,q,ie,ae,te;for(U=w.lastIndexOf(v),U<0&&(U=0),V=0;V<U;++V)w.charCodeAt(V)>=128&&H("not-basic"),I.push(w.charCodeAt(V));for(j=U>0?U+1:0;j<S;){for(z=L,K=1,q=l;j>=S&&H("invalid-input"),ie=Z(w.charCodeAt(j++)),(ie>=l||ie>_((a-L)/K))&&H("overflow"),L+=ie*K,ae=q<=k?u:q>=k+c?c:q-k,!(ie<ae);q+=l)te=l-ae,K>_(a/te)&&H("overflow"),K*=te;A=I.length+1,k=$(L-z,A,z==0),_(L/A)>a-B&&H("overflow"),B+=_(L/A),L%=A,I.splice(L++,0,B)}return D(I)}function O(w){var I,S,A,L,B,k,U,V,j,z,K,q=[],ie,ae,te,re;for(w=Y(w),ie=w.length,I=p,S=0,B=d,k=0;k<ie;++k)K=w[k],K<128&&q.push(F(K));for(A=L=q.length,L&&q.push(v);A<ie;){for(U=a,k=0;k<ie;++k)K=w[k],K>=I&&K<U&&(U=K);for(ae=A+1,U-I>_((a-S)/ae)&&H("overflow"),S+=(U-I)*ae,I=U,k=0;k<ie;++k)if(K=w[k],K<I&&++S>a&&H("overflow"),K==I){for(V=S,j=l;z=j<=B?u:j>=B+c?c:j-B,!(V<z);j+=l)re=V-z,te=l-z,q.push(F(Q(z+re%te,0))),V=_(re/te);q.push(F(Q(V,0))),B=$(S,ae,A==L),S=0,++A}++S,++I}return q.join("")}function m(w){return N(w,function(I){return y.test(I)?C(I.slice(4).toLowerCase()):I})}function x(w){return N(w,function(I){return g.test(I)?"xn--"+O(I):I})}if(o={version:"1.4.1",ucs2:{decode:Y,encode:D},decode:C,encode:O,toASCII:x,toUnicode:m},r&&n)if(i.exports==r)n.exports=o;else for(P in o)o.hasOwnProperty(P)&&(r[P]=o[P]);else e.punycode=o})(dg)})(Qi,Qi.exports)),Qi.exports}var So,Yc;function Li(){return Yc||(Yc=1,So=TypeError),So}const yg={},mg=Object.freeze(Object.defineProperty({__proto__:null,default:yg},Symbol.toStringTag,{value:"Module"})),vg=Zv(mg);var Co,zc;function Hs(){if(zc)return Co;zc=1;var i=typeof Map=="function"&&Map.prototype,t=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,e=i&&t&&typeof t.get=="function"?t.get:null,r=i&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=n&&s&&typeof s.get=="function"?s.get:null,a=n&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,u=l?WeakMap.prototype.has:null,c=typeof WeakSet=="function"&&WeakSet.prototype,h=c?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,d=f?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,v=Object.prototype.toString,y=Function.prototype.toString,g=String.prototype.match,E=String.prototype.slice,T=String.prototype.replace,R=String.prototype.toUpperCase,_=String.prototype.toLowerCase,F=RegExp.prototype.test,P=Array.prototype.concat,H=Array.prototype.join,M=Array.prototype.slice,N=Math.floor,Y=typeof BigInt=="function"?BigInt.prototype.valueOf:null,D=Object.getOwnPropertySymbols,Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Q=typeof Symbol=="function"&&typeof Symbol.iterator=="object",$=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Q||!0)?Symbol.toStringTag:null,C=Object.prototype.propertyIsEnumerable,O=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(X){return X.__proto__}:null);function m(X,G){if(X===1/0||X===-1/0||X!==X||X&&X>-1e3&&X<1e3||F.call(/e/,G))return G;var me=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof X=="number"){var Te=X<0?-N(-X):N(X);if(Te!==X){var Se=String(Te),ue=E.call(G,Se.length+1);return T.call(Se,me,"$&_")+"."+T.call(T.call(ue,/([0-9]{3})/g,"$&_"),/_$/,"")}}return T.call(G,me,"$&_")}var x=vg,w=x.custom,I=ae(w)?w:null,S={__proto__:null,double:'"',single:"'"},A={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};Co=function X(G,me,Te,Se){var ue=me||{};if(we(ue,"quoteStyle")&&!we(S,ue.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(we(ue,"maxStringLength")&&(typeof ue.maxStringLength=="number"?ue.maxStringLength<0&&ue.maxStringLength!==1/0:ue.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var tr=we(ue,"customInspect")?ue.customInspect:!0;if(typeof tr!="boolean"&&tr!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(we(ue,"indent")&&ue.indent!==null&&ue.indent!=="	"&&!(parseInt(ue.indent,10)===ue.indent&&ue.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(we(ue,"numericSeparator")&&typeof ue.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var gr=ue.numericSeparator;if(typeof G>"u")return"undefined";if(G===null)return"null";if(typeof G=="boolean")return G?"true":"false";if(typeof G=="string")return mc(G,ue);if(typeof G=="number"){if(G===0)return 1/0/G>0?"0":"-0";var ct=String(G);return gr?m(G,ct):ct}if(typeof G=="bigint"){var rr=String(G)+"n";return gr?m(G,rr):rr}var ho=typeof ue.depth>"u"?5:ue.depth;if(typeof Te>"u"&&(Te=0),Te>=ho&&ho>0&&typeof G=="object")return U(G)?"[Array]":"[Object]";var Jr=jv(ue,Te);if(typeof Se>"u")Se=[];else if(er(Se,G)>=0)return"[Circular]";function It(Qr,Nn,Kv){if(Nn&&(Se=M.call(Se),Se.push(Nn)),Kv){var Ec={depth:ue.depth};return we(ue,"quoteStyle")&&(Ec.quoteStyle=ue.quoteStyle),X(Qr,Ec,Te+1,Se)}return X(Qr,ue,Te+1,Se)}if(typeof G=="function"&&!j(G)){var gc=Pe(G),bc=Rn(G,It);return"[Function"+(gc?": "+gc:" (anonymous)")+"]"+(bc.length>0?" { "+H.call(bc,", ")+" }":"")}if(ae(G)){var _c=Q?T.call(String(G),/^(Symbol\(.*\))_[^)]*$/,"$1"):Z.call(G);return typeof G=="object"&&!Q?Gi(_c):_c}if($v(G)){for(var Yi="<"+_.call(String(G.nodeName)),fo=G.attributes||[],Ln=0;Ln<fo.length;Ln++)Yi+=" "+fo[Ln].name+"="+L(B(fo[Ln].value),"double",ue);return Yi+=">",G.childNodes&&G.childNodes.length&&(Yi+="..."),Yi+="</"+_.call(String(G.nodeName))+">",Yi}if(U(G)){if(G.length===0)return"[]";var po=Rn(G,It);return Jr&&!qv(po)?"["+co(po,Jr)+"]":"[ "+H.call(po,", ")+" ]"}if(z(G)){var yo=Rn(G,It);return!("cause"in Error.prototype)&&"cause"in G&&!C.call(G,"cause")?"{ ["+String(G)+"] "+H.call(P.call("[cause]: "+It(G.cause),yo),", ")+" }":yo.length===0?"["+String(G)+"]":"{ ["+String(G)+"] "+H.call(yo,", ")+" }"}if(typeof G=="object"&&tr){if(I&&typeof G[I]=="function"&&x)return x(G,{depth:ho-Te});if(tr!=="symbol"&&typeof G.inspect=="function")return G.inspect()}if(Tt(G)){var xc=[];return r&&r.call(G,function(Qr,Nn){xc.push(It(Nn,G,!0)+" => "+It(Qr,G))}),vc("Map",e.call(G),xc,Jr)}if(Zr(G)){var wc=[];return a&&a.call(G,function(Qr){wc.push(It(Qr,G))}),vc("Set",o.call(G),wc,Jr)}if(Wr(G))return uo("WeakMap");if(zv(G))return uo("WeakSet");if(Kr(G))return uo("WeakRef");if(q(G))return Gi(It(Number(G)));if(te(G))return Gi(It(Y.call(G)));if(ie(G))return Gi(p.call(G));if(K(G))return Gi(It(String(G)));if(typeof window<"u"&&G===window)return"{ [object Window] }";if(typeof globalThis<"u"&&G===globalThis||typeof _i<"u"&&G===_i)return"{ [object globalThis] }";if(!V(G)&&!j(G)){var mo=Rn(G,It),Tc=O?O(G)===Object.prototype:G instanceof Object||G.constructor===Object,vo=G instanceof Object?"":"null prototype",Ic=!Tc&&$&&Object(G)===G&&$ in G?E.call(xe(G),8,-1):vo?"Object":"",Wv=Tc||typeof G.constructor!="function"?"":G.constructor.name?G.constructor.name+" ":"",go=Wv+(Ic||vo?"["+H.call(P.call([],Ic||[],vo||[]),": ")+"] ":"");return mo.length===0?go+"{}":Jr?go+"{"+co(mo,Jr)+"}":go+"{ "+H.call(mo,", ")+" }"}return String(G)};function L(X,G,me){var Te=me.quoteStyle||G,Se=S[Te];return Se+X+Se}function B(X){return T.call(String(X),/"/g,"&quot;")}function k(X){return!$||!(typeof X=="object"&&($ in X||typeof X[$]<"u"))}function U(X){return xe(X)==="[object Array]"&&k(X)}function V(X){return xe(X)==="[object Date]"&&k(X)}function j(X){return xe(X)==="[object RegExp]"&&k(X)}function z(X){return xe(X)==="[object Error]"&&k(X)}function K(X){return xe(X)==="[object String]"&&k(X)}function q(X){return xe(X)==="[object Number]"&&k(X)}function ie(X){return xe(X)==="[object Boolean]"&&k(X)}function ae(X){if(Q)return X&&typeof X=="object"&&X instanceof Symbol;if(typeof X=="symbol")return!0;if(!X||typeof X!="object"||!Z)return!1;try{return Z.call(X),!0}catch{}return!1}function te(X){if(!X||typeof X!="object"||!Y)return!1;try{return Y.call(X),!0}catch{}return!1}var re=Object.prototype.hasOwnProperty||function(X){return X in this};function we(X,G){return re.call(X,G)}function xe(X){return v.call(X)}function Pe(X){if(X.name)return X.name;var G=g.call(y.call(X),/^function\s*([\w$]+)/);return G?G[1]:null}function er(X,G){if(X.indexOf)return X.indexOf(G);for(var me=0,Te=X.length;me<Te;me++)if(X[me]===G)return me;return-1}function Tt(X){if(!e||!X||typeof X!="object")return!1;try{e.call(X);try{o.call(X)}catch{return!0}return X instanceof Map}catch{}return!1}function Wr(X){if(!u||!X||typeof X!="object")return!1;try{u.call(X,u);try{h.call(X,h)}catch{return!0}return X instanceof WeakMap}catch{}return!1}function Kr(X){if(!d||!X||typeof X!="object")return!1;try{return d.call(X),!0}catch{}return!1}function Zr(X){if(!o||!X||typeof X!="object")return!1;try{o.call(X);try{e.call(X)}catch{return!0}return X instanceof Set}catch{}return!1}function zv(X){if(!h||!X||typeof X!="object")return!1;try{h.call(X,h);try{u.call(X,u)}catch{return!0}return X instanceof WeakSet}catch{}return!1}function $v(X){return!X||typeof X!="object"?!1:typeof HTMLElement<"u"&&X instanceof HTMLElement?!0:typeof X.nodeName=="string"&&typeof X.getAttribute=="function"}function mc(X,G){if(X.length>G.maxStringLength){var me=X.length-G.maxStringLength,Te="... "+me+" more character"+(me>1?"s":"");return mc(E.call(X,0,G.maxStringLength),G)+Te}var Se=A[G.quoteStyle||"single"];Se.lastIndex=0;var ue=T.call(T.call(X,Se,"\\$1"),/[\x00-\x1f]/g,Vv);return L(ue,"single",G)}function Vv(X){var G=X.charCodeAt(0),me={8:"b",9:"t",10:"n",12:"f",13:"r"}[G];return me?"\\"+me:"\\x"+(G<16?"0":"")+R.call(G.toString(16))}function Gi(X){return"Object("+X+")"}function uo(X){return X+" { ? }"}function vc(X,G,me,Te){var Se=Te?co(me,Te):H.call(me,", ");return X+" ("+G+") {"+Se+"}"}function qv(X){for(var G=0;G<X.length;G++)if(er(X[G],`
`)>=0)return!1;return!0}function jv(X,G){var me;if(X.indent==="	")me="	";else if(typeof X.indent=="number"&&X.indent>0)me=H.call(Array(X.indent+1)," ");else return null;return{base:me,prev:H.call(Array(G+1),me)}}function co(X,G){if(X.length===0)return"";var me=`
`+G.prev+G.base;return me+H.call(X,","+me)+`
`+G.prev}function Rn(X,G){var me=U(X),Te=[];if(me){Te.length=X.length;for(var Se=0;Se<X.length;Se++)Te[Se]=we(X,Se)?G(X[Se],X):""}var ue=typeof D=="function"?D(X):[],tr;if(Q){tr={};for(var gr=0;gr<ue.length;gr++)tr["$"+ue[gr]]=ue[gr]}for(var ct in X)we(X,ct)&&(me&&String(Number(ct))===ct&&ct<X.length||Q&&tr["$"+ct]instanceof Symbol||(F.call(/[^\w$]/,ct)?Te.push(G(ct,X)+": "+G(X[ct],X)):Te.push(ct+": "+G(X[ct],X))));if(typeof D=="function")for(var rr=0;rr<ue.length;rr++)C.call(X,ue[rr])&&Te.push("["+G(ue[rr])+"]: "+G(X[ue[rr]],X));return Te}return Co}var Ao,$c;function gg(){if($c)return Ao;$c=1;var i=Hs(),t=Li(),e=function(a,l,u){for(var c=a,h;(h=c.next)!=null;c=h)if(h.key===l)return c.next=h.next,u||(h.next=a.next,a.next=h),h},r=function(a,l){if(a){var u=e(a,l);return u&&u.value}},n=function(a,l,u){var c=e(a,l);c?c.value=u:a.next={key:l,next:a.next,value:u}},s=function(a,l){return a?!!e(a,l):!1},o=function(a,l){if(a)return e(a,l,!0)};return Ao=function(){var l,u={assert:function(c){if(!u.has(c))throw new t("Side channel does not contain "+i(c))},delete:function(c){var h=l&&l.next,f=o(l,c);return f&&h&&h===f&&(l=void 0),!!f},get:function(c){return r(l,c)},has:function(c){return s(l,c)},set:function(c,h){l||(l={next:void 0}),n(l,c,h)}};return u},Ao}var Po,Vc;function lp(){return Vc||(Vc=1,Po=Object),Po}var Oo,qc;function bg(){return qc||(qc=1,Oo=Error),Oo}var Fo,jc;function _g(){return jc||(jc=1,Fo=EvalError),Fo}var Mo,Wc;function xg(){return Wc||(Wc=1,Mo=RangeError),Mo}var Ro,Kc;function wg(){return Kc||(Kc=1,Ro=ReferenceError),Ro}var Lo,Zc;function Tg(){return Zc||(Zc=1,Lo=SyntaxError),Lo}var No,Jc;function Ig(){return Jc||(Jc=1,No=URIError),No}var Bo,Qc;function Eg(){return Qc||(Qc=1,Bo=Math.abs),Bo}var Do,eh;function Sg(){return eh||(eh=1,Do=Math.floor),Do}var ko,th;function Cg(){return th||(th=1,ko=Math.max),ko}var Uo,rh;function Ag(){return rh||(rh=1,Uo=Math.min),Uo}var Xo,ih;function Pg(){return ih||(ih=1,Xo=Math.pow),Xo}var Ho,nh;function Og(){return nh||(nh=1,Ho=Math.round),Ho}var Go,sh;function Fg(){return sh||(sh=1,Go=Number.isNaN||function(t){return t!==t}),Go}var Yo,oh;function Mg(){if(oh)return Yo;oh=1;var i=Fg();return Yo=function(e){return i(e)||e===0?e:e<0?-1:1},Yo}var zo,ah;function Rg(){return ah||(ah=1,zo=Object.getOwnPropertyDescriptor),zo}var $o,lh;function up(){if(lh)return $o;lh=1;var i=Rg();if(i)try{i([],"length")}catch{i=null}return $o=i,$o}var Vo,uh;function Lg(){if(uh)return Vo;uh=1;var i=Object.defineProperty||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return Vo=i,Vo}var qo,ch;function Ng(){return ch||(ch=1,qo=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},e=Symbol("test"),r=Object(e);if(typeof e=="string"||Object.prototype.toString.call(e)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;t[e]=n;for(var s in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var o=Object.getOwnPropertySymbols(t);if(o.length!==1||o[0]!==e||!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(t,e);if(a.value!==n||a.enumerable!==!0)return!1}return!0}),qo}var jo,hh;function Bg(){if(hh)return jo;hh=1;var i=typeof Symbol<"u"&&Symbol,t=Ng();return jo=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:t()},jo}var Wo,fh;function cp(){return fh||(fh=1,Wo=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Wo}var Ko,dh;function hp(){if(dh)return Ko;dh=1;var i=lp();return Ko=i.getPrototypeOf||null,Ko}var Zo,ph;function Dg(){if(ph)return Zo;ph=1;var i="Function.prototype.bind called on incompatible ",t=Object.prototype.toString,e=Math.max,r="[object Function]",n=function(l,u){for(var c=[],h=0;h<l.length;h+=1)c[h]=l[h];for(var f=0;f<u.length;f+=1)c[f+l.length]=u[f];return c},s=function(l,u){for(var c=[],h=u,f=0;h<l.length;h+=1,f+=1)c[f]=l[h];return c},o=function(a,l){for(var u="",c=0;c<a.length;c+=1)u+=a[c],c+1<a.length&&(u+=l);return u};return Zo=function(l){var u=this;if(typeof u!="function"||t.apply(u)!==r)throw new TypeError(i+u);for(var c=s(arguments,1),h,f=function(){if(this instanceof h){var g=u.apply(this,n(c,arguments));return Object(g)===g?g:this}return u.apply(l,n(c,arguments))},d=e(0,u.length-c.length),p=[],v=0;v<d;v++)p[v]="$"+v;if(h=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(f),u.prototype){var y=function(){};y.prototype=u.prototype,h.prototype=new y,y.prototype=null}return h},Zo}var Jo,yh;function Gs(){if(yh)return Jo;yh=1;var i=Dg();return Jo=Function.prototype.bind||i,Jo}var Qo,mh;function yu(){return mh||(mh=1,Qo=Function.prototype.call),Qo}var ea,vh;function fp(){return vh||(vh=1,ea=Function.prototype.apply),ea}var ta,gh;function kg(){return gh||(gh=1,ta=typeof Reflect<"u"&&Reflect&&Reflect.apply),ta}var ra,bh;function Ug(){if(bh)return ra;bh=1;var i=Gs(),t=fp(),e=yu(),r=kg();return ra=r||i.call(e,t),ra}var ia,_h;function dp(){if(_h)return ia;_h=1;var i=Gs(),t=Li(),e=yu(),r=Ug();return ia=function(s){if(s.length<1||typeof s[0]!="function")throw new t("a function is required");return r(i,e,s)},ia}var na,xh;function Xg(){if(xh)return na;xh=1;var i=dp(),t=up(),e;try{e=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!e&&t&&t(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return na=r&&typeof r.get=="function"?i([r.get]):typeof s=="function"?function(a){return s(a==null?a:n(a))}:!1,na}var sa,wh;function Hg(){if(wh)return sa;wh=1;var i=cp(),t=hp(),e=Xg();return sa=i?function(n){return i(n)}:t?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return t(n)}:e?function(n){return e(n)}:null,sa}var oa,Th;function Gg(){if(Th)return oa;Th=1;var i=Function.prototype.call,t=Object.prototype.hasOwnProperty,e=Gs();return oa=e.call(i,t),oa}var aa,Ih;function mu(){if(Ih)return aa;Ih=1;var i,t=lp(),e=bg(),r=_g(),n=xg(),s=wg(),o=Tg(),a=Li(),l=Ig(),u=Eg(),c=Sg(),h=Cg(),f=Ag(),d=Pg(),p=Og(),v=Mg(),y=Function,g=function(j){try{return y('"use strict"; return ('+j+").constructor;")()}catch{}},E=up(),T=Lg(),R=function(){throw new a},_=E?(function(){try{return arguments.callee,R}catch{try{return E(arguments,"callee").get}catch{return R}}})():R,F=Bg()(),P=Hg(),H=hp(),M=cp(),N=fp(),Y=yu(),D={},Z=typeof Uint8Array>"u"||!P?i:P(Uint8Array),Q={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":F&&P?P([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":D,"%AsyncGenerator%":D,"%AsyncGeneratorFunction%":D,"%AsyncIteratorPrototype%":D,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":e,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?i:Float16Array,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":y,"%GeneratorFunction%":D,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":F&&P?P(P([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!F||!P?i:P(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":t,"%Object.getOwnPropertyDescriptor%":E,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":n,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!F||!P?i:P(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":F&&P?P(""[Symbol.iterator]()):i,"%Symbol%":F?Symbol:i,"%SyntaxError%":o,"%ThrowTypeError%":_,"%TypedArray%":Z,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":l,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet,"%Function.prototype.call%":Y,"%Function.prototype.apply%":N,"%Object.defineProperty%":T,"%Object.getPrototypeOf%":H,"%Math.abs%":u,"%Math.floor%":c,"%Math.max%":h,"%Math.min%":f,"%Math.pow%":d,"%Math.round%":p,"%Math.sign%":v,"%Reflect.getPrototypeOf%":M};if(P)try{null.error}catch(j){var $=P(P(j));Q["%Error.prototype%"]=$}var C=function j(z){var K;if(z==="%AsyncFunction%")K=g("async function () {}");else if(z==="%GeneratorFunction%")K=g("function* () {}");else if(z==="%AsyncGeneratorFunction%")K=g("async function* () {}");else if(z==="%AsyncGenerator%"){var q=j("%AsyncGeneratorFunction%");q&&(K=q.prototype)}else if(z==="%AsyncIteratorPrototype%"){var ie=j("%AsyncGenerator%");ie&&P&&(K=P(ie.prototype))}return Q[z]=K,K},O={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},m=Gs(),x=Gg(),w=m.call(Y,Array.prototype.concat),I=m.call(N,Array.prototype.splice),S=m.call(Y,String.prototype.replace),A=m.call(Y,String.prototype.slice),L=m.call(Y,RegExp.prototype.exec),B=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k=/\\(\\)?/g,U=function(z){var K=A(z,0,1),q=A(z,-1);if(K==="%"&&q!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(q==="%"&&K!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var ie=[];return S(z,B,function(ae,te,re,we){ie[ie.length]=re?S(we,k,"$1"):te||ae}),ie},V=function(z,K){var q=z,ie;if(x(O,q)&&(ie=O[q],q="%"+ie[0]+"%"),x(Q,q)){var ae=Q[q];if(ae===D&&(ae=C(q)),typeof ae>"u"&&!K)throw new a("intrinsic "+z+" exists, but is not available. Please file an issue!");return{alias:ie,name:q,value:ae}}throw new o("intrinsic "+z+" does not exist!")};return aa=function(z,K){if(typeof z!="string"||z.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof K!="boolean")throw new a('"allowMissing" argument must be a boolean');if(L(/^%?[^%]*%?$/,z)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var q=U(z),ie=q.length>0?q[0]:"",ae=V("%"+ie+"%",K),te=ae.name,re=ae.value,we=!1,xe=ae.alias;xe&&(ie=xe[0],I(q,w([0,1],xe)));for(var Pe=1,er=!0;Pe<q.length;Pe+=1){var Tt=q[Pe],Wr=A(Tt,0,1),Kr=A(Tt,-1);if((Wr==='"'||Wr==="'"||Wr==="`"||Kr==='"'||Kr==="'"||Kr==="`")&&Wr!==Kr)throw new o("property names with quotes must have matching quotes");if((Tt==="constructor"||!er)&&(we=!0),ie+="."+Tt,te="%"+ie+"%",x(Q,te))re=Q[te];else if(re!=null){if(!(Tt in re)){if(!K)throw new a("base intrinsic for "+z+" exists, but the property is not available.");return}if(E&&Pe+1>=q.length){var Zr=E(re,Tt);er=!!Zr,er&&"get"in Zr&&!("originalValue"in Zr.get)?re=Zr.get:re=re[Tt]}else er=x(re,Tt),re=re[Tt];er&&!we&&(Q[te]=re)}}return re},aa}var la,Eh;function pp(){if(Eh)return la;Eh=1;var i=mu(),t=dp(),e=t([i("%String.prototype.indexOf%")]);return la=function(n,s){var o=i(n,!!s);return typeof o=="function"&&e(n,".prototype.")>-1?t([o]):o},la}var ua,Sh;function yp(){if(Sh)return ua;Sh=1;var i=mu(),t=pp(),e=Hs(),r=Li(),n=i("%Map%",!0),s=t("Map.prototype.get",!0),o=t("Map.prototype.set",!0),a=t("Map.prototype.has",!0),l=t("Map.prototype.delete",!0),u=t("Map.prototype.size",!0);return ua=!!n&&function(){var h,f={assert:function(d){if(!f.has(d))throw new r("Side channel does not contain "+e(d))},delete:function(d){if(h){var p=l(h,d);return u(h)===0&&(h=void 0),p}return!1},get:function(d){if(h)return s(h,d)},has:function(d){return h?a(h,d):!1},set:function(d,p){h||(h=new n),o(h,d,p)}};return f},ua}var ca,Ch;function Yg(){if(Ch)return ca;Ch=1;var i=mu(),t=pp(),e=Hs(),r=yp(),n=Li(),s=i("%WeakMap%",!0),o=t("WeakMap.prototype.get",!0),a=t("WeakMap.prototype.set",!0),l=t("WeakMap.prototype.has",!0),u=t("WeakMap.prototype.delete",!0);return ca=s?function(){var h,f,d={assert:function(p){if(!d.has(p))throw new n("Side channel does not contain "+e(p))},delete:function(p){if(s&&p&&(typeof p=="object"||typeof p=="function")){if(h)return u(h,p)}else if(r&&f)return f.delete(p);return!1},get:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?o(h,p):f&&f.get(p)},has:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&h?l(h,p):!!f&&f.has(p)},set:function(p,v){s&&p&&(typeof p=="object"||typeof p=="function")?(h||(h=new s),a(h,p,v)):r&&(f||(f=r()),f.set(p,v))}};return d}:r,ca}var ha,Ah;function zg(){if(Ah)return ha;Ah=1;var i=Li(),t=Hs(),e=gg(),r=yp(),n=Yg(),s=n||r||e;return ha=function(){var a,l={assert:function(u){if(!l.has(u))throw new i("Side channel does not contain "+t(u))},delete:function(u){return!!a&&a.delete(u)},get:function(u){return a&&a.get(u)},has:function(u){return!!a&&a.has(u)},set:function(u,c){a||(a=s()),a.set(u,c)}};return l},ha}var fa,Ph;function vu(){if(Ph)return fa;Ph=1;var i=String.prototype.replace,t=/%20/g,e={RFC1738:"RFC1738",RFC3986:"RFC3986"};return fa={default:e.RFC3986,formatters:{RFC1738:function(r){return i.call(r,t,"+")},RFC3986:function(r){return String(r)}},RFC1738:e.RFC1738,RFC3986:e.RFC3986},fa}var da,Oh;function mp(){if(Oh)return da;Oh=1;var i=vu(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r=(function(){for(var y=[],g=0;g<256;++g)y.push("%"+((g<16?"0":"")+g.toString(16)).toUpperCase());return y})(),n=function(g){for(;g.length>1;){var E=g.pop(),T=E.obj[E.prop];if(e(T)){for(var R=[],_=0;_<T.length;++_)typeof T[_]<"u"&&R.push(T[_]);E.obj[E.prop]=R}}},s=function(g,E){for(var T=E&&E.plainObjects?{__proto__:null}:{},R=0;R<g.length;++R)typeof g[R]<"u"&&(T[R]=g[R]);return T},o=function y(g,E,T){if(!E)return g;if(typeof E!="object"&&typeof E!="function"){if(e(g))g.push(E);else if(g&&typeof g=="object")(T&&(T.plainObjects||T.allowPrototypes)||!t.call(Object.prototype,E))&&(g[E]=!0);else return[g,E];return g}if(!g||typeof g!="object")return[g].concat(E);var R=g;return e(g)&&!e(E)&&(R=s(g,T)),e(g)&&e(E)?(E.forEach(function(_,F){if(t.call(g,F)){var P=g[F];P&&typeof P=="object"&&_&&typeof _=="object"?g[F]=y(P,_,T):g.push(_)}else g[F]=_}),g):Object.keys(E).reduce(function(_,F){var P=E[F];return t.call(_,F)?_[F]=y(_[F],P,T):_[F]=P,_},R)},a=function(g,E){return Object.keys(E).reduce(function(T,R){return T[R]=E[R],T},g)},l=function(y,g,E){var T=y.replace(/\+/g," ");if(E==="iso-8859-1")return T.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(T)}catch{return T}},u=1024,c=function(g,E,T,R,_){if(g.length===0)return g;var F=g;if(typeof g=="symbol"?F=Symbol.prototype.toString.call(g):typeof g!="string"&&(F=String(g)),T==="iso-8859-1")return escape(F).replace(/%u[0-9a-f]{4}/gi,function(Z){return"%26%23"+parseInt(Z.slice(2),16)+"%3B"});for(var P="",H=0;H<F.length;H+=u){for(var M=F.length>=u?F.slice(H,H+u):F,N=[],Y=0;Y<M.length;++Y){var D=M.charCodeAt(Y);if(D===45||D===46||D===95||D===126||D>=48&&D<=57||D>=65&&D<=90||D>=97&&D<=122||_===i.RFC1738&&(D===40||D===41)){N[N.length]=M.charAt(Y);continue}if(D<128){N[N.length]=r[D];continue}if(D<2048){N[N.length]=r[192|D>>6]+r[128|D&63];continue}if(D<55296||D>=57344){N[N.length]=r[224|D>>12]+r[128|D>>6&63]+r[128|D&63];continue}Y+=1,D=65536+((D&1023)<<10|M.charCodeAt(Y)&1023),N[N.length]=r[240|D>>18]+r[128|D>>12&63]+r[128|D>>6&63]+r[128|D&63]}P+=N.join("")}return P},h=function(g){for(var E=[{obj:{o:g},prop:"o"}],T=[],R=0;R<E.length;++R)for(var _=E[R],F=_.obj[_.prop],P=Object.keys(F),H=0;H<P.length;++H){var M=P[H],N=F[M];typeof N=="object"&&N!==null&&T.indexOf(N)===-1&&(E.push({obj:F,prop:M}),T.push(N))}return n(E),g},f=function(g){return Object.prototype.toString.call(g)==="[object RegExp]"},d=function(g){return!g||typeof g!="object"?!1:!!(g.constructor&&g.constructor.isBuffer&&g.constructor.isBuffer(g))},p=function(g,E){return[].concat(g,E)},v=function(g,E){if(e(g)){for(var T=[],R=0;R<g.length;R+=1)T.push(E(g[R]));return T}return E(g)};return da={arrayToObject:s,assign:a,combine:p,compact:h,decode:l,encode:c,isBuffer:d,isRegExp:f,maybeMap:v,merge:o},da}var pa,Fh;function $g(){if(Fh)return pa;Fh=1;var i=zg(),t=mp(),e=vu(),r=Object.prototype.hasOwnProperty,n={brackets:function(y){return y+"[]"},comma:"comma",indices:function(y,g){return y+"["+g+"]"},repeat:function(y){return y}},s=Array.isArray,o=Array.prototype.push,a=function(v,y){o.apply(v,s(y)?y:[y])},l=Date.prototype.toISOString,u=e.default,c={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:t.encode,encodeValuesOnly:!1,filter:void 0,format:u,formatter:e.formatters[u],indices:!1,serializeDate:function(y){return l.call(y)},skipNulls:!1,strictNullHandling:!1},h=function(y){return typeof y=="string"||typeof y=="number"||typeof y=="boolean"||typeof y=="symbol"||typeof y=="bigint"},f={},d=function v(y,g,E,T,R,_,F,P,H,M,N,Y,D,Z,Q,$,C,O){for(var m=y,x=O,w=0,I=!1;(x=x.get(f))!==void 0&&!I;){var S=x.get(y);if(w+=1,typeof S<"u"){if(S===w)throw new RangeError("Cyclic object value");I=!0}typeof x.get(f)>"u"&&(w=0)}if(typeof M=="function"?m=M(g,m):m instanceof Date?m=D(m):E==="comma"&&s(m)&&(m=t.maybeMap(m,function(te){return te instanceof Date?D(te):te})),m===null){if(_)return H&&!$?H(g,c.encoder,C,"key",Z):g;m=""}if(h(m)||t.isBuffer(m)){if(H){var A=$?g:H(g,c.encoder,C,"key",Z);return[Q(A)+"="+Q(H(m,c.encoder,C,"value",Z))]}return[Q(g)+"="+Q(String(m))]}var L=[];if(typeof m>"u")return L;var B;if(E==="comma"&&s(m))$&&H&&(m=t.maybeMap(m,H)),B=[{value:m.length>0?m.join(",")||null:void 0}];else if(s(M))B=M;else{var k=Object.keys(m);B=N?k.sort(N):k}var U=P?String(g).replace(/\./g,"%2E"):String(g),V=T&&s(m)&&m.length===1?U+"[]":U;if(R&&s(m)&&m.length===0)return V+"[]";for(var j=0;j<B.length;++j){var z=B[j],K=typeof z=="object"&&z&&typeof z.value<"u"?z.value:m[z];if(!(F&&K===null)){var q=Y&&P?String(z).replace(/\./g,"%2E"):String(z),ie=s(m)?typeof E=="function"?E(V,q):V:V+(Y?"."+q:"["+q+"]");O.set(y,w);var ae=i();ae.set(f,O),a(L,v(K,ie,E,T,R,_,F,P,E==="comma"&&$&&s(m)?null:H,M,N,Y,D,Z,Q,$,C,ae))}}return L},p=function(y){if(!y)return c;if(typeof y.allowEmptyArrays<"u"&&typeof y.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof y.encodeDotInKeys<"u"&&typeof y.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(y.encoder!==null&&typeof y.encoder<"u"&&typeof y.encoder!="function")throw new TypeError("Encoder has to be a function.");var g=y.charset||c.charset;if(typeof y.charset<"u"&&y.charset!=="utf-8"&&y.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var E=e.default;if(typeof y.format<"u"){if(!r.call(e.formatters,y.format))throw new TypeError("Unknown format option provided.");E=y.format}var T=e.formatters[E],R=c.filter;(typeof y.filter=="function"||s(y.filter))&&(R=y.filter);var _;if(y.arrayFormat in n?_=y.arrayFormat:"indices"in y?_=y.indices?"indices":"repeat":_=c.arrayFormat,"commaRoundTrip"in y&&typeof y.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var F=typeof y.allowDots>"u"?y.encodeDotInKeys===!0?!0:c.allowDots:!!y.allowDots;return{addQueryPrefix:typeof y.addQueryPrefix=="boolean"?y.addQueryPrefix:c.addQueryPrefix,allowDots:F,allowEmptyArrays:typeof y.allowEmptyArrays=="boolean"?!!y.allowEmptyArrays:c.allowEmptyArrays,arrayFormat:_,charset:g,charsetSentinel:typeof y.charsetSentinel=="boolean"?y.charsetSentinel:c.charsetSentinel,commaRoundTrip:!!y.commaRoundTrip,delimiter:typeof y.delimiter>"u"?c.delimiter:y.delimiter,encode:typeof y.encode=="boolean"?y.encode:c.encode,encodeDotInKeys:typeof y.encodeDotInKeys=="boolean"?y.encodeDotInKeys:c.encodeDotInKeys,encoder:typeof y.encoder=="function"?y.encoder:c.encoder,encodeValuesOnly:typeof y.encodeValuesOnly=="boolean"?y.encodeValuesOnly:c.encodeValuesOnly,filter:R,format:E,formatter:T,serializeDate:typeof y.serializeDate=="function"?y.serializeDate:c.serializeDate,skipNulls:typeof y.skipNulls=="boolean"?y.skipNulls:c.skipNulls,sort:typeof y.sort=="function"?y.sort:null,strictNullHandling:typeof y.strictNullHandling=="boolean"?y.strictNullHandling:c.strictNullHandling}};return pa=function(v,y){var g=v,E=p(y),T,R;typeof E.filter=="function"?(R=E.filter,g=R("",g)):s(E.filter)&&(R=E.filter,T=R);var _=[];if(typeof g!="object"||g===null)return"";var F=n[E.arrayFormat],P=F==="comma"&&E.commaRoundTrip;T||(T=Object.keys(g)),E.sort&&T.sort(E.sort);for(var H=i(),M=0;M<T.length;++M){var N=T[M],Y=g[N];E.skipNulls&&Y===null||a(_,d(Y,N,F,P,E.allowEmptyArrays,E.strictNullHandling,E.skipNulls,E.encodeDotInKeys,E.encode?E.encoder:null,E.filter,E.sort,E.allowDots,E.serializeDate,E.format,E.formatter,E.encodeValuesOnly,E.charset,H))}var D=_.join(E.delimiter),Z=E.addQueryPrefix===!0?"?":"";return E.charsetSentinel&&(E.charset==="iso-8859-1"?Z+="utf8=%26%2310003%3B&":Z+="utf8=%E2%9C%93&"),D.length>0?Z+D:""},pa}var ya,Mh;function Vg(){if(Mh)return ya;Mh=1;var i=mp(),t=Object.prototype.hasOwnProperty,e=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},n=function(f){return f.replace(/&#(\d+);/g,function(d,p){return String.fromCharCode(parseInt(p,10))})},s=function(f,d,p){if(f&&typeof f=="string"&&d.comma&&f.indexOf(",")>-1)return f.split(",");if(d.throwOnLimitExceeded&&p>=d.arrayLimit)throw new RangeError("Array limit exceeded. Only "+d.arrayLimit+" element"+(d.arrayLimit===1?"":"s")+" allowed in an array.");return f},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",l=function(d,p){var v={__proto__:null},y=p.ignoreQueryPrefix?d.replace(/^\?/,""):d;y=y.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var g=p.parameterLimit===1/0?void 0:p.parameterLimit,E=y.split(p.delimiter,p.throwOnLimitExceeded?g+1:g);if(p.throwOnLimitExceeded&&E.length>g)throw new RangeError("Parameter limit exceeded. Only "+g+" parameter"+(g===1?"":"s")+" allowed.");var T=-1,R,_=p.charset;if(p.charsetSentinel)for(R=0;R<E.length;++R)E[R].indexOf("utf8=")===0&&(E[R]===a?_="utf-8":E[R]===o&&(_="iso-8859-1"),T=R,R=E.length);for(R=0;R<E.length;++R)if(R!==T){var F=E[R],P=F.indexOf("]="),H=P===-1?F.indexOf("="):P+1,M,N;H===-1?(M=p.decoder(F,r.decoder,_,"key"),N=p.strictNullHandling?null:""):(M=p.decoder(F.slice(0,H),r.decoder,_,"key"),N=i.maybeMap(s(F.slice(H+1),p,e(v[M])?v[M].length:0),function(D){return p.decoder(D,r.decoder,_,"value")})),N&&p.interpretNumericEntities&&_==="iso-8859-1"&&(N=n(String(N))),F.indexOf("[]=")>-1&&(N=e(N)?[N]:N);var Y=t.call(v,M);Y&&p.duplicates==="combine"?v[M]=i.combine(v[M],N):(!Y||p.duplicates==="last")&&(v[M]=N)}return v},u=function(f,d,p,v){var y=0;if(f.length>0&&f[f.length-1]==="[]"){var g=f.slice(0,-1).join("");y=Array.isArray(d)&&d[g]?d[g].length:0}for(var E=v?d:s(d,p,y),T=f.length-1;T>=0;--T){var R,_=f[T];if(_==="[]"&&p.parseArrays)R=p.allowEmptyArrays&&(E===""||p.strictNullHandling&&E===null)?[]:i.combine([],E);else{R=p.plainObjects?{__proto__:null}:{};var F=_.charAt(0)==="["&&_.charAt(_.length-1)==="]"?_.slice(1,-1):_,P=p.decodeDotInKeys?F.replace(/%2E/g,"."):F,H=parseInt(P,10);!p.parseArrays&&P===""?R={0:E}:!isNaN(H)&&_!==P&&String(H)===P&&H>=0&&p.parseArrays&&H<=p.arrayLimit?(R=[],R[H]=E):P!=="__proto__"&&(R[P]=E)}E=R}return E},c=function(d,p,v,y){if(d){var g=v.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,E=/(\[[^[\]]*])/,T=/(\[[^[\]]*])/g,R=v.depth>0&&E.exec(g),_=R?g.slice(0,R.index):g,F=[];if(_){if(!v.plainObjects&&t.call(Object.prototype,_)&&!v.allowPrototypes)return;F.push(_)}for(var P=0;v.depth>0&&(R=T.exec(g))!==null&&P<v.depth;){if(P+=1,!v.plainObjects&&t.call(Object.prototype,R[1].slice(1,-1))&&!v.allowPrototypes)return;F.push(R[1])}if(R){if(v.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+v.depth+" and strictDepth is true");F.push("["+g.slice(R.index)+"]")}return u(F,p,v,y)}},h=function(d){if(!d)return r;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.decodeDotInKeys<"u"&&typeof d.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(d.decoder!==null&&typeof d.decoder<"u"&&typeof d.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof d.throwOnLimitExceeded<"u"&&typeof d.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var p=typeof d.charset>"u"?r.charset:d.charset,v=typeof d.duplicates>"u"?r.duplicates:d.duplicates;if(v!=="combine"&&v!=="first"&&v!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var y=typeof d.allowDots>"u"?d.decodeDotInKeys===!0?!0:r.allowDots:!!d.allowDots;return{allowDots:y,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof d.allowPrototypes=="boolean"?d.allowPrototypes:r.allowPrototypes,allowSparse:typeof d.allowSparse=="boolean"?d.allowSparse:r.allowSparse,arrayLimit:typeof d.arrayLimit=="number"?d.arrayLimit:r.arrayLimit,charset:p,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:r.charsetSentinel,comma:typeof d.comma=="boolean"?d.comma:r.comma,decodeDotInKeys:typeof d.decodeDotInKeys=="boolean"?d.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof d.decoder=="function"?d.decoder:r.decoder,delimiter:typeof d.delimiter=="string"||i.isRegExp(d.delimiter)?d.delimiter:r.delimiter,depth:typeof d.depth=="number"||d.depth===!1?+d.depth:r.depth,duplicates:v,ignoreQueryPrefix:d.ignoreQueryPrefix===!0,interpretNumericEntities:typeof d.interpretNumericEntities=="boolean"?d.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof d.parameterLimit=="number"?d.parameterLimit:r.parameterLimit,parseArrays:d.parseArrays!==!1,plainObjects:typeof d.plainObjects=="boolean"?d.plainObjects:r.plainObjects,strictDepth:typeof d.strictDepth=="boolean"?!!d.strictDepth:r.strictDepth,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof d.throwOnLimitExceeded=="boolean"?d.throwOnLimitExceeded:!1}};return ya=function(f,d){var p=h(d);if(f===""||f===null||typeof f>"u")return p.plainObjects?{__proto__:null}:{};for(var v=typeof f=="string"?l(f,p):f,y=p.plainObjects?{__proto__:null}:{},g=Object.keys(v),E=0;E<g.length;++E){var T=g[E],R=c(T,v[T],p,typeof f=="string");y=i.merge(y,R,p)}return p.allowSparse===!0?y:i.compact(y)},ya}var ma,Rh;function qg(){if(Rh)return ma;Rh=1;var i=$g(),t=Vg(),e=vu();return ma={formats:e,parse:t,stringify:i},ma}var Lh;function jg(){if(Lh)return br;Lh=1;var i=pg();function t(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var e=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,n=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),l=["%","/","?",";","#"].concat(a),u=["/","?","#"],c=255,h=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,d={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=qg();function g(_,F,P){if(_&&typeof _=="object"&&_ instanceof t)return _;var H=new t;return H.parse(_,F,P),H}t.prototype.parse=function(_,F,P){if(typeof _!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof _);var H=_.indexOf("?"),M=H!==-1&&H<_.indexOf("#")?"?":"#",N=_.split(M),Y=/\\/g;N[0]=N[0].replace(Y,"/"),_=N.join(M);var D=_;if(D=D.trim(),!P&&_.split("#").length===1){var Z=n.exec(D);if(Z)return this.path=D,this.href=D,this.pathname=Z[1],Z[2]?(this.search=Z[2],F?this.query=y.parse(this.search.substr(1)):this.query=this.search.substr(1)):F&&(this.search="",this.query={}),this}var Q=e.exec(D);if(Q){Q=Q[0];var $=Q.toLowerCase();this.protocol=$,D=D.substr(Q.length)}if(P||Q||D.match(/^\/\/[^@/]+@[^@/]+/)){var C=D.substr(0,2)==="//";C&&!(Q&&p[Q])&&(D=D.substr(2),this.slashes=!0)}if(!p[Q]&&(C||Q&&!v[Q])){for(var O=-1,m=0;m<u.length;m++){var x=D.indexOf(u[m]);x!==-1&&(O===-1||x<O)&&(O=x)}var w,I;O===-1?I=D.lastIndexOf("@"):I=D.lastIndexOf("@",O),I!==-1&&(w=D.slice(0,I),D=D.slice(I+1),this.auth=decodeURIComponent(w)),O=-1;for(var m=0;m<l.length;m++){var x=D.indexOf(l[m]);x!==-1&&(O===-1||x<O)&&(O=x)}O===-1&&(O=D.length),this.host=D.slice(0,O),D=D.slice(O),this.parseHost(),this.hostname=this.hostname||"";var S=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!S)for(var A=this.hostname.split(/\./),m=0,L=A.length;m<L;m++){var B=A[m];if(B&&!B.match(h)){for(var k="",U=0,V=B.length;U<V;U++)B.charCodeAt(U)>127?k+="x":k+=B[U];if(!k.match(h)){var j=A.slice(0,m),z=A.slice(m+1),K=B.match(f);K&&(j.push(K[1]),z.unshift(K[2])),z.length&&(D="/"+z.join(".")+D),this.hostname=j.join(".");break}}}this.hostname.length>c?this.hostname="":this.hostname=this.hostname.toLowerCase(),S||(this.hostname=i.toASCII(this.hostname));var q=this.port?":"+this.port:"",ie=this.hostname||"";this.host=ie+q,this.href+=this.host,S&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),D[0]!=="/"&&(D="/"+D))}if(!d[$])for(var m=0,L=a.length;m<L;m++){var ae=a[m];if(D.indexOf(ae)!==-1){var te=encodeURIComponent(ae);te===ae&&(te=escape(ae)),D=D.split(ae).join(te)}}var re=D.indexOf("#");re!==-1&&(this.hash=D.substr(re),D=D.slice(0,re));var we=D.indexOf("?");if(we!==-1?(this.search=D.substr(we),this.query=D.substr(we+1),F&&(this.query=y.parse(this.query)),D=D.slice(0,we)):F&&(this.search="",this.query={}),D&&(this.pathname=D),v[$]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var q=this.pathname||"",xe=this.search||"";this.path=q+xe}return this.href=this.format(),this};function E(_){return typeof _=="string"&&(_=g(_)),_ instanceof t?_.format():t.prototype.format.call(_)}t.prototype.format=function(){var _=this.auth||"";_&&(_=encodeURIComponent(_),_=_.replace(/%3A/i,":"),_+="@");var F=this.protocol||"",P=this.pathname||"",H=this.hash||"",M=!1,N="";this.host?M=_+this.host:this.hostname&&(M=_+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(M+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(N=y.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var Y=this.search||N&&"?"+N||"";return F&&F.substr(-1)!==":"&&(F+=":"),this.slashes||(!F||v[F])&&M!==!1?(M="//"+(M||""),P&&P.charAt(0)!=="/"&&(P="/"+P)):M||(M=""),H&&H.charAt(0)!=="#"&&(H="#"+H),Y&&Y.charAt(0)!=="?"&&(Y="?"+Y),P=P.replace(/[?#]/g,function(D){return encodeURIComponent(D)}),Y=Y.replace("#","%23"),F+M+P+Y+H};function T(_,F){return g(_,!1,!0).resolve(F)}t.prototype.resolve=function(_){return this.resolveObject(g(_,!1,!0)).format()};function R(_,F){return _?g(_,!1,!0).resolveObject(F):F}return t.prototype.resolveObject=function(_){if(typeof _=="string"){var F=new t;F.parse(_,!1,!0),_=F}for(var P=new t,H=Object.keys(this),M=0;M<H.length;M++){var N=H[M];P[N]=this[N]}if(P.hash=_.hash,_.href==="")return P.href=P.format(),P;if(_.slashes&&!_.protocol){for(var Y=Object.keys(_),D=0;D<Y.length;D++){var Z=Y[D];Z!=="protocol"&&(P[Z]=_[Z])}return v[P.protocol]&&P.hostname&&!P.pathname&&(P.pathname="/",P.path=P.pathname),P.href=P.format(),P}if(_.protocol&&_.protocol!==P.protocol){if(!v[_.protocol]){for(var Q=Object.keys(_),$=0;$<Q.length;$++){var C=Q[$];P[C]=_[C]}return P.href=P.format(),P}if(P.protocol=_.protocol,!_.host&&!p[_.protocol]){for(var L=(_.pathname||"").split("/");L.length&&!(_.host=L.shift()););_.host||(_.host=""),_.hostname||(_.hostname=""),L[0]!==""&&L.unshift(""),L.length<2&&L.unshift(""),P.pathname=L.join("/")}else P.pathname=_.pathname;if(P.search=_.search,P.query=_.query,P.host=_.host||"",P.auth=_.auth,P.hostname=_.hostname||_.host,P.port=_.port,P.pathname||P.search){var O=P.pathname||"",m=P.search||"";P.path=O+m}return P.slashes=P.slashes||_.slashes,P.href=P.format(),P}var x=P.pathname&&P.pathname.charAt(0)==="/",w=_.host||_.pathname&&_.pathname.charAt(0)==="/",I=w||x||P.host&&_.pathname,S=I,A=P.pathname&&P.pathname.split("/")||[],L=_.pathname&&_.pathname.split("/")||[],B=P.protocol&&!v[P.protocol];if(B&&(P.hostname="",P.port=null,P.host&&(A[0]===""?A[0]=P.host:A.unshift(P.host)),P.host="",_.protocol&&(_.hostname=null,_.port=null,_.host&&(L[0]===""?L[0]=_.host:L.unshift(_.host)),_.host=null),I=I&&(L[0]===""||A[0]==="")),w)P.host=_.host||_.host===""?_.host:P.host,P.hostname=_.hostname||_.hostname===""?_.hostname:P.hostname,P.search=_.search,P.query=_.query,A=L;else if(L.length)A||(A=[]),A.pop(),A=A.concat(L),P.search=_.search,P.query=_.query;else if(_.search!=null){if(B){P.host=A.shift(),P.hostname=P.host;var k=P.host&&P.host.indexOf("@")>0?P.host.split("@"):!1;k&&(P.auth=k.shift(),P.hostname=k.shift(),P.host=P.hostname)}return P.search=_.search,P.query=_.query,(P.pathname!==null||P.search!==null)&&(P.path=(P.pathname?P.pathname:"")+(P.search?P.search:"")),P.href=P.format(),P}if(!A.length)return P.pathname=null,P.search?P.path="/"+P.search:P.path=null,P.href=P.format(),P;for(var U=A.slice(-1)[0],V=(P.host||_.host||A.length>1)&&(U==="."||U==="..")||U==="",j=0,z=A.length;z>=0;z--)U=A[z],U==="."?A.splice(z,1):U===".."?(A.splice(z,1),j++):j&&(A.splice(z,1),j--);if(!I&&!S)for(;j--;j)A.unshift("..");I&&A[0]!==""&&(!A[0]||A[0].charAt(0)!=="/")&&A.unshift(""),V&&A.join("/").substr(-1)!=="/"&&A.push("");var K=A[0]===""||A[0]&&A[0].charAt(0)==="/";if(B){P.hostname=K?"":A.length?A.shift():"",P.host=P.hostname;var k=P.host&&P.host.indexOf("@")>0?P.host.split("@"):!1;k&&(P.auth=k.shift(),P.hostname=k.shift(),P.host=P.hostname)}return I=I||P.host&&A.length,I&&!K&&A.unshift(""),A.length>0?P.pathname=A.join("/"):(P.pathname=null,P.path=null),(P.pathname!==null||P.search!==null)&&(P.path=(P.pathname?P.pathname:"")+(P.search?P.search:"")),P.auth=_.auth||P.auth,P.slashes=P.slashes||_.slashes,P.href=P.format(),P},t.prototype.parseHost=function(){var _=this.host,F=r.exec(_);F&&(F=F[0],F!==":"&&(this.port=F.substr(1)),_=_.substr(0,_.length-F.length)),_&&(this.hostname=_)},br.parse=g,br.resolve=T,br.resolveObject=R,br.format=E,br.Url=t,br}var vp=jg();const gp=Mi(vp);/*!
 * @pixi/constants - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Nt;(function(i){i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2"})(Nt||(Nt={}));var xi;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS"})(xi||(xi={}));var hn;(function(i){i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL"})(hn||(hn={}));var se;(function(i){i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR"})(se||(se={}));var ft;(function(i){i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(ft||(ft={}));var wi;(function(i){i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(wi||(wi={}));var hr;(function(i){i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(hr||(hr={}));var De;(function(i){i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.FLOAT=5126]="FLOAT",i[i.HALF_FLOAT=36193]="HALF_FLOAT"})(De||(De={}));var Ct;(function(i){i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR"})(Ct||(Ct={}));var Rt;(function(i){i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(Rt||(Rt={}));var Ti;(function(i){i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON"})(Ti||(Ti={}));var qt;(function(i){i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"})(qt||(qt={}));var Et;(function(i){i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT"})(Et||(Et={}));var As;(function(i){i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL"})(As||(As={}));var At;(function(i){i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp"})(At||(At={}));var it;(function(i){i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE"})(it||(it={}));var Br;(function(i){i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH"})(Br||(Br={}));/*!
 * @pixi/utils - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/utils is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */ne.RETINA_PREFIX=/@([0-9\.]+)x/;ne.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var nl=!1,Nh="5.3.12";function Wg(){nl=!0}function bp(i){var t;if(!nl){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var e=[`
 %c %c %c PixiJS `+Nh+" -  "+i+`   %c  %c  http://www.pixijs.com/  %c %c %c%c 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(t=window.console).log.apply(t,e)}else window.console&&window.console.log("PixiJS "+Nh+" - "+i+" - http://www.pixijs.com/");nl=!0}}var va;function _p(){return typeof va>"u"&&(va=(function(){var t={stencil:!0,failIfMajorPerformanceCaveat:ne.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var e=document.createElement("canvas"),r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t),n=!!(r&&r.getContextAttributes().stencil);if(r){var s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,n}catch{return!1}})()),va}function Dr(i,t){return t===void 0&&(t=[]),t[0]=(i>>16&255)/255,t[1]=(i>>8&255)/255,t[2]=(i&255)/255,t}function gu(i){var t=i.toString(16);return t="000000".substr(0,6-t.length)+t,"#"+t}function bu(i){return typeof i=="string"&&i[0]==="#"&&(i=i.substr(1)),parseInt(i,16)}function Kg(i){return(i[0]*255<<16)+(i[1]*255<<8)+(i[2]*255|0)}function Zg(){for(var i=[],t=[],e=0;e<32;e++)i[e]=e,t[e]=e;i[se.NORMAL_NPM]=se.NORMAL,i[se.ADD_NPM]=se.ADD,i[se.SCREEN_NPM]=se.SCREEN,t[se.NORMAL]=se.NORMAL_NPM,t[se.ADD]=se.ADD_NPM,t[se.SCREEN]=se.SCREEN_NPM;var r=[];return r.push(t),r.push(i),r}var _u=Zg();function xu(i,t){return _u[t?1:0][i]}function xp(i,t,e,r){return e=e||new Float32Array(4),r||r===void 0?(e[0]=i[0]*t,e[1]=i[1]*t,e[2]=i[2]*t):(e[0]=i[0],e[1]=i[1],e[2]=i[2]),e[3]=t,e}function Ys(i,t){if(t===1)return(t*255<<24)+i;if(t===0)return 0;var e=i>>16&255,r=i>>8&255,n=i&255;return e=e*t+.5|0,r=r*t+.5|0,n=n*t+.5|0,(t*255<<24)+(e<<16)+(r<<8)+n}function wu(i,t,e,r){return e=e||new Float32Array(4),e[0]=(i>>16&255)/255,e[1]=(i>>8&255)/255,e[2]=(i&255)/255,(r||r===void 0)&&(e[0]*=t,e[1]*=t,e[2]*=t),e[3]=t,e}function Tu(i,t){t===void 0&&(t=null);var e=i*6;if(t=t||new Uint16Array(e),t.length!==e)throw new Error("Out buffer length is incorrect, got "+t.length+" and expected "+e);for(var r=0,n=0;r<e;r+=6,n+=4)t[r+0]=n+0,t[r+1]=n+1,t[r+2]=n+2,t[r+3]=n+0,t[r+4]=n+2,t[r+5]=n+3;return t}function wp(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}var Jg={Float32Array,Uint32Array,Int32Array,Uint8Array};function Qg(i,t){for(var e=0,r=0,n={},s=0;s<i.length;s++)r+=t[s],e+=i[s].length;for(var o=new ArrayBuffer(e*4),a=null,l=0,s=0;s<i.length;s++){var u=t[s],c=i[s],h=wp(c);n[h]||(n[h]=new Jg[h](o)),a=n[h];for(var f=0;f<c.length;f++){var d=(f/u|0)*r+l,p=f%u;a[d+p]=c[f]}l+=u}return new Float32Array(o)}function fn(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function sl(i){return!(i&i-1)&&!!i}function ol(i){var t=(i>65535?1:0)<<4;i>>>=t;var e=(i>255?1:0)<<3;return i>>>=e,t|=e,e=(i>15?1:0)<<2,i>>>=e,t|=e,e=(i>3?1:0)<<1,i>>>=e,t|=e,t|i>>1}function Nr(i,t,e){var r=i.length,n;if(!(t>=r||e===0)){e=t+e>r?r-t:e;var s=r-e;for(n=t;n<s;++n)i[n]=i[n+e];i.length=s}}function Rr(i){return i===0?0:i<0?-1:1}var e0=0;function kr(){return++e0}var Bh={};function W(i,t,e){if(e===void 0&&(e=3),!Bh[t]){var r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+i):(r=r.split(`
`).splice(e).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t+`
Deprecated since v`+i),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",t+`
Deprecated since v`+i),console.warn(r))),Bh[t]=!0}}var al={},nt=Object.create(null),gt=Object.create(null);function t0(){var i;for(i in nt)nt[i].destroy();for(i in gt)gt[i].destroy()}function r0(){var i;for(i in nt)delete nt[i];for(i in gt)delete gt[i]}var ll=(function(){function i(t,e,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||ne.RESOLUTION,this.resize(t,e)}return i.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.resize=function(t,e){this.canvas.width=t*this.resolution,this.canvas.height=e*this.resolution},i.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(i.prototype,"width",{get:function(){return this.canvas.width},set:function(t){this.canvas.width=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.canvas.height},set:function(t){this.canvas.height=t},enumerable:!1,configurable:!0}),i})();function Tp(i){var t=i.width,e=i.height,r=i.getContext("2d"),n=r.getImageData(0,0,t,e),s=n.data,o=s.length,a={top:null,left:null,right:null,bottom:null},l=null,u,c,h;for(u=0;u<o;u+=4)s[u+3]!==0&&(c=u/4%t,h=~~(u/4/t),a.top===null&&(a.top=h),(a.left===null||c<a.left)&&(a.left=c),(a.right===null||a.right<c)&&(a.right=c+1),(a.bottom===null||a.bottom<h)&&(a.bottom=h));return a.top!==null&&(t=a.right-a.left,e=a.bottom-a.top+1,l=r.getImageData(a.left,a.top,t,e)),{height:e,width:t,data:l}}var Ip=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function i0(i){var t=Ip.exec(i);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}}var Un;function Ep(i,t){if(t===void 0&&(t=window.location),i.indexOf("data:")===0)return"";t=t||window.location,Un||(Un=document.createElement("a")),Un.href=i;var e=vp.parse(Un.href),r=!e.port&&t.port===""||e.port===t.port;return e.hostname!==t.hostname||!r||e.protocol!==t.protocol?"anonymous":""}function dn(i,t){var e=ne.RETINA_PREFIX.exec(i);return e?parseFloat(e[1]):t!==void 0?t:1}const n0=Object.freeze(Object.defineProperty({__proto__:null,BaseTextureCache:gt,CanvasRenderTarget:ll,DATA_URI:Ip,EventEmitter:Ri,ProgramCache:al,TextureCache:nt,clearTextureCache:r0,correctBlendMode:xu,createIndicesForQuads:Tu,decomposeDataUri:i0,deprecation:W,destroyTextureCache:t0,determineCrossOrigin:Ep,earcut:pu,getBufferType:wp,getResolutionOfUrl:dn,hex2rgb:Dr,hex2string:gu,interleaveTypedArrays:Qg,isMobile:_t,isPow2:sl,isWebGLSupported:_p,log2:ol,nextPow2:fn,premultiplyBlendMode:_u,premultiplyRgba:xp,premultiplyTint:Ys,premultiplyTintToRgba:wu,removeItems:Nr,rgb2hex:Kg,sayHello:bp,sign:Rr,skipHello:Wg,string2hex:bu,trimCanvas:Tp,uid:kr,url:gp},Symbol.toStringTag,{value:"Module"}));/*!
 * @pixi/math - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/math is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Ii=Math.PI*2,Sp=180/Math.PI,Cp=Math.PI/180,Re;(function(i){i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC"})(Re||(Re={}));var ge=(function(){function i(t,e,r,n){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=Number(t),this.y=Number(e),this.width=Number(r),this.height=Number(n),this.type=Re.RECT}return Object.defineProperty(i.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(i,"EMPTY",{get:function(){return new i(0,0,0,0)},enumerable:!1,configurable:!0}),i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},i.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t},i.prototype.contains=function(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height},i.prototype.pad=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this},i.prototype.fit=function(t){var e=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),s=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(r-e,0),this.y=n,this.height=Math.max(s-n,0),this},i.prototype.ceil=function(t,e){t===void 0&&(t=1),e===void 0&&(e=.001);var r=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=r-this.x,this.height=n-this.y,this},i.prototype.enlarge=function(t){var e=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),s=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=r-e,this.y=n,this.height=s-n,this},i})(),Ap=(function(){function i(t,e,r){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),this.x=t,this.y=e,this.radius=r,this.type=Re.CIRC}return i.prototype.clone=function(){return new i(this.x,this.y,this.radius)},i.prototype.contains=function(t,e){if(this.radius<=0)return!1;var r=this.radius*this.radius,n=this.x-t,s=this.y-e;return n*=n,s*=s,n+s<=r},i.prototype.getBounds=function(){return new ge(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},i})(),Pp=(function(){function i(t,e,r,n){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=t,this.y=e,this.width=r,this.height=n,this.type=Re.ELIP}return i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;var r=(t-this.x)/this.width,n=(e-this.y)/this.height;return r*=r,n*=n,r+n<=1},i.prototype.getBounds=function(){return new ge(this.x-this.width,this.y-this.height,this.width,this.height)},i})(),mi=(function(){function i(){for(var t=arguments,e=[],r=0;r<arguments.length;r++)e[r]=t[r];var n=Array.isArray(e[0])?e[0]:e;if(typeof n[0]!="number"){for(var s=[],o=0,a=n.length;o<a;o++)s.push(n[o].x,n[o].y);n=s}this.points=n,this.type=Re.POLY,this.closeStroke=!0}return i.prototype.clone=function(){var t=this.points.slice(),e=new i(t);return e.closeStroke=this.closeStroke,e},i.prototype.contains=function(t,e){for(var r=!1,n=this.points.length/2,s=0,o=n-1;s<n;o=s++){var a=this.points[s*2],l=this.points[s*2+1],u=this.points[o*2],c=this.points[o*2+1],h=l>e!=c>e&&t<(u-a)*((e-l)/(c-l))+a;h&&(r=!r)}return r},i})(),Op=(function(){function i(t,e,r,n,s){t===void 0&&(t=0),e===void 0&&(e=0),r===void 0&&(r=0),n===void 0&&(n=0),s===void 0&&(s=20),this.x=t,this.y=e,this.width=r,this.height=n,this.radius=s,this.type=Re.RREC}return i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.radius)},i.prototype.contains=function(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){if(e>=this.y+this.radius&&e<=this.y+this.height-this.radius||t>=this.x+this.radius&&t<=this.x+this.width-this.radius)return!0;var r=t-(this.x+this.radius),n=e-(this.y+this.radius),s=this.radius*this.radius;if(r*r+n*n<=s||(r=t-(this.x+this.width-this.radius),r*r+n*n<=s)||(n=e-(this.y+this.height-this.radius),r*r+n*n<=s)||(r=t-(this.x+this.radius),r*r+n*n<=s))return!0}return!1},i})(),ze=(function(){function i(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this.x=t,this.y=e}return i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.copyFrom=function(t){return this.set(t.x,t.y),this},i.prototype.copyTo=function(t){return t.set(this.x,this.y),t},i.prototype.equals=function(t){return t.x===this.x&&t.y===this.y},i.prototype.set=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x=t,this.y=e,this},i})(),Lr=(function(){function i(t,e,r,n){r===void 0&&(r=0),n===void 0&&(n=0),this._x=r,this._y=n,this.cb=t,this.scope=e}return i.prototype.clone=function(t,e){return t===void 0&&(t=this.cb),e===void 0&&(e=this.scope),new i(t,e,this._x,this._y)},i.prototype.set=function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this.cb.call(this.scope)),this},i.prototype.copyFrom=function(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this},i.prototype.copyTo=function(t){return t.set(this._x,this._y),t},i.prototype.equals=function(t){return t.x===this._x&&t.y===this._y},Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),i})(),Le=(function(){function i(t,e,r,n,s,o){t===void 0&&(t=1),e===void 0&&(e=0),r===void 0&&(r=0),n===void 0&&(n=1),s===void 0&&(s=0),o===void 0&&(o=0),this.array=null,this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=o}return i.prototype.fromArray=function(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]},i.prototype.set=function(t,e,r,n,s,o){return this.a=t,this.b=e,this.c=r,this.d=n,this.tx=s,this.ty=o,this},i.prototype.toArray=function(t,e){this.array||(this.array=new Float32Array(9));var r=e||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},i.prototype.apply=function(t,e){e=e||new ze;var r=t.x,n=t.y;return e.x=this.a*r+this.c*n+this.tx,e.y=this.b*r+this.d*n+this.ty,e},i.prototype.applyInverse=function(t,e){e=e||new ze;var r=1/(this.a*this.d+this.c*-this.b),n=t.x,s=t.y;return e.x=this.d*r*n+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,e.y=this.a*r*s+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,e},i.prototype.translate=function(t,e){return this.tx+=t,this.ty+=e,this},i.prototype.scale=function(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this},i.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=this.a,s=this.c,o=this.tx;return this.a=n*e-this.b*r,this.b=n*r+this.b*e,this.c=s*e-this.d*r,this.d=s*r+this.d*e,this.tx=o*e-this.ty*r,this.ty=o*r+this.ty*e,this},i.prototype.append=function(t){var e=this.a,r=this.b,n=this.c,s=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*r+t.b*s,this.c=t.c*e+t.d*n,this.d=t.c*r+t.d*s,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*r+t.ty*s+this.ty,this},i.prototype.setTransform=function(t,e,r,n,s,o,a,l,u){return this.a=Math.cos(a+u)*s,this.b=Math.sin(a+u)*s,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(r*this.a+n*this.c),this.ty=e-(r*this.b+n*this.d),this},i.prototype.prepend=function(t){var e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){var r=this.a,n=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this},i.prototype.decompose=function(t){var e=this.a,r=this.b,n=this.c,s=this.d,o=-Math.atan2(-n,s),a=Math.atan2(r,e),l=Math.abs(o+a);return l<1e-5||Math.abs(Ii-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+r*r),t.scale.y=Math.sqrt(n*n+s*s),t.position.x=this.tx,t.position.y=this.ty,t},i.prototype.invert=function(){var t=this.a,e=this.b,r=this.c,n=this.d,s=this.tx,o=t*n-e*r;return this.a=n/o,this.b=-e/o,this.c=-r/o,this.d=t/o,this.tx=(r*this.ty-n*s)/o,this.ty=-(t*this.ty-e*s)/o,this},i.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},i.prototype.clone=function(){var t=new i;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},i.prototype.copyTo=function(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t},i.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},Object.defineProperty(i,"IDENTITY",{get:function(){return new i},enumerable:!1,configurable:!0}),Object.defineProperty(i,"TEMP_MATRIX",{get:function(){return new i},enumerable:!1,configurable:!0}),i})(),Tr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Ir=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Er=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Sr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],ul=[],Fp=[],Xn=Math.sign;function s0(){for(var i=0;i<16;i++){var t=[];ul.push(t);for(var e=0;e<16;e++)for(var r=Xn(Tr[i]*Tr[e]+Er[i]*Ir[e]),n=Xn(Ir[i]*Tr[e]+Sr[i]*Ir[e]),s=Xn(Tr[i]*Er[e]+Er[i]*Sr[e]),o=Xn(Ir[i]*Er[e]+Sr[i]*Sr[e]),a=0;a<16;a++)if(Tr[a]===r&&Ir[a]===n&&Er[a]===s&&Sr[a]===o){t.push(a);break}}for(var i=0;i<16;i++){var l=new Le;l.set(Tr[i],Ir[i],Er[i],Sr[i],0,0),Fp.push(l)}}s0();var Fe={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(i){return Tr[i]},uY:function(i){return Ir[i]},vX:function(i){return Er[i]},vY:function(i){return Sr[i]},inv:function(i){return i&8?i&15:-i&7},add:function(i,t){return ul[i][t]},sub:function(i,t){return ul[i][Fe.inv(t)]},rotate180:function(i){return i^4},isVertical:function(i){return(i&3)===2},byDirection:function(i,t){return Math.abs(i)*2<=Math.abs(t)?t>=0?Fe.S:Fe.N:Math.abs(t)*2<=Math.abs(i)?i>0?Fe.E:Fe.W:t>0?i>0?Fe.SE:Fe.SW:i>0?Fe.NE:Fe.NW},matrixAppendRotationInv:function(i,t,e,r){e===void 0&&(e=0),r===void 0&&(r=0);var n=Fp[Fe.inv(t)];n.tx=e,n.ty=r,i.append(n)}},Iu=(function(){function i(){this.worldTransform=new Le,this.localTransform=new Le,this.position=new Lr(this.onChange,this,0,0),this.scale=new Lr(this.onChange,this,1,1),this.pivot=new Lr(this.onChange,this,0,0),this.skew=new Lr(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return i.prototype.onChange=function(){this._localID++},i.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},i.prototype.updateLocalTransform=function(){var t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)},i.prototype.updateTransform=function(t){var e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){var r=t.worldTransform,n=this.worldTransform;n.a=e.a*r.a+e.b*r.c,n.b=e.a*r.b+e.b*r.d,n.c=e.c*r.a+e.d*r.c,n.d=e.c*r.b+e.d*r.d,n.tx=e.tx*r.a+e.ty*r.c+r.tx,n.ty=e.tx*r.b+e.ty*r.d+r.ty,this._parentID=t._worldID,this._worldID++}},i.prototype.setFromMatrix=function(t){t.decompose(this),this._localID++},Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())},enumerable:!1,configurable:!0}),i.IDENTITY=new i,i})();/*!
 * @pixi/display - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/display is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */ne.SORTABLE_CHILDREN=!1;var pn=(function(){function i(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return i.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},i.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},i.prototype.getRectangle=function(t){return this.minX>this.maxX||this.minY>this.maxY?ge.EMPTY:(t=t||new ge(0,0,1,1),t.x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)},i.prototype.addPoint=function(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)},i.prototype.addQuad=function(t){var e=this.minX,r=this.minY,n=this.maxX,s=this.maxY,o=t[0],a=t[1];e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[2],a=t[3],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[4],a=t[5],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=t[6],a=t[7],e=o<e?o:e,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,this.minX=e,this.minY=r,this.maxX=n,this.maxY=s},i.prototype.addFrame=function(t,e,r,n,s){this.addFrameMatrix(t.worldTransform,e,r,n,s)},i.prototype.addFrameMatrix=function(t,e,r,n,s){var o=t.a,a=t.b,l=t.c,u=t.d,c=t.tx,h=t.ty,f=this.minX,d=this.minY,p=this.maxX,v=this.maxY,y=o*e+l*r+c,g=a*e+u*r+h;f=y<f?y:f,d=g<d?g:d,p=y>p?y:p,v=g>v?g:v,y=o*n+l*r+c,g=a*n+u*r+h,f=y<f?y:f,d=g<d?g:d,p=y>p?y:p,v=g>v?g:v,y=o*e+l*s+c,g=a*e+u*s+h,f=y<f?y:f,d=g<d?g:d,p=y>p?y:p,v=g>v?g:v,y=o*n+l*s+c,g=a*n+u*s+h,f=y<f?y:f,d=g<d?g:d,p=y>p?y:p,v=g>v?g:v,this.minX=f,this.minY=d,this.maxX=p,this.maxY=v},i.prototype.addVertexData=function(t,e,r){for(var n=this.minX,s=this.minY,o=this.maxX,a=this.maxY,l=e;l<r;l+=2){var u=t[l],c=t[l+1];n=u<n?u:n,s=c<s?c:s,o=u>o?u:o,a=c>a?c:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a},i.prototype.addVertices=function(t,e,r,n){this.addVerticesMatrix(t.worldTransform,e,r,n)},i.prototype.addVerticesMatrix=function(t,e,r,n,s,o){s===void 0&&(s=0),o===void 0&&(o=s);for(var a=t.a,l=t.b,u=t.c,c=t.d,h=t.tx,f=t.ty,d=this.minX,p=this.minY,v=this.maxX,y=this.maxY,g=r;g<n;g+=2){var E=e[g],T=e[g+1],R=a*E+u*T+h,_=c*T+l*E+f;d=Math.min(d,R-s),v=Math.max(v,R+s),p=Math.min(p,_-o),y=Math.max(y,_+o)}this.minX=d,this.minY=p,this.maxX=v,this.maxY=y},i.prototype.addBounds=function(t){var e=this.minX,r=this.minY,n=this.maxX,s=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<r?t.minY:r,this.maxX=t.maxX>n?t.maxX:n,this.maxY=t.maxY>s?t.maxY:s},i.prototype.addBoundsMask=function(t,e){var r=t.minX>e.minX?t.minX:e.minX,n=t.minY>e.minY?t.minY:e.minY,s=t.maxX<e.maxX?t.maxX:e.maxX,o=t.maxY<e.maxY?t.maxY:e.maxY;if(r<=s&&n<=o){var a=this.minX,l=this.minY,u=this.maxX,c=this.maxY;this.minX=r<a?r:a,this.minY=n<l?n:l,this.maxX=s>u?s:u,this.maxY=o>c?o:c}},i.prototype.addBoundsMatrix=function(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)},i.prototype.addBoundsArea=function(t,e){var r=t.minX>e.x?t.minX:e.x,n=t.minY>e.y?t.minY:e.y,s=t.maxX<e.x+e.width?t.maxX:e.x+e.width,o=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(r<=s&&n<=o){var a=this.minX,l=this.minY,u=this.maxX,c=this.maxY;this.minX=r<a?r:a,this.minY=n<l?n:l,this.maxX=s>u?s:u,this.maxY=o>c?o:c}},i.prototype.pad=function(t,e){t===void 0&&(t=0),e===void 0&&(e=t),this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)},i.prototype.addFramePad=function(t,e,r,n,s,o){t-=s,e-=o,r+=s,n+=o,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>n?this.maxY:n},i})();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var cl=function(i,t){return cl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},cl(i,t)};function Eu(i,t){cl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Ue=(function(i){Eu(t,i);function t(){var e=i.call(this)||this;return e.tempDisplayObjectParent=null,e.transform=new Iu,e.alpha=1,e.visible=!0,e.renderable=!0,e.parent=null,e.worldAlpha=1,e._lastSortedIndex=0,e._zIndex=0,e.filterArea=null,e.filters=null,e._enabledFilters=null,e._bounds=new pn,e._localBounds=null,e._boundsID=0,e._boundsRect=null,e._localBoundsRect=null,e._mask=null,e._destroyed=!1,e.isSprite=!1,e.isMask=!1,e}return t.mixin=function(e){for(var r=Object.keys(e),n=0;n<r.length;++n){var s=r[n];Object.defineProperty(t.prototype,s,Object.getOwnPropertyDescriptor(e,s))}},t.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},t.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},t.prototype.getBounds=function(e,r){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new ge),r=this._boundsRect),this._bounds.getRectangle(r)},t.prototype.getLocalBounds=function(e){e||(this._localBoundsRect||(this._localBoundsRect=new ge),e=this._localBoundsRect),this._localBounds||(this._localBounds=new pn);var r=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;var a=this.getBounds(!1,e);return this.parent=n,this.transform=r,this._bounds=s,this._bounds.updateID+=this._boundsID-o,a},t.prototype.toGlobal=function(e,r,n){return n===void 0&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,r)},t.prototype.toLocal=function(e,r,n,s){return r&&(e=r.toGlobal(e,n,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,n)},t.prototype.setParent=function(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e},t.prototype.setTransform=function(e,r,n,s,o,a,l,u,c){return e===void 0&&(e=0),r===void 0&&(r=0),n===void 0&&(n=1),s===void 0&&(s=1),o===void 0&&(o=0),a===void 0&&(a=0),l===void 0&&(l=0),u===void 0&&(u=0),c===void 0&&(c=0),this.position.x=e,this.position.y=r,this.scale.x=n||1,this.scale.y=s||1,this.rotation=o,this.skew.x=a,this.skew.y=l,this.pivot.x=u,this.pivot.y=c,this},t.prototype.destroy=function(e){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(t.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new Su),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),t.prototype.enableTempParent=function(){var e=this.parent;return this.parent=this._tempDisplayObjectParent,e},t.prototype.disableTempParent=function(e){this.parent=e},Object.defineProperty(t.prototype,"x",{get:function(){return this.position.x},set:function(e){this.transform.position.x=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this.position.y},set:function(e){this.transform.position.y=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"position",{get:function(){return this.transform.position},set:function(e){this.transform.position.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.transform.scale},set:function(e){this.transform.scale.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(e){this.transform.pivot.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"skew",{get:function(){return this.transform.skew},set:function(e){this.transform.skew.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(e){this.transform.rotation=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.transform.rotation*Sp},set:function(e){this.transform.rotation=e*Cp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"zIndex",{get:function(){return this._zIndex},set:function(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"worldVisible",{get:function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"mask",{get:function(){return this._mask},set:function(e){if(this._mask){var r=this._mask.maskObject||this._mask;r.renderable=!0,r.isMask=!1}if(this._mask=e,this._mask){var r=this._mask.maskObject||this._mask;r.renderable=!1,r.isMask=!0}},enumerable:!1,configurable:!0}),t})(Ri),Su=(function(i){Eu(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.sortDirty=null,e}return t})(Ue);Ue.prototype.displayObjectUpdateTransform=Ue.prototype.updateTransform;function o0(i,t){return i.zIndex===t.zIndex?i._lastSortedIndex-t._lastSortedIndex:i.zIndex-t.zIndex}var st=(function(i){Eu(t,i);function t(){var e=i.call(this)||this;return e.children=[],e.sortableChildren=ne.SORTABLE_CHILDREN,e.sortDirty=!1,e}return t.prototype.onChildrenChange=function(e){},t.prototype.addChild=function(){for(var e=arguments,r=[],n=0;n<arguments.length;n++)r[n]=e[n];if(r.length>1)for(var s=0;s<r.length;s++)this.addChild(r[s]);else{var o=r[0];o.parent&&o.parent.removeChild(o),o.parent=this,this.sortDirty=!0,o.transform._parentID=-1,this.children.push(o),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",o,this,this.children.length-1),o.emit("added",this)}return r[0]},t.prototype.addChildAt=function(e,r){if(r<0||r>this.children.length)throw new Error(e+"addChildAt: The index "+r+" supplied is out of bounds "+this.children.length);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(r,0,e),this._boundsID++,this.onChildrenChange(r),e.emit("added",this),this.emit("childAdded",e,this,r),e},t.prototype.swapChildren=function(e,r){if(e!==r){var n=this.getChildIndex(e),s=this.getChildIndex(r);this.children[n]=r,this.children[s]=e,this.onChildrenChange(n<s?n:s)}},t.prototype.getChildIndex=function(e){var r=this.children.indexOf(e);if(r===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return r},t.prototype.setChildIndex=function(e,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(e);Nr(this.children,n,1),this.children.splice(r,0,e),this.onChildrenChange(r)},t.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Index ("+e+") does not exist.");return this.children[e]},t.prototype.removeChild=function(){for(var e=arguments,r=[],n=0;n<arguments.length;n++)r[n]=e[n];if(r.length>1)for(var s=0;s<r.length;s++)this.removeChild(r[s]);else{var o=r[0],a=this.children.indexOf(o);if(a===-1)return null;o.parent=null,o.transform._parentID=-1,Nr(this.children,a,1),this._boundsID++,this.onChildrenChange(a),o.emit("removed",this),this.emit("childRemoved",o,this,a)}return r[0]},t.prototype.removeChildAt=function(e){var r=this.getChildAt(e);return r.parent=null,r.transform._parentID=-1,Nr(this.children,e,1),this._boundsID++,this.onChildrenChange(e),r.emit("removed",this),this.emit("childRemoved",r,this,e),r},t.prototype.removeChildren=function(e,r){e===void 0&&(e=0),r===void 0&&(r=this.children.length);var n=e,s=r,o=s-n,a;if(o>0&&o<=s){a=this.children.splice(n,o);for(var l=0;l<a.length;++l)a[l].parent=null,a[l].transform&&(a[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(var l=0;l<a.length;++l)a[l].emit("removed",this),this.emit("childRemoved",a[l],this,l);return a}else if(o===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},t.prototype.sortChildren=function(){for(var e=!1,r=0,n=this.children.length;r<n;++r){var s=this.children[r];s._lastSortedIndex=r,!e&&s.zIndex!==0&&(e=!0)}e&&this.children.length>1&&this.children.sort(o0),this.sortDirty=!1},t.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var e=0,r=this.children.length;e<r;++e){var n=this.children[e];n.visible&&n.updateTransform()}},t.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var e=0;e<this.children.length;e++){var r=this.children[e];if(!(!r.visible||!r.renderable))if(r.calculateBounds(),r._mask){var n=r._mask.maskObject||r._mask;n.calculateBounds(),this._bounds.addBoundsMask(r._bounds,n._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._bounds.updateID=this._boundsID},t.prototype.getLocalBounds=function(e,r){r===void 0&&(r=!1);var n=i.prototype.getLocalBounds.call(this,e);if(!r)for(var s=0,o=this.children.length;s<o;++s){var a=this.children[s];a.visible&&a.updateTransform()}return n},t.prototype._calculateBounds=function(){},t.prototype.render=function(e){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(e);else{this._render(e);for(var r=0,n=this.children.length;r<n;++r)this.children[r].render(e)}},t.prototype.renderAdvanced=function(e){e.batch.flush();var r=this.filters,n=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var s=0;s<r.length;s++)r[s].enabled&&this._enabledFilters.push(r[s]);this._enabledFilters.length&&e.filter.push(this,this._enabledFilters)}n&&e.mask.push(this,this._mask),this._render(e);for(var s=0,o=this.children.length;s<o;s++)this.children[s].render(e);e.batch.flush(),n&&e.mask.pop(this),r&&this._enabledFilters&&this._enabledFilters.length&&e.filter.pop()},t.prototype._render=function(e){},t.prototype.destroy=function(e){i.prototype.destroy.call(this),this.sortDirty=!1;var r=typeof e=="boolean"?e:e&&e.children,n=this.removeChildren(0,this.children.length);if(r)for(var s=0;s<n.length;++s)n[s].destroy(e)},Object.defineProperty(t.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(e){var r=this.getLocalBounds().width;r!==0?this.scale.x=e/r:this.scale.x=1,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(e){var r=this.getLocalBounds().height;r!==0?this.scale.y=e/r:this.scale.y=1,this._height=e},enumerable:!1,configurable:!0}),t})(Ue);st.prototype.containerUpdateTransform=st.prototype.updateTransform;/*!
 * @pixi/accessibility - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/accessibility is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Mp={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Ue.mixin(Mp);var a0=9,Hn=100,l0=0,u0=0,Dh=2,kh=1,c0=-1e3,h0=-1e3,f0=2,Rp=(function(){function i(t){this._hookDiv=null,(_t.tablet||_t.phone)&&this.createTouchHook();var e=document.createElement("div");e.style.width=Hn+"px",e.style.height=Hn+"px",e.style.position="absolute",e.style.top=l0+"px",e.style.left=u0+"px",e.style.zIndex=Dh.toString(),this.div=e,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=t,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._isActive=!1,this._isMobileAccessibility=!1,this.androidUpdateCount=0,this.androidUpdateFrequency=500,window.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(i.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),i.prototype.createTouchHook=function(){var t=this,e=document.createElement("button");e.style.width=kh+"px",e.style.height=kh+"px",e.style.position="absolute",e.style.top=c0+"px",e.style.left=h0+"px",e.style.zIndex=f0.toString(),e.style.backgroundColor="#FF0000",e.title="select to enable accessability for this content",e.addEventListener("focus",function(){t._isMobileAccessibility=!0,t.activate(),t.destroyTouchHook()}),document.body.appendChild(e),this._hookDiv=e},i.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},i.prototype.activate=function(){this._isActive||(this._isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},i.prototype.deactivate=function(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},i.prototype.updateAccessibleObjects=function(t){if(!(!t.visible||!t.accessibleChildren)){t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);for(var e=t.children,r=0;r<e.length;r++)this.updateAccessibleObjects(e[r])}},i.prototype.update=function(){var t=performance.now();if(!(_t.android.device&&t<this.androidUpdateCount)&&(this.androidUpdateCount=t+this.androidUpdateFrequency,!!this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),r=this.renderer.resolution,n=e.width/this.renderer.width*r,s=e.height/this.renderer.height*r,o=this.div;o.style.left=e.left+"px",o.style.top=e.top+"px",o.style.width=this.renderer.width+"px",o.style.height=this.renderer.height+"px";for(var a=0;a<this.children.length;a++){var l=this.children[a];if(l.renderId!==this.renderId)l._accessibleActive=!1,Nr(this.children,a,1),this.div.removeChild(l._accessibleDiv),this.pool.push(l._accessibleDiv),l._accessibleDiv=null,a--;else{o=l._accessibleDiv;var u=l.hitArea,c=l.worldTransform;l.hitArea?(o.style.left=(c.tx+u.x*c.a)*n+"px",o.style.top=(c.ty+u.y*c.d)*s+"px",o.style.width=u.width*c.a*n+"px",o.style.height=u.height*c.d*s+"px"):(u=l.getBounds(),this.capHitArea(u),o.style.left=u.x*n+"px",o.style.top=u.y*s+"px",o.style.width=u.width*n+"px",o.style.height=u.height*s+"px",o.title!==l.accessibleTitle&&l.accessibleTitle!==null&&(o.title=l.accessibleTitle),o.getAttribute("aria-label")!==l.accessibleHint&&l.accessibleHint!==null&&o.setAttribute("aria-label",l.accessibleHint)),(l.accessibleTitle!==o.title||l.tabIndex!==o.tabIndex)&&(o.title=l.accessibleTitle,o.tabIndex=l.tabIndex,this.debug&&this.updateDebugHTML(o))}}this.renderId++}},i.prototype.updateDebugHTML=function(t){t.innerHTML="type: "+t.type+"</br> title : "+t.title+"</br> tabIndex: "+t.tabIndex},i.prototype.capHitArea=function(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0),t.x+t.width>this.renderer.width&&(t.width=this.renderer.width-t.x),t.y+t.height>this.renderer.height&&(t.height=this.renderer.height-t.y)},i.prototype.addChild=function(t){var e=this.pool.pop();e||(e=document.createElement("button"),e.style.width=Hn+"px",e.style.height=Hn+"px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=Dh.toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?e.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(e.title="displayObject "+t.tabIndex),t.accessibleHint&&t.accessibleHint!==null&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex},i.prototype._onClick=function(t){var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"click",e.eventData),e.dispatchEvent(t.target.displayObject,"pointertap",e.eventData),e.dispatchEvent(t.target.displayObject,"tap",e.eventData)},i.prototype._onFocus=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseover",e.eventData)},i.prototype._onFocusOut=function(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite");var e=this.renderer.plugins.interaction;e.dispatchEvent(t.target.displayObject,"mouseout",e.eventData)},i.prototype._onKeyDown=function(t){t.keyCode===a0&&this.activate()},i.prototype._onMouseMove=function(t){t.movementX===0&&t.movementY===0||this.deactivate()},i.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},i})();/*!
 * @pixi/ticker - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */ne.TARGET_FPMS=.06;var Bt;(function(i){i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY"})(Bt||(Bt={}));var ga=(function(){function i(t,e,r,n){e===void 0&&(e=null),r===void 0&&(r=0),n===void 0&&(n=!1),this.fn=t,this.context=e,this.priority=r,this.once=n,this.next=null,this.previous=null,this._destroyed=!1}return i.prototype.match=function(t,e){return e===void 0&&(e=null),this.fn===t&&this.context===e},i.prototype.emit=function(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));var e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e},i.prototype.connect=function(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this},i.prototype.destroy=function(t){t===void 0&&(t=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var e=this.next;return this.next=t?null:e,this.previous=null,e},i})(),Ye=(function(){function i(){var t=this;this._head=new ga(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/ne.TARGET_FPMS,this.elapsedMS=1/ne.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(e){t._requestId=null,t.started&&(t.update(e),t.started&&t._requestId===null&&t._head.next&&(t._requestId=requestAnimationFrame(t._tick)))}}return i.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},i.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},i.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},i.prototype.add=function(t,e,r){return r===void 0&&(r=Bt.NORMAL),this._addListener(new ga(t,e,r))},i.prototype.addOnce=function(t,e,r){return r===void 0&&(r=Bt.NORMAL),this._addListener(new ga(t,e,r,!0))},i.prototype._addListener=function(t){var e=this._head.next,r=this._head;if(!e)t.connect(r);else{for(;e;){if(t.priority>e.priority){t.connect(r);break}r=e,e=e.next}t.previous||t.connect(r)}return this._startIfPossible(),this},i.prototype.remove=function(t,e){for(var r=this._head.next;r;)r.match(t,e)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(i.prototype,"count",{get:function(){if(!this._head)return 0;for(var t=0,e=this._head;e=e.next;)t++;return t},enumerable:!1,configurable:!0}),i.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},i.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},i.prototype.destroy=function(){if(!this._protected){this.stop();for(var t=this._head.next;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}},i.prototype.update=function(t){t===void 0&&(t=performance.now());var e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){var r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*ne.TARGET_FPMS;for(var n=this._head,s=n.next;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t},Object.defineProperty(i.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(t){var e=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,e)/1e3,ne.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(t){if(t===0)this._minElapsedMS=0;else{var e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(i,"shared",{get:function(){if(!i._shared){var t=i._shared=new i;t.autoStart=!0,t._protected=!0}return i._shared},enumerable:!1,configurable:!0}),Object.defineProperty(i,"system",{get:function(){if(!i._system){var t=i._system=new i;t.autoStart=!0,t._protected=!0}return i._system},enumerable:!1,configurable:!0}),i})(),Lp=(function(){function i(){}return i.init=function(t){var e=this;t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set:function(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,Bt.LOW)},get:function(){return this._ticker}}),this.stop=function(){e._ticker.stop()},this.start=function(){e._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Ye.shared:new Ye,t.autoStart&&this.start()},i.destroy=function(){if(this._ticker){var t=this._ticker;this.ticker=null,t.destroy()}},i})();/*!
 * @pixi/interaction - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/interaction is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var hl=(function(){function i(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new ze,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(i.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),i.prototype.getLocalPosition=function(t,e,r){return t.worldTransform.applyInverse(r||this.global,e)},i.prototype.copyEvent=function(t){"isPrimary"in t&&t.isPrimary&&(this.isPrimary=!0),this.button="button"in t&&t.button;var e="buttons"in t&&t.buttons;this.buttons=Number.isInteger(e)?e:"which"in t&&t.which,this.width="width"in t&&t.width,this.height="height"in t&&t.height,this.tiltX="tiltX"in t&&t.tiltX,this.tiltY="tiltY"in t&&t.tiltY,this.pointerType="pointerType"in t&&t.pointerType,this.pressure="pressure"in t&&t.pressure,this.rotationAngle="rotationAngle"in t&&t.rotationAngle,this.twist="twist"in t&&t.twist||0,this.tangentialPressure="tangentialPressure"in t&&t.tangentialPressure||0},i.prototype.reset=function(){this.isPrimary=!1},i})();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var fl=function(i,t){return fl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},fl(i,t)};function d0(i,t){fl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Np=(function(){function i(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return i.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},i.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},i})(),vs=(function(){function i(t){this._pointerId=t,this._flags=i.FLAGS.NONE}return i.prototype._doSet=function(t,e){e?this._flags=this._flags|t:this._flags=this._flags&~t},Object.defineProperty(i.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"flags",{get:function(){return this._flags},set:function(t){this._flags=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"none",{get:function(){return this._flags===i.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"over",{get:function(){return(this._flags&i.FLAGS.OVER)!==0},set:function(t){this._doSet(i.FLAGS.OVER,t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightDown",{get:function(){return(this._flags&i.FLAGS.RIGHT_DOWN)!==0},set:function(t){this._doSet(i.FLAGS.RIGHT_DOWN,t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftDown",{get:function(){return(this._flags&i.FLAGS.LEFT_DOWN)!==0},set:function(t){this._doSet(i.FLAGS.LEFT_DOWN,t)},enumerable:!1,configurable:!0}),i.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),i})(),p0=(function(){function i(){this._tempPoint=new ze}return i.prototype.recursiveFindHit=function(t,e,r,n,s){if(!e||!e.visible)return!1;var o=t.data.global;s=e.interactive||s;var a=!1,l=s,u=!0;if(e.hitArea?(n&&(e.worldTransform.applyInverse(o,this._tempPoint),e.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(n=!1,u=!1)),l=!1):e._mask&&n&&(e._mask.containsPoint&&e._mask.containsPoint(o)||(n=!1)),u&&e.interactiveChildren&&e.children)for(var c=e.children,h=c.length-1;h>=0;h--){var f=c[h],d=this.recursiveFindHit(t,f,r,n,l);if(d){if(!f.parent)continue;l=!1,d&&(t.target&&(n=!1),a=!0)}}return s&&(n&&!t.target&&!e.hitArea&&e.containsPoint&&e.containsPoint(o)&&(a=!0),e.interactive&&(a&&!t.target&&(t.target=e),r&&r(t,e,!!a))),a},i.prototype.findHit=function(t,e,r,n){this.recursiveFindHit(t,e,r,n,!1)},i})(),Bp={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(i){i?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};Ue.mixin(Bp);var Gn=1,Yn={target:null,data:{global:null}},Dp=(function(i){d0(t,i);function t(e,r){var n=i.call(this)||this;return r=r||{},n.renderer=e,n.autoPreventDefault=r.autoPreventDefault!==void 0?r.autoPreventDefault:!0,n.interactionFrequency=r.interactionFrequency||10,n.mouse=new hl,n.mouse.identifier=Gn,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[Gn]=n.mouse,n.interactionDataPool=[],n.eventData=new Np,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!1,n.supportsTouchEvents="ontouchstart"in window,n.supportsPointerEvents=!!window.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new p0,n._tempDisplayObject=new Su,n._useSystemTicker=r.useSystemTicker!==void 0?r.useSystemTicker:!0,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return Object.defineProperty(t.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(e){this._useSystemTicker=e,e?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),t.prototype.hitTest=function(e,r){return Yn.target=null,Yn.data.global=e,r||(r=this.lastObjectRendered),this.processInteractive(Yn,r,null,!0),Yn.target},t.prototype.setTargetElement=function(e,r){r===void 0&&(r=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=e,this.resolution=r,this.addEvents(),this.addTickerListener()},t.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Ye.system.add(this.tickerUpdate,this,Bt.INTERACTION),this.tickerAdded=!0)},t.prototype.removeTickerListener=function(){this.tickerAdded&&(Ye.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},t.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var e=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(e.msContentZooming="none",e.msTouchAction="none"):this.supportsPointerEvents&&(e.touchAction="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0}},t.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var e=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(e.msContentZooming="",e.msTouchAction=""):this.supportsPointerEvents&&(e.touchAction=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1}},t.prototype.tickerUpdate=function(e){this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},t.prototype.update=function(){if(this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var e in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(e)){var r=this.activeInteractionData[e];if(r.originalEvent&&r.pointerType!=="touch"){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},t.prototype.setCursorMode=function(e){if(e=e||"default",this.currentCursorMode!==e){this.currentCursorMode=e;var r=this.cursorStyles[e];if(r)switch(typeof r){case"string":this.interactionDOMElement.style.cursor=r;break;case"function":r(e);break;case"object":Object.assign(this.interactionDOMElement.style,r);break}else typeof e=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,e)&&(this.interactionDOMElement.style.cursor=e)}},t.prototype.dispatchEvent=function(e,r,n){(!n.stopPropagationHint||e===n.stopsPropagatingAt)&&(n.currentTarget=e,n.type=r,e.emit(r,n),e[r]&&e[r](n))},t.prototype.delayDispatchEvent=function(e,r,n){this.delayedEvents.push({displayObject:e,eventString:r,eventData:n})},t.prototype.mapPositionToPoint=function(e,r,n){var s;this.interactionDOMElement.parentElement?s=this.interactionDOMElement.getBoundingClientRect():s={x:0,y:0,width:0,height:0};var o=1/this.resolution;e.x=(r-s.left)*(this.interactionDOMElement.width/s.width)*o,e.y=(n-s.top)*(this.interactionDOMElement.height/s.height)*o},t.prototype.processInteractive=function(e,r,n,s){var o=this.search.findHit(e,r,n,s),a=this.delayedEvents;if(!a.length)return o;e.stopPropagationHint=!1;var l=a.length;this.delayedEvents=[];for(var u=0;u<l;u++){var c=a[u],h=c.displayObject,f=c.eventString,d=c.eventData;d.stopsPropagatingAt===h&&(d.stopPropagationHint=!0),this.dispatchEvent(h,f,d)}return o},t.prototype.onPointerDown=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var r=this.normalizeToPointerData(e);if(this.autoPreventDefault&&r[0].isNormalized){var n=e.cancelable||!("cancelable"in e);n&&e.preventDefault()}for(var s=r.length,o=0;o<s;o++){var a=r[o],l=this.getInteractionDataForPointerId(a),u=this.configureInteractionEventForDOMEvent(this.eventData,a,l);if(u.data.originalEvent=e,this.processInteractive(u,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",u),a.pointerType==="touch")this.emit("touchstart",u);else if(a.pointerType==="mouse"||a.pointerType==="pen"){var c=a.button===2;this.emit(c?"rightdown":"mousedown",this.eventData)}}}},t.prototype.processPointerDown=function(e,r,n){var s=e.data,o=e.data.identifier;if(n){if(r.trackedPointers[o]||(r.trackedPointers[o]=new vs(o)),this.dispatchEvent(r,"pointerdown",e),s.pointerType==="touch")this.dispatchEvent(r,"touchstart",e);else if(s.pointerType==="mouse"||s.pointerType==="pen"){var a=s.button===2;a?r.trackedPointers[o].rightDown=!0:r.trackedPointers[o].leftDown=!0,this.dispatchEvent(r,a?"rightdown":"mousedown",e)}}},t.prototype.onPointerComplete=function(e,r,n){for(var s=this.normalizeToPointerData(e),o=s.length,a=e.target!==this.interactionDOMElement?"outside":"",l=0;l<o;l++){var u=s[l],c=this.getInteractionDataForPointerId(u),h=this.configureInteractionEventForDOMEvent(this.eventData,u,c);if(h.data.originalEvent=e,this.processInteractive(h,this.lastObjectRendered,n,r||!a),this.emit(r?"pointercancel":"pointerup"+a,h),u.pointerType==="mouse"||u.pointerType==="pen"){var f=u.button===2;this.emit(f?"rightup"+a:"mouseup"+a,h)}else u.pointerType==="touch"&&(this.emit(r?"touchcancel":"touchend"+a,h),this.releaseInteractionDataForPointerId(u.pointerId))}},t.prototype.onPointerCancel=function(e){this.supportsTouchEvents&&e.pointerType==="touch"||this.onPointerComplete(e,!0,this.processPointerCancel)},t.prototype.processPointerCancel=function(e,r){var n=e.data,s=e.data.identifier;r.trackedPointers[s]!==void 0&&(delete r.trackedPointers[s],this.dispatchEvent(r,"pointercancel",e),n.pointerType==="touch"&&this.dispatchEvent(r,"touchcancel",e))},t.prototype.onPointerUp=function(e){this.supportsTouchEvents&&e.pointerType==="touch"||this.onPointerComplete(e,!1,this.processPointerUp)},t.prototype.processPointerUp=function(e,r,n){var s=e.data,o=e.data.identifier,a=r.trackedPointers[o],l=s.pointerType==="touch",u=s.pointerType==="mouse"||s.pointerType==="pen",c=!1;if(u){var h=s.button===2,f=vs.FLAGS,d=h?f.RIGHT_DOWN:f.LEFT_DOWN,p=a!==void 0&&a.flags&d;n?(this.dispatchEvent(r,h?"rightup":"mouseup",e),p&&(this.dispatchEvent(r,h?"rightclick":"click",e),c=!0)):p&&this.dispatchEvent(r,h?"rightupoutside":"mouseupoutside",e),a&&(h?a.rightDown=!1:a.leftDown=!1)}n?(this.dispatchEvent(r,"pointerup",e),l&&this.dispatchEvent(r,"touchend",e),a&&((!u||c)&&this.dispatchEvent(r,"pointertap",e),l&&(this.dispatchEvent(r,"tap",e),a.over=!1))):a&&(this.dispatchEvent(r,"pointerupoutside",e),l&&this.dispatchEvent(r,"touchendoutside",e)),a&&a.none&&delete r.trackedPointers[o]},t.prototype.onPointerMove=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var r=this.normalizeToPointerData(e);(r[0].pointerType==="mouse"||r[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var n=r.length,s=0;s<n;s++){var o=r[s],a=this.getInteractionDataForPointerId(o),l=this.configureInteractionEventForDOMEvent(this.eventData,o,a);l.data.originalEvent=e,this.processInteractive(l,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",l),o.pointerType==="touch"&&this.emit("touchmove",l),(o.pointerType==="mouse"||o.pointerType==="pen")&&this.emit("mousemove",l)}r[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},t.prototype.processPointerMove=function(e,r,n){var s=e.data,o=s.pointerType==="touch",a=s.pointerType==="mouse"||s.pointerType==="pen";a&&this.processPointerOverOut(e,r,n),(!this.moveWhenInside||n)&&(this.dispatchEvent(r,"pointermove",e),o&&this.dispatchEvent(r,"touchmove",e),a&&this.dispatchEvent(r,"mousemove",e))},t.prototype.onPointerOut=function(e){if(!(this.supportsTouchEvents&&e.pointerType==="touch")){var r=this.normalizeToPointerData(e),n=r[0];n.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,this.processInteractive(o,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",o),n.pointerType==="mouse"||n.pointerType==="pen"?this.emit("mouseout",o):this.releaseInteractionDataForPointerId(s.identifier)}},t.prototype.processPointerOverOut=function(e,r,n){var s=e.data,o=e.data.identifier,a=s.pointerType==="mouse"||s.pointerType==="pen",l=r.trackedPointers[o];n&&!l&&(l=r.trackedPointers[o]=new vs(o)),l!==void 0&&(n&&this.mouseOverRenderer?(l.over||(l.over=!0,this.delayDispatchEvent(r,"pointerover",e),a&&this.delayDispatchEvent(r,"mouseover",e)),a&&this.cursor===null&&(this.cursor=r.cursor)):l.over&&(l.over=!1,this.dispatchEvent(r,"pointerout",this.eventData),a&&this.dispatchEvent(r,"mouseout",e),l.none&&delete r.trackedPointers[o]))},t.prototype.onPointerOver=function(e){var r=this.normalizeToPointerData(e),n=r[0],s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,n.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",o),(n.pointerType==="mouse"||n.pointerType==="pen")&&this.emit("mouseover",o)},t.prototype.getInteractionDataForPointerId=function(e){var r=e.pointerId,n;return r===Gn||e.pointerType==="mouse"?n=this.mouse:this.activeInteractionData[r]?n=this.activeInteractionData[r]:(n=this.interactionDataPool.pop()||new hl,n.identifier=r,this.activeInteractionData[r]=n),n.copyEvent(e),n},t.prototype.releaseInteractionDataForPointerId=function(e){var r=this.activeInteractionData[e];r&&(delete this.activeInteractionData[e],r.reset(),this.interactionDataPool.push(r))},t.prototype.configureInteractionEventForDOMEvent=function(e,r,n){return e.data=n,this.mapPositionToPoint(n.global,r.clientX,r.clientY),r.pointerType==="touch"&&(r.globalX=n.global.x,r.globalY=n.global.y),n.originalEvent=r,e.reset(),e},t.prototype.normalizeToPointerData=function(e){var r=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(var n=0,s=e.changedTouches.length;n<s;n++){var o=e.changedTouches[n];typeof o.button>"u"&&(o.button=e.touches.length?1:0),typeof o.buttons>"u"&&(o.buttons=e.touches.length?1:0),typeof o.isPrimary>"u"&&(o.isPrimary=e.touches.length===1&&e.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,r.push(o)}else if(e instanceof MouseEvent&&(!this.supportsPointerEvents||!(e instanceof window.PointerEvent))){var a=e;typeof a.isPrimary>"u"&&(a.isPrimary=!0),typeof a.width>"u"&&(a.width=1),typeof a.height>"u"&&(a.height=1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="mouse"),typeof a.pointerId>"u"&&(a.pointerId=Gn),typeof a.pressure>"u"&&(a.pressure=.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),a.isNormalized=!0,r.push(a)}else r.push(e);return r},t.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},t})(Ri);/*!
 * @pixi/runner - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/runner is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var qe=(function(){function i(t){this.items=[],this._name=t,this._aliasCount=0}return i.prototype.emit=function(t,e,r,n,s,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");var u=this,c=u.name,h=u.items;this._aliasCount++;for(var f=0,d=h.length;f<d;f++)h[f][c](t,e,r,n,s,o,a,l);return h===this.items&&this._aliasCount--,this},i.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},i.prototype.add=function(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this},i.prototype.remove=function(t){var e=this.items.indexOf(t);return e!==-1&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this},i.prototype.contains=function(t){return this.items.indexOf(t)!==-1},i.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},i.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(i.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),i})();Object.defineProperties(qe.prototype,{dispatch:{value:qe.prototype.emit},run:{value:qe.prototype.emit}});/*!
 * @pixi/core - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/core is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */ne.PREFER_ENV=_t.any?Nt.WEBGL:Nt.WEBGL2;ne.STRICT_TEXTURE_CACHE=!1;var Ps=[];function Cu(i,t){if(!i)return null;var e="";if(typeof i=="string"){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(e=r[1].toLowerCase())}for(var n=Ps.length-1;n>=0;--n){var s=Ps[n];if(s.test&&s.test(i,e))return new s(i,t)}throw new Error("Unrecognized source type to auto-detect Resource")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var dl=function(i,t){return dl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},dl(i,t)};function fe(i,t){dl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Ei=(function(){function i(t,e){t===void 0&&(t=0),e===void 0&&(e=0),this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new qe("setRealSize"),this.onUpdate=new qe("update"),this.onError=new qe("onError")}return i.prototype.bind=function(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},i.prototype.unbind=function(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)},i.prototype.resize=function(t,e){(t!==this._width||e!==this._height)&&(this._width=t,this._height=e,this.onResize.emit(t,e))},Object.defineProperty(i.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),i.prototype.update=function(){this.destroyed||this.onUpdate.emit()},i.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),i.prototype.style=function(t,e,r){return!1},i.prototype.dispose=function(){},i.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},i.test=function(t,e){return!1},i})(),zs=(function(i){fe(t,i);function t(e,r){var n=this,s=r||{},o=s.width,a=s.height;if(!o||!a)throw new Error("BufferResource width or height invalid");return n=i.call(this,o,a)||this,n.data=e,n}return t.prototype.upload=function(e,r,n){var s=e.gl;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===qt.UNPACK),n.width===r.width&&n.height===r.height?s.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(n.width=r.width,n.height=r.height,s.texImage2D(r.target,0,n.internalFormat,r.width,r.height,0,r.format,n.type,this.data)),!0},t.prototype.dispose=function(){this.data=null},t.test=function(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array},t})(Ei),y0={scaleMode:Ct.NEAREST,format:wi.RGBA,alphaMode:qt.NPM},Ee=(function(i){fe(t,i);function t(e,r){e===void 0&&(e=null),r===void 0&&(r=null);var n=i.call(this)||this;r=r||{};var s=r.alphaMode,o=r.mipmap,a=r.anisotropicLevel,l=r.scaleMode,u=r.width,c=r.height,h=r.wrapMode,f=r.format,d=r.type,p=r.target,v=r.resolution,y=r.resourceOptions;return e&&!(e instanceof Ei)&&(e=Cu(e,y),e.internal=!0),n.width=u||0,n.height=c||0,n.resolution=v||ne.RESOLUTION,n.mipmap=o!==void 0?o:ne.MIPMAP_TEXTURES,n.anisotropicLevel=a!==void 0?a:ne.ANISOTROPIC_LEVEL,n.wrapMode=h||ne.WRAP_MODE,n.scaleMode=l!==void 0?l:ne.SCALE_MODE,n.format=f||wi.RGBA,n.type=d||De.UNSIGNED_BYTE,n.target=p||hr.TEXTURE_2D,n.alphaMode=s!==void 0?s:qt.UNPACK,r.premultiplyAlpha!==void 0&&(n.premultiplyAlpha=r.premultiplyAlpha),n.uid=kr(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=u>0&&c>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(e),n}return Object.defineProperty(t.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),t.prototype.setStyle=function(e,r){var n;return e!==void 0&&e!==this.scaleMode&&(this.scaleMode=e,n=!0),r!==void 0&&r!==this.mipmap&&(this.mipmap=r,n=!0),n&&this.dirtyStyleId++,this},t.prototype.setSize=function(e,r,n){return this.resolution=n||this.resolution,this.width=e,this.height=r,this._refreshPOT(),this.update(),this},t.prototype.setRealSize=function(e,r,n){return this.resolution=n||this.resolution,this.width=e/this.resolution,this.height=r/this.resolution,this._refreshPOT(),this.update(),this},t.prototype._refreshPOT=function(){this.isPowerOfTwo=sl(this.realWidth)&&sl(this.realHeight)},t.prototype.setResolution=function(e){var r=this.resolution;return r===e?this:(this.resolution=e,this.valid&&(this.width=this.width*r/e,this.height=this.height*r/e,this.emit("update",this)),this._refreshPOT(),this)},t.prototype.setResource=function(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this},t.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},t.prototype.onError=function(e){this.emit("error",this,e)},t.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete gt[this.cacheId],delete nt[this.cacheId],this.cacheId=null),this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},t.prototype.dispose=function(){this.emit("dispose",this)},t.prototype.castToBaseTexture=function(){return this},t.from=function(e,r,n){n===void 0&&(n=ne.STRICT_TEXTURE_CACHE);var s=typeof e=="string",o=null;s?o=e:(e._pixiId||(e._pixiId="pixiid_"+kr()),o=e._pixiId);var a=gt[o];if(s&&n&&!a)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return a||(a=new t(e,r),a.cacheId=o,t.addToCache(a,o)),a},t.fromBuffer=function(e,r,n,s){e=e||new Float32Array(r*n*4);var o=new zs(e,{width:r,height:n}),a=e instanceof Float32Array?De.FLOAT:De.UNSIGNED_BYTE;return new t(o,Object.assign(y0,s||{width:r,height:n,type:a}))},t.addToCache=function(e,r){r&&(e.textureCacheIds.indexOf(r)===-1&&e.textureCacheIds.push(r),gt[r]&&console.warn("BaseTexture added to the cache with an id ["+r+"] that already had an entry"),gt[r]=e)},t.removeFromCache=function(e){if(typeof e=="string"){var r=gt[e];if(r){var n=r.textureCacheIds.indexOf(e);return n>-1&&r.textureCacheIds.splice(n,1),delete gt[e],r}}else if(e&&e.textureCacheIds){for(var s=0;s<e.textureCacheIds.length;++s)delete gt[e.textureCacheIds[s]];return e.textureCacheIds.length=0,e}return null},t._globalBatch=0,t})(Ri),Au=(function(i){fe(t,i);function t(e,r){var n=this,s=r||{},o=s.width,a=s.height;n=i.call(this,o,a)||this,n.items=[],n.itemDirtyIds=[];for(var l=0;l<e;l++){var u=new Ee;n.items.push(u),n.itemDirtyIds.push(-2)}return n.length=e,n._load=null,n.baseTexture=null,n}return t.prototype.initFromArray=function(e,r){for(var n=0;n<this.length;n++)e[n]&&(e[n].castToBaseTexture?this.addBaseTextureAt(e[n].castToBaseTexture(),n):e[n]instanceof Ei?this.addResourceAt(e[n],n):this.addResourceAt(Cu(e[n],r),n))},t.prototype.dispose=function(){for(var e=0,r=this.length;e<r;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},t.prototype.addResourceAt=function(e,r){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[r].setResource(e),this},t.prototype.bind=function(e){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");i.prototype.bind.call(this,e);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=e,this.items[r].on("update",e.update,e)},t.prototype.unbind=function(e){i.prototype.unbind.call(this,e);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",e.update,e)},t.prototype.load=function(){var e=this;if(this._load)return this._load;var r=this.items.map(function(s){return s.resource}).filter(function(s){return s}),n=r.map(function(s){return s.load()});return this._load=Promise.all(n).then(function(){var s=e.items[0],o=s.realWidth,a=s.realHeight;return e.resize(o,a),Promise.resolve(e)}),this._load},t})(Ei),kp=(function(i){fe(t,i);function t(e,r){var n=this,s=r||{},o=s.width,a=s.height,l,u;return Array.isArray(e)?(l=e,u=e.length):u=e,n=i.call(this,u,{width:o,height:a})||this,l&&n.initFromArray(l,r),n}return t.prototype.addBaseTextureAt=function(e,r){if(e.resource)this.addResourceAt(e.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this},t.prototype.bind=function(e){i.prototype.bind.call(this,e),e.target=hr.TEXTURE_2D_ARRAY},t.prototype.upload=function(e,r,n){var s=this,o=s.length,a=s.itemDirtyIds,l=s.items,u=e.gl;n.dirtyId<0&&u.texImage3D(u.TEXTURE_2D_ARRAY,0,r.format,this._width,this._height,o,0,r.format,r.type,null);for(var c=0;c<o;c++){var h=l[c];a[c]<h.dirtyId&&(a[c]=h.dirtyId,h.valid&&u.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,c,h.resource.width,h.resource.height,1,r.format,r.type,h.resource.source))}return!0},t})(Au),jt=(function(i){fe(t,i);function t(e){var r=this,n=e,s=n.naturalWidth||n.videoWidth||n.width,o=n.naturalHeight||n.videoHeight||n.height;return r=i.call(this,s,o)||this,r.source=e,r.noSubImage=!1,r}return t.crossOrigin=function(e,r,n){n===void 0&&r.indexOf("data:")!==0?e.crossOrigin=Ep(r):n!==!1&&(e.crossOrigin=typeof n=="string"?n:"anonymous")},t.prototype.upload=function(e,r,n,s){var o=e.gl,a=r.realWidth,l=r.realHeight;return s=s||this.source,o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===qt.UNPACK),!this.noSubImage&&r.target===o.TEXTURE_2D&&n.width===a&&n.height===l?o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,r.type,s):(n.width=a,n.height=l,o.texImage2D(r.target,0,r.format,r.format,r.type,s)),!0},t.prototype.update=function(){if(!this.destroyed){var e=this.source,r=e.naturalWidth||e.videoWidth||e.width,n=e.naturalHeight||e.videoHeight||e.height;this.resize(r,n),i.prototype.update.call(this)}},t.prototype.dispose=function(){this.source=null},t})(Ei),Pu=(function(i){fe(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.test=function(e){var r=window.OffscreenCanvas;return r&&e instanceof r?!0:e instanceof HTMLCanvasElement},t})(jt),Up=(function(i){fe(t,i);function t(e,r){var n=this,s=r||{},o=s.width,a=s.height,l=s.autoLoad,u=s.linkBaseTexture;if(e&&e.length!==t.SIDES)throw new Error("Invalid length. Got "+e.length+", expected 6");n=i.call(this,6,{width:o,height:a})||this;for(var c=0;c<t.SIDES;c++)n.items[c].target=hr.TEXTURE_CUBE_MAP_POSITIVE_X+c;return n.linkBaseTexture=u!==!1,e&&n.initFromArray(e,r),l!==!1&&n.load(),n}return t.prototype.bind=function(e){i.prototype.bind.call(this,e),e.target=hr.TEXTURE_CUBE_MAP},t.prototype.addBaseTextureAt=function(e,r,n){if(n===void 0&&(n=this.linkBaseTexture),!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||e.parentTextureArray||Object.keys(e._glTextures).length>0)if(e.resource)this.addResourceAt(e.resource,r);else throw new Error("CubeResource does not support copying of renderTexture.");else e.target=hr.TEXTURE_CUBE_MAP_POSITIVE_X+r,e.parentTextureArray=this.baseTexture,this.items[r]=e;return e.valid&&!this.valid&&this.resize(e.realWidth,e.realHeight),this.items[r]=e,this},t.prototype.upload=function(e,r,n){for(var s=this.itemDirtyIds,o=0;o<t.SIDES;o++){var a=this.items[o];s[o]<a.dirtyId&&(a.valid&&a.resource?(a.resource.upload(e,a,n),s[o]=a.dirtyId):s[o]<-1&&(e.gl.texImage2D(a.target,0,n.internalFormat,r.realWidth,r.realHeight,0,r.format,n.type,null),s[o]=-1))}return!0},t.test=function(e){return Array.isArray(e)&&e.length===t.SIDES},t.SIDES=6,t})(Au),Ou=(function(i){fe(t,i);function t(e,r){var n=this;if(r=r||{},!(e instanceof HTMLImageElement)){var s=new Image;jt.crossOrigin(s,e,r.crossorigin),s.src=e,e=s}return n=i.call(this,e)||this,!e.complete&&n._width&&n._height&&(n._width=0,n._height=0),n.url=e.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(r.createBitmap!==void 0?r.createBitmap:ne.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,n.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,r.premultiplyAlpha!==void 0&&(n.premultiplyAlpha=r.premultiplyAlpha),n.bitmap=null,n._load=null,r.autoLoad!==!1&&n.load(),n}return t.prototype.load=function(e){var r=this;return this._load?this._load:(e!==void 0&&(this.createBitmap=e),this._load=new Promise(function(n,s){var o=r.source;r.url=o.src;var a=function(){r.destroyed||(o.onload=null,o.onerror=null,r.resize(o.width,o.height),r._load=null,r.createBitmap?n(r.process()):n(r))};o.complete&&o.src?a():(o.onload=a,o.onerror=function(l){s(l),r.onError.emit(l)})}),this._load)},t.prototype.process=function(){var e=this,r=this.source;return this._process!==null?this._process:this.bitmap!==null||!window.createImageBitmap?Promise.resolve(this):(this._process=window.createImageBitmap(r,0,0,r.width,r.height,{premultiplyAlpha:this.alphaMode===qt.UNPACK?"premultiply":"none"}).then(function(n){return e.destroyed?Promise.reject():(e.bitmap=n,e.update(),e._process=null,Promise.resolve(e))}),this._process)},t.prototype.upload=function(e,r,n){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return i.prototype.upload.call(this,e,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(i.prototype.upload.call(this,e,r,n,this.bitmap),!this.preserveBitmap){var s=!0,o=r._glTextures;for(var a in o){var l=o[a];if(l!==n&&l.dirtyId!==r.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},t.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,i.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},t.test=function(e){return typeof e=="string"||e instanceof HTMLImageElement},t})(jt),Xp=(function(i){fe(t,i);function t(e,r){var n=this;return r=r||{},n=i.call(this,document.createElement("canvas"))||this,n._width=0,n._height=0,n.svg=e,n.scale=r.scale||1,n._overrideWidth=r.width,n._overrideHeight=r.height,n._resolve=null,n._crossorigin=r.crossorigin,n._load=null,r.autoLoad!==!1&&n.load(),n}return t.prototype.load=function(){var e=this;return this._load?this._load:(this._load=new Promise(function(r){if(e._resolve=function(){e.resize(e.source.width,e.source.height),r(e)},/^\<svg/.test(e.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");e.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.svg)))}e._loadSvg()}),this._load)},t.prototype._loadSvg=function(){var e=this,r=new Image;jt.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(n){e._resolve&&(r.onerror=null,e.onError.emit(n))},r.onload=function(){if(e._resolve){var n=r.width,s=r.height;if(!n||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var o=n*e.scale,a=s*e.scale;(e._overrideWidth||e._overrideHeight)&&(o=e._overrideWidth||e._overrideHeight/s*n,a=e._overrideHeight||e._overrideWidth/n*s),o=Math.round(o),a=Math.round(a);var l=e.source;l.width=o,l.height=a,l._pixiId="canvas_"+kr(),l.getContext("2d").drawImage(r,0,0,n,s,0,0,o,a),e._resolve(),e._resolve=null}}},t.getSize=function(e){var r=t.SVG_SIZE.exec(e),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n},t.prototype.dispose=function(){i.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},t.test=function(e,r){return r==="svg"||typeof e=="string"&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(e)||typeof e=="string"&&e.indexOf("<svg")===0},t.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,t})(jt),Hp=(function(i){fe(t,i);function t(e,r){var n=this;if(r=r||{},!(e instanceof HTMLVideoElement)){var s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),typeof e=="string"&&(e=[e]);var o=e[0].src||e[0];jt.crossOrigin(s,o,r.crossorigin);for(var a=0;a<e.length;++a){var l=document.createElement("source"),u=e[a],c=u.src,h=u.mime;c=c||e[a];var f=c.split("?").shift().toLowerCase(),d=f.substr(f.lastIndexOf(".")+1);h=h||t.MIME_TYPES[d]||"video/"+d,l.src=c,l.type=h,s.appendChild(l)}e=s}return n=i.call(this,e)||this,n.noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=r.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=r.autoPlay!==!1,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),r.autoLoad!==!1&&n.load(),n}return t.prototype.update=function(e){if(!this.destroyed){var r=Ye.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(i.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},t.prototype.load=function(){var e=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(function(n){e.valid?n(e):(e._resolve=n,r.load())}),this._load},t.prototype._onError=function(e){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(e)},t.prototype._isSourcePlaying=function(){var e=this.source;return e.currentTime>0&&e.paused===!1&&e.ended===!1&&e.readyState>2},t.prototype._isSourceReady=function(){var e=this.source;return e.readyState===3||e.readyState===4},t.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Ye.shared.add(this.update,this),this._isConnectedToTicker=!0)},t.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Ye.shared.remove(this.update,this),this._isConnectedToTicker=!1)},t.prototype._onCanPlay=function(){var e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);var r=this.valid;this.resize(e.videoWidth,e.videoHeight),!r&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()},t.prototype.dispose=function(){this._isConnectedToTicker&&Ye.shared.remove(this.update,this);var e=this.source;e&&(e.removeEventListener("error",this._onError,!0),e.pause(),e.src="",e.load()),i.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Ye.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Ye.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(e){e!==this._updateFPS&&(this._updateFPS=e)},enumerable:!1,configurable:!0}),t.test=function(e,r){return e instanceof HTMLVideoElement||t.TYPES.indexOf(r)>-1},t.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],t.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},t})(jt),Gp=(function(i){fe(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.test=function(e){return!!window.createImageBitmap&&e instanceof ImageBitmap},t})(jt);Ps.push(Ou,Gp,Pu,Hp,Xp,zs,Up,kp);var Yp={Resource:Ei,BaseImageResource:jt,INSTALLED:Ps,autoDetectResource:Cu,AbstractMultiResource:Au,ArrayResource:kp,BufferResource:zs,CanvasResource:Pu,CubeResource:Up,ImageResource:Ou,SVGResource:Xp,VideoResource:Hp,ImageBitmapResource:Gp},lt=(function(){function i(t){this.renderer=t}return i.prototype.destroy=function(){this.renderer=null},i})(),m0=(function(i){fe(t,i);function t(){return i!==null&&i.apply(this,arguments)||this}return t.prototype.upload=function(e,r,n){var s=e.gl;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===qt.UNPACK),n.width===r.width&&n.height===r.height?s.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(n.width=r.width,n.height=r.height,s.texImage2D(r.target,0,e.context.webGLVersion===1?s.DEPTH_COMPONENT:s.DEPTH_COMPONENT16,r.width,r.height,0,r.format,r.type,this.data)),!0},t})(zs),Os=(function(){function i(t,e){this.width=Math.ceil(t||100),this.height=Math.ceil(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new qe("disposeFramebuffer"),this.multisample=Br.NONE}return Object.defineProperty(i.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),i.prototype.addColorTexture=function(t,e){return t===void 0&&(t=0),this.colorTextures[t]=e||new Ee(null,{scaleMode:Ct.NEAREST,resolution:1,mipmap:Ti.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},i.prototype.addDepthTexture=function(t){return this.depthTexture=t||new Ee(new m0(null,{width:this.width,height:this.height}),{scaleMode:Ct.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:Ti.OFF,format:wi.DEPTH_COMPONENT,type:De.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},i.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},i.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},i.prototype.resize=function(t,e){if(t=Math.ceil(t),e=Math.ceil(e),!(t===this.width&&e===this.height)){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var n=this.colorTextures[r],s=n.resolution;n.setSize(t/s,e/s)}if(this.depthTexture){var s=this.depthTexture.resolution;this.depthTexture.setSize(t/s,e/s)}}},i.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},i.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},i})(),on=(function(i){fe(t,i);function t(e){var r=this;if(typeof e=="number"){var n=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];e={width:n,height:s,scaleMode:o,resolution:a}}r=i.call(this,null,e)||this;var l=e||{},u=l.width,c=l.height;return r.mipmap=0,r.width=Math.ceil(u)||100,r.height=Math.ceil(c)||100,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new Os(r.width*r.resolution,r.height*r.resolution).addColorTexture(0,r),r.maskStack=[],r.filterStack=[{}],r}return t.prototype.resize=function(e,r){e=Math.ceil(e),r=Math.ceil(r),this.framebuffer.resize(e*this.resolution,r*this.resolution)},t.prototype.dispose=function(){this.framebuffer.dispose(),i.prototype.dispose.call(this)},t.prototype.destroy=function(){i.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},t})(Ee),Fu=(function(){function i(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return i.prototype.set=function(t,e,r){var n=e.width,s=e.height;if(r){var o=t.width/2/n,a=t.height/2/s,l=t.x/n+o,u=t.y/s+a;r=Fe.add(r,Fe.NW),this.x0=l+o*Fe.uX(r),this.y0=u+a*Fe.uY(r),r=Fe.add(r,2),this.x1=l+o*Fe.uX(r),this.y1=u+a*Fe.uY(r),r=Fe.add(r,2),this.x2=l+o*Fe.uX(r),this.y2=u+a*Fe.uY(r),r=Fe.add(r,2),this.x3=l+o*Fe.uX(r),this.y3=u+a*Fe.uY(r)}else this.x0=t.x/n,this.y0=t.y/s,this.x1=(t.x+t.width)/n,this.y1=t.y/s,this.x2=(t.x+t.width)/n,this.y2=(t.y+t.height)/s,this.x3=t.x/n,this.y3=(t.y+t.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},i})(),Uh=new Fu,le=(function(i){fe(t,i);function t(e,r,n,s,o,a){var l=i.call(this)||this;if(l.noFrame=!1,r||(l.noFrame=!0,r=new ge(0,0,1,1)),e instanceof t&&(e=e.baseTexture),l.baseTexture=e,l._frame=r,l.trim=s,l.valid=!1,l._uvs=Uh,l.uvMatrix=null,l.orig=n||r,l._rotate=Number(o||0),o===!0)l._rotate=2;else if(l._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return l.defaultAnchor=a?new ze(a.x,a.y):new ze(0,0),l._updateID=0,l.textureCacheIds=[],e.valid?l.noFrame?e.valid&&l.onBaseTextureUpdated(e):l.frame=r:e.once("loaded",l.onBaseTextureUpdated,l),l.noFrame&&e.on("update",l.onBaseTextureUpdated,l),l}return t.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},t.prototype.onBaseTextureUpdated=function(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},t.prototype.destroy=function(e){if(this.baseTexture){if(e){var r=this.baseTexture;r&&r.url&&nt[r.url]&&t.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null},t.prototype.clone=function(){return new t(this.baseTexture,this.frame.clone(),this.orig.clone(),this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor)},t.prototype.updateUvs=function(){this._uvs===Uh&&(this._uvs=new Fu),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},t.from=function(e,r,n){r===void 0&&(r={}),n===void 0&&(n=ne.STRICT_TEXTURE_CACHE);var s=typeof e=="string",o=null;s?o=e:(e._pixiId||(e._pixiId="pixiid_"+kr()),o=e._pixiId);var a=nt[o];if(s&&n&&!a)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return a||(r.resolution||(r.resolution=dn(e)),a=new t(new Ee(e,r)),a.baseTexture.cacheId=o,Ee.addToCache(a.baseTexture,o),t.addToCache(a,o)),a},t.fromURL=function(e,r){var n=Object.assign({autoLoad:!1},r?.resourceOptions),s=t.from(e,Object.assign({resourceOptions:n},r),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(function(){return Promise.resolve(s)})},t.fromBuffer=function(e,r,n,s){return new t(Ee.fromBuffer(e,r,n,s))},t.fromLoader=function(e,r,n){var s=new Ou(e);s.url=r;var o=new Ee(s,{scaleMode:ne.SCALE_MODE,resolution:dn(r)}),a=new t(o);return n||(n=r),Ee.addToCache(a.baseTexture,n),t.addToCache(a,n),n!==r&&(Ee.addToCache(a.baseTexture,r),t.addToCache(a,r)),a},t.addToCache=function(e,r){r&&(e.textureCacheIds.indexOf(r)===-1&&e.textureCacheIds.push(r),nt[r]&&console.warn("Texture added to the cache with an id ["+r+"] that already had an entry"),nt[r]=e)},t.removeFromCache=function(e){if(typeof e=="string"){var r=nt[e];if(r){var n=r.textureCacheIds.indexOf(e);return n>-1&&r.textureCacheIds.splice(n,1),delete nt[e],r}}else if(e&&e.textureCacheIds){for(var s=0;s<e.textureCacheIds.length;++s)nt[e.textureCacheIds[s]]===e&&delete nt[e.textureCacheIds[s]];return e.textureCacheIds.length=0,e}return null},Object.defineProperty(t.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"frame",{get:function(){return this._frame},set:function(e){this._frame=e,this.noFrame=!1;var r=e.x,n=e.y,s=e.width,o=e.height,a=r+s>this.baseTexture.width,l=n+o>this.baseTexture.height;if(a||l){var u=a&&l?"and":"or",c="X: "+r+" + "+s+" = "+(r+s)+" > "+this.baseTexture.width,h="Y: "+n+" + "+o+" = "+(n+o)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(c+" "+u+" "+h))}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=e),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rotate",{get:function(){return this._rotate},set:function(e){this._rotate=e,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),t.prototype.castToBaseTexture=function(){return this.baseTexture},t})(Ri);function v0(){var i=document.createElement("canvas");i.width=16,i.height=16;var t=i.getContext("2d");return t.fillStyle="white",t.fillRect(0,0,16,16),new le(new Ee(new Pu(i)))}function $s(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}le.EMPTY=new le(new Ee);$s(le.EMPTY);$s(le.EMPTY.baseTexture);le.WHITE=v0();$s(le.WHITE);$s(le.WHITE.baseTexture);var Ur=(function(i){fe(t,i);function t(e,r){var n=this,s=null;if(!(e instanceof on)){var o=arguments[1],a=arguments[2],l=arguments[3],u=arguments[4];console.warn("Please use RenderTexture.create("+o+", "+a+") instead of the ctor directly."),s=arguments[0],r=null,e=new on({width:o,height:a,scaleMode:l,resolution:u})}return n=i.call(this,e,r)||this,n.legacyRenderer=s,n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Object.defineProperty(t.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),t.prototype.resize=function(e,r,n){n===void 0&&(n=!0),e=Math.ceil(e),r=Math.ceil(r),this.valid=e>0&&r>0,this._frame.width=this.orig.width=e,this._frame.height=this.orig.height=r,n&&this.baseTexture.resize(e,r),this.updateUvs()},t.prototype.setResolution=function(e){var r=this.baseTexture;r.resolution!==e&&(r.setResolution(e),this.resize(r.width,r.height,!1))},t.create=function(e){return typeof e=="number"&&(e={width:e,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new t(new on(e))},t})(le),zp=(function(){function i(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return i.prototype.createTexture=function(t,e){var r=new on(Object.assign({width:t,height:e,resolution:1},this.textureOptions));return new Ur(r)},i.prototype.getOptimalTexture=function(t,e,r){r===void 0&&(r=1);var n=i.SCREEN_KEY;t*=r,e*=r,(!this.enableFullScreen||t!==this._pixelsWidth||e!==this._pixelsHeight)&&(t=fn(t),e=fn(e),n=(t&65535)<<16|e&65535),this.texturePool[n]||(this.texturePool[n]=[]);var s=this.texturePool[n].pop();return s||(s=this.createTexture(t,e)),s.filterPoolKey=n,s.setResolution(r),s},i.prototype.getFilterTexture=function(t,e){var r=this.getOptimalTexture(t.width,t.height,e||t.resolution);return r.filterFrame=t.filterFrame,r},i.prototype.returnTexture=function(t){var e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)},i.prototype.returnFilterTexture=function(t){this.returnTexture(t)},i.prototype.clear=function(t){if(t=t!==!1,t)for(var e in this.texturePool){var r=this.texturePool[e];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}},i.prototype.setScreenSize=function(t){if(!(t.width===this._pixelsWidth&&t.height===this._pixelsHeight)){var e=i.SCREEN_KEY,r=this.texturePool[e];if(this.enableFullScreen=t.width>0&&t.height>0,r)for(var n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[e]=[],this._pixelsWidth=t.width,this._pixelsHeight=t.height}},i.SCREEN_KEY="screen",i})(),pl=(function(){function i(t,e,r,n,s,o,a){e===void 0&&(e=0),r===void 0&&(r=!1),n===void 0&&(n=5126),this.buffer=t,this.size=e,this.normalized=r,this.type=n,this.stride=s,this.start=o,this.instance=a}return i.prototype.destroy=function(){this.buffer=null},i.from=function(t,e,r,n,s){return new i(t,e,r,n,s)},i})(),g0=0,Be=(function(){function i(t,e,r){e===void 0&&(e=!0),r===void 0&&(r=!1),this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=e,this.id=g0++,this.disposeRunner=new qe("disposeBuffer")}return i.prototype.update=function(t){this.data=t||this.data,this._updateID++},i.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},i.prototype.destroy=function(){this.dispose(),this.data=null},i.from=function(t){return t instanceof Array&&(t=new Float32Array(t)),new i(t)},i})();function $p(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}var b0={Float32Array,Uint32Array,Int32Array,Uint8Array};function _0(i,t){for(var e=0,r=0,n={},s=0;s<i.length;s++)r+=t[s],e+=i[s].length;for(var o=new ArrayBuffer(e*4),a=null,l=0,s=0;s<i.length;s++){var u=t[s],c=i[s],h=$p(c);n[h]||(n[h]=new b0[h](o)),a=n[h];for(var f=0;f<c.length;f++){var d=(f/u|0)*r+l,p=f%u;a[d+p]=c[f]}l+=u}return new Float32Array(o)}var Xh={5126:4,5123:2,5121:1},x0=0,w0={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},zr=(function(){function i(t,e){t===void 0&&(t=[]),e===void 0&&(e={}),this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=x0++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new qe("disposeGeometry"),this.refCount=0}return i.prototype.addAttribute=function(t,e,r,n,s,o,a,l){if(r===void 0&&(r=0),n===void 0&&(n=!1),l===void 0&&(l=!1),!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof Be||(e instanceof Array&&(e=new Float32Array(e)),e=new Be(e));var u=t.split("|");if(u.length>1){for(var c=0;c<u.length;c++)this.addAttribute(u[c],e,r,n,s);return this}var h=this.buffers.indexOf(e);return h===-1&&(this.buffers.push(e),h=this.buffers.length-1),this.attributes[t]=new pl(h,r,n,s,o,a,l),this.instanced=this.instanced||l,this},i.prototype.getAttribute=function(t){return this.attributes[t]},i.prototype.getBuffer=function(t){return this.buffers[this.getAttribute(t).buffer]},i.prototype.addIndex=function(t){return t instanceof Be||(t instanceof Array&&(t=new Uint16Array(t)),t=new Be(t)),t.index=!0,this.indexBuffer=t,this.buffers.indexOf(t)===-1&&this.buffers.push(t),this},i.prototype.getIndex=function(){return this.indexBuffer},i.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var t=[],e=[],r=new Be,n;for(n in this.attributes){var s=this.attributes[n],o=this.buffers[s.buffer];t.push(o.data),e.push(s.size*Xh[s.type]/4),s.buffer=0}for(r.data=_0(t,e),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},i.prototype.getSize=function(){for(var t in this.attributes){var e=this.attributes[t],r=this.buffers[e.buffer];return r.data.length/(e.stride/4||e.size)}return 0},i.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},i.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},i.prototype.clone=function(){for(var t=new i,e=0;e<this.buffers.length;e++)t.buffers[e]=new Be(this.buffers[e].data.slice(0));for(var e in this.attributes){var r=this.attributes[e];t.attributes[e]=new pl(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.index=!0),t},i.merge=function(t){for(var e=new i,r=[],n=[],s=[],o,a=0;a<t.length;a++){o=t[a];for(var l=0;l<o.buffers.length;l++)n[l]=n[l]||0,n[l]+=o.buffers[l].data.length,s[l]=0}for(var a=0;a<o.buffers.length;a++)r[a]=new w0[$p(o.buffers[a].data)](n[a]),e.buffers[a]=new Be(r[a]);for(var a=0;a<t.length;a++){o=t[a];for(var l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,s[l]),s[l]+=o.buffers[l].data.length}if(e.attributes=o.attributes,o.indexBuffer){e.indexBuffer=e.buffers[o.buffers.indexOf(o.indexBuffer)],e.indexBuffer.index=!0;for(var u=0,c=0,h=0,f=0,a=0;a<o.buffers.length;a++)if(o.buffers[a]!==o.indexBuffer){f=a;break}for(var a in o.attributes){var d=o.attributes[a];(d.buffer|0)===f&&(c+=d.size*Xh[d.type]/4)}for(var a=0;a<t.length;a++){for(var p=t[a].indexBuffer.data,l=0;l<p.length;l++)e.indexBuffer.data[l+h]+=u;u+=o.buffers[f].data.length/c,h+=p.length}}return e},i})(),Vp=(function(i){fe(t,i);function t(){var e=i.call(this)||this;return e.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),e}return t})(zr),Mu=(function(i){fe(t,i);function t(){var e=i.call(this)||this;return e.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),e.uvs=new Float32Array([0,0,1,0,1,1,0,1]),e.vertexBuffer=new Be(e.vertices),e.uvBuffer=new Be(e.uvs),e.addAttribute("aVertexPosition",e.vertexBuffer).addAttribute("aTextureCoord",e.uvBuffer).addIndex([0,1,2,0,2,3]),e}return t.prototype.map=function(e,r){var n=0,s=0;return this.uvs[0]=n,this.uvs[1]=s,this.uvs[2]=n+r.width/e.width,this.uvs[3]=s,this.uvs[4]=n+r.width/e.width,this.uvs[5]=s+r.height/e.height,this.uvs[6]=n,this.uvs[7]=s+r.height/e.height,n=r.x,s=r.y,this.vertices[0]=n,this.vertices[1]=s,this.vertices[2]=n+r.width,this.vertices[3]=s,this.vertices[4]=n+r.width,this.vertices[5]=s+r.height,this.vertices[6]=n,this.vertices[7]=s+r.height,this.invalidate(),this},t.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},t})(zr),T0=0,fr=(function(){function i(t,e){this.uniforms=t,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=T0++,this.static=!!e}return i.prototype.update=function(){this.dirtyId++},i.prototype.add=function(t,e,r){this.uniforms[t]=new i(e,r)},i.from=function(t,e){return new i(t,e)},i})(),qp=(function(){function i(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new ge,this.destinationFrame=new ge,this.filters=[]}return i.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},i})(),jp=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.defaultFilterStack=[{}],r.texturePool=new zp,r.texturePool.setScreenSize(e.view),r.statePool=[],r.quad=new Vp,r.quadUv=new Mu,r.tempRect=new ge,r.activeState={},r.globalUniforms=new fr({outputFrame:r.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),r.forceClear=!1,r.useMaxPadding=!1,r}return t.prototype.push=function(e,r){for(var n=this.renderer,s=this.defaultFilterStack,o=this.statePool.pop()||new qp,a=r[0].resolution,l=r[0].padding,u=r[0].autoFit,c=r[0].legacy,h=1;h<r.length;h++){var f=r[h];a=Math.min(a,f.resolution),l=this.useMaxPadding?Math.max(l,f.padding):l+f.padding,u=u&&f.autoFit,c=c||f.legacy}s.length===1&&(this.defaultFilterStack[0].renderTexture=n.renderTexture.current),s.push(o),o.resolution=a,o.legacy=c,o.target=e,o.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),o.sourceFrame.pad(l),u&&o.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),o.sourceFrame.ceil(a),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,a),o.filters=r,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;var d=this.tempRect;d.width=o.sourceFrame.width,d.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,n.renderTexture.bind(o.renderTexture,o.sourceFrame,d),n.renderTexture.clear()},t.prototype.pop=function(){var e=this.defaultFilterStack,r=e.pop(),n=r.filters;this.activeState=r;var s=this.globalUniforms.uniforms;s.outputFrame=r.sourceFrame,s.resolution=r.resolution;var o=s.inputSize,a=s.inputPixel,l=s.inputClamp;if(o[0]=r.destinationFrame.width,o[1]=r.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],a[0]=o[0]*r.resolution,a[1]=o[1]*r.resolution,a[2]=1/a[0],a[3]=1/a[1],l[0]=.5*a[2],l[1]=.5*a[3],l[2]=r.sourceFrame.width*o[2]-.5*a[2],l[3]=r.sourceFrame.height*o[3]-.5*a[3],r.legacy){var u=s.filterArea;u[0]=r.destinationFrame.width,u[1]=r.destinationFrame.height,u[2]=r.sourceFrame.x,u[3]=r.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();var c=e[e.length-1];if(r.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),n.length===1)n[0].apply(this,r.renderTexture,c.renderTexture,Et.BLEND,r),this.returnFilterTexture(r.renderTexture);else{var h=r.renderTexture,f=this.getOptimalFilterTexture(h.width,h.height,r.resolution);f.filterFrame=h.filterFrame;var d=0;for(d=0;d<n.length-1;++d){n[d].apply(this,h,f,Et.CLEAR,r);var p=h;h=f,f=p}n[d].apply(this,h,c.renderTexture,Et.BLEND,r),this.returnFilterTexture(h),this.returnFilterTexture(f)}r.clear(),this.statePool.push(r)},t.prototype.bindAndClear=function(e,r){if(r===void 0&&(r=Et.CLEAR),e&&e.filterFrame){var n=this.tempRect;n.width=e.filterFrame.width,n.height=e.filterFrame.height,this.renderer.renderTexture.bind(e,e.filterFrame,n)}else this.renderer.renderTexture.bind(e);typeof r=="boolean"&&(r=r?Et.CLEAR:Et.BLEND,W("5.2.1","Use CLEAR_MODES when using clear applyFilter option")),(r===Et.CLEAR||r===Et.BLIT&&this.forceClear)&&this.renderer.renderTexture.clear()},t.prototype.applyFilter=function(e,r,n,s){var o=this.renderer;this.bindAndClear(n,s),e.uniforms.uSampler=r,e.uniforms.filterGlobals=this.globalUniforms,o.state.set(e.state),o.shader.bind(e),e.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(ft.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(ft.TRIANGLE_STRIP))},t.prototype.calculateSpriteMatrix=function(e,r){var n=this.activeState,s=n.sourceFrame,o=n.destinationFrame,a=r._texture.orig,l=e.set(o.width,0,0,o.height,s.x,s.y),u=r.worldTransform.copyTo(Le.TEMP_MATRIX);return u.invert(),l.prepend(u),l.scale(1/a.width,1/a.height),l.translate(r.anchor.x,r.anchor.y),l},t.prototype.destroy=function(){this.texturePool.clear(!1)},t.prototype.getOptimalFilterTexture=function(e,r,n){return n===void 0&&(n=1),this.texturePool.getOptimalTexture(e,r,n)},t.prototype.getFilterTexture=function(e,r){if(typeof e=="number"){var n=e;e=r,r=n}e=e||this.activeState.renderTexture;var s=this.texturePool.getOptimalTexture(e.width,e.height,r||e.resolution);return s.filterFrame=e.filterFrame,s},t.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},t.prototype.emptyPool=function(){this.texturePool.clear(!0)},t.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},t})(lt),Ni=(function(){function i(t){this.renderer=t}return i.prototype.flush=function(){},i.prototype.destroy=function(){this.renderer=null},i.prototype.start=function(){},i.prototype.stop=function(){this.flush()},i.prototype.render=function(t){},i})(),Wp=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.emptyRenderer=new Ni(e),r.currentRenderer=r.emptyRenderer,r}return t.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},t.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.copyBoundTextures=function(e,r){for(var n=this.renderer.texture.boundTextures,s=r-1;s>=0;--s)e[s]=n[s]||null,e[s]&&(e[s]._batchLocation=s)},t.prototype.boundArray=function(e,r,n,s){for(var o=e.elements,a=e.ids,l=e.count,u=0,c=0;c<l;c++){var h=o[c],f=h._batchLocation;if(f>=0&&f<s&&r[f]===h){a[c]=f;continue}for(;u<s;){var d=r[u];if(d&&d._batchEnabled===n&&d._batchLocation===u){u++;continue}a[c]=u,h._batchLocation=u,r[u]=h;break}}},t})(lt),Hh=0,Kp=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.webGLVersion=1,r.extensions={},r.supports={uint32Indices:!1},r.handleContextLost=r.handleContextLost.bind(r),r.handleContextRestored=r.handleContextRestored.bind(r),e.view.addEventListener("webglcontextlost",r.handleContextLost,!1),e.view.addEventListener("webglcontextrestored",r.handleContextRestored,!1),r}return Object.defineProperty(t.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),t.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=Hh++,e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext()},t.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=Hh++,this.renderer.runners.contextChange.emit(e)},t.prototype.initFromOptions=function(e){var r=this.createContext(this.renderer.view,e);this.initFromContext(r)},t.prototype.createContext=function(e,r){var n;if(ne.PREFER_ENV>=Nt.WEBGL2&&(n=e.getContext("webgl2",r)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=e.getContext("webgl",r)||e.getContext("experimental-webgl",r),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl},t.prototype.getExtensions=function(){var e=this.gl;this.webGLVersion===1?Object.assign(this.extensions,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBGL_depth_texture"),loseContext:e.getExtension("WEBGL_lose_context"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,{anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:e.getExtension("EXT_color_buffer_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear")})},t.prototype.handleContextLost=function(e){e.preventDefault()},t.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},t.prototype.destroy=function(){var e=this.renderer.view;e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},t.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},t.prototype.validateContext=function(e){var r=e.getContextAttributes(),n="WebGL2RenderingContext"in window&&e instanceof window.WebGL2RenderingContext;n&&(this.webGLVersion=2),r.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var s=n||!!e.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},t})(lt),Zp=(function(){function i(t){this.framebuffer=t,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=Br.NONE,this.msaaBuffer=null,this.blitFramebuffer=null}return i})(),I0=new ge,Jp=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.managedFramebuffers=[],r.unknownFramebuffer=new Os(10,10),r.msaaSamples=null,r}return t.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new ge,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){var r=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;ne.PREFER_ENV===Nt.WEBGL_LEGACY&&(r=null,n=null),r?e.drawBuffers=function(s){return r.drawBuffersWEBGL(s)}:(this.hasMRT=!1,e.drawBuffers=function(){}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=e.getInternalformatParameter(e.RENDERBUFFER,e.RGBA8,e.SAMPLES)},t.prototype.bind=function(e,r){var n=this.gl;if(e){var s=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.dirtyId!==e.dirtyId&&(s.dirtyId=e.dirtyId,s.dirtyFormat!==e.dirtyFormat?(s.dirtyFormat=e.dirtyFormat,this.updateFramebuffer(e)):s.dirtySize!==e.dirtySize&&(s.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var o=0;o<e.colorTextures.length;o++){var a=e.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,e.width,e.height)}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},t.prototype.setViewport=function(e,r,n,s){var o=this.viewport;(o.width!==n||o.height!==s||o.x!==e||o.y!==r)&&(o.x=e,o.y=r,o.width=n,o.height=s,this.gl.viewport(e,r,n,s))},Object.defineProperty(t.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),t.prototype.clear=function(e,r,n,s,o){o===void 0&&(o=hn.COLOR|hn.DEPTH);var a=this.gl;a.clearColor(e,r,n,s),a.clear(o)},t.prototype.initFramebuffer=function(e){var r=this.gl,n=new Zp(r.createFramebuffer());return n.multisample=this.detectSamples(e.multisample),e.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(e),e.disposeRunner.add(this),n},t.prototype.resizeFramebuffer=function(e){var r=this.gl,n=e.glFramebuffers[this.CONTEXT_UID];n.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height));for(var s=e.colorTextures,o=0;o<s.length;o++)this.renderer.texture.bind(s[o],0);e.depthTexture&&this.renderer.texture.bind(e.depthTexture,0)},t.prototype.updateFramebuffer=function(e){var r=this.gl,n=e.glFramebuffers[this.CONTEXT_UID],s=e.colorTextures,o=s.length;r.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&(n.msaaBuffer=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.RGBA8,e.width,e.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer));for(var a=[],l=0;l<o;l++)if(!(l===0&&n.multisample>1)){var u=e.colorTextures[l],c=u.parentTextureArray||u;this.renderer.texture.bind(c,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,u.target,c._glTextures[this.CONTEXT_UID].texture,0),a.push(r.COLOR_ATTACHMENT0+l)}if(a.length>1&&r.drawBuffers(a),e.depthTexture){var h=this.writeDepthTexture;if(h){var f=e.depthTexture;this.renderer.texture.bind(f,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,f._glTextures[this.CONTEXT_UID].texture,0)}}!n.stencil&&(e.stencil||e.depth)&&(n.stencil=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,e.width,e.height),e.depthTexture||r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil))},t.prototype.detectSamples=function(e){var r=this.msaaSamples,n=Br.NONE;if(e<=1||r===null)return n;for(var s=0;s<r.length;s++)if(r[s]<=e){n=r[s];break}return n===1&&(n=Br.NONE),n},t.prototype.blit=function(e,r,n){var s=this,o=s.current,a=s.renderer,l=s.gl,u=s.CONTEXT_UID;if(a.context.webGLVersion===2&&o){var c=o.glFramebuffers[u];if(c){if(!e){if(c.multisample<=1)return;c.blitFramebuffer||(c.blitFramebuffer=new Os(o.width,o.height),c.blitFramebuffer.addColorTexture(0,o.colorTextures[0])),e=c.blitFramebuffer,e.width=o.width,e.height=o.height}r||(r=I0,r.width=o.width,r.height=o.height),n||(n=r);var h=r.width===n.width&&r.height===n.height;this.bind(e),l.bindFramebuffer(l.READ_FRAMEBUFFER,c.framebuffer),l.blitFramebuffer(r.x,r.y,r.width,r.height,n.x,n.y,n.width,n.height,l.COLOR_BUFFER_BIT,h?l.NEAREST:l.LINEAR)}}},t.prototype.disposeFramebuffer=function(e,r){var n=e.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(n){delete e.glFramebuffers[this.CONTEXT_UID];var o=this.managedFramebuffers.indexOf(e);o>=0&&this.managedFramebuffers.splice(o,1),e.disposeRunner.remove(this),r||(s.deleteFramebuffer(n.framebuffer),n.stencil&&s.deleteRenderbuffer(n.stencil))}},t.prototype.disposeAll=function(e){var r=this.managedFramebuffers;this.managedFramebuffers=[];for(var n=0;n<r.length;n++)this.disposeFramebuffer(r[n],e)},t.prototype.forceStencil=function(){var e=this.current;if(e){var r=e.glFramebuffers[this.CONTEXT_UID];if(!(!r||r.stencil)){e.enableStencil();var n=e.width,s=e.height,o=this.gl,a=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,a),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,n,s),r.stencil=a,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,a)}}},t.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new ge},t})(lt),E0=(function(){function i(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return i})(),ba={5126:4,5123:2,5121:1},Qp=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r._activeGeometry=null,r._activeVao=null,r.hasVao=!0,r.hasInstance=!0,r.canUseUInt32ElementIndex=!1,r.managedGeometries={},r.managedBuffers={},r}return t.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,r.webGLVersion!==2){var n=this.renderer.context.extensions.vertexArrayObject;ne.PREFER_ENV===Nt.WEBGL_LEGACY&&(n=null),n?(e.createVertexArray=function(){return n.createVertexArrayOES()},e.bindVertexArray=function(o){return n.bindVertexArrayOES(o)},e.deleteVertexArray=function(o){return n.deleteVertexArrayOES(o)}):(this.hasVao=!1,e.createVertexArray=function(){return null},e.bindVertexArray=function(){return null},e.deleteVertexArray=function(){return null})}if(r.webGLVersion!==2){var s=e.getExtension("ANGLE_instanced_arrays");s?(e.vertexAttribDivisor=function(o,a){return s.vertexAttribDivisorANGLE(o,a)},e.drawElementsInstanced=function(o,a,l,u,c){return s.drawElementsInstancedANGLE(o,a,l,u,c)},e.drawArraysInstanced=function(o,a,l,u){return s.drawArraysInstancedANGLE(o,a,l,u)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=r.webGLVersion===2||!!r.extensions.uint32ElementIndex},t.prototype.bind=function(e,r){r=r||this.renderer.shader.shader;var n=this.gl,s=e.glVertexArrayObjects[this.CONTEXT_UID],o=!1;s||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=s={},o=!0);var a=s[r.program.id]||this.initGeometryVao(e,r.program,o);this._activeGeometry=e,this._activeVao!==a&&(this._activeVao=a,this.hasVao?n.bindVertexArray(a):this.activateVao(e,r.program)),this.updateBuffers()},t.prototype.reset=function(){this.unbind()},t.prototype.updateBuffers=function(){for(var e=this._activeGeometry,r=this.gl,n=0;n<e.buffers.length;n++){var s=e.buffers[n],o=s._glBuffers[this.CONTEXT_UID];if(s._updateID!==o.updateID){o.updateID=s._updateID;var a=s.index?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER;if(r.bindBuffer(a,o.buffer),this._boundBuffer=o,o.byteLength>=s.data.byteLength)r.bufferSubData(a,0,s.data);else{var l=s.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;o.byteLength=s.data.byteLength,r.bufferData(a,s.data,l)}}}},t.prototype.checkCompatibility=function(e,r){var n=e.attributes,s=r.attributeData;for(var o in s)if(!n[o])throw new Error('shader and geometry incompatible, geometry missing the "'+o+'" attribute')},t.prototype.getSignature=function(e,r){var n=e.attributes,s=r.attributeData,o=["g",e.id];for(var a in n)s[a]&&o.push(a);return o.join("-")},t.prototype.initGeometryVao=function(e,r,n){n===void 0&&(n=!0),this.checkCompatibility(e,r);var s=this.gl,o=this.CONTEXT_UID,a=this.getSignature(e,r),l=e.glVertexArrayObjects[this.CONTEXT_UID],u=l[a];if(u)return l[r.id]=u,u;var c=e.buffers,h=e.attributes,f={},d={};for(var p in c)f[p]=0,d[p]=0;for(var p in h)!h[p].size&&r.attributeData[p]?h[p].size=r.attributeData[p].size:h[p].size||console.warn("PIXI Geometry attribute '"+p+"' size cannot be determined (likely the bound shader does not have the attribute)"),f[h[p].buffer]+=h[p].size*ba[h[p].type];for(var p in h){var v=h[p],y=v.size;v.stride===void 0&&(f[v.buffer]===y*ba[v.type]?v.stride=0:v.stride=f[v.buffer]),v.start===void 0&&(v.start=d[v.buffer],d[v.buffer]+=y*ba[v.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(var g=0;g<c.length;g++){var E=c[g];E._glBuffers[o]||(E._glBuffers[o]=new E0(s.createBuffer()),this.managedBuffers[E.id]=E,E.disposeRunner.add(this)),n&&E._glBuffers[o].refCount++}return this.activateVao(e,r),this._activeVao=u,l[r.id]=u,l[a]=u,u},t.prototype.disposeBuffer=function(e,r){if(this.managedBuffers[e.id]){delete this.managedBuffers[e.id];var n=e._glBuffers[this.CONTEXT_UID],s=this.gl;e.disposeRunner.remove(this),n&&(r||s.deleteBuffer(n.buffer),delete e._glBuffers[this.CONTEXT_UID])}},t.prototype.disposeGeometry=function(e,r){if(this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var n=e.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=e.buffers;if(e.disposeRunner.remove(this),!!n){for(var a=0;a<o.length;a++){var l=o[a]._glBuffers[this.CONTEXT_UID];l.refCount--,l.refCount===0&&!r&&this.disposeBuffer(o[a],r)}if(!r){for(var u in n)if(u[0]==="g"){var c=n[u];this._activeVao===c&&this.unbind(),s.deleteVertexArray(c)}}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},t.prototype.disposeAll=function(e){for(var r=Object.keys(this.managedGeometries),n=0;n<r.length;n++)this.disposeGeometry(this.managedGeometries[r[n]],e);r=Object.keys(this.managedBuffers);for(var n=0;n<r.length;n++)this.disposeBuffer(this.managedBuffers[r[n]],e)},t.prototype.activateVao=function(e,r){var n=this.gl,s=this.CONTEXT_UID,o=e.buffers,a=e.attributes;e.indexBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.indexBuffer._glBuffers[s].buffer);var l=null;for(var u in a){var c=a[u],h=o[c.buffer],f=h._glBuffers[s];if(r.attributeData[u]){l!==f&&(n.bindBuffer(n.ARRAY_BUFFER,f.buffer),l=f);var d=r.attributeData[u].location;if(n.enableVertexAttribArray(d),n.vertexAttribPointer(d,c.size,c.type||n.FLOAT,c.normalized,c.stride,c.start),c.instance)if(this.hasInstance)n.vertexAttribDivisor(d,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},t.prototype.draw=function(e,r,n,s){var o=this.gl,a=this._activeGeometry;if(a.indexBuffer){var l=a.indexBuffer.data.BYTES_PER_ELEMENT,u=l===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?a.instanced?o.drawElementsInstanced(e,r||a.indexBuffer.data.length,u,(n||0)*l,s||1):o.drawElements(e,r||a.indexBuffer.data.length,u,(n||0)*l):console.warn("unsupported index buffer type: uint32")}else a.instanced?o.drawArraysInstanced(e,n,r||a.getSize(),s||1):o.drawArrays(e,n,r||a.getSize());return this},t.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},t})(lt),ey=(function(){function i(t){t===void 0&&(t=null),this.type=it.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return i.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=it.NONE,this.autoDetect=!0),this._target=null},i.prototype.copyCountersOrReset=function(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},i})();function Gh(i,t,e){var r=i.createShader(t);return i.shaderSource(r,e),i.compileShader(r),r}function ty(i,t,e,r){var n=Gh(i,i.VERTEX_SHADER,t),s=Gh(i,i.FRAGMENT_SHADER,e),o=i.createProgram();if(i.attachShader(o,n),i.attachShader(o,s),r)for(var a in r)i.bindAttribLocation(o,r[a],a);return i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)||(i.getShaderParameter(n,i.COMPILE_STATUS)||(console.warn(t),console.error(i.getShaderInfoLog(n))),i.getShaderParameter(s,i.COMPILE_STATUS)||(console.warn(e),console.error(i.getShaderInfoLog(s))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",i.getProgramParameter(o,i.VALIDATE_STATUS)),console.error("gl.getError()",i.getError()),i.getProgramInfoLog(o)!==""&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(o)),i.deleteProgram(o),o=null),i.deleteShader(n),i.deleteShader(s),o}function _a(i){for(var t=new Array(i),e=0;e<t.length;e++)t[e]=!1;return t}function ry(i,t){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"bool":return!1;case"bvec2":return _a(2*t);case"bvec3":return _a(3*t);case"bvec4":return _a(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var iy={},zi=iy;function ny(){if(zi===iy||zi&&zi.isContextLost()){var i=document.createElement("canvas"),t=void 0;ne.PREFER_ENV>=Nt.WEBGL2&&(t=i.getContext("webgl2",{})),t||(t=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),t?t.getExtension("WEBGL_draw_buffers"):t=null),zi=t}return zi}var zn;function S0(){if(!zn){zn=At.MEDIUM;var i=ny();if(i&&i.getShaderPrecisionFormat){var t=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);zn=t.precision?At.HIGH:At.MEDIUM}}return zn}function Yh(i,t,e){if(i.substring(0,9)!=="precision"){var r=t;return t===At.HIGH&&e!==At.HIGH&&(r=At.MEDIUM),"precision "+r+` float;
`+i}else if(e!==At.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}var C0={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function A0(i){return C0[i]}var $n=null,zh={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function $h(i,t){if(!$n){var e=Object.keys(zh);$n={};for(var r=0;r<e.length;++r){var n=e[r];$n[i[n]]=zh[n]}}return $n[t]}var gs=[{test:function(i){return i.type==="float"&&i.size===1},code:function(i){return`
            if(uv["`+i+'"] !== ud["'+i+`"].value)
            {
                ud["`+i+'"].value = uv["'+i+`"]
                gl.uniform1f(ud["`+i+'"].location, uv["'+i+`"])
            }
            `}},{test:function(i){return(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray},code:function(i){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+i+`"], t);

            if(ud["`+i+`"].value !== t)
            {
                ud["`+i+`"].value = t;
                gl.uniform1i(ud["`+i+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(i,t){return i.type==="mat3"&&i.size===1&&t.a!==void 0},code:function(i){return`
            gl.uniformMatrix3fv(ud["`+i+'"].location, false, uv["'+i+`"].toArray(true));
            `}},{test:function(i,t){return i.type==="vec2"&&i.size===1&&t.x!==void 0},code:function(i){return`
                cv = ud["`+i+`"].value;
                v = uv["`+i+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+i+`"].location, v.x, v.y);
                }`}},{test:function(i){return i.type==="vec2"&&i.size===1},code:function(i){return`
                cv = ud["`+i+`"].value;
                v = uv["`+i+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+i+`"].location, v[0], v[1]);
                }
            `}},{test:function(i,t){return i.type==="vec4"&&i.size===1&&t.width!==void 0},code:function(i){return`
                cv = ud["`+i+`"].value;
                v = uv["`+i+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+i+`"].location, v.x, v.y, v.width, v.height)
                }`}},{test:function(i){return i.type==="vec4"&&i.size===1},code:function(i){return`
                cv = ud["`+i+`"].value;
                v = uv["`+i+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+i+`"].location, v[0], v[1], v[2], v[3])
                }`}}],P0={float:`
    if(cv !== v)
    {
        cv.v = v;
        gl.uniform1f(location, v)
    }`,vec2:`
    if(cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},O0={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function F0(i,t){var e=[`
        var v = null;
        var cv = null
        var t = 0;
        var gl = renderer.gl
    `];for(var r in i.uniforms){var n=t[r];if(!n){i.uniforms[r].group&&e.push(`
                    renderer.shader.syncUniformGroup(uv["`+r+`"], syncData);
                `);continue}for(var s=i.uniforms[r],o=!1,a=0;a<gs.length;a++)if(gs[a].test(n,s)){e.push(gs[a].code(r,s)),o=!0;break}if(!o){var l=n.size===1?P0:O0,u=l[n.type].replace("location",'ud["'+r+'"].location');e.push(`
            cv = ud["`+r+`"].value;
            v = uv["`+r+`"];
            `+u+";")}}return new Function("ud","uv","renderer","syncData",e.join(`
`))}var M0=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function R0(i){for(var t="",e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+="if(test == "+e+".0){}");return t}function sy(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var e=t.createShader(t.FRAGMENT_SHADER);;){var r=M0.replace(/%forloop%/gi,R0(i));if(t.shaderSource(e,r),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}return i}var $i;function L0(){if(typeof $i=="boolean")return $i;try{var i=new Function("param1","param2","param3","return param1[param2] === param3;");$i=i({a:"b"},"a","b")===!0}catch{$i=!1}return $i}var N0=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,B0=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,D0=0,Vn={},Bi=(function(){function i(t,e,r){r===void 0&&(r="pixi-shader"),this.id=D0++,this.vertexSrc=t||i.defaultVertexSrc,this.fragmentSrc=e||i.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Vn[r]?(Vn[r]++,r+="-"+Vn[r]):Vn[r]=1,this.vertexSrc="#define SHADER_NAME "+r+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+`
`+this.fragmentSrc,this.vertexSrc=Yh(this.vertexSrc,ne.PRECISION_VERTEX,At.HIGH),this.fragmentSrc=Yh(this.fragmentSrc,ne.PRECISION_FRAGMENT,S0())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return i.prototype.extractData=function(t,e){var r=ny();if(r){var n=ty(r,t,e);this.attributeData=this.getAttributeData(n,r),this.uniformData=this.getUniformData(n,r),r.deleteProgram(n)}else this.uniformData={},this.attributeData={}},i.prototype.getAttributeData=function(t,e){for(var r={},n=[],s=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),o=0;o<s;o++){var a=e.getActiveAttrib(t,o),l=$h(e,a.type),u={type:l,name:a.name,size:A0(l),location:0};r[a.name]=u,n.push(u)}n.sort(function(c,h){return c.name>h.name?1:-1});for(var o=0;o<n.length;o++)n[o].location=o;return r},i.prototype.getUniformData=function(t,e){for(var r={},n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),s=0;s<n;s++){var o=e.getActiveUniform(t,s),a=o.name.replace(/\[.*?\]$/,""),l=o.name.match(/\[.*?\]$/),u=$h(e,o.type);r[a]={type:u,size:o.size,isArray:l,value:ry(u,o.size)}}return r},Object.defineProperty(i,"defaultVertexSrc",{get:function(){return B0},enumerable:!1,configurable:!0}),Object.defineProperty(i,"defaultFragmentSrc",{get:function(){return N0},enumerable:!1,configurable:!0}),i.from=function(t,e,r){var n=t+e,s=al[n];return s||(al[n]=s=new i(t,e,r)),s},i})(),Wt=(function(){function i(t,e){this.program=t,e?e instanceof fr?this.uniformGroup=e:this.uniformGroup=new fr(e):this.uniformGroup=new fr({});for(var r in t.uniformData)this.uniformGroup.uniforms[r]instanceof Array&&(this.uniformGroup.uniforms[r]=new Float32Array(this.uniformGroup.uniforms[r]))}return i.prototype.checkUniformExists=function(t,e){if(e.uniforms[t])return!0;for(var r in e.uniforms){var n=e.uniforms[r];if(n.group&&this.checkUniformExists(t,n))return!0}return!1},i.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(i.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),i.from=function(t,e,r){var n=Bi.from(t,e);return new i(n,r)},i})(),xa=0,wa=1,Ta=2,Ia=3,Ea=4,mr=(function(){function i(){this.data=0,this.blendMode=se.NORMAL,this.polygonOffset=0,this.blend=!0}return Object.defineProperty(i.prototype,"blend",{get:function(){return!!(this.data&1<<xa)},set:function(t){!!(this.data&1<<xa)!==t&&(this.data^=1<<xa)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"offsets",{get:function(){return!!(this.data&1<<wa)},set:function(t){!!(this.data&1<<wa)!==t&&(this.data^=1<<wa)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"culling",{get:function(){return!!(this.data&1<<Ta)},set:function(t){!!(this.data&1<<Ta)!==t&&(this.data^=1<<Ta)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthTest",{get:function(){return!!(this.data&1<<Ia)},set:function(t){!!(this.data&1<<Ia)!==t&&(this.data^=1<<Ia)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<Ea)},set:function(t){!!(this.data&1<<Ea)!==t&&(this.data^=1<<Ea)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._blendMode},set:function(t){this.blend=t!==se.NONE,this._blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(t){this.offsets=!!t,this._polygonOffset=t},enumerable:!1,configurable:!0}),i.for2d=function(){var t=new i;return t.depthTest=!1,t.blend=!0,t},i})(),k0=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,U0=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,Jt=(function(i){fe(t,i);function t(e,r,n){var s=this,o=Bi.from(e||t.defaultVertexSrc,r||t.defaultFragmentSrc);return s=i.call(this,o,n)||this,s.padding=0,s.resolution=ne.FILTER_RESOLUTION,s.enabled=!0,s.autoFit=!0,s.legacy=!!s.program.attributeData.aTextureCoord,s.state=new mr,s}return t.prototype.apply=function(e,r,n,s,o){e.applyFilter(this,r,n,s)},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultVertexSrc",{get:function(){return k0},enumerable:!1,configurable:!0}),Object.defineProperty(t,"defaultFragmentSrc",{get:function(){return U0},enumerable:!1,configurable:!0}),t})(Wt),X0=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,H0=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,Vh=new Le,Vs=(function(){function i(t,e){this._texture=t,this.mapCoord=new Le,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof e>"u"?.5:e,this.isSimple=!1}return Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture=t,this._textureID=-1},enumerable:!1,configurable:!0}),i.prototype.multiplyUvs=function(t,e){e===void 0&&(e=t);for(var r=this.mapCoord,n=0;n<t.length;n+=2){var s=t[n],o=t[n+1];e[n]=s*r.a+o*r.c+r.tx,e[n+1]=s*r.b+o*r.d+r.ty}return e},i.prototype.update=function(t){var e=this._texture;if(!e||!e.valid||!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;var r=e._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=e.orig,s=e.trim;s&&(Vh.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(Vh));var o=e.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,u=this.clampOffset;return a[0]=(e._frame.x+l+u)/o.width,a[1]=(e._frame.y+l+u)/o.height,a[2]=(e._frame.x+e._frame.width-l+u)/o.width,a[3]=(e._frame.y+e._frame.height-l+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,this.isSimple=e._frame.width===o.width&&e._frame.height===o.height&&e.rotate===0,!0},i})(),oy=(function(i){fe(t,i);function t(e){var r=this,n=new Le;return r=i.call(this,X0,H0)||this,e.renderable=!1,r.maskSprite=e,r.maskMatrix=n,r}return t.prototype.apply=function(e,r,n,s){var o=this.maskSprite,a=o._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Vs(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,o).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,e.applyFilter(this,r,n,s))},t})(Jt),ay=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.enableScissor=!1,r.alphaMaskPool=[],r.maskDataPool=[],r.maskStack=[],r.alphaMaskIndex=0,r}return t.prototype.setMaskStack=function(e){this.maskStack=e,this.renderer.scissor.setMaskStack(e),this.renderer.stencil.setMaskStack(e)},t.prototype.push=function(e,r){var n=r;if(!n.isMaskData){var s=this.maskDataPool.pop()||new ey;s.pooled=!0,s.maskObject=r,n=s}switch(n.autoDetect&&this.detect(n),n.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),n._target=e,n.type){case it.SCISSOR:this.maskStack.push(n),this.renderer.scissor.push(n);break;case it.STENCIL:this.maskStack.push(n),this.renderer.stencil.push(n);break;case it.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n),this.maskStack.push(n);break}},t.prototype.pop=function(e){var r=this.maskStack.pop();if(!(!r||r._target!==e)){switch(r.type){case it.SCISSOR:this.renderer.scissor.pop();break;case it.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case it.SPRITE:this.popSpriteMask();break}r.reset(),r.pooled&&this.maskDataPool.push(r)}},t.prototype.detect=function(e){var r=e.maskObject;if(r.isSprite){e.type=it.SPRITE;return}if(e.type=it.STENCIL,this.enableScissor&&r.isFastRect&&r.isFastRect()){var n=r.worldTransform,s=Math.atan2(n.b,n.a),o=Math.atan2(n.d,n.c);s=Math.round(s*(180/Math.PI)*100),o=Math.round(o*(180/Math.PI)*100)-s,s=(s%9e3+9e3)%9e3,o=(o%18e3+18e3)%18e3,s===0&&o===9e3&&(e.type=it.SCISSOR)}},t.prototype.pushSpriteMask=function(e){var r=e.maskObject,n=e._target,s=this.alphaMaskPool[this.alphaMaskIndex];s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new oy(r)]),s[0].resolution=this.renderer.resolution,s[0].maskSprite=r;var o=n.filterArea;n.filterArea=r.getBounds(!0),this.renderer.filter.push(n,s),n.filterArea=o,this.alphaMaskIndex++},t.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},t})(lt),ly=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.maskStack=[],r.glConst=0,r}return t.prototype.getStackLength=function(){return this.maskStack.length},t.prototype.setMaskStack=function(e){var r=this.renderer.gl,n=this.getStackLength();this.maskStack=e;var s=this.getStackLength();s!==n&&(s===0?r.disable(this.glConst):(r.enable(this.glConst),this._useCurrent()))},t.prototype._useCurrent=function(){},t.prototype.destroy=function(){i.prototype.destroy.call(this),this.maskStack=null},t})(lt),uy=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.glConst=WebGLRenderingContext.SCISSOR_TEST,r}return t.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._scissorCounter:0},t.prototype.push=function(e){var r=e.maskObject;r.renderable=!0;var n=e._scissorRect,s=r.getBounds(!0),o=this.renderer.gl;r.renderable=!1,n?s.fit(n):o.enable(o.SCISSOR_TEST),e._scissorCounter++,e._scissorRect=s,this._useCurrent()},t.prototype.pop=function(){var e=this.renderer.gl;this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)},t.prototype._useCurrent=function(){var e=this.maskStack[this.maskStack.length-1]._scissorRect,r=this.renderer.renderTexture.current,n=this.renderer.projection,s=n.transform,o=n.sourceFrame,a=n.destinationFrame,l=r?r.resolution:this.renderer.resolution,u=(e.x-o.x)*l+a.x,c=(e.y-o.y)*l+a.y,h=e.width*l,f=e.height*l;s&&(u+=s.tx*l,c+=s.ty*l),r||(c=this.renderer.height-f-c),this.renderer.gl.scissor(u,c,h,f)},t})(ly),cy=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.glConst=WebGLRenderingContext.STENCIL_TEST,r}return t.prototype.getStackLength=function(){var e=this.maskStack[this.maskStack.length-1];return e?e._stencilCounter:0},t.prototype.push=function(e){var r=e.maskObject,n=this.renderer.gl,s=e._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),n.enable(n.STENCIL_TEST)),e._stencilCounter++,n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.EQUAL,s,this._getBitwiseMask()),n.stencilOp(n.KEEP,n.KEEP,n.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,this._useCurrent()},t.prototype.pop=function(e){var r=this.renderer.gl;this.getStackLength()===0?(r.disable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),r.clearStencil(0)):(r.colorMask(!1,!1,!1,!1),r.stencilOp(r.KEEP,r.KEEP,r.DECR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent())},t.prototype._useCurrent=function(){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,this.getStackLength(),this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},t})(ly),hy=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.destinationFrame=null,r.sourceFrame=null,r.defaultFrame=null,r.projectionMatrix=new Le,r.transform=null,r}return t.prototype.update=function(e,r,n,s){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=r||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,s),this.transform&&this.projectionMatrix.append(this.transform);var o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)},t.prototype.calculateProjection=function(e,r,n,s){var o=this.projectionMatrix,a=s?-1:1;o.identity(),o.a=1/r.width*2,o.d=a*(1/r.height*2),o.tx=-1-r.x*o.a,o.ty=-a-r.y*o.d},t.prototype.setTransform=function(e){},t})(lt),_r=new ge,Vi=new ge,qi=new ge,fy=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.clearColor=e._backgroundColorRgba,r.defaultMaskStack=[],r.current=null,r.sourceFrame=new ge,r.destinationFrame=new ge,r}return t.prototype.bind=function(e,r,n){e===void 0&&(e=null);var s=this.renderer;this.current=e;var o,a,l;e?(o=e.baseTexture,l=o.resolution,r||(_r.width=e.frame.width,_r.height=e.frame.height,r=_r),n||(Vi.x=e.frame.x,Vi.y=e.frame.y,Vi.width=r.width,Vi.height=r.height,n=Vi),a=o.framebuffer):(l=s.resolution,r||(_r.width=s.screen.width,_r.height=s.screen.height,r=_r),n||(n=_r,n.width=r.width,n.height=r.height)),qi.x=n.x*l,qi.y=n.y*l,qi.width=n.width*l,qi.height=n.height*l,this.renderer.framebuffer.bind(a,qi),this.renderer.projection.update(n,r,l,!a),e?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(r),this.destinationFrame.copyFrom(n)},t.prototype.clear=function(e,r){this.current?e=e||this.current.baseTexture.clearColor:e=e||this.clearColor,this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3],r)},t.prototype.resize=function(){this.bind(null)},t.prototype.reset=function(){this.bind(null)},t})(lt),G0=(function(){function i(){}return i})(),dy=(function(){function i(t,e){this.program=t,this.uniformData=e,this.uniformGroups={}}return i.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},i})(),Y0=0,qh={textureCount:0},py=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.destroyed=!1,r.systemCheck(),r.gl=null,r.shader=null,r.program=null,r.cache={},r.id=Y0++,r}return t.prototype.systemCheck=function(){if(!L0())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},t.prototype.contextChange=function(e){this.gl=e,this.reset()},t.prototype.bind=function(e,r){e.uniforms.globals=this.renderer.globalUniforms;var n=e.program,s=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(e);return this.shader=e,this.program!==n&&(this.program=n,this.gl.useProgram(s.program)),r||(qh.textureCount=0,this.syncUniformGroup(e.uniformGroup,qh)),s},t.prototype.setUniforms=function(e){var r=this.shader.program,n=r.glPrograms[this.renderer.CONTEXT_UID];r.syncUniforms(n.uniformData,e,this.renderer)},t.prototype.syncUniformGroup=function(e,r){var n=this.getglProgram();(!e.static||e.dirtyId!==n.uniformGroups[e.id])&&(n.uniformGroups[e.id]=e.dirtyId,this.syncUniforms(e,n,r))},t.prototype.syncUniforms=function(e,r,n){var s=e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e);s(r.uniformData,e.uniforms,this.renderer,n)},t.prototype.createSyncGroups=function(e){var r=this.getSignature(e,this.shader.program.uniformData);return this.cache[r]||(this.cache[r]=F0(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[r],e.syncUniforms[this.shader.program.id]},t.prototype.getSignature=function(e,r){var n=e.uniforms,s=[];for(var o in n)s.push(o),r[o]&&s.push(r[o].type);return s.join("-")},t.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},t.prototype.generateShader=function(e){var r=this.gl,n=e.program,s={};for(var o in n.attributeData)s[o]=n.attributeData[o].location;var a=ty(r,n.vertexSrc,n.fragmentSrc,s),l={};for(var o in n.uniformData){var u=n.uniformData[o];l[o]={location:r.getUniformLocation(a,o),value:ry(u.type,u.size)}}var c=new dy(a,l);return n.glPrograms[this.renderer.CONTEXT_UID]=c,c},t.prototype.reset=function(){this.program=null,this.shader=null},t.prototype.destroy=function(){this.destroyed=!0},t})(lt);function z0(i,t){return t===void 0&&(t=[]),t[se.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.ADD]=[i.ONE,i.ONE],t[se.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.NONE]=[0,0],t[se.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],t[se.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],t[se.SRC_IN]=[i.DST_ALPHA,i.ZERO],t[se.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],t[se.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[se.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],t[se.DST_IN]=[i.ZERO,i.SRC_ALPHA],t[se.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],t[se.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],t[se.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],t[se.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],t}var $0=0,V0=1,q0=2,j0=3,W0=4,yy=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.gl=null,r.stateId=0,r.polygonOffset=0,r.blendMode=se.NONE,r._blendEq=!1,r.map=[],r.map[$0]=r.setBlend,r.map[V0]=r.setOffset,r.map[q0]=r.setCullFace,r.map[j0]=r.setDepthTest,r.map[W0]=r.setFrontFace,r.checks=[],r.defaultState=new mr,r.defaultState.blend=!0,r}return t.prototype.contextChange=function(e){this.gl=e,this.blendModes=z0(e),this.set(this.defaultState),this.reset()},t.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var r=this.stateId^e.data,n=0;r;)r&1&&this.map[n].call(this,!!(e.data&1<<n)),r=r>>1,n++;this.stateId=e.data}for(var n=0;n<this.checks.length;n++)this.checks[n](this,e)},t.prototype.forceState=function(e){e=e||this.defaultState;for(var r=0;r<this.map.length;r++)this.map[r].call(this,!!(e.data&1<<r));for(var r=0;r<this.checks.length;r++)this.checks[r](this,e);this.stateId=e.data},t.prototype.setBlend=function(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},t.prototype.setOffset=function(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},t.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},t.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},t.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},t.prototype.setBlendMode=function(e){if(e!==this.blendMode){this.blendMode=e;var r=this.blendModes[e],n=this.gl;r.length===2?n.blendFunc(r[0],r[1]):n.blendFuncSeparate(r[0],r[1],r[2],r[3]),r.length===6?(this._blendEq=!0,n.blendEquationSeparate(r[4],r[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}},t.prototype.setPolygonOffset=function(e,r){this.gl.polygonOffset(e,r)},t.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},t.prototype.updateCheck=function(e,r){var n=this.checks.indexOf(e);r&&n===-1?this.checks.push(e):!r&&n!==-1&&this.checks.splice(n,1)},t.checkBlendMode=function(e,r){e.setBlendMode(r.blendMode)},t.checkPolygonOffset=function(e,r){e.setPolygonOffset(1,r.polygonOffset)},t})(lt),my=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.count=0,r.checkCount=0,r.maxIdle=ne.GC_MAX_IDLE,r.checkCountMax=ne.GC_MAX_CHECK_COUNT,r.mode=ne.GC_MODE,r}return t.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==As.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},t.prototype.run=function(){for(var e=this.renderer.texture,r=e.managedTextures,n=!1,s=0;s<r.length;s++){var o=r[s];!o.framebuffer&&this.count-o.touched>this.maxIdle&&(e.destroyTexture(o,!0),r[s]=null,n=!0)}if(n){for(var a=0,s=0;s<r.length;s++)r[s]!==null&&(r[a++]=r[s]);r.length=a}},t.prototype.unload=function(e){var r=this.renderer.texture,n=e._texture;n&&!n.framebuffer&&r.destroyTexture(n);for(var s=e.children.length-1;s>=0;s--)this.unload(e.children[s])},t})(lt),bs=(function(){function i(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121}return i})(),vy=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.boundTextures=[],r.currentLocation=-1,r.managedTextures=[],r._unknownBoundTextures=!1,r.unknownTexture=new Ee,r}return t.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var r=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(var n=0;n<r;n++)this.boundTextures[n]=null;this.emptyTextures={};var s=new bs(e.createTexture());e.bindTexture(e.TEXTURE_2D,s.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=s,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new bs(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(var n=0;n<6;n++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var n=0;n<this.boundTextures.length;n++)this.bind(null,n)},t.prototype.bind=function(e,r){r===void 0&&(r=0);var n=this.gl;if(e){if(e=e.castToBaseTexture(),e.parentTextureArray)return;if(e.valid){e.touched=this.renderer.textureGC.count;var s=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.boundTextures[r]!==e&&(this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),n.bindTexture(e.target,s.texture)),s.dirtyId!==e.dirtyId&&(this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),this.updateTexture(e)),this.boundTextures[r]=e}}else this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[r]=null},t.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},t.prototype.unbind=function(e){var r=this,n=r.gl,s=r.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var o=0;o<s.length;o++)s[o]===this.unknownTexture&&this.bind(null,o)}for(var o=0;o<s.length;o++)s[o]===e&&(this.currentLocation!==o&&(n.activeTexture(n.TEXTURE0+o),this.currentLocation=o),n.bindTexture(e.target,this.emptyTextures[e.target].texture),s[o]=null)},t.prototype.initTexture=function(e){var r=new bs(this.gl.createTexture());return r.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=r,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),r},t.prototype.initTextureType=function(e,r){if(r.internalFormat=e.format,r.type=e.type,this.webGLVersion===2){var n=this.renderer.gl;e.type===n.FLOAT&&e.format===n.RGBA&&(r.internalFormat=n.RGBA32F),e.type===De.HALF_FLOAT&&(r.type=n.HALF_FLOAT),r.type===n.HALF_FLOAT&&e.format===n.RGBA&&(r.internalFormat=n.RGBA16F)}},t.prototype.updateTexture=function(e){var r=e._glTextures[this.CONTEXT_UID];if(r){var n=this.renderer;if(this.initTextureType(e,r),!(e.resource&&e.resource.upload(n,e,r))){var s=e.realWidth,o=e.realHeight,a=n.gl;(r.width!==s||r.height!==o||r.dirtyId<0)&&(r.width=s,r.height=o,a.texImage2D(e.target,0,r.internalFormat,s,o,0,e.format,r.type,null))}e.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(e),r.dirtyId=e.dirtyId}},t.prototype.destroyTexture=function(e,r){var n=this.gl;if(e=e.castToBaseTexture(),e._glTextures[this.CONTEXT_UID]&&(this.unbind(e),n.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!r)){var s=this.managedTextures.indexOf(e);s!==-1&&Nr(this.managedTextures,s,1)}},t.prototype.updateTextureStyle=function(e){var r=e._glTextures[this.CONTEXT_UID];r&&((e.mipmap===Ti.POW2||this.webGLVersion!==2)&&!e.isPowerOfTwo?r.mipmap=!1:r.mipmap=e.mipmap>=1,this.webGLVersion!==2&&!e.isPowerOfTwo?r.wrapMode=Rt.CLAMP:r.wrapMode=e.wrapMode,e.resource&&e.resource.style(this.renderer,e,r)||this.setStyle(e,r),r.dirtyStyleId=e.dirtyStyleId)},t.prototype.setStyle=function(e,r){var n=this.gl;if(r.mipmap&&n.generateMipmap(e.target),n.texParameteri(e.target,n.TEXTURE_WRAP_S,r.wrapMode),n.texParameteri(e.target,n.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===Ct.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);var s=this.renderer.context.extensions.anisotropicFiltering;if(s&&e.anisotropicLevel>0&&e.scaleMode===Ct.LINEAR){var o=Math.min(e.anisotropicLevel,n.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(e.target,s.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else n.texParameteri(e.target,n.TEXTURE_MIN_FILTER,e.scaleMode===Ct.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(e.target,n.TEXTURE_MAG_FILTER,e.scaleMode===Ct.LINEAR?n.LINEAR:n.NEAREST)},t})(lt),K0={FilterSystem:jp,BatchSystem:Wp,ContextSystem:Kp,FramebufferSystem:Jp,GeometrySystem:Qp,MaskSystem:ay,ScissorSystem:uy,StencilSystem:cy,ProjectionSystem:hy,RenderTextureSystem:fy,ShaderSystem:py,StateSystem:yy,TextureGCSystem:my,TextureSystem:vy},Sa=new Le,gy=(function(i){fe(t,i);function t(e,r){e===void 0&&(e=xi.UNKNOWN);var n=i.call(this)||this;return r=Object.assign({},ne.RENDER_OPTIONS,r),r.roundPixels&&(ne.ROUND_PIXELS=r.roundPixels,W("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),n.options=r,n.type=e,n.screen=new ge(0,0,r.width,r.height),n.view=r.view||document.createElement("canvas"),n.resolution=r.resolution||ne.RESOLUTION,n.transparent=r.transparent,n.autoDensity=r.autoDensity||r.autoResize||!1,n.preserveDrawingBuffer=r.preserveDrawingBuffer,n.clearBeforeRender=r.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,0],n._backgroundColorString="#000000",n.backgroundColor=r.backgroundColor||n._backgroundColor,n._lastObjectRendered=null,n.plugins={},n}return t.prototype.initPlugins=function(e){for(var r in e)this.plugins[r]=new e[r](this)},Object.defineProperty(t.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),t.prototype.resize=function(e,r){this.screen.width=e,this.screen.height=r,this.view.width=e*this.resolution,this.view.height=r*this.resolution,this.autoDensity&&(this.view.style.width=e+"px",this.view.style.height=r+"px"),this.emit("resize",e,r)},t.prototype.generateTexture=function(e,r,n,s){s=s||e.getLocalBounds(null,!0),s.width===0&&(s.width=1),s.height===0&&(s.height=1);var o=Ur.create({width:s.width|0,height:s.height|0,scaleMode:r,resolution:n});return Sa.tx=-s.x,Sa.ty=-s.y,this.render(e,o,!1,Sa,!!e.parent),o},t.prototype.destroy=function(e){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=xi.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(e){this._backgroundColor=e,this._backgroundColorString=gu(e),Dr(e,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),t})(Ri),kt=(function(i){fe(t,i);function t(e){var r=i.call(this,xi.WEBGL,e)||this;return e=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new qe("destroy"),contextChange:new qe("contextChange"),reset:new qe("reset"),update:new qe("update"),postrender:new qe("postrender"),prerender:new qe("prerender"),resize:new qe("resize")},r.globalUniforms=new fr({projectionMatrix:new Le},!0),r.addSystem(ay,"mask").addSystem(Kp,"context").addSystem(yy,"state").addSystem(py,"shader").addSystem(vy,"texture").addSystem(Qp,"geometry").addSystem(Jp,"framebuffer").addSystem(uy,"scissor").addSystem(cy,"stencil").addSystem(hy,"projection").addSystem(my,"textureGC").addSystem(jp,"filter").addSystem(fy,"renderTexture").addSystem(Wp,"batch"),r.initPlugins(t.__plugins),e.context?r.context.initFromContext(e.context):r.context.initFromOptions({alpha:!!r.transparent,antialias:e.antialias,premultipliedAlpha:r.transparent&&r.transparent!=="notMultiplied",stencil:!0,preserveDrawingBuffer:e.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,bp(r.context.webGLVersion===2?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return t.create=function(e){if(_p())return new t(e);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},t.prototype.addSystem=function(e,r){r||(r=e.name);var n=new e(this);if(this[r])throw new Error('Whoops! The name "'+r+'" is already in use');this[r]=n;for(var s in this.runners)this.runners[s].add(n);return this},t.prototype.render=function(e,r,n,s,o){if(this.renderingToScreen=!r,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=s,!this.context.isLost){if(r||(this._lastObjectRendered=e),!o){var a=e.enableTempParent();e.updateTransform(),e.disableTempParent(a)}this.renderTexture.bind(r),this.batch.currentRenderer.start(),(n!==void 0?n:this.clearBeforeRender)&&this.renderTexture.clear(),e.render(this),this.batch.currentRenderer.flush(),r&&r.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},t.prototype.resize=function(e,r){i.prototype.resize.call(this,e,r),this.runners.resize.emit(e,r)},t.prototype.reset=function(){return this.runners.reset.emit(),this},t.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},t.prototype.destroy=function(e){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();i.prototype.destroy.call(this,e),this.gl=null},t.registerPlugin=function(e,r){t.__plugins=t.__plugins||{},t.__plugins[e]=r},t})(gy);function by(i){return kt.create(i)}var _y=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,Ru=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,Fs=(function(){function i(){this.texArray=null,this.blend=0,this.type=ft.TRIANGLES,this.start=0,this.size=0,this.data=null}return i})(),Ms=(function(){function i(){this.elements=[],this.ids=[],this.count=0}return i.prototype.clear=function(){for(var t=0;t<this.count;t++)this.elements[t]=null;this.count=0},i})(),xy=(function(){function i(t){this.rawBinaryData=new ArrayBuffer(t),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(i.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),i.prototype.view=function(t){return this[t+"View"]},i.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},i.sizeOf=function(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(t+" isn't a valid view type")}},i})(),wy=(function(i){fe(t,i);function t(e){var r=i.call(this,e)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=mr.for2d(),r.size=ne.SPRITE_BATCH_SIZE*4,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),e.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return t.prototype.contextChange=function(){var e=this.renderer.gl;ne.PREFER_ENV===Nt.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),ne.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=sy(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},t.prototype.initFlushBuffers=function(){for(var e=t._drawCallPool,r=t._textureArrayPool,n=this.size/4,s=Math.floor(n/this.MAX_TEXTURES)+1;e.length<n;)e.push(new Fs);for(;r.length<s;)r.push(new Ms);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},t.prototype.onPrerender=function(){this._flushId=0},t.prototype.render=function(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedTextures[this._bufferSize]=e._texture.baseTexture,this._bufferedElements[this._bufferSize++]=e)},t.prototype.buildTexturesAndDrawCalls=function(){var e=this,r=e._bufferedTextures,n=e.MAX_TEXTURES,s=t._textureArrayPool,o=this.renderer.batch,a=this._tempBoundTextures,l=this.renderer.textureGC.count,u=++Ee._globalBatch,c=0,h=s[0],f=0;o.copyBoundTextures(a,n);for(var d=0;d<this._bufferSize;++d){var p=r[d];r[d]=null,p._batchEnabled!==u&&(h.count>=n&&(o.boundArray(h,a,u,n),this.buildDrawCalls(h,f,d),f=d,h=s[++c],++u),p._batchEnabled=u,p.touched=l,h.elements[h.count++]=p)}h.count>0&&(o.boundArray(h,a,u,n),this.buildDrawCalls(h,f,this._bufferSize),++c,++u);for(var d=0;d<a.length;d++)a[d]=null;Ee._globalBatch=u},t.prototype.buildDrawCalls=function(e,r,n){var s=this,o=s._bufferedElements,a=s._attributeBuffer,l=s._indexBuffer,u=s.vertexSize,c=t._drawCallPool,h=this._dcIndex,f=this._aIndex,d=this._iIndex,p=c[h];p.start=this._iIndex,p.texArray=e;for(var v=r;v<n;++v){var y=o[v],g=y._texture.baseTexture,E=_u[g.alphaMode?1:0][y.blendMode];o[v]=null,r<v&&p.blend!==E&&(p.size=d-p.start,r=v,p=c[++h],p.texArray=e,p.start=d),this.packInterleavedGeometry(y,a,l,f,d),f+=y.vertexData.length/2*u,d+=y.indices.length,p.blend=E}r<n&&(p.size=d-p.start,++h),this._dcIndex=h,this._aIndex=f,this._iIndex=d},t.prototype.bindAndClearTexArray=function(e){for(var r=this.renderer.texture,n=0;n<e.count;n++)r.bind(e.elements[n],e.ids[n]),e.elements[n]=null;e.count=0},t.prototype.updateGeometry=function(){var e=this,r=e._packedGeometries,n=e._attributeBuffer,s=e._indexBuffer;ne.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},t.prototype.drawBatches=function(){for(var e=this._dcIndex,r=this.renderer,n=r.gl,s=r.state,o=t._drawCallPool,a=null,l=0;l<e;l++){var u=o[l],c=u.texArray,h=u.type,f=u.size,d=u.start,p=u.blend;a!==c&&(a=c,this.bindAndClearTexArray(c)),this.state.blendMode=p,s.set(this.state),n.drawElements(h,f,n.UNSIGNED_SHORT,d*2)}},t.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},t.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),ne.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]&&this._packedGeometries[e].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),i.prototype.destroy.call(this)},t.prototype.getAttributeBuffer=function(e){var r=fn(Math.ceil(e/8)),n=ol(r),s=r*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._aBuffers[s];return o||(this._aBuffers[s]=o=new xy(s*this.vertexSize*4)),o},t.prototype.getIndexBuffer=function(e){var r=fn(Math.ceil(e/12)),n=ol(r),s=r*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._iBuffers[n];return o||(this._iBuffers[n]=o=new Uint16Array(s)),o},t.prototype.packInterleavedGeometry=function(e,r,n,s,o){for(var a=r.uint32View,l=r.float32View,u=s/this.vertexSize,c=e.uvs,h=e.indices,f=e.vertexData,d=e._texture.baseTexture._batchLocation,p=Math.min(e.worldAlpha,1),v=p<1&&e._texture.baseTexture.alphaMode?Ys(e._tintRGB,p):e._tintRGB+(p*255<<24),y=0;y<f.length;y+=2)l[s++]=f[y],l[s++]=f[y+1],l[s++]=c[y],l[s++]=c[y+1],a[s++]=v,l[s++]=d;for(var y=0;y<h.length;y++)n[o++]=u+h[y]},t._drawCallPool=[],t._textureArrayPool=[],t})(Ni),Ty=(function(){function i(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},e.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(e.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return i.prototype.generateShader=function(t){if(!this.programCache[t]){for(var e=new Int32Array(t),r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=fr.from({uSamplers:e},!0);var n=this.fragTemplate;n=n.replace(/%count%/gi,""+t),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new Bi(this.vertexSrc,n)}var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Le,default:this.defaultGroupCache[t]};return new Wt(this.programCache[t],s)},i.prototype.generateSampleSrc=function(t){var e="";e+=`
`,e+=`
`;for(var r=0;r<t;r++)r>0&&(e+=`
else `),r<t-1&&(e+="if(vTextureId < "+r+".5)"),e+=`
{`,e+=`
	color = texture2D(uSamplers[`+r+"], vTextureCoord);",e+=`
}`;return e+=`
`,e+=`
`,e},i})(),Lu=(function(i){fe(t,i);function t(e){e===void 0&&(e=!1);var r=i.call(this)||this;return r._buffer=new Be(null,e,!1),r._indexBuffer=new Be(null,e,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,De.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,De.FLOAT).addAttribute("aColor",r._buffer,4,!0,De.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,De.FLOAT).addIndex(r._indexBuffer),r}return t})(zr),jh=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,Wh=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Iy=(function(){function i(){}return i.create=function(t){var e=Object.assign({vertex:jh,fragment:Wh,geometryClass:Lu,vertexSize:6},t),r=e.vertex,n=e.fragment,s=e.vertexSize,o=e.geometryClass;return(function(a){fe(l,a);function l(u){var c=a.call(this,u)||this;return c.shaderGenerator=new Ty(r,n),c.geometryClass=o,c.vertexSize=s,c}return l})(wy)},Object.defineProperty(i,"defaultVertexSrc",{get:function(){return jh},enumerable:!1,configurable:!0}),Object.defineProperty(i,"defaultFragmentTemplate",{get:function(){return Wh},enumerable:!1,configurable:!0}),i})(),Ey=Iy.create();/*!
 * @pixi/app - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/app is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var In=(function(){function i(t){var e=this;t=Object.assign({forceCanvas:!1},t),this.renderer=by(t),this.stage=new st,i._plugins.forEach(function(r){r.init.call(e,t)})}return i.registerPlugin=function(t){i._plugins.push(t)},i.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(i.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),i.prototype.destroy=function(t,e){var r=this,n=i._plugins.slice(0);n.reverse(),n.forEach(function(s){s.destroy.call(r)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null},i})();In._plugins=[];var Z0=(function(){function i(){}return i.init=function(t){var e=this;Object.defineProperty(this,"resizeTo",{set:function(r){window.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(window.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){e._resizeTo&&(e.cancelResize(),e._resizeId=requestAnimationFrame(function(){return e.resize()}))},this.cancelResize=function(){e._resizeId&&(cancelAnimationFrame(e._resizeId),e._resizeId=null)},this.resize=function(){if(e._resizeTo){e.cancelResize();var r,n;if(e._resizeTo===window)r=window.innerWidth,n=window.innerHeight;else{var s=e._resizeTo,o=s.clientWidth,a=s.clientHeight;r=o,n=a}e.renderer.resize(r,n)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null},i.destroy=function(){window.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},i})();In.registerPlugin(Z0);/*!
 * @pixi/extract - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/extract is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Kh=new ge,Zh=4,Sy=(function(){function i(t){this.renderer=t,t.extract=this}return i.prototype.image=function(t,e,r){var n=new Image;return n.src=this.base64(t,e,r),n},i.prototype.base64=function(t,e,r){return this.canvas(t).toDataURL(e,r)},i.prototype.canvas=function(t){var e=this.renderer,r,n,s=!1,o,a=!1;t&&(t instanceof Ur?o=t:(o=this.renderer.generateTexture(t),a=!0)),o?(r=o.baseTexture.resolution,n=o.frame,s=!1,e.renderTexture.bind(o)):(r=this.renderer.resolution,s=!0,n=Kh,n.width=this.renderer.width,n.height=this.renderer.height,e.renderTexture.bind(null));var l=Math.floor(n.width*r+1e-4),u=Math.floor(n.height*r+1e-4),c=new ll(l,u,1),h=new Uint8Array(Zh*l*u),f=e.gl;f.readPixels(n.x*r,n.y*r,l,u,f.RGBA,f.UNSIGNED_BYTE,h);var d=c.context.getImageData(0,0,l,u);if(i.arrayPostDivide(h,d.data),c.context.putImageData(d,0,0),s){var p=new ll(c.width,c.height,1);p.context.scale(1,-1),p.context.drawImage(c.canvas,0,-u),c.destroy(),c=p}return a&&o.destroy(!0),c.canvas},i.prototype.pixels=function(t){var e=this.renderer,r,n,s,o=!1;t&&(t instanceof Ur?s=t:(s=this.renderer.generateTexture(t),o=!0)),s?(r=s.baseTexture.resolution,n=s.frame,e.renderTexture.bind(s)):(r=e.resolution,n=Kh,n.width=e.width,n.height=e.height,e.renderTexture.bind(null));var a=n.width*r,l=n.height*r,u=new Uint8Array(Zh*a*l),c=e.gl;return c.readPixels(n.x*r,n.y*r,a,l,c.RGBA,c.UNSIGNED_BYTE,u),o&&s.destroy(!0),i.arrayPostDivide(u,u),u},i.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},i.arrayPostDivide=function(t,e){for(var r=0;r<t.length;r+=4){var n=e[r+3]=t[r+3];n!==0?(e[r]=Math.round(Math.min(t[r]*255/n,255)),e[r+1]=Math.round(Math.min(t[r+1]*255/n,255)),e[r+2]=Math.round(Math.min(t[r+2]*255/n,255))):(e[r]=t[r],e[r+1]=t[r+1],e[r+2]=t[r+2])}},i})(),Ca,Jh;function J0(){return Jh||(Jh=1,Ca=(i,t={})=>{if(!i)return;const e=/(?:^|&)([^&=]*)=?([^&]*)/g,r={strict:/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*)|([^?#]*?))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,loose:/^(?:([^:/?#.]+):)?(?:\/\/([^/?#]*)|([^?#]*?))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},s=(t.strictMode?r.strict:r.loose).exec(i);if(!s)return;const[,o="",a="",l="",u="",c="",h=""]=s,f=a||"",d=a?u:l+u,p={source:i,protocol:o,authority:f,relative:d,query:c,anchor:h,userInfo:"",user:"",password:"",host:"",port:"",path:d,directory:"",file:"",queryKey:{}};if(f){const y=/^(?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?/.exec(f);if(y){const[,g="",E="",T="",R="",_=""]=y;Object.assign(p,{userInfo:g,user:E,password:T,host:R,port:_})}}if(d){const v=d.lastIndexOf("/");v>-1?(p.directory=d.substring(0,v+1),p.file=d.substring(v+1)):p.file=d}if(c)for(const[,v,y]of c.matchAll(e))v&&(p.queryKey[v]=y);return p}),Ca}var Q0=J0();const Cy=Mi(Q0);class qn{constructor(t,e=!1,r){this._fn=t,this._once=e,this._thisArg=r,this._next=this._prev=this._owner=null}detach(){return this._owner===null?!1:(this._owner.detach(this),!0)}}function Qh(i,t){return i._head?(i._tail._next=t,t._prev=i._tail,i._tail=t):(i._head=t,i._tail=t),t._owner=i,t}class Xt{constructor(){this._head=this._tail=void 0}handlers(t=!1){let e=this._head;if(t)return!!e;const r=[];for(;e;)r.push(e),e=e._next;return r}has(t){if(!(t instanceof qn))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return t._owner===this}dispatch(){let t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,arguments),t=t._next;return!0}add(t,e=null){if(typeof t!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return Qh(this,new qn(t,!1,e))}once(t,e=null){if(typeof t!="function")throw new Error("MiniSignal#once(): First arg must be a Function.");return Qh(this,new qn(t,!0,e))}detach(t){if(!(t instanceof qn))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return t._owner!==this?this:(t._prev&&(t._prev._next=t._next),t._next&&(t._next._prev=t._prev),t===this._head?(this._head=t._next,t._next===null&&(this._tail=null)):t===this._tail&&(this._tail=t._prev,this._tail._next=null),t._owner=null,this)}detachAll(){let t=this._head;if(!t)return this;for(this._head=this._tail=null;t;)t._owner=null,t=t._next;return this}}/*!
 * resource-loader - v3.0.1
 * https://github.com/pixijs/pixi-sound
 * Compiled Tue, 02 Jul 2019 14:06:18 UTC
 *
 * resource-loader is licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license
 */function xr(){}function ef(i,t,e,r){var n=0,s=i.length;(function o(a){if(a||n===s){e&&e(a);return}r?setTimeout(function(){t(i[n++],o)},1):t(i[n++],o)})()}function eb(i){return function(){if(i===null)throw new Error("Callback was already called.");var e=i;i=null,e.apply(this,arguments)}}function tb(i,t){if(t==null)t=1;else if(t===0)throw new Error("Concurrency must not be zero");var e=0,r={_tasks:[],concurrency:t,saturated:xr,unsaturated:xr,buffer:t/4,empty:xr,drain:xr,error:xr,started:!1,paused:!1,push:function(a,l){n(a,!1,l)},kill:function(){e=0,r.drain=xr,r.started=!1,r._tasks=[]},unshift:function(a,l){n(a,!0,l)},process:function(){for(;!r.paused&&e<r.concurrency&&r._tasks.length;){var a=r._tasks.shift();r._tasks.length===0&&r.empty(),e+=1,e===r.concurrency&&r.saturated(),i(a.data,eb(s(a)))}},length:function(){return r._tasks.length},running:function(){return e},idle:function(){return r._tasks.length+e===0},pause:function(){r.paused!==!0&&(r.paused=!0)},resume:function(){if(r.paused!==!1){r.paused=!1;for(var a=1;a<=r.concurrency;a++)r.process()}}};function n(o,a,l){if(l!=null&&typeof l!="function")throw new Error("task callback must be a function");if(r.started=!0,o==null&&r.idle()){setTimeout(function(){return r.drain()},1);return}var u={data:o,callback:typeof l=="function"?l:xr};a?r._tasks.unshift(u):r._tasks.push(u),setTimeout(function(){return r.process()},1)}function s(o){return function(){e-=1,o.callback.apply(o,arguments),arguments[0]!=null&&r.error(arguments[0],o.data),e<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}}return r}function rb(i,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}}function Ay(i,t,e){return t&&rb(i.prototype,t),i}var ib=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest)),jn=null,nb=0,tf=200,sb=204,ob=1223,ab=2;function lb(){}var oe=(function(){i.setExtensionLoadType=function(r,n){rf(i._loadTypeMap,r,n)},i.setExtensionXhrType=function(r,n){rf(i._xhrTypeMap,r,n)};function i(e,r,n){if(typeof e!="string"||typeof r!="string")throw new Error("Both name and url are required for constructing a resource.");n=n||{},this._flags=0,this._setFlag(i.STATUS_FLAGS.DATA_URL,r.indexOf("data:")===0),this.name=e,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=n.crossOrigin===!0?"anonymous":n.crossOrigin,this.timeout=n.timeout||0,this.loadType=n.loadType||this._determineLoadType(),this.xhrType=n.xhrType,this.metadata=n.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=i.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=lb,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Xt,this.onProgress=new Xt,this.onComplete=new Xt,this.onAfterMiddleware=new Xt}var t=i.prototype;return t.complete=function(){this._clearEvents(),this._finish()},t.abort=function(r){if(!this.error){if(this.error=new Error(r),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=i.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},t.load=function(r){var n=this;if(!this.isLoading){if(this.isComplete){r&&setTimeout(function(){return r(n)},1);return}else r&&this.onComplete.once(r);switch(this._setFlag(i.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case i.LOAD_TYPE.IMAGE:this.type=i.TYPE.IMAGE,this._loadElement("image");break;case i.LOAD_TYPE.AUDIO:this.type=i.TYPE.AUDIO,this._loadSourceElement("audio");break;case i.LOAD_TYPE.VIDEO:this.type=i.TYPE.VIDEO,this._loadSourceElement("video");break;case i.LOAD_TYPE.XHR:default:ib&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},t._hasFlag=function(r){return(this._flags&r)!==0},t._setFlag=function(r,n){this._flags=n?this._flags|r:this._flags&~r},t._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},t._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(i.STATUS_FLAGS.COMPLETE,!0),this._setFlag(i.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t._loadElement=function(r){this.metadata.loadElement?this.data=this.metadata.loadElement:r==="image"&&typeof window.Image<"u"?this.data=new Image:this.data=document.createElement(r),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t._loadSourceElement=function(r){if(this.metadata.loadElement?this.data=this.metadata.loadElement:r==="audio"&&typeof window.Audio<"u"?this.data=new Audio:this.data=document.createElement(r),this.data===null){this.abort("Unsupported element: "+r);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var n=this.metadata.mimeType,s=0;s<this.url.length;++s)this.data.appendChild(this._createSource(r,this.url[s],Array.isArray(n)?n[s]:n));else{var o=this.metadata.mimeType;this.data.appendChild(this._createSource(r,this.url,Array.isArray(o)?o[0]:o))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var r=this.xhr=new XMLHttpRequest;r.open("GET",this.url,!0),r.timeout=this.timeout,this.xhrType===i.XHR_RESPONSE_TYPE.JSON||this.xhrType===i.XHR_RESPONSE_TYPE.DOCUMENT?r.responseType=i.XHR_RESPONSE_TYPE.TEXT:r.responseType=this.xhrType,r.addEventListener("error",this._boundXhrOnError,!1),r.addEventListener("timeout",this._boundXhrOnTimeout,!1),r.addEventListener("abort",this._boundXhrOnAbort,!1),r.addEventListener("progress",this._boundOnProgress,!1),r.addEventListener("load",this._boundXhrOnLoad,!1),r.send()},t._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var r=this.xhr=new XDomainRequest;r.timeout=this.timeout||5e3,r.onerror=this._boundXhrOnError,r.ontimeout=this._boundXhrOnTimeout,r.onprogress=this._boundOnProgress,r.onload=this._boundXhrOnLoad,r.open("GET",this.url,!0),setTimeout(function(){return r.send()},1)},t._createSource=function(r,n,s){s||(s=r+"/"+this._getExtension(n));var o=document.createElement("source");return o.src=n,o.type=s,o},t._onError=function(r){this.abort("Failed to load element using: "+r.target.nodeName)},t._onProgress=function(r){r&&r.lengthComputable&&this.onProgress.dispatch(this,r.loaded/r.total)},t._onTimeout=function(){this.abort("Load timed out.")},t._xhrOnError=function(){var r=this.xhr;this.abort(Aa(r)+" Request failed. Status: "+r.status+', text: "'+r.statusText+'"')},t._xhrOnTimeout=function(){var r=this.xhr;this.abort(Aa(r)+" Request timed out.")},t._xhrOnAbort=function(){var r=this.xhr;this.abort(Aa(r)+" Request was aborted by the user.")},t._xhrOnLoad=function(){var r=this.xhr,n="",s=typeof r.status>"u"?tf:r.status;(r.responseType===""||r.responseType==="text"||typeof r.responseType>"u")&&(n=r.responseText),s===nb&&(n.length>0||r.responseType===i.XHR_RESPONSE_TYPE.BUFFER)?s=tf:s===ob&&(s=sb);var o=s/100|0;if(o===ab)if(this.xhrType===i.XHR_RESPONSE_TYPE.TEXT)this.data=n,this.type=i.TYPE.TEXT;else if(this.xhrType===i.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(n),this.type=i.TYPE.JSON}catch(u){this.abort("Error trying to parse loaded json: "+u);return}else if(this.xhrType===i.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var a=new DOMParser;this.data=a.parseFromString(n,"text/xml")}else{var l=document.createElement("div");l.innerHTML=n,this.data=l}this.type=i.TYPE.XML}catch(u){this.abort("Error trying to parse loaded xml: "+u);return}else this.data=r.response||n;else{this.abort("["+r.status+"] "+r.statusText+": "+r.responseURL);return}this.complete()},t._determineCrossOrigin=function(r,n){if(r.indexOf("data:")===0)return"";if(window.origin!==window.location.origin)return"anonymous";n=n||window.location,jn||(jn=document.createElement("a")),jn.href=r,r=Cy(jn.href,{strictMode:!0});var s=!r.port&&n.port===""||r.port===n.port,o=r.protocol?r.protocol+":":"";return r.host!==n.hostname||!s||o!==n.protocol?"anonymous":""},t._determineXhrType=function(){return i._xhrTypeMap[this.extension]||i.XHR_RESPONSE_TYPE.TEXT},t._determineLoadType=function(){return i._loadTypeMap[this.extension]||i.LOAD_TYPE.XHR},t._getExtension=function(){var r=this.url,n="";if(this.isDataUrl){var s=r.indexOf("/");n=r.substring(s+1,r.indexOf(";",s))}else{var o=r.indexOf("?"),a=r.indexOf("#"),l=Math.min(o>-1?o:r.length,a>-1?a:r.length);r=r.substring(0,l),n=r.substring(r.lastIndexOf(".")+1)}return n.toLowerCase()},t._getMimeFromXhrType=function(r){switch(r){case i.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case i.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case i.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case i.XHR_RESPONSE_TYPE.JSON:return"application/json";case i.XHR_RESPONSE_TYPE.DEFAULT:case i.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},Ay(i,[{key:"isDataUrl",get:function(){return this._hasFlag(i.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(i.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(i.STATUS_FLAGS.LOADING)}}]),i})();oe.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4};oe.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6};oe.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};oe.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};oe._loadTypeMap={gif:oe.LOAD_TYPE.IMAGE,png:oe.LOAD_TYPE.IMAGE,bmp:oe.LOAD_TYPE.IMAGE,jpg:oe.LOAD_TYPE.IMAGE,jpeg:oe.LOAD_TYPE.IMAGE,tif:oe.LOAD_TYPE.IMAGE,tiff:oe.LOAD_TYPE.IMAGE,webp:oe.LOAD_TYPE.IMAGE,tga:oe.LOAD_TYPE.IMAGE,svg:oe.LOAD_TYPE.IMAGE,"svg+xml":oe.LOAD_TYPE.IMAGE,mp3:oe.LOAD_TYPE.AUDIO,ogg:oe.LOAD_TYPE.AUDIO,wav:oe.LOAD_TYPE.AUDIO,mp4:oe.LOAD_TYPE.VIDEO,webm:oe.LOAD_TYPE.VIDEO};oe._xhrTypeMap={xhtml:oe.XHR_RESPONSE_TYPE.DOCUMENT,html:oe.XHR_RESPONSE_TYPE.DOCUMENT,htm:oe.XHR_RESPONSE_TYPE.DOCUMENT,xml:oe.XHR_RESPONSE_TYPE.DOCUMENT,tmx:oe.XHR_RESPONSE_TYPE.DOCUMENT,svg:oe.XHR_RESPONSE_TYPE.DOCUMENT,tsx:oe.XHR_RESPONSE_TYPE.DOCUMENT,gif:oe.XHR_RESPONSE_TYPE.BLOB,png:oe.XHR_RESPONSE_TYPE.BLOB,bmp:oe.XHR_RESPONSE_TYPE.BLOB,jpg:oe.XHR_RESPONSE_TYPE.BLOB,jpeg:oe.XHR_RESPONSE_TYPE.BLOB,tif:oe.XHR_RESPONSE_TYPE.BLOB,tiff:oe.XHR_RESPONSE_TYPE.BLOB,webp:oe.XHR_RESPONSE_TYPE.BLOB,tga:oe.XHR_RESPONSE_TYPE.BLOB,json:oe.XHR_RESPONSE_TYPE.JSON,text:oe.XHR_RESPONSE_TYPE.TEXT,txt:oe.XHR_RESPONSE_TYPE.TEXT,ttf:oe.XHR_RESPONSE_TYPE.BUFFER,otf:oe.XHR_RESPONSE_TYPE.BUFFER};oe.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function rf(i,t,e){t&&t.indexOf(".")===0&&(t=t.substring(1)),t&&(i[t]=e)}function Aa(i){return i.toString().replace("object ","")}var ub="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function cb(i){for(var t="",e=0;e<i.length;){for(var r=[0,0,0],n=[0,0,0,0],s=0;s<r.length;++s)e<i.length?r[s]=i.charCodeAt(e++)&255:r[s]=0;n[0]=r[0]>>2,n[1]=(r[0]&3)<<4|r[1]>>4,n[2]=(r[1]&15)<<2|r[2]>>6,n[3]=r[2]&63;var o=e-(i.length-1);switch(o){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64;break}for(var a=0;a<n.length;++a)t+=ub.charAt(n[a])}return t}var nf=window.URL||window.webkitURL;function hb(i,t){if(!i.data){t();return}if(i.xhr&&i.xhrType===oe.XHR_RESPONSE_TYPE.BLOB){if(!window.Blob||typeof i.data=="string"){var e=i.xhr.getResponseHeader("content-type");if(e&&e.indexOf("image")===0){i.data=new Image,i.data.src="data:"+e+";base64,"+cb(i.xhr.responseText),i.type=oe.TYPE.IMAGE,i.data.onload=function(){i.data.onload=null,t()};return}}else if(i.data.type.indexOf("image")===0){var r=nf.createObjectURL(i.data);i.blob=i.data,i.data=new Image,i.data.src=r,i.type=oe.TYPE.IMAGE,i.data.onload=function(){nf.revokeObjectURL(r),i.data.onload=null,t()};return}}t()}var fb={parsing:hb},Pa=100,db=/(#[\w-]+)?$/,zt=(function(){function i(e,r){var n=this;e===void 0&&(e=""),r===void 0&&(r=10),this.baseUrl=e,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(a,l){return n._loadResource(a,l)},this._queue=tb(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new Xt,this.onError=new Xt,this.onLoad=new Xt,this.onStart=new Xt,this.onComplete=new Xt;for(var s=0;s<i._defaultBeforeMiddleware.length;++s)this.pre(i._defaultBeforeMiddleware[s]);for(var o=0;o<i._defaultAfterMiddleware.length;++o)this.use(i._defaultAfterMiddleware[o])}var t=i.prototype;return t.add=function(r,n,s,o){if(Array.isArray(r)){for(var a=0;a<r.length;++a)this.add(r[a]);return this}if(typeof r=="object"&&(o=n||r.callback||r.onComplete,s=r,n=r.url,r=r.name||r.key||r.url),typeof n!="string"&&(o=s,s=n,n=r),typeof n!="string")throw new Error("No url passed to add resource to loader.");if(typeof s=="function"&&(o=s,s=null),this.loading&&(!s||!s.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[r])throw new Error('Resource named "'+r+'" already exists.');if(n=this._prepareUrl(n),this.resources[r]=new oe(r,n,s),typeof o=="function"&&this.resources[r].onAfterMiddleware.once(o),this.loading){for(var l=s.parentResource,u=[],c=0;c<l.children.length;++c)l.children[c].isComplete||u.push(l.children[c]);var h=l.progressChunk*(u.length+1),f=h/(u.length+2);l.children.push(this.resources[r]),l.progressChunk=f;for(var d=0;d<u.length;++d)u[d].progressChunk=f;this.resources[r].progressChunk=f}return this._queue.push(this.resources[r]),this},t.pre=function(r){return this._beforeMiddleware.push(r),this},t.use=function(r){return this._afterMiddleware.push(r),this},t.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var r in this.resources){var n=this.resources[r];n._onLoadBinding&&n._onLoadBinding.detach(),n.isLoading&&n.abort()}return this.resources={},this},t.load=function(r){if(typeof r=="function"&&this.onComplete.once(r),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var n=this._queue._tasks.length,s=Pa/n,o=0;o<this._queue._tasks.length;++o)this._queue._tasks[o].data.progressChunk=s;this._onStart(),this._queue.resume()}return this},t._prepareUrl=function(r){var n=Cy(r,{strictMode:!0}),s;if(n.protocol||!n.path||r.indexOf("//")===0?s=r:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&r.charAt(0)!=="/"?s=this.baseUrl+"/"+r:s=this.baseUrl+r,this.defaultQueryString){var o=db.exec(s)[0];s=s.substr(0,s.length-o.length),s.indexOf("?")!==-1?s+="&"+this.defaultQueryString:s+="?"+this.defaultQueryString,s+=o}return s},t._loadResource=function(r,n){var s=this;r._dequeue=n,ef(this._beforeMiddleware,function(o,a){o.call(s,r,function(){a(r.isComplete?{}:null)})},function(){r.isComplete?s._onLoad(r):(r._onLoadBinding=r.onComplete.once(s._onLoad,s),r.load())},!0)},t._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t._onComplete=function(){this.progress=Pa,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t._onLoad=function(r){var n=this;r._onLoadBinding=null,this._resourcesParsing.push(r),r._dequeue(),ef(this._afterMiddleware,function(s,o){s.call(n,r,o)},function(){r.onAfterMiddleware.dispatch(r),n.progress=Math.min(Pa,n.progress+r.progressChunk),n.onProgress.dispatch(n,r),r.error?n.onError.dispatch(r.error,n,r):n.onLoad.dispatch(n,r),n._resourcesParsing.splice(n._resourcesParsing.indexOf(r),1),n._queue.idle()&&n._resourcesParsing.length===0&&n._onComplete()},!0)},Ay(i,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(r){this._queue.concurrency=r}}]),i})();zt._defaultBeforeMiddleware=[];zt._defaultAfterMiddleware=[];zt.pre=function(t){return zt._defaultBeforeMiddleware.push(t),zt};zt.use=function(t){return zt._defaultAfterMiddleware.push(t),zt};/*!
 * @pixi/loaders - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/loaders is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var an=oe;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var yl=function(i,t){return yl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},yl(i,t)};function pb(i,t){yl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Py=(function(){function i(){}return i.use=function(t,e){t.data&&t.type===oe.TYPE.IMAGE&&(t.texture=le.fromLoader(t.data,t.url,t.name)),e()},i})(),Xr=(function(i){pb(t,i);function t(e,r){for(var n=i.call(this,e,r)||this,s=0;s<t._plugins.length;++s){var o=t._plugins[s],a=o.pre,l=o.use;a&&n.pre(a),l&&n.use(l)}return n._protected=!1,n}return t.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(t,"shared",{get:function(){var e=t._shared;return e||(e=new t,e._protected=!0,t._shared=e),e},enumerable:!1,configurable:!0}),t.registerPlugin=function(e){return t._plugins.push(e),e.add&&e.add(),t},t._plugins=[],t})(zt);Xr.registerPlugin({use:fb.parsing});Xr.registerPlugin(Py);var Oy=(function(){function i(){}return i.init=function(t){t=Object.assign({sharedLoader:!1},t),this.loader=t.sharedLoader?Xr.shared:new Xr},i.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},i})();/*!
 * @pixi/particles - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/particles is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ml=function(i,t){return ml=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},ml(i,t)};function Fy(i,t){ml(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var yb=(function(i){Fy(t,i);function t(e,r,n,s){e===void 0&&(e=1500),n===void 0&&(n=16384),s===void 0&&(s=!1);var o=i.call(this)||this,a=16384;return n>a&&(n=a),o._properties=[!1,!0,!1,!1,!1],o._maxSize=e,o._batchSize=n,o._buffers=null,o._bufferUpdateIDs=[],o._updateID=0,o.interactiveChildren=!1,o.blendMode=se.NORMAL,o.autoResize=s,o.roundPixels=!0,o.baseTexture=null,o.setProperties(r),o._tint=0,o.tintRgb=new Float32Array(4),o.tint=16777215,o}return t.prototype.setProperties=function(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])},t.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(e){this._tint=e,Dr(e,this.tintRgb)},enumerable:!1,configurable:!0}),t.prototype.render=function(e){var r=this;!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return r.onChildrenChange(0)})),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))},t.prototype.onChildrenChange=function(e){for(var r=Math.floor(e/this._batchSize);this._bufferUpdateIDs.length<r;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[r]=++this._updateID},t.prototype.dispose=function(){if(this._buffers){for(var e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}},t.prototype.destroy=function(e){i.prototype.destroy.call(this,e),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},t})(st),sf=(function(){function i(t,e,r){this.geometry=new zr,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<t.length;++n){var s=t[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||De.FLOAT,offset:s.offset},e[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return i.prototype.initBuffers=function(){var t=this.geometry,e=0;this.indexBuffer=new Be(Tu(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];n.offset=e,e+=n.size,this.dynamicStride+=n.size}var s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new Be(this.dynamicData,!1,!1);var o=0;this.staticStride=0;for(var r=0;r<this.staticProperties.length;++r){var n=this.staticProperties[r];n.offset=o,o+=n.size,this.staticStride+=n.size}var a=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(a),this.staticDataUint32=new Uint32Array(a),this.staticBuffer=new Be(this.staticData,!0,!1);for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];t.addAttribute(n.attributeName,this.dynamicBuffer,0,n.type===De.UNSIGNED_BYTE,n.type,this.dynamicStride*4,n.offset*4)}for(var r=0;r<this.staticProperties.length;++r){var n=this.staticProperties[r];t.addAttribute(n.attributeName,this.staticBuffer,0,n.type===De.UNSIGNED_BYTE,n.type,this.staticStride*4,n.offset*4)}},i.prototype.uploadDynamic=function(t,e,r){for(var n=0;n<this.dynamicProperties.length;n++){var s=this.dynamicProperties[n];s.uploadFunction(t,e,r,s.type===De.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++},i.prototype.uploadStatic=function(t,e,r){for(var n=0;n<this.staticProperties.length;n++){var s=this.staticProperties[n];s.uploadFunction(t,e,r,s.type===De.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++},i.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},i})(),mb=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,vb=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`,My=(function(i){Fy(t,i);function t(e){var r=i.call(this,e)||this;return r.shader=null,r.properties=null,r.tempMatrix=new Le,r.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:r.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:r.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:r.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:r.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:De.UNSIGNED_BYTE,uploadFunction:r.uploadTint,offset:0}],r.shader=Wt.from(vb,mb,{}),r.state=mr.for2d(),r}return t.prototype.render=function(e){var r=e.children,n=e._maxSize,s=e._batchSize,o=this.renderer,a=r.length;if(a!==0){a>n&&!e.autoResize&&(a=n);var l=e._buffers;l||(l=e._buffers=this.generateBuffers(e));var u=r[0]._texture.baseTexture;this.state.blendMode=xu(e.blendMode,u.alphaMode),o.state.set(this.state);var c=o.gl,h=e.worldTransform.copyTo(this.tempMatrix);h.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=h.toArray(!0),this.shader.uniforms.uColor=xp(e.tintRgb,e.worldAlpha,this.shader.uniforms.uColor,u.alphaMode),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);for(var f=!1,d=0,p=0;d<a;d+=s,p+=1){var v=a-d;v>s&&(v=s),p>=l.length&&l.push(this._generateOneMoreBuffer(e));var y=l[p];y.uploadDynamic(r,d,v);var g=e._bufferUpdateIDs[p]||0;f=f||y._updateID<g,f&&(y._updateID=e._updateID,y.uploadStatic(r,d,v)),o.geometry.bind(y.geometry),c.drawElements(c.TRIANGLES,v*6,c.UNSIGNED_SHORT,0)}}},t.prototype.generateBuffers=function(e){for(var r=[],n=e._maxSize,s=e._batchSize,o=e._properties,a=0;a<n;a+=s)r.push(new sf(this.properties,o,s));return r},t.prototype._generateOneMoreBuffer=function(e){var r=e._batchSize,n=e._properties;return new sf(this.properties,n,r)},t.prototype.uploadVertices=function(e,r,n,s,o,a){for(var l=0,u=0,c=0,h=0,f=0;f<n;++f){var d=e[r+f],p=d._texture,v=d.scale.x,y=d.scale.y,g=p.trim,E=p.orig;g?(u=g.x-d.anchor.x*E.width,l=u+g.width,h=g.y-d.anchor.y*E.height,c=h+g.height):(l=E.width*(1-d.anchor.x),u=E.width*-d.anchor.x,c=E.height*(1-d.anchor.y),h=E.height*-d.anchor.y),s[a]=u*v,s[a+1]=h*y,s[a+o]=l*v,s[a+o+1]=h*y,s[a+o*2]=l*v,s[a+o*2+1]=c*y,s[a+o*3]=u*v,s[a+o*3+1]=c*y,a+=o*4}},t.prototype.uploadPosition=function(e,r,n,s,o,a){for(var l=0;l<n;l++){var u=e[r+l].position;s[a]=u.x,s[a+1]=u.y,s[a+o]=u.x,s[a+o+1]=u.y,s[a+o*2]=u.x,s[a+o*2+1]=u.y,s[a+o*3]=u.x,s[a+o*3+1]=u.y,a+=o*4}},t.prototype.uploadRotation=function(e,r,n,s,o,a){for(var l=0;l<n;l++){var u=e[r+l].rotation;s[a]=u,s[a+o]=u,s[a+o*2]=u,s[a+o*3]=u,a+=o*4}},t.prototype.uploadUvs=function(e,r,n,s,o,a){for(var l=0;l<n;++l){var u=e[r+l]._texture._uvs;u?(s[a]=u.x0,s[a+1]=u.y0,s[a+o]=u.x1,s[a+o+1]=u.y1,s[a+o*2]=u.x2,s[a+o*2+1]=u.y2,s[a+o*3]=u.x3,s[a+o*3+1]=u.y3,a+=o*4):(s[a]=0,s[a+1]=0,s[a+o]=0,s[a+o+1]=0,s[a+o*2]=0,s[a+o*2+1]=0,s[a+o*3]=0,s[a+o*3+1]=0,a+=o*4)}},t.prototype.uploadTint=function(e,r,n,s,o,a){for(var l=0;l<n;++l){var u=e[r+l],c=u._texture.baseTexture.alphaMode>0,h=u.alpha,f=h<1&&c?Ys(u._tintRGB,h):u._tintRGB+(h*255<<24);s[a]=f,s[a+o]=f,s[a+o*2]=f,s[a+o*3]=f,a+=o*4}},t.prototype.destroy=function(){i.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},t})(Ni);/*!
 * @pixi/graphics - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/graphics is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Gt;(function(i){i.MITER="miter",i.BEVEL="bevel",i.ROUND="round"})(Gt||(Gt={}));var Yt;(function(i){i.BUTT="butt",i.ROUND="round",i.SQUARE="square"})(Yt||(Yt={}));var Si={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(i,t){if(t===void 0&&(t=20),!this.adaptive||!i||isNaN(i))return t;var e=Math.ceil(i/this.maxLength);return e<this.minSegments?e=this.minSegments:e>this.maxSegments&&(e=this.maxSegments),e}},Nu=(function(){function i(){this.color=16777215,this.alpha=1,this.texture=le.WHITE,this.matrix=null,this.visible=!1,this.reset()}return i.prototype.clone=function(){var t=new i;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t},i.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=le.WHITE,this.matrix=null,this.visible=!1},i.prototype.destroy=function(){this.texture=null,this.matrix=null},i})();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var vl=function(i,t){return vl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},vl(i,t)};function qs(i,t){vl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Bu={build:function(i){i.points=i.shape.points.slice()},triangulate:function(i,t){var e=i.points,r=i.holes,n=t.points,s=t.indices;if(e.length>=6){for(var o=[],a=0;a<r.length;a++){var l=r[a];o.push(e.length/2),e=e.concat(l.points)}var u=pu(e,o,2);if(!u)return;for(var c=n.length/2,a=0;a<u.length;a+=3)s.push(u[a]+c),s.push(u[a+1]+c),s.push(u[a+2]+c);for(var a=0;a<e.length;a++)n.push(e[a])}}},gl={build:function(i){var t=i.shape,e=i.points,r=t.x,n=t.y,s,o;if(e.length=0,i.type===Re.CIRC)s=t.radius,o=t.radius;else{var a=i.shape;s=a.width,o=a.height}if(!(s===0||o===0)){var l=Math.floor(30*Math.sqrt(t.radius))||Math.floor(15*Math.sqrt(s+o));l/=2.3;for(var u=Math.PI*2/l,c=0;c<l-.5;c++)e.push(r+Math.sin(-u*c)*s,n+Math.cos(-u*c)*o);e.push(e[0],e[1])}},triangulate:function(i,t){var e=i.points,r=t.points,n=t.indices,s=r.length/2,o=s,a=i.shape,l=i.matrix,u=a.x,c=a.y;r.push(i.matrix?l.a*u+l.c*c+l.tx:u,i.matrix?l.b*u+l.d*c+l.ty:c);for(var h=0;h<e.length;h+=2)r.push(e[h],e[h+1]),n.push(s++,o,s)}},Ry={build:function(i){var t=i.shape,e=t.x,r=t.y,n=t.width,s=t.height,o=i.points;o.length=0,o.push(e,r,e+n,r,e+n,r+s,e,r+s)},triangulate:function(i,t){var e=i.points,r=t.points,n=r.length/2;r.push(e[0],e[1],e[2],e[3],e[6],e[7],e[4],e[5]),t.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function ti(i,t,e){var r=t-i;return i+r*e}function Wn(i,t,e,r,n,s,o){o===void 0&&(o=[]);for(var a=20,l=o,u=0,c=0,h=0,f=0,d=0,p=0,v=0,y=0;v<=a;++v)y=v/a,u=ti(i,e,y),c=ti(t,r,y),h=ti(e,n,y),f=ti(r,s,y),d=ti(u,h,y),p=ti(c,f,y),l.push(d,p);return l}var Ly={build:function(i){var t=i.shape,e=i.points,r=t.x,n=t.y,s=t.width,o=t.height,a=Math.max(0,Math.min(t.radius,Math.min(s,o)/2));e.length=0,a?(Wn(r,n+a,r,n,r+a,n,e),Wn(r+s-a,n,r+s,n,r+s,n+a,e),Wn(r+s,n+o-a,r+s,n+o,r+s-a,n+o,e),Wn(r+a,n+o,r,n+o,r,n+o-a,e)):e.push(r,n,r+s,n,r+s,n+o,r,n+o)},triangulate:function(i,t){for(var e=i.points,r=t.points,n=t.indices,s=r.length/2,o=pu(e,null,2),a=0,l=o.length;a<l;a+=3)n.push(o[a]+s),n.push(o[a+1]+s),n.push(o[a+2]+s);for(var a=0,l=e.length;a<l;a++)r.push(e[a],e[++a])}};function of(i,t,e,r,n,s,o,a){var l=i-e*n,u=t-r*n,c=i+e*s,h=t+r*s,f,d;o?(f=r,d=-e):(f=-r,d=e);var p=l+f,v=u+d,y=c+f,g=h+d;return a.push(p,v),a.push(y,g),2}function ri(i,t,e,r,n,s,o,a){var l=e-i,u=r-t,c=Math.atan2(l,u),h=Math.atan2(n-i,s-t);a&&c<h?c+=Math.PI*2:!a&&c>h&&(h+=Math.PI*2);var f=c,d=h-c,p=Math.abs(d),v=Math.sqrt(l*l+u*u),y=(15*p*Math.sqrt(v)/Math.PI>>0)+1,g=d/y;if(f+=g,a){o.push(i,t),o.push(e,r);for(var E=1,T=f;E<y;E++,T+=g)o.push(i,t),o.push(i+Math.sin(T)*v,t+Math.cos(T)*v);o.push(i,t),o.push(n,s)}else{o.push(e,r),o.push(i,t);for(var E=1,T=f;E<y;E++,T+=g)o.push(i+Math.sin(T)*v,t+Math.cos(T)*v),o.push(i,t);o.push(n,s),o.push(i,t)}return y*2}function gb(i,t){var e=i.shape,r=i.points||e.points.slice(),n=t.closePointEps;if(r.length!==0){var s=i.lineStyle,o=new ze(r[0],r[1]),a=new ze(r[r.length-2],r[r.length-1]),l=e.type!==Re.POLY||e.closeStroke,u=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(l){r=r.slice(),u&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));var c=(o.x+a.x)*.5,h=(a.y+o.y)*.5;r.unshift(c,h),r.push(c,h)}var f=t.points,d=r.length/2,p=r.length,v=f.length/2,y=s.width/2,g=y*y,E=s.miterLimit*s.miterLimit,T=r[0],R=r[1],_=r[2],F=r[3],P=0,H=0,M=-(R-F),N=T-_,Y=0,D=0,Z=Math.sqrt(M*M+N*N);M/=Z,N/=Z,M*=y,N*=y;var Q=s.alignment,$=(1-Q)*2,C=Q*2;l||(s.cap===Yt.ROUND?p+=ri(T-M*($-C)*.5,R-N*($-C)*.5,T-M*$,R-N*$,T+M*C,R+N*C,f,!0)+2:s.cap===Yt.SQUARE&&(p+=of(T,R,M,N,$,C,!0,f))),f.push(T-M*$,R-N*$),f.push(T+M*C,R+N*C);for(var O=1;O<d-1;++O){T=r[(O-1)*2],R=r[(O-1)*2+1],_=r[O*2],F=r[O*2+1],P=r[(O+1)*2],H=r[(O+1)*2+1],M=-(R-F),N=T-_,Z=Math.sqrt(M*M+N*N),M/=Z,N/=Z,M*=y,N*=y,Y=-(F-H),D=_-P,Z=Math.sqrt(Y*Y+D*D),Y/=Z,D/=Z,Y*=y,D*=y;var m=_-T,x=R-F,w=_-P,I=H-F,S=x*w-I*m,A=S<0;if(Math.abs(S)<.1){f.push(_-M*$,F-N*$),f.push(_+M*C,F+N*C);continue}var L=(-M+T)*(-N+F)-(-M+_)*(-N+R),B=(-Y+P)*(-D+F)-(-Y+_)*(-D+H),k=(m*B-w*L)/S,U=(I*L-x*B)/S,V=(k-_)*(k-_)+(U-F)*(U-F),j=_+(k-_)*$,z=F+(U-F)*$,K=_-(k-_)*C,q=F-(U-F)*C,ie=Math.min(m*m+x*x,w*w+I*I),ae=A?$:C,te=ie+ae*ae*g,re=V<=te;re?s.join===Gt.BEVEL||V/g>E?(A?(f.push(j,z),f.push(_+M*C,F+N*C),f.push(j,z),f.push(_+Y*C,F+D*C)):(f.push(_-M*$,F-N*$),f.push(K,q),f.push(_-Y*$,F-D*$),f.push(K,q)),p+=2):s.join===Gt.ROUND?A?(f.push(j,z),f.push(_+M*C,F+N*C),p+=ri(_,F,_+M*C,F+N*C,_+Y*C,F+D*C,f,!0)+4,f.push(j,z),f.push(_+Y*C,F+D*C)):(f.push(_-M*$,F-N*$),f.push(K,q),p+=ri(_,F,_-M*$,F-N*$,_-Y*$,F-D*$,f,!1)+4,f.push(_-Y*$,F-D*$),f.push(K,q)):(f.push(j,z),f.push(K,q)):(f.push(_-M*$,F-N*$),f.push(_+M*C,F+N*C),s.join===Gt.BEVEL||V/g>E||(s.join===Gt.ROUND?A?p+=ri(_,F,_+M*C,F+N*C,_+Y*C,F+D*C,f,!0)+2:p+=ri(_,F,_-M*$,F-N*$,_-Y*$,F-D*$,f,!1)+2:(A?(f.push(K,q),f.push(K,q)):(f.push(j,z),f.push(j,z)),p+=2)),f.push(_-Y*$,F-D*$),f.push(_+Y*C,F+D*C),p+=2)}T=r[(d-2)*2],R=r[(d-2)*2+1],_=r[(d-1)*2],F=r[(d-1)*2+1],M=-(R-F),N=T-_,Z=Math.sqrt(M*M+N*N),M/=Z,N/=Z,M*=y,N*=y,f.push(_-M*$,F-N*$),f.push(_+M*C,F+N*C),l||(s.cap===Yt.ROUND?p+=ri(_-M*($-C)*.5,F-N*($-C)*.5,_-M*$,F-N*$,_+M*C,F+N*C,f,!1)+2:s.cap===Yt.SQUARE&&(p+=of(_,F,M,N,$,C,!1,f)));for(var we=t.indices,xe=Si.epsilon*Si.epsilon,O=v;O<p+v-2;++O)T=f[O*2],R=f[O*2+1],_=f[(O+1)*2],F=f[(O+1)*2+1],P=f[(O+2)*2],H=f[(O+2)*2+1],!(Math.abs(T*(F-H)+_*(H-R)+P*(R-F))<xe)&&we.push(O,O+1,O+2)}}function bb(i,t){var e=0,r=i.shape,n=i.points||r.points,s=r.type!==Re.POLY||r.closeStroke;if(n.length!==0){var o=t.points,a=t.indices,l=n.length/2,u=o.length/2,c=u;for(o.push(n[0],n[1]),e=1;e<l;e++)o.push(n[e*2],n[e*2+1]),a.push(c,c+1),c++;s&&a.push(c,u)}}function bl(i,t){i.lineStyle.native?bb(i,t):gb(i,t)}var Ny=(function(i){qs(t,i);function t(e,r,n,s,o,a){a===void 0&&(a=0);var l=this;o=o||s/2;for(var u=-1*Math.PI/2+a,c=n*2,h=Ii/c,f=[],d=0;d<c;d++){var p=d%2?o:s,v=d*h+u;f.push(e+p*Math.cos(v),r+p*Math.sin(v))}return l=i.call(this,f)||this,l}return t})(mi),_l=(function(){function i(){}return i.curveTo=function(t,e,r,n,s,o){var a=o[o.length-2],l=o[o.length-1],u=l-e,c=a-t,h=n-e,f=r-t,d=Math.abs(u*f-c*h);if(d<1e-8||s===0)return(o[o.length-2]!==t||o[o.length-1]!==e)&&o.push(t,e),null;var p=u*u+c*c,v=h*h+f*f,y=u*h+c*f,g=s*Math.sqrt(p)/d,E=s*Math.sqrt(v)/d,T=g*y/p,R=E*y/v,_=g*f+E*c,F=g*h+E*u,P=c*(E+T),H=u*(E+T),M=f*(g+R),N=h*(g+R),Y=Math.atan2(H-F,P-_),D=Math.atan2(N-F,M-_);return{cx:_+t,cy:F+e,radius:s,startAngle:Y,endAngle:D,anticlockwise:c*h>f*u}},i.arc=function(t,e,r,n,s,o,a,l,u){for(var c=a-o,h=Si._segmentsCount(Math.abs(c)*s,Math.ceil(Math.abs(c)/Ii)*40),f=c/(h*2),d=f*2,p=Math.cos(f),v=Math.sin(f),y=h-1,g=y%1/y,E=0;E<=y;++E){var T=E+g*E,R=f+o+d*T,_=Math.cos(R),F=-Math.sin(R);u.push((p*_+v*F)*s+r,(p*-F+v*_)*s+n)}},i})(),By=(function(){function i(){}return i.curveLength=function(t,e,r,n,s,o,a,l){for(var u=10,c=0,h=0,f=0,d=0,p=0,v=0,y=0,g=0,E=0,T=0,R=0,_=t,F=e,P=1;P<=u;++P)h=P/u,f=h*h,d=f*h,p=1-h,v=p*p,y=v*p,g=y*t+3*v*h*r+3*p*f*s+d*a,E=y*e+3*v*h*n+3*p*f*o+d*l,T=_-g,R=F-E,_=g,F=E,c+=Math.sqrt(T*T+R*R);return c},i.curveTo=function(t,e,r,n,s,o,a){var l=a[a.length-2],u=a[a.length-1];a.length-=2;var c=Si._segmentsCount(i.curveLength(l,u,t,e,r,n,s,o)),h=0,f=0,d=0,p=0,v=0;a.push(l,u);for(var y=1,g=0;y<=c;++y)g=y/c,h=1-g,f=h*h,d=f*h,p=g*g,v=p*g,a.push(d*l+3*f*g*t+3*h*p*r+v*s,d*u+3*f*g*e+3*h*p*n+v*o)},i})(),Dy=(function(){function i(){}return i.curveLength=function(t,e,r,n,s,o){var a=t-2*r+s,l=e-2*n+o,u=2*r-2*t,c=2*n-2*e,h=4*(a*a+l*l),f=4*(a*u+l*c),d=u*u+c*c,p=2*Math.sqrt(h+f+d),v=Math.sqrt(h),y=2*h*v,g=2*Math.sqrt(d),E=f/v;return(y*p+v*f*(p-g)+(4*d*h-f*f)*Math.log((2*v+E+p)/(E+g)))/(4*y)},i.curveTo=function(t,e,r,n,s){for(var o=s[s.length-2],a=s[s.length-1],l=Si._segmentsCount(i.curveLength(o,a,t,e,r,n)),u=0,c=0,h=1;h<=l;++h){var f=h/l;u=o+(t-o)*f,c=a+(e-a)*f,s.push(u+(t+(r-t)*f-u)*f,c+(e+(n-e)*f-c)*f)}},i})(),ky=(function(){function i(){this.reset()}return i.prototype.begin=function(t,e,r){this.reset(),this.style=t,this.start=e,this.attribStart=r},i.prototype.end=function(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start},i.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},i})(),wr,_s=(wr={},wr[Re.POLY]=Bu,wr[Re.CIRC]=gl,wr[Re.ELIP]=gl,wr[Re.RECT]=Ry,wr[Re.RREC]=Ly,wr),xl=[],en=[],_b={buildPoly:Bu,buildCircle:gl,buildRectangle:Ry,buildRoundedRectangle:Ly,FILL_COMMANDS:_s,BATCH_POOL:xl,DRAW_CALL_POOL:en,buildLine:bl,Star:Ny,ArcUtils:_l,BezierUtils:By,QuadraticUtils:Dy,BatchPart:ky},wl=(function(){function i(t,e,r,n){e===void 0&&(e=null),r===void 0&&(r=null),n===void 0&&(n=null),this.shape=t,this.lineStyle=r,this.fillStyle=e,this.matrix=n,this.type=t.type,this.points=[],this.holes=[]}return i.prototype.clone=function(){return new i(this.shape,this.fillStyle,this.lineStyle,this.matrix)},i.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},i})(),ii=new ze,xb=new pn,Uy=(function(i){qs(t,i);function t(){var e=i.call(this)||this;return e.uvsFloat32=null,e.indicesUint16=null,e.points=[],e.colors=[],e.uvs=[],e.indices=[],e.textureIds=[],e.graphicsData=[],e.dirty=0,e.batchDirty=-1,e.cacheDirty=-1,e.clearDirty=0,e.drawCalls=[],e.batches=[],e.shapeIndex=0,e._bounds=new pn,e.boundsDirty=-1,e.boundsPadding=0,e.batchable=!1,e.indicesUint16=null,e.uvsFloat32=null,e.closePointEps=1e-4,e}return Object.defineProperty(t.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),t.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var e=0;e<this.drawCalls.length;e++)this.drawCalls[e].texArray.clear(),en.push(this.drawCalls[e]);this.drawCalls.length=0;for(var e=0;e<this.batches.length;e++){var r=this.batches[e];r.reset(),xl.push(r)}this.batches.length=0},t.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},t.prototype.drawShape=function(e,r,n,s){r===void 0&&(r=null),n===void 0&&(n=null),s===void 0&&(s=null);var o=new wl(e,r,n,s);return this.graphicsData.push(o),this.dirty++,this},t.prototype.drawHole=function(e,r){if(r===void 0&&(r=null),!this.graphicsData.length)return null;var n=new wl(e,null,null,r),s=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=s.lineStyle,s.holes.push(n),this.dirty++,this},t.prototype.destroy=function(){i.prototype.destroy.call(this);for(var e=0;e<this.graphicsData.length;++e)this.graphicsData[e].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},t.prototype.containsPoint=function(e){for(var r=this.graphicsData,n=0;n<r.length;++n){var s=r[n];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(e,ii):ii.copyFrom(e),s.shape.contains(ii.x,ii.y))){var o=!1;if(s.holes)for(var a=0;a<s.holes.length;a++){var l=s.holes[a];if(l.shape.contains(ii.x,ii.y)){o=!0;break}}if(!o)return!0}}return!1},t.prototype.updateBatches=function(e){if(!this.graphicsData.length){this.batchable=!0;return}if(this.validateBatching()){this.cacheDirty=this.dirty;var r=this.uvs,n=this.graphicsData,s=null,o=null;this.batches.length>0&&(s=this.batches[this.batches.length-1],o=s.style);for(var a=this.shapeIndex;a<n.length;a++){this.shapeIndex++;var l=n[a],u=l.fillStyle,c=l.lineStyle,h=_s[l.type];h.build(l),l.matrix&&this.transformPoints(l.points,l.matrix);for(var f=0;f<2;f++){var d=f===0?u:c;if(d.visible){var p=d.texture.baseTexture,v=this.indices.length,y=this.points.length/2;p.wrapMode=Rt.REPEAT,f===0?this.processFill(l):this.processLine(l);var g=this.points.length/2-y;g!==0&&(s&&!this._compareStyles(o,d)&&(s.end(v,y),s=null),s||(s=xl.pop()||new ky,s.begin(d,v,y),this.batches.push(s),o=d),this.addUvs(this.points,r,d.texture,y,g,d.matrix))}}}var E=this.indices.length,T=this.points.length/2;if(s&&s.end(E,T),this.batches.length===0){this.batchable=!0;return}if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var R=T>65535&&e;this.indicesUint16=R?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},t.prototype._compareStyles=function(e,r){return!(!e||!r||e.texture.baseTexture!==r.texture.baseTexture||e.color+e.alpha!==r.color+r.alpha||!!e.native!=!!r.native)},t.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var e=0,r=this.graphicsData.length;e<r;e++){var n=this.graphicsData[e],s=n.fillStyle,o=n.lineStyle;if(s&&!s.texture.baseTexture.valid||o&&!o.texture.baseTexture.valid)return!1}return!0},t.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var e=this.batches,r=0,n=e.length;r<n;r++)for(var s=e[r],o=0;o<s.size;o++){var a=s.start+o;this.indicesUint16[a]=this.indicesUint16[a]-s.attribStart}},t.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var e=this.batches,r=0;r<e.length;r++)if(e[r].style.native)return!1;return this.points.length<t.BATCHABLE_SIZE*2},t.prototype.buildDrawCalls=function(){for(var e=++Ee._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),en.push(this.drawCalls[r]);this.drawCalls.length=0;var n=this.colors,s=this.textureIds,o=en.pop();o||(o=new Fs,o.texArray=new Ms),o.texArray.count=0,o.start=0,o.size=0,o.type=ft.TRIANGLES;var a=0,l=null,u=0,c=!1,h=ft.TRIANGLES,f=0;this.drawCalls.push(o);for(var r=0;r<this.batches.length;r++){var d=this.batches[r],p=8,v=d.style,y=v.texture.baseTexture;c!==!!v.native&&(c=!!v.native,h=c?ft.LINES:ft.TRIANGLES,l=null,a=p,e++),l!==y&&(l=y,y._batchEnabled!==e&&(a===p&&(e++,a=0,o.size>0&&(o=en.pop(),o||(o=new Fs,o.texArray=new Ms),this.drawCalls.push(o)),o.start=f,o.size=0,o.texArray.count=0,o.type=h),y.touched=1,y._batchEnabled=e,y._batchLocation=a,y.wrapMode=10497,o.texArray.elements[o.texArray.count++]=y,a++)),o.size+=d.size,f+=d.size,u=y._batchLocation,this.addColors(n,v.color,v.alpha,d.attribSize,d.attribStart),this.addTextureIds(s,u,d.attribSize,d.attribStart)}Ee._globalBatch=e,this.packAttributes()},t.prototype.packAttributes=function(){for(var e=this.points,r=this.uvs,n=this.colors,s=this.textureIds,o=new ArrayBuffer(e.length*3*4),a=new Float32Array(o),l=new Uint32Array(o),u=0,c=0;c<e.length/2;c++)a[u++]=e[c*2],a[u++]=e[c*2+1],a[u++]=r[c*2],a[u++]=r[c*2+1],l[u++]=n[c],a[u++]=s[c];this._buffer.update(o),this._indexBuffer.update(this.indicesUint16)},t.prototype.processFill=function(e){if(e.holes.length)this.processHoles(e.holes),Bu.triangulate(e,this);else{var r=_s[e.type];r.triangulate(e,this)}},t.prototype.processLine=function(e){bl(e,this);for(var r=0;r<e.holes.length;r++)bl(e.holes[r],this)},t.prototype.processHoles=function(e){for(var r=0;r<e.length;r++){var n=e[r],s=_s[n.type];s.build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},t.prototype.calculateBounds=function(){var e=this._bounds,r=xb,n=Le.IDENTITY;this._bounds.clear(),r.clear();for(var s=0;s<this.graphicsData.length;s++){var o=this.graphicsData[s],a=o.shape,l=o.type,u=o.lineStyle,c=o.matrix||Le.IDENTITY,h=0;if(u&&u.visible){var f=u.alignment;h=u.width,l===Re.POLY?h=h*(.5+Math.abs(.5-f)):h=h*Math.max(0,f)}if(n!==c&&(r.isEmpty()||(e.addBoundsMatrix(r,n),r.clear()),n=c),l===Re.RECT||l===Re.RREC){var d=a;r.addFramePad(d.x,d.y,d.x+d.width,d.y+d.height,h,h)}else if(l===Re.CIRC){var p=a;r.addFramePad(p.x,p.y,p.x,p.y,p.radius+h,p.radius+h)}else if(l===Re.ELIP){var v=a;r.addFramePad(v.x,v.y,v.x,v.y,v.width+h,v.height+h)}else{var y=a;e.addVerticesMatrix(n,y.points,0,y.points.length,h,h)}}r.isEmpty()||e.addBoundsMatrix(r,n),e.pad(this.boundsPadding,this.boundsPadding)},t.prototype.transformPoints=function(e,r){for(var n=0;n<e.length/2;n++){var s=e[n*2],o=e[n*2+1];e[n*2]=r.a*s+r.c*o+r.tx,e[n*2+1]=r.b*s+r.d*o+r.ty}},t.prototype.addColors=function(e,r,n,s,o){o===void 0&&(o=0);var a=(r>>16)+(r&65280)+((r&255)<<16),l=Ys(a,n);e.length=Math.max(e.length,o+s);for(var u=0;u<s;u++)e[o+u]=l},t.prototype.addTextureIds=function(e,r,n,s){s===void 0&&(s=0),e.length=Math.max(e.length,s+n);for(var o=0;o<n;o++)e[s+o]=r},t.prototype.addUvs=function(e,r,n,s,o,a){a===void 0&&(a=null);for(var l=0,u=r.length,c=n.frame;l<o;){var h=e[(s+l)*2],f=e[(s+l)*2+1];if(a){var d=a.a*h+a.c*f+a.tx;f=a.b*h+a.d*f+a.ty,h=d}l++,r.push(h/c.width,f/c.height)}var p=n.baseTexture;(c.width<p.width||c.height<p.height)&&this.adjustUvs(r,n,u,o)},t.prototype.adjustUvs=function(e,r,n,s){for(var o=r.baseTexture,a=1e-6,l=n+s*2,u=r.frame,c=u.width/o.width,h=u.height/o.height,f=u.x/u.width,d=u.y/u.height,p=Math.floor(e[n]+a),v=Math.floor(e[n+1]+a),y=n+2;y<l;y+=2)p=Math.min(p,Math.floor(e[y]+a)),v=Math.min(v,Math.floor(e[y+1]+a));f-=p,d-=v;for(var y=n;y<l;y+=2)e[y]=(e[y]+f)*c,e[y+1]=(e[y+1]+d)*h},t.BATCHABLE_SIZE=100,t})(Lu),Xy=(function(i){qs(t,i);function t(){var e=i!==null&&i.apply(this,arguments)||this;return e.width=0,e.alignment=.5,e.native=!1,e.cap=Yt.BUTT,e.join=Gt.MITER,e.miterLimit=10,e}return t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e.cap=this.cap,e.join=this.join,e.miterLimit=this.miterLimit,e},t.prototype.reset=function(){i.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},t})(Nu),wb=new Float32Array(3),Oa={},js=(function(i){qs(t,i);function t(e){e===void 0&&(e=null);var r=i.call(this)||this;return r._geometry=e||new Uy,r._geometry.refCount++,r.shader=null,r.state=mr.for2d(),r._fillStyle=new Nu,r._lineStyle=new Xy,r._matrix=null,r._holeMode=!1,r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r.pluginName="batch",r._transformID=-1,r.tint=16777215,r.blendMode=se.NORMAL,r}return Object.defineProperty(t.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return this.finishPoly(),new t(this._geometry)},Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(e){this._tint=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),t.prototype.lineStyle=function(e){if(e===void 0&&(e=null),typeof e=="number"){var r=arguments;e={width:r[0]||0,color:r[1]||0,alpha:r[2]!==void 0?r[2]:1,alignment:r[3]!==void 0?r[3]:.5,native:!!r[4]}}return this.lineTextureStyle(e)},t.prototype.lineTextureStyle=function(e){if(typeof e=="number"){W("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var r=arguments,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],u=r[5],c=r[6];e={width:n,texture:s,color:o,alpha:a,matrix:l,alignment:u,native:c},Object.keys(e).forEach(function(f){return e[f]===void 0&&delete e[f]})}e=Object.assign({width:0,texture:le.WHITE,color:e&&e.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Yt.BUTT,join:Gt.MITER,miterLimit:10},e),this.currentPath&&this.startPoly();var h=e.width>0&&e.alpha>0;return h?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._lineStyle,{visible:h},e)):this._lineStyle.reset(),this},t.prototype.startPoly=function(){if(this.currentPath){var e=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new mi,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[r-2],e[r-1]))}else this.currentPath=new mi,this.currentPath.closeStroke=!1},t.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},t.prototype.moveTo=function(e,r){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=r,this},t.prototype.lineTo=function(e,r){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points,s=n[n.length-2],o=n[n.length-1];return(s!==e||o!==r)&&n.push(e,r),this},t.prototype._initCurve=function(e,r){e===void 0&&(e=0),r===void 0&&(r=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[e,r]):this.moveTo(e,r)},t.prototype.quadraticCurveTo=function(e,r,n,s){this._initCurve();var o=this.currentPath.points;return o.length===0&&this.moveTo(0,0),Dy.curveTo(e,r,n,s,o),this},t.prototype.bezierCurveTo=function(e,r,n,s,o,a){return this._initCurve(),By.curveTo(e,r,n,s,o,a,this.currentPath.points),this},t.prototype.arcTo=function(e,r,n,s,o){this._initCurve(e,r);var a=this.currentPath.points,l=_l.curveTo(e,r,n,s,o,a);if(l){var u=l.cx,c=l.cy,h=l.radius,f=l.startAngle,d=l.endAngle,p=l.anticlockwise;this.arc(u,c,h,f,d,p)}return this},t.prototype.arc=function(e,r,n,s,o,a){if(a===void 0&&(a=!1),s===o)return this;!a&&o<=s?o+=Ii:a&&s<=o&&(s+=Ii);var l=o-s;if(l===0)return this;var u=e+Math.cos(s)*n,c=r+Math.sin(s)*n,h=this._geometry.closePointEps,f=this.currentPath?this.currentPath.points:null;if(f){var d=Math.abs(f[f.length-2]-u),p=Math.abs(f[f.length-1]-c);d<h&&p<h||f.push(u,c)}else this.moveTo(u,c),f=this.currentPath.points;return _l.arc(u,c,e,r,n,s,o,a,f),this},t.prototype.beginFill=function(e,r){return e===void 0&&(e=0),r===void 0&&(r=1),this.beginTextureFill({texture:le.WHITE,color:e,alpha:r})},t.prototype.beginTextureFill=function(e){if(e instanceof le){W("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var r=arguments,n=r[0],s=r[1],o=r[2],a=r[3];e={texture:n,color:s,alpha:o,matrix:a},Object.keys(e).forEach(function(u){return e[u]===void 0&&delete e[u]})}e=Object.assign({texture:le.WHITE,color:16777215,alpha:1,matrix:null},e),this.currentPath&&this.startPoly();var l=e.alpha>0;return l?(e.matrix&&(e.matrix=e.matrix.clone(),e.matrix.invert()),Object.assign(this._fillStyle,{visible:l},e)):this._fillStyle.reset(),this},t.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},t.prototype.drawRect=function(e,r,n,s){return this.drawShape(new ge(e,r,n,s))},t.prototype.drawRoundedRect=function(e,r,n,s,o){return this.drawShape(new Op(e,r,n,s,o))},t.prototype.drawCircle=function(e,r,n){return this.drawShape(new Ap(e,r,n))},t.prototype.drawEllipse=function(e,r,n,s){return this.drawShape(new Pp(e,r,n,s))},t.prototype.drawPolygon=function(){for(var e=arguments,r=[],n=0;n<arguments.length;n++)r[n]=e[n];var s,o=!0,a=r[0];a.points?(o=a.closeStroke,s=a.points):Array.isArray(r[0])?s=r[0]:s=r;var l=new mi(s);return l.closeStroke=o,this.drawShape(l),this},t.prototype.drawShape=function(e){return this._holeMode?this._geometry.drawHole(e,this._matrix):this._geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},t.prototype.drawStar=function(e,r,n,s,o,a){return a===void 0&&(a=0),this.drawPolygon(new Ny(e,r,n,s,o,a))},t.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},t.prototype.isFastRect=function(){var e=this._geometry.graphicsData;return e.length===1&&e[0].shape.type===Re.RECT&&!(e[0].lineStyle.visible&&e[0].lineStyle.width)},t.prototype._render=function(e){this.finishPoly();var r=this._geometry,n=e.context.supports.uint32Indices;r.updateBatches(n),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))},t.prototype._populateBatches=function(){var e=this._geometry,r=this.blendMode,n=e.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(e.points);for(var s=0;s<n;s++){var o=e.batches[s],a=o.style.color,l=new Float32Array(this.vertexData.buffer,o.attribStart*4*2,o.attribSize*2),u=new Float32Array(e.uvsFloat32.buffer,o.attribStart*4*2,o.attribSize*2),c=new Uint16Array(e.indicesUint16.buffer,o.start*2,o.size),h={vertexData:l,blendMode:r,indices:c,uvs:u,_batchRGB:Dr(a),_tintRGB:a,_texture:o.style.texture,alpha:o.style.alpha,worldAlpha:1};this.batches[s]=h}},t.prototype._renderBatched=function(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var r=0,n=this.batches.length;r<n;r++){var s=this.batches[r];s.worldAlpha=this.worldAlpha*s.alpha,e.plugins[this.pluginName].render(s)}}},t.prototype._renderDirect=function(e){var r=this._resolveDirectShader(e),n=this._geometry,s=this.tint,o=this.worldAlpha,a=r.uniforms,l=n.drawCalls;a.translationMatrix=this.transform.worldTransform,a.tint[0]=(s>>16&255)/255*o,a.tint[1]=(s>>8&255)/255*o,a.tint[2]=(s&255)/255*o,a.tint[3]=o,e.shader.bind(r),e.geometry.bind(n,r),e.state.set(this.state);for(var u=0,c=l.length;u<c;u++)this._renderDrawCallDirect(e,n.drawCalls[u])},t.prototype._renderDrawCallDirect=function(e,r){for(var n=r.texArray,s=r.type,o=r.size,a=r.start,l=n.count,u=0;u<l;u++)e.texture.bind(n.elements[u],u);e.geometry.draw(s,o,a)},t.prototype._resolveDirectShader=function(e){var r=this.shader,n=this.pluginName;if(!r){if(!Oa[n]){for(var s=e.plugins.batch.MAX_TEXTURES,o=new Int32Array(s),a=0;a<s;a++)o[a]=a;var l={tint:new Float32Array([1,1,1,1]),translationMatrix:new Le,default:fr.from({uSamplers:o},!0)},u=e.plugins[n]._shader.program;Oa[n]=new Wt(u,l)}r=Oa[n]}return r},t.prototype._calculateBounds=function(){this.finishPoly();var e=this._geometry;if(e.graphicsData.length){var r=e.bounds,n=r.minX,s=r.minY,o=r.maxX,a=r.maxY;this._bounds.addFrame(this.transform,n,s,o,a)}},t.prototype.containsPoint=function(e){return this.worldTransform.applyInverse(e,t._TEMP_POINT),this._geometry.containsPoint(t._TEMP_POINT)},t.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var e=Dr(this.tint,wb),r=0;r<this.batches.length;r++){var n=this.batches[r],s=n._batchRGB,o=e[0]*s[0]*255,a=e[1]*s[1]*255,l=e[2]*s[2]*255,u=(o<<16)+(a<<8)+(l|0);n._tintRGB=(u>>16)+(u&65280)+((u&255)<<16)}}},t.prototype.calculateVertices=function(){var e=this.transform._worldID;if(this._transformID!==e){this._transformID=e;for(var r=this.transform.worldTransform,n=r.a,s=r.b,o=r.c,a=r.d,l=r.tx,u=r.ty,c=this._geometry.points,h=this.vertexData,f=0,d=0;d<c.length;d+=2){var p=c[d],v=c[d+1];h[f++]=n*p+o*v+l,h[f++]=a*v+s*p+u}}},t.prototype.closePath=function(){var e=this.currentPath;return e&&(e.closeStroke=!0),this},t.prototype.setMatrix=function(e){return this._matrix=e,this},t.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},t.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},t.prototype.destroy=function(e){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,i.prototype.destroy.call(this,e)},t._TEMP_POINT=new ze,t})(st);/*!
 * @pixi/sprite - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/sprite is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Tl=function(i,t){return Tl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Tl(i,t)};function Tb(i,t){Tl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ji=new ze,Ib=new Uint16Array([0,1,2,0,2,3]),$r=(function(i){Tb(t,i);function t(e){var r=i.call(this)||this;return r._anchor=new Lr(r._onAnchorUpdate,r,e?e.defaultAnchor.x:0,e?e.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=se.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=e||le.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=Ib,r.pluginName="batch",r.isSprite=!0,r._roundPixels=ne.ROUND_PIXELS,r}return t.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Rr(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Rr(this.scale.y)*this._height/this._texture.orig.height)},t.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},t.prototype.calculateVertices=function(){var e=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===e._updateID)){this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;var r=this.transform.worldTransform,n=r.a,s=r.b,o=r.c,a=r.d,l=r.tx,u=r.ty,c=this.vertexData,h=e.trim,f=e.orig,d=this._anchor,p=0,v=0,y=0,g=0;if(h?(v=h.x-d._x*f.width,p=v+h.width,g=h.y-d._y*f.height,y=g+h.height):(v=-d._x*f.width,p=v+f.width,g=-d._y*f.height,y=g+f.height),c[0]=n*v+o*g+l,c[1]=a*g+s*v+u,c[2]=n*p+o*g+l,c[3]=a*g+s*p+u,c[4]=n*p+o*y+l,c[5]=a*y+s*p+u,c[6]=n*v+o*y+l,c[7]=a*y+s*v+u,this._roundPixels)for(var E=ne.RESOLUTION,T=0;T<c.length;++T)c[T]=Math.round((c[T]*E|0)/E)}},t.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var e=this._texture,r=this.vertexTrimmedData,n=e.orig,s=this._anchor,o=this.transform.worldTransform,a=o.a,l=o.b,u=o.c,c=o.d,h=o.tx,f=o.ty,d=-s._x*n.width,p=d+n.width,v=-s._y*n.height,y=v+n.height;r[0]=a*d+u*v+h,r[1]=c*v+l*d+f,r[2]=a*p+u*v+h,r[3]=c*v+l*p+f,r[4]=a*p+u*y+h,r[5]=c*y+l*p+f,r[6]=a*d+u*y+h,r[7]=c*y+l*d+f},t.prototype._render=function(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)},t.prototype._calculateBounds=function(){var e=this._texture.trim,r=this._texture.orig;!e||e.width===r.width&&e.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},t.prototype.getLocalBounds=function(e){return this.children.length===0?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ge),e=this._localBoundsRect),this._bounds.getRectangle(e)):i.prototype.getLocalBounds.call(this,e)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,ji);var r=this._texture.orig.width,n=this._texture.orig.height,s=-r*this.anchor.x,o=0;return ji.x>=s&&ji.x<s+r&&(o=-n*this.anchor.y,ji.y>=o&&ji.y<o+n)},t.prototype.destroy=function(e){i.prototype.destroy.call(this,e),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var r=typeof e=="boolean"?e:e&&e.texture;if(r){var n=typeof e=="boolean"?e:e&&e.baseTexture;this._texture.destroy(!!n)}this._texture=null},t.from=function(e,r){var n=e instanceof le?e:le.from(e,r);return new t(n)},Object.defineProperty(t.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(e){var r=Rr(this.scale.x)||1;this.scale.x=r*e/this._texture.orig.width,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(e){var r=Rr(this.scale.y)||1;this.scale.y=r*e/this._texture.orig.height,this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},set:function(e){this._anchor.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(e){this._tint=e,this._tintRGB=(e>>16)+(e&65280)+((e&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture!==e&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=e||le.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),t})(st);/*!
 * @pixi/text - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/text is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Il=function(i,t){return Il=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Il(i,t)};function Eb(i,t){Il(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Ci;(function(i){i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(Ci||(Ci={}));var Fa={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Ci.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},Sb=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Hr=(function(){function i(t){this.styleID=0,this.reset(),Ra(this,t,t)}return i.prototype.clone=function(){var t={};return Ra(t,this,Fa),new i(t)},i.prototype.reset=function(){Ra(this,Fa,Fa)},Object.defineProperty(i.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"breakWords",{get:function(){return this._breakWords},set:function(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(t){var e=Ma(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fill",{get:function(){return this._fill},set:function(t){var e=Ma(t);this._fill!==e&&(this._fill=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(t){Cb(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leading",{get:function(){return this._leading},set:function(t){this._leading!==t&&(this._leading=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"padding",{get:function(){return this._padding},set:function(t){this._padding!==t&&(this._padding=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"stroke",{get:function(){return this._stroke},set:function(t){var e=Ma(t);this._stroke!==e&&(this._stroke=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trim",{get:function(){return this._trim},set:function(t){this._trim!==t&&(this._trim=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)},enumerable:!1,configurable:!0}),i.prototype.toFontString=function(){var t=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(var r=e.length-1;r>=0;r--){var n=e[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&Sb.indexOf(n)<0&&(n='"'+n+'"'),e[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+t+" "+e.join(",")},i})();function af(i){return typeof i=="number"?gu(i):(typeof i=="string"&&i.indexOf("0x")===0&&(i=i.replace("0x","#")),i)}function Ma(i){if(Array.isArray(i)){for(var t=0;t<i.length;++t)i[t]=af(i[t]);return i}else return af(i)}function Cb(i,t){if(!Array.isArray(i)||!Array.isArray(t)||i.length!==t.length)return!1;for(var e=0;e<i.length;++e)if(i[e]!==t[e])return!1;return!0}function Ra(i,t,e){for(var r in e)Array.isArray(t[r])?i[r]=t[r].slice():i[r]=t[r]}var wt=(function(){function i(t,e,r,n,s,o,a,l,u){this.text=t,this.style=e,this.width=r,this.height=n,this.lines=s,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=u}return i.measureText=function(t,e,r,n){n===void 0&&(n=i._canvas),r=r??e.wordWrap;var s=e.toFontString(),o=i.measureFont(s);o.fontSize===0&&(o.fontSize=e.fontSize,o.ascent=e.fontSize);var a=n.getContext("2d");a.font=s;for(var l=r?i.wordWrap(t,e,n):t,u=l.split(/(?:\r\n|\r|\n)/),c=new Array(u.length),h=0,f=0;f<u.length;f++){var d=a.measureText(u[f]).width+(u[f].length-1)*e.letterSpacing;c[f]=d,h=Math.max(h,d)}var p=h+e.strokeThickness;e.dropShadow&&(p+=e.dropShadowDistance);var v=e.lineHeight||o.fontSize+e.strokeThickness,y=Math.max(v,o.fontSize+e.strokeThickness)+(u.length-1)*(v+e.leading);return e.dropShadow&&(y+=e.dropShadowDistance),new i(t,e,p,y,u,c,v+e.leading,h,o)},i.wordWrap=function(t,e,r){r===void 0&&(r=i._canvas);for(var n=r.getContext("2d"),s=0,o="",a="",l=Object.create(null),u=e.letterSpacing,c=e.whiteSpace,h=i.collapseSpaces(c),f=i.collapseNewlines(c),d=!h,p=e.wordWrapWidth+u,v=i.tokenize(t),y=0;y<v.length;y++){var g=v[y];if(i.isNewline(g)){if(!f){a+=i.addLine(o),d=!h,o="",s=0;continue}g=" "}if(h){var E=i.isBreakingSpace(g),T=i.isBreakingSpace(o[o.length-1]);if(E&&T)continue}var R=i.getFromCache(g,u,l,n);if(R>p)if(o!==""&&(a+=i.addLine(o),o="",s=0),i.canBreakWords(g,e.breakWords))for(var _=i.wordWrapSplit(g),F=0;F<_.length;F++){for(var P=_[F],H=1;_[F+H];){var M=_[F+H],N=P[P.length-1];if(!i.canBreakChars(N,M,g,F,e.breakWords))P+=M;else break;H++}F+=P.length-1;var Y=i.getFromCache(P,u,l,n);Y+s>p&&(a+=i.addLine(o),d=!1,o="",s=0),o+=P,s+=Y}else{o.length>0&&(a+=i.addLine(o),o="",s=0);var D=y===v.length-1;a+=i.addLine(g,!D),d=!1,o="",s=0}else R+s>p&&(d=!1,a+=i.addLine(o),o="",s=0),(o.length>0||!i.isBreakingSpace(g)||d)&&(o+=g,s+=R)}return a+=i.addLine(o,!1),a},i.addLine=function(t,e){return e===void 0&&(e=!0),t=i.trimRight(t),t=e?t+`
`:t,t},i.getFromCache=function(t,e,r,n){var s=r[t];if(typeof s!="number"){var o=t.length*e;s=n.measureText(t).width+o,r[t]=s}return s},i.collapseSpaces=function(t){return t==="normal"||t==="pre-line"},i.collapseNewlines=function(t){return t==="normal"},i.trimRight=function(t){if(typeof t!="string")return"";for(var e=t.length-1;e>=0;e--){var r=t[e];if(!i.isBreakingSpace(r))break;t=t.slice(0,-1)}return t},i.isNewline=function(t){return typeof t!="string"?!1:i._newlines.indexOf(t.charCodeAt(0))>=0},i.isBreakingSpace=function(t){return typeof t!="string"?!1:i._breakingSpaces.indexOf(t.charCodeAt(0))>=0},i.tokenize=function(t){var e=[],r="";if(typeof t!="string")return e;for(var n=0;n<t.length;n++){var s=t[n];if(i.isBreakingSpace(s)||i.isNewline(s)){r!==""&&(e.push(r),r=""),e.push(s);continue}r+=s}return r!==""&&e.push(r),e},i.canBreakWords=function(t,e){return e},i.canBreakChars=function(t,e,r,n,s){return!0},i.wordWrapSplit=function(t){return t.split("")},i.measureFont=function(t){if(i._fonts[t])return i._fonts[t];var e={ascent:0,descent:0,fontSize:0},r=i._canvas,n=i._context;n.font=t;var s=i.METRICS_STRING+i.BASELINE_SYMBOL,o=Math.ceil(n.measureText(s).width),a=Math.ceil(n.measureText(i.BASELINE_SYMBOL).width),l=2*a;a=a*i.BASELINE_MULTIPLIER|0,r.width=o,r.height=l,n.fillStyle="#f00",n.fillRect(0,0,o,l),n.font=t,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,a);var u=n.getImageData(0,0,o,l).data,c=u.length,h=o*4,f=0,d=0,p=!1;for(f=0;f<a;++f){for(var v=0;v<h;v+=4)if(u[d+v]!==255){p=!0;break}if(!p)d+=h;else break}for(e.ascent=a-f,d=c-h,p=!1,f=l;f>a;--f){for(var v=0;v<h;v+=4)if(u[d+v]!==255){p=!0;break}if(!p)d-=h;else break}return e.descent=f-a,e.fontSize=e.ascent+e.descent,i._fonts[t]=e,e},i.clearMetrics=function(t){t===void 0&&(t=""),t?delete i._fonts[t]:i._fonts={}},i})(),Rs=(function(){try{var i=new OffscreenCanvas(0,0),t=i.getContext("2d");return t&&t.measureText?i:document.createElement("canvas")}catch{return document.createElement("canvas")}})();Rs.width=Rs.height=10;wt._canvas=Rs;wt._context=Rs.getContext("2d");wt._fonts={};wt.METRICS_STRING="|q";wt.BASELINE_SYMBOL="M";wt.BASELINE_MULTIPLIER=1.4;wt._newlines=[10,13];wt._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var Ab={texture:!0,children:!1,baseTexture:!0},Du=(function(i){Eb(t,i);function t(e,r,n){var s=this,o=!1;n||(n=document.createElement("canvas"),o=!0),n.width=3,n.height=3;var a=le.from(n);return a.orig=new ge,a.trim=new ge,s=i.call(this,a)||this,s._ownCanvas=o,s.canvas=n,s.context=s.canvas.getContext("2d"),s._resolution=ne.RESOLUTION,s._autoResolution=!0,s._text=null,s._style=null,s._styleListener=null,s._font="",s.text=e,s.style=r,s.localStyleID=-1,s}return t.prototype.updateText=function(e){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!(!this.dirty&&e)){this._font=this._style.toFontString();var n=this.context,s=wt.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=s.width,a=s.height,l=s.lines,u=s.lineHeight,c=s.lineWidths,h=s.maxLineWidth,f=s.fontProperties;this.canvas.width=Math.ceil((Math.max(1,o)+r.padding*2)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,a)+r.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=r.strokeThickness,n.textBaseline=r.textBaseline,n.lineJoin=r.lineJoin,n.miterLimit=r.miterLimit;for(var d,p,v=r.dropShadow?2:1,y=0;y<v;++y){var g=r.dropShadow&&y===0,E=g?Math.ceil(Math.max(1,a)+r.padding*2):0,T=E*this._resolution;if(g){n.fillStyle="black",n.strokeStyle="black";var R=r.dropShadowColor,_=Dr(typeof R=="number"?R:bu(R)),F=r.dropShadowBlur*this._resolution,P=r.dropShadowDistance*this._resolution;n.shadowColor="rgba("+_[0]*255+","+_[1]*255+","+_[2]*255+","+r.dropShadowAlpha+")",n.shadowBlur=F,n.shadowOffsetX=Math.cos(r.dropShadowAngle)*P,n.shadowOffsetY=Math.sin(r.dropShadowAngle)*P+T}else n.fillStyle=this._generateFillStyle(r,l,s),n.strokeStyle=r.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;for(var H=0;H<l.length;H++)d=r.strokeThickness/2,p=r.strokeThickness/2+H*u+f.ascent,r.align==="right"?d+=h-c[H]:r.align==="center"&&(d+=(h-c[H])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(l[H],d+r.padding,p+r.padding-E,!0),r.fill&&this.drawLetterSpacing(l[H],d+r.padding,p+r.padding-E)}this.updateTexture()}},t.prototype.drawLetterSpacing=function(e,r,n,s){s===void 0&&(s=!1);var o=this._style,a=o.letterSpacing;if(a===0){s?this.context.strokeText(e,r,n):this.context.fillText(e,r,n);return}for(var l=r,u=Array.from?Array.from(e):e.split(""),c=this.context.measureText(e).width,h=0,f=0;f<u.length;++f){var d=u[f];s?this.context.strokeText(d,l,n):this.context.fillText(d,l,n),h=this.context.measureText(e.substring(f+1)).width,l+=c-h+a,c=h}},t.prototype.updateTexture=function(){var e=this.canvas;if(this._style.trim){var r=Tp(e);r.data&&(e.width=r.width,e.height=r.height,this.context.putImageData(r.data,0,0))}var n=this._texture,s=this._style,o=s.trim?0:s.padding,a=n.baseTexture;n.trim.width=n._frame.width=Math.ceil(e.width/this._resolution),n.trim.height=n._frame.height=Math.ceil(e.height/this._resolution),n.trim.x=-o,n.trim.y=-o,n.orig.width=n._frame.width-o*2,n.orig.height=n._frame.height-o*2,this._onTextureUpdate(),a.setRealSize(e.width,e.height,this._resolution),this._recursivePostUpdateTransform(),this.dirty=!1},t.prototype._render=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),i.prototype._render.call(this,e)},t.prototype.getLocalBounds=function(e){return this.updateText(!0),i.prototype.getLocalBounds.call(this,e)},t.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},t.prototype._generateFillStyle=function(e,r,n){var s=e.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;var o,a=e.dropShadow?e.dropShadowDistance:0,l=e.padding||0,u=Math.ceil(this.canvas.width/this._resolution)-a-l*2,c=Math.ceil(this.canvas.height/this._resolution)-a-l*2,h=s.slice(),f=e.fillGradientStops.slice();if(!f.length)for(var d=h.length+1,p=1;p<d;++p)f.push(p/d);if(h.unshift(s[0]),f.unshift(0),h.push(s[s.length-1]),f.push(1),e.fillGradientType===Ci.LINEAR_VERTICAL){o=this.context.createLinearGradient(u/2,l,u/2,c+l);for(var v=0,y=n.fontProperties.fontSize+e.strokeThickness,g=y/c,p=0;p<r.length;p++)for(var E=n.lineHeight*p,T=0;T<h.length;T++){var R=0;typeof f[T]=="number"?R=f[T]:R=T/h.length;var _=E/c+R*g,F=Math.max(v,_);F=Math.min(F,1),o.addColorStop(F,h[T]),v=F}}else{o=this.context.createLinearGradient(l,c/2,u+l,c/2);for(var P=h.length+1,H=1,p=0;p<h.length;p++){var M=void 0;typeof f[p]=="number"?M=f[p]:M=H/P,o.addColorStop(M,h[p]),H++}}return o},t.prototype.destroy=function(e){typeof e=="boolean"&&(e={children:e}),e=Object.assign({},Ab,e),i.prototype.destroy.call(this,e),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(t.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(e){this.updateText(!0);var r=Rr(this.scale.x)||1;this.scale.x=r*e/this._texture.orig.width,this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(e){this.updateText(!0);var r=Rr(this.scale.y)||1;this.scale.y=r*e/this._texture.orig.height,this._height=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(e){e=e||{},e instanceof Hr?this._style=e:this._style=new Hr(e),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)},enumerable:!1,configurable:!0}),t})($r);/*!
 * @pixi/prepare - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/prepare is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */ne.UPLOADS_PER_FRAME=4;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var El=function(i,t){return El=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},El(i,t)};function Pb(i,t){El(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Hy=(function(){function i(t){this.maxItemsPerFrame=t,this.itemsLeft=0}return i.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},i.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},i})();function Ob(i,t){var e=!1;if(i&&i._textures&&i._textures.length){for(var r=0;r<i._textures.length;r++)if(i._textures[r]instanceof le){var n=i._textures[r].baseTexture;t.indexOf(n)===-1&&(t.push(n),e=!0)}}return e}function Fb(i,t){if(i.baseTexture instanceof Ee){var e=i.baseTexture;return t.indexOf(e)===-1&&t.push(e),!0}return!1}function Mb(i,t){if(i._texture&&i._texture instanceof le){var e=i._texture.baseTexture;return t.indexOf(e)===-1&&t.push(e),!0}return!1}function Rb(i,t){return t instanceof Du?(t.updateText(!0),!0):!1}function Lb(i,t){if(t instanceof Hr){var e=t.toFontString();return wt.measureFont(e),!0}return!1}function Nb(i,t){if(i instanceof Du){t.indexOf(i.style)===-1&&t.push(i.style),t.indexOf(i)===-1&&t.push(i);var e=i._texture.baseTexture;return t.indexOf(e)===-1&&t.push(e),!0}return!1}function Bb(i,t){return i instanceof Hr?(t.indexOf(i)===-1&&t.push(i),!0):!1}var Gy=(function(){function i(t){var e=this;this.limiter=new Hy(ne.UPLOADS_PER_FRAME),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){e.queue&&e.prepareItems()},this.registerFindHook(Nb),this.registerFindHook(Bb),this.registerFindHook(Ob),this.registerFindHook(Fb),this.registerFindHook(Mb),this.registerUploadHook(Rb),this.registerUploadHook(Lb)}return i.prototype.upload=function(t,e){typeof t=="function"&&(e=t,t=null),t&&this.add(t),this.queue.length?(e&&this.completes.push(e),this.ticking||(this.ticking=!0,Ye.system.addOnce(this.tick,this,Bt.UTILITY))):e&&e()},i.prototype.tick=function(){setTimeout(this.delayedTick,0)},i.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var t=this.queue[0],e=!1;if(t&&!t._destroyed){for(var r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}}e||this.queue.shift()}if(this.queue.length)Ye.system.addOnce(this.tick,this,Bt.UTILITY);else{this.ticking=!1;var s=this.completes.slice(0);this.completes.length=0;for(var r=0,n=s.length;r<n;r++)s[r]()}},i.prototype.registerFindHook=function(t){return t&&this.addHooks.push(t),this},i.prototype.registerUploadHook=function(t){return t&&this.uploadHooks.push(t),this},i.prototype.add=function(t){for(var e=0,r=this.addHooks.length;e<r&&!this.addHooks[e](t,this.queue);e++);if(t instanceof st)for(var e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this},i.prototype.destroy=function(){this.ticking&&Ye.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},i})();function Yy(i,t){return t instanceof Ee?(t._glTextures[i.CONTEXT_UID]||i.texture.bind(t),!0):!1}function Db(i,t){if(!(t instanceof js))return!1;var e=t.geometry;t.finishPoly(),e.updateBatches();for(var r=e.batches,n=0;n<r.length;n++){var s=r[n].style.texture;s&&Yy(i,s.baseTexture)}return e.batchable||i.geometry.bind(e,t._resolveDirectShader(i)),!0}function kb(i,t){return i instanceof js?(t.push(i),!0):!1}var zy=(function(i){Pb(t,i);function t(e){var r=i.call(this,e)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook(kb),r.registerUploadHook(Yy),r.registerUploadHook(Db),r}return t})(Gy),Ub=(function(){function i(t){this.maxMilliseconds=t,this.frameStart=0}return i.prototype.beginFrame=function(){this.frameStart=Date.now()},i.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},i})();/*!
 * @pixi/spritesheet - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/spritesheet is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var $y=(function(){function i(t,e,r){r===void 0&&(r=null),this._texture=t instanceof le?t:null,this.baseTexture=t instanceof Ee?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;var n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return i.prototype._updateResolution=function(t){t===void 0&&(t=null);var e=this.data.meta.scale,r=dn(t,null);return r===null&&(r=e!==void 0?parseFloat(e):1),r!==1&&this.baseTexture.setResolution(r),r},i.prototype.parse=function(t){this._batchIndex=0,this._callback=t,this._frameKeys.length<=i.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},i.prototype._processFrames=function(t){for(var e=t,r=i.BATCH_SIZE;e-t<r&&e<this._frameKeys.length;){var n=this._frameKeys[e],s=this._frames[n],o=s.frame;if(o){var a=null,l=null,u=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,c=new ge(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);s.rotated?a=new ge(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new ge(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(l=new ge(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new le(this.baseTexture,a,c,l,s.rotated?2:0,s.anchor),le.addToCache(this.textures[n],n)}e++}},i.prototype._processAnimations=function(){var t=this.data.animations||{};for(var e in t){this.animations[e]=[];for(var r=0;r<t[e].length;r++){var n=t[e][r];this.animations[e].push(this.textures[n])}}},i.prototype._parseComplete=function(){var t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)},i.prototype._nextBatch=function(){var t=this;this._processFrames(this._batchIndex*i.BATCH_SIZE),this._batchIndex++,setTimeout(function(){t._batchIndex*i.BATCH_SIZE<t._frameKeys.length?t._nextBatch():(t._processAnimations(),t._parseComplete())},0)},i.prototype.destroy=function(t){var e;t===void 0&&(t=!1);for(var r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)===null||e===void 0||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},i.BATCH_SIZE=1e3,i})(),Vy=(function(){function i(){}return i.use=function(t,e){var r=this,n=t.name+"_image";if(!t.data||t.type!==an.TYPE.JSON||!t.data.frames||r.resources[n]){e();return}var s={crossOrigin:t.crossOrigin,metadata:t.metadata.imageMetadata,parentResource:t},o=i.getResourcePath(t,r.baseUrl);r.add(n,o,s,function(l){if(l.error){e(l.error);return}var u=new $y(l.texture,t.data,t.url);u.parse(function(){t.spritesheet=u,t.textures=u.textures,e()})})},i.getResourcePath=function(t,e){return t.isDataUrl?t.data.meta.image:gp.resolve(t.url.replace(e,""),t.data.meta.image)},i})();/*!
 * @pixi/sprite-tiling - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/sprite-tiling is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Sl=function(i,t){return Sl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Sl(i,t)};function qy(i,t){Sl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Wi=new ze,Xb=(function(i){qy(t,i);function t(e,r,n){r===void 0&&(r=100),n===void 0&&(n=100);var s=i.call(this,e)||this;return s.tileTransform=new Iu,s._width=r,s._height=n,s.uvMatrix=s.texture.uvMatrix||new Vs(e),s.pluginName="tilingSprite",s.uvRespectAnchor=!1,s}return Object.defineProperty(t.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(e){this.tileTransform.scale.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(e){this.tileTransform.position.copyFrom(e)},enumerable:!1,configurable:!0}),t.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},t.prototype._render=function(e){var r=this._texture;!r||!r.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))},t.prototype._calculateBounds=function(){var e=this._width*-this._anchor._x,r=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),s=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,r,n,s)},t.prototype.getLocalBounds=function(e){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),e||(this._localBoundsRect||(this._localBoundsRect=new ge),e=this._localBoundsRect),this._bounds.getRectangle(e)):i.prototype.getLocalBounds.call(this,e)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,Wi);var r=this._width,n=this._height,s=-r*this.anchor._x;if(Wi.x>=s&&Wi.x<s+r){var o=-n*this.anchor._y;if(Wi.y>=o&&Wi.y<o+n)return!0}return!1},t.prototype.destroy=function(e){i.prototype.destroy.call(this,e),this.tileTransform=null,this.uvMatrix=null},t.from=function(e,r){return typeof r=="number"&&(W("5.3.0","TilingSprite.from use options instead of width and height args"),r={width:r,height:arguments[2]}),new t(le.from(e,r),r.width,r.height)},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e},enumerable:!1,configurable:!0}),t})($r),lf=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,Hb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture2D(uSampler, coord);
    gl_FragColor = texSample * uColor;
}
`,Gb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,Kn=new Le,jy=(function(i){qy(t,i);function t(e){var r=i.call(this,e)||this,n={globals:r.renderer.globalUniforms};return r.shader=Wt.from(lf,Hb,n),r.simpleShader=Wt.from(lf,Gb,n),r.quad=new Mu,r.state=mr.for2d(),r}return t.prototype.render=function(e){var r=this.renderer,n=this.quad,s=n.vertices;s[0]=s[6]=e._width*-e.anchor.x,s[1]=s[3]=e._height*-e.anchor.y,s[2]=s[4]=e._width*(1-e.anchor.x),s[5]=s[7]=e._height*(1-e.anchor.y),e.uvRespectAnchor&&(s=n.uvs,s[0]=s[6]=-e.anchor.x,s[1]=s[3]=-e.anchor.y,s[2]=s[4]=1-e.anchor.x,s[5]=s[7]=1-e.anchor.y),n.invalidate();var o=e._texture,a=o.baseTexture,l=e.tileTransform.localTransform,u=e.uvMatrix,c=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;c&&(a._glTextures[r.CONTEXT_UID]?c=a.wrapMode!==Rt.CLAMP:a.wrapMode===Rt.CLAMP&&(a.wrapMode=Rt.REPEAT));var h=c?this.simpleShader:this.shader,f=o.width,d=o.height,p=e._width,v=e._height;Kn.set(l.a*f/p,l.b*f/v,l.c*d/p,l.d*d/v,l.tx/p,l.ty/v),Kn.invert(),c?Kn.prepend(u.mapCoord):(h.uniforms.uMapCoord=u.mapCoord.toArray(!0),h.uniforms.uClampFrame=u.uClampFrame,h.uniforms.uClampOffset=u.uClampOffset),h.uniforms.uTransform=Kn.toArray(!0),h.uniforms.uColor=wu(e.tint,e.worldAlpha,h.uniforms.uColor,a.alphaMode),h.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),h.uniforms.uSampler=o,r.shader.bind(h),r.geometry.bind(n),this.state.blendMode=xu(e.blendMode,a.alphaMode),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},t})(Ni);/*!
 * @pixi/mesh - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mesh is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Cl=function(i,t){return Cl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Cl(i,t)};function ku(i,t){Cl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Wy=(function(){function i(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return i.prototype.update=function(t){if(!(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var e=this.uvBuffer.data;(!this.data||this.data.length!==e.length)&&(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}},i})(),La=new ze,uf=new mi,Ai=(function(i){ku(t,i);function t(e,r,n,s){s===void 0&&(s=ft.TRIANGLES);var o=i.call(this)||this;return o.geometry=e,e.refCount++,o.shader=r,o.state=n||mr.for2d(),o.drawMode=s,o.start=0,o.size=0,o.uvs=null,o.indices=null,o.vertexData=new Float32Array(1),o.vertexDirty=0,o._transformID=-1,o._roundPixels=ne.ROUND_PIXELS,o.batchUvs=null,o}return Object.defineProperty(t.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"material",{get:function(){return this.shader},set:function(e){this.shader=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(e){this.state.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this.shader.tint},set:function(e){this.shader.tint=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"texture",{get:function(){return this.shader.texture},set:function(e){this.shader.texture=e},enumerable:!1,configurable:!0}),t.prototype._render=function(e){var r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ft.TRIANGLES&&r.length<t.BATCHABLE_SIZE*2?this._renderToBatch(e):this._renderDefault(e)},t.prototype._renderDefault=function(e){var r=this.shader;r.alpha=this.worldAlpha,r.update&&r.update(),e.batch.flush(),r.program.uniformData.translationMatrix&&(r.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),e.shader.bind(r),e.state.set(this.state),e.geometry.bind(this.geometry,r),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},t.prototype._renderToBatch=function(e){var r=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=r.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var n=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[n]),e.plugins[n].render(this)},t.prototype.calculateVertices=function(){var e=this.geometry,r=e.buffers[0].data;if(!(e.vertexDirtyId===this.vertexDirty&&this._transformID===this.transform._worldID)){this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));for(var n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,l=n.d,u=n.tx,c=n.ty,h=this.vertexData,f=0;f<h.length/2;f++){var d=r[f*2],p=r[f*2+1];h[f*2]=s*d+a*p+u,h[f*2+1]=o*d+l*p+c}if(this._roundPixels)for(var v=ne.RESOLUTION,f=0;f<h.length;++f)h[f]=Math.round((h[f]*v|0)/v);this.vertexDirty=e.vertexDirtyId}},t.prototype.calculateUvs=function(){var e=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new Wy(e,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},t.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},t.prototype.containsPoint=function(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,La);for(var r=this.geometry.getBuffer("aVertexPosition").data,n=uf.points,s=this.geometry.getIndex().data,o=s.length,a=this.drawMode===4?3:1,l=0;l+2<o;l+=a){var u=s[l]*2,c=s[l+1]*2,h=s[l+2]*2;if(n[0]=r[u],n[1]=r[u+1],n[2]=r[c],n[3]=r[c+1],n[4]=r[h],n[5]=r[h+1],uf.contains(La.x,La.y))return!0}return!1},t.prototype.destroy=function(e){i.prototype.destroy.call(this,e),this.geometry.refCount--,this.geometry.refCount===0&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},t.BATCHABLE_SIZE=100,t})(st),Yb=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,zb=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`,En=(function(i){ku(t,i);function t(e,r){var n=this,s={uSampler:e,alpha:1,uTextureMatrix:Le.IDENTITY,uColor:new Float32Array([1,1,1,1])};return r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(s,r.uniforms),n=i.call(this,r.program||Bi.from(zb,Yb),s)||this,n._colorDirty=!1,n.uvMatrix=new Vs(e),n.batchable=r.program===void 0,n.pluginName=r.pluginName,n.tint=r.tint,n.alpha=r.alpha,n}return Object.defineProperty(t.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(e){this.uniforms.uSampler!==e&&(this.uniforms.uSampler=e,this.uvMatrix.texture=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this._alpha},set:function(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(e){e!==this._tint&&(this._tint=e,this._tintRGB=(e>>16)+(e&65280)+((e&255)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),t.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var e=this.texture.baseTexture;wu(this._tint,this._alpha,this.uniforms.uColor,e.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},t})(Wt),Sn=(function(i){ku(t,i);function t(e,r,n){var s=i.call(this)||this,o=new Be(e),a=new Be(r,!0),l=new Be(n,!0,!0);return s.addAttribute("aVertexPosition",o,2,!1,De.FLOAT).addAttribute("aTextureCoord",a,2,!1,De.FLOAT).addIndex(l),s._updateId=-1,s}return Object.defineProperty(t.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),t})(zr);/*!
 * @pixi/text-bitmap - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/text-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Al=function(i,t){return Al=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Al(i,t)};function $b(i,t){Al(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var yn=(function(){function i(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]}return i})(),Vb=(function(){function i(){}return i.test=function(t){return typeof t=="string"&&t.indexOf("info face=")===0},i.parse=function(t){var e=t.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var n in e){var s=e[n].match(/^[a-z]+/gm)[0],o=e[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),a={};for(var l in o){var u=o[l].split("="),c=u[0],h=u[1].replace(/"/gm,""),f=parseFloat(h),d=isNaN(f)?h:f;a[c]=d}r[s].push(a)}var p=new yn;return r.info.forEach(function(v){return p.info.push({face:v.face,size:parseInt(v.size,10)})}),r.common.forEach(function(v){return p.common.push({lineHeight:parseInt(v.lineHeight,10)})}),r.page.forEach(function(v){return p.page.push({id:parseInt(v.id,10),file:v.file})}),r.char.forEach(function(v){return p.char.push({id:parseInt(v.id,10),page:parseInt(v.page,10),x:parseInt(v.x,10),y:parseInt(v.y,10),width:parseInt(v.width,10),height:parseInt(v.height,10),xoffset:parseInt(v.xoffset,10),yoffset:parseInt(v.yoffset,10),xadvance:parseInt(v.xadvance,10)})}),r.kerning.forEach(function(v){return p.kerning.push({first:parseInt(v.first,10),second:parseInt(v.second,10),amount:parseInt(v.amount,10)})}),p},i})(),Pl=(function(){function i(){}return i.test=function(t){return t instanceof XMLDocument&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},i.parse=function(t){for(var e=new yn,r=t.getElementsByTagName("info"),n=t.getElementsByTagName("common"),s=t.getElementsByTagName("page"),o=t.getElementsByTagName("char"),a=t.getElementsByTagName("kerning"),l=0;l<r.length;l++)e.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(var l=0;l<n.length;l++)e.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(var l=0;l<s.length;l++)e.page.push({id:parseInt(s[l].getAttribute("id"),10)||0,file:s[l].getAttribute("file")});for(var l=0;l<o.length;l++){var u=o[l];e.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(var l=0;l<a.length;l++)e.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});return e},i})(),qb=(function(){function i(){}return i.test=function(t){if(typeof t=="string"&&t.indexOf("<font>")>-1){var e=new self.DOMParser().parseFromString(t,"text/xml");return Pl.test(e)}return!1},i.parse=function(t){var e=new window.DOMParser().parseFromString(t,"text/xml");return Pl.parse(e)},i})(),Na=[Vb,Pl,qb];function Ky(i){for(var t=0;t<Na.length;t++)if(Na[t].test(i))return Na[t];return null}function jb(i,t,e,r,n,s){var o=e.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;var a,l=e.dropShadow?e.dropShadowDistance:0,u=e.padding||0,c=Math.ceil(i.width/r)-l-u*2,h=Math.ceil(i.height/r)-l-u*2,f=o.slice(),d=e.fillGradientStops.slice();if(!d.length)for(var p=f.length+1,v=1;v<p;++v)d.push(v/p);if(f.unshift(o[0]),d.unshift(0),f.push(o[o.length-1]),d.push(1),e.fillGradientType===Ci.LINEAR_VERTICAL){a=t.createLinearGradient(c/2,u,c/2,h+u);for(var y=0,g=s.fontProperties.fontSize+e.strokeThickness,E=g/h,v=0;v<n.length;v++)for(var T=s.lineHeight*v,R=0;R<f.length;R++){var _=0;typeof d[R]=="number"?_=d[R]:_=R/f.length;var F=T/h+_*E,P=Math.max(y,F);P=Math.min(P,1),a.addColorStop(P,f[R]),y=P}}else{a=t.createLinearGradient(u,h/2,c+u,h/2);for(var H=f.length+1,M=1,v=0;v<f.length;v++){var N=void 0;typeof d[v]=="number"?N=d[v]:N=M/H,a.addColorStop(N,f[v]),M++}}return a}function Wb(i,t,e,r,n,s,o){var a=e.text,l=e.fontProperties;t.translate(r,n),t.scale(s,s);var u=o.strokeThickness/2,c=-(o.strokeThickness/2);if(t.font=o.toFontString(),t.lineWidth=o.strokeThickness,t.textBaseline=o.textBaseline,t.lineJoin=o.lineJoin,t.miterLimit=o.miterLimit,t.fillStyle=jb(i,t,o,s,[a],e),t.strokeStyle=o.stroke,o.dropShadow){var h=o.dropShadowColor,f=Dr(typeof h=="number"?h:bu(h)),d=o.dropShadowBlur*s,p=o.dropShadowDistance*s;t.shadowColor="rgba("+f[0]*255+","+f[1]*255+","+f[2]*255+","+o.dropShadowAlpha+")",t.shadowBlur=d,t.shadowOffsetX=Math.cos(o.dropShadowAngle)*p,t.shadowOffsetY=Math.sin(o.dropShadowAngle)*p}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0;o.stroke&&o.strokeThickness&&t.strokeText(a,u,c+e.lineHeight-l.descent),o.fill&&t.fillText(a,u,c+e.lineHeight-l.descent),t.setTransform(1,0,0,1,0,0),t.fillStyle="rgba(0, 0, 0, 0)"}function Kb(i){typeof i=="string"&&(i=[i]);for(var t=[],e=0,r=i.length;e<r;e++){var n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(var a=s,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push.apply(t,n.split(""))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}var sr=(function(){function i(t,e,r){var n=t.info[0],s=t.common[0],o=t.page[0],a=dn(o.file),l={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=l;for(var u=0;u<t.page.length;u++){var c=t.page[u],h=c.id,f=c.file;l[h]=e instanceof Array?e[u]:e[f]}for(var u=0;u<t.char.length;u++){var d=t.char[u],h=d.id,p=d.page,v=t.char[u],y=v.x,g=v.y,E=v.width,T=v.height,R=v.xoffset,_=v.yoffset,F=v.xadvance;y/=a,g/=a,E/=a,T/=a,R/=a,_/=a,F/=a;var P=new ge(y+l[p].frame.x/a,g+l[p].frame.y/a,E,T);this.chars[h]={xOffset:R,yOffset:_,xAdvance:F,kerning:{},texture:new le(l[p].baseTexture,P),page:p}}for(var u=0;u<t.kerning.length;u++){var H=t.kerning[u],M=H.first,N=H.second,Y=H.amount;M/=a,N/=a,Y/=a,this.chars[N]&&(this.chars[N].kerning[M]=Y)}}return i.prototype.destroy=function(){for(var t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(var t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null},i.install=function(t,e,r){var n;if(t instanceof yn)n=t;else{var s=Ky(t);if(!s)throw new Error("Unrecognized data format for font.");n=s.parse(t)}e instanceof le&&(e=[e]);var o=new i(n,e,r);return i.available[o.font]=o,o},i.uninstall=function(t){var e=i.available[t];if(!e)throw new Error("No font found named '"+t+"'");e.destroy(),delete i.available[t]},i.from=function(t,e,r){if(!t)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},i.defaultOptions,r),s=n.chars,o=n.padding,a=n.resolution,l=n.textureWidth,u=n.textureHeight,c=Kb(s),h=e instanceof Hr?e:new Hr(e),f=l,d=new yn;d.info[0]={face:h.fontFamily,size:h.fontSize},d.common[0]={lineHeight:h.fontSize};for(var p=0,v=0,y,g,E,T=0,R=[],_=0;_<c.length;_++){y||(y=document.createElement("canvas"),y.width=l,y.height=u,g=y.getContext("2d"),E=new Ee(y,{resolution:a}),R.push(new le(E)),d.page.push({id:R.length-1,file:""}));var F=wt.measureText(c[_],h,!1,y),P=F.width,H=Math.ceil(F.height),M=Math.ceil((h.fontStyle==="italic"?2:1)*P);if(v>=u-H*a){if(v===0)throw new Error("[BitmapFont] textureHeight "+u+"px is "+("too small for "+h.fontSize+"px fonts"));--_,y=null,g=null,E=null,v=0,p=0,T=0;continue}if(T=Math.max(H+F.fontProperties.descent,T),M*a+p>=f){--_,v+=T*a,v=Math.ceil(v),p=0,T=0;continue}Wb(y,g,F,p,v,a,h);var N=F.text.charCodeAt(0);d.char.push({id:N,page:R.length-1,x:p/a,y:v/a,width:M,height:H,xoffset:0,yoffset:0,xadvance:Math.ceil(P-(h.dropShadow?h.dropShadowDistance:0)-(h.stroke?h.strokeThickness:0))}),p+=(M+2*o)*a,p=Math.ceil(p)}var Y=new i(d,R,!0);return i.available[t]!==void 0&&i.uninstall(t),i.available[t]=Y,Y},i.ALPHA=[["a","z"],["A","Z"]," "],i.NUMERIC=[["0","9"]],i.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],i.ASCII=[[" ","~"]],i.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:i.ALPHANUMERIC},i.available={},i})(),cf=[],hf=[],Zb=(function(i){$b(t,i);function t(e,r){r===void 0&&(r={});var n=i.call(this)||this;n._tint=16777215,r.font&&(W("5.3.0","PIXI.BitmapText constructor style.font property is deprecated."),n._upgradeStyle(r));var s=Object.assign({},t.styleDefaults,r),o=s.align,a=s.tint,l=s.maxWidth,u=s.letterSpacing,c=s.fontName,h=s.fontSize;if(!sr.available[c])throw new Error('Missing BitmapFont "'+c+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=o,n._tint=a,n._fontName=c,n._fontSize=h||sr.available[c].size,n._text=e,n._maxWidth=l,n._maxLineHeight=0,n._letterSpacing=u,n._anchor=new Lr(function(){n.dirty=!0},n,0,0),n._roundPixels=ne.ROUND_PIXELS,n.dirty=!0,n._textureCache={},n}return t.prototype.updateText=function(){for(var e,r=sr.available[this._fontName],n=this._fontSize/r.size,s=new ze,o=[],a=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=l.length,c=this._maxWidth*r.size/this._fontSize,h=null,f=0,d=0,p=0,v=-1,y=0,g=0,E=0,T=0;T<u;T++){var R=l.charCodeAt(T),_=l.charAt(T);if(/(?:\s)/.test(_)&&(v=T,y=f),_==="\r"||_===`
`){a.push(f),d=Math.max(d,f),++p,++g,s.x=0,s.y+=r.lineHeight,h=null;continue}var F=r.chars[R];if(F){h&&F.kerning[h]&&(s.x+=F.kerning[h]);var P=hf.pop()||{texture:le.EMPTY,line:0,charCode:0,position:new ze};P.texture=F.texture,P.line=p,P.charCode=R,P.position.x=s.x+F.xOffset+this._letterSpacing/2,P.position.y=s.y+F.yOffset,o.push(P),s.x+=F.xAdvance+this._letterSpacing,f=s.x,E=Math.max(E,F.yOffset+F.texture.height),h=R,v!==-1&&c>0&&s.x>c&&(++g,Nr(o,1+v-g,1+T-v),T=v,v=-1,a.push(y),d=Math.max(d,y),p++,s.x=0,s.y+=r.lineHeight,h=null)}}var H=l.charAt(l.length-1);H!=="\r"&&H!==`
`&&(/(?:\s)/.test(H)&&(f=y),a.push(f),d=Math.max(d,f));for(var M=[],T=0;T<=p;T++){var N=0;this._align==="right"?N=d-a[T]:this._align==="center"&&(N=(d-a[T])/2),M.push(N)}for(var Y=o.length,D={},Z=[],Q=this._activePagesMeshData,T=0;T<Q.length;T++)cf.push(Q[T]);for(var T=0;T<Y;T++){var $=o[T].texture,C=$.baseTexture.uid;if(!D[C]){var O=cf.pop();if(!O){var m=new Sn,x=new En(le.EMPTY),w=new Ai(m,x);O={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:w,vertices:null,uvs:null,indices:null}}O.index=0,O.indexCount=0,O.vertexCount=0,O.uvsCount=0,O.total=0;var I=this._textureCache;I[C]=I[C]||new le($.baseTexture),O.mesh.texture=I[C],O.mesh.tint=this._tint,Z.push(O),D[C]=O}D[C].total++}for(var T=0;T<Q.length;T++)Z.indexOf(Q[T])===-1&&this.removeChild(Q[T].mesh);for(var T=0;T<Z.length;T++)Z[T].mesh.parent!==this&&this.addChild(Z[T].mesh);this._activePagesMeshData=Z;for(var T in D){var O=D[T],S=O.total;if(!(((e=O.indices)===null||e===void 0?void 0:e.length)>6*S)||O.vertices.length<Ai.BATCHABLE_SIZE*2)O.vertices=new Float32Array(8*S),O.uvs=new Float32Array(8*S),O.indices=new Uint16Array(6*S);else for(var A=O.total,L=O.vertices,B=A*4*2;B<L.length;B++)L[B]=0;O.mesh.size=6*S}for(var T=0;T<Y;T++){var _=o[T],k=_.position.x+M[_.line];this._roundPixels&&(k=Math.round(k));var U=k*n,V=_.position.y*n,$=_.texture,j=D[$.baseTexture.uid],z=$.frame,K=$._uvs,q=j.index++;j.indices[q*6+0]=0+q*4,j.indices[q*6+1]=1+q*4,j.indices[q*6+2]=2+q*4,j.indices[q*6+3]=0+q*4,j.indices[q*6+4]=2+q*4,j.indices[q*6+5]=3+q*4,j.vertices[q*8+0]=U,j.vertices[q*8+1]=V,j.vertices[q*8+2]=U+z.width*n,j.vertices[q*8+3]=V,j.vertices[q*8+4]=U+z.width*n,j.vertices[q*8+5]=V+z.height*n,j.vertices[q*8+6]=U,j.vertices[q*8+7]=V+z.height*n,j.uvs[q*8+0]=K.x0,j.uvs[q*8+1]=K.y0,j.uvs[q*8+2]=K.x1,j.uvs[q*8+3]=K.y1,j.uvs[q*8+4]=K.x2,j.uvs[q*8+5]=K.y2,j.uvs[q*8+6]=K.x3,j.uvs[q*8+7]=K.y3}this._textWidth=d*n,this._textHeight=(s.y+r.lineHeight)*n;for(var T in D){var O=D[T];if(this.anchor.x!==0||this.anchor.y!==0)for(var ie=0,ae=this._textWidth*this.anchor.x,te=this._textHeight*this.anchor.y,re=0;re<O.total;re++)O.vertices[ie++]-=ae,O.vertices[ie++]-=te,O.vertices[ie++]-=ae,O.vertices[ie++]-=te,O.vertices[ie++]-=ae,O.vertices[ie++]-=te,O.vertices[ie++]-=ae,O.vertices[ie++]-=te;this._maxLineHeight=E*n;var we=O.mesh.geometry.getBuffer("aVertexPosition"),xe=O.mesh.geometry.getBuffer("aTextureCoord"),Pe=O.mesh.geometry.getIndex();we.data=O.vertices,xe.data=O.uvs,Pe.data=O.indices,we.update(),xe.update(),Pe.update()}for(var T=0;T<o.length;T++)hf.push(o[T])},t.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},t.prototype.getLocalBounds=function(){return this.validate(),i.prototype.getLocalBounds.call(this)},t.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(t.prototype,"tint",{get:function(){return this._tint},set:function(e){if(this._tint!==e){this._tint=e;for(var r=0;r<this._activePagesMeshData.length;r++)this._activePagesMeshData[r].mesh.tint=e}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontName",{get:function(){return this._fontName},set:function(e){if(!sr.available[e])throw new Error('Missing BitmapFont "'+e+'"');this._fontName!==e&&(this._fontName=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"anchor",{get:function(){return this._anchor},set:function(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this._text},set:function(e){e=String(e??""),this._text!==e&&(this._text=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(e){e!==this._roundPixels&&(this._roundPixels=e,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),t.prototype._upgradeStyle=function(e){if(typeof e.font=="string"){var r=e.font.split(" ");e.fontName=r.length===1?r[0]:r.slice(1).join(" "),r.length>=2&&(e.fontSize=parseInt(r[0],10))}else e.fontName=e.font.name,e.fontSize=typeof e.font.size=="number"?e.font.size:parseInt(e.font.size,10)},t.prototype.destroy=function(e){var r=this._textureCache;for(var n in r){var s=r[n];s.destroy(),delete r[n]}this._textureCache=null,i.prototype.destroy.call(this,e)},t.registerFont=function(e,r){return W("5.3.0","PIXI.BitmapText.registerFont is deprecated, use PIXI.BitmapFont.install"),sr.install(e,r)},Object.defineProperty(t,"fonts",{get:function(){return W("5.3.0","PIXI.BitmapText.fonts is deprecated, use PIXI.BitmapFont.available"),sr.available},enumerable:!1,configurable:!0}),t.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},t})(st),Zy=(function(){function i(){}return i.add=function(){an.setExtensionXhrType("fnt",an.XHR_RESPONSE_TYPE.TEXT)},i.use=function(t,e){var r=Ky(t.data);if(!r){e();return}for(var n=i.getBaseUrl(this,t),s=r.parse(t.data),o={},a=function(v){o[v.metadata.pageFile]=v.texture,Object.keys(o).length===s.page.length&&(t.bitmapFont=sr.install(s,o,!0),e())},l=0;l<s.page.length;++l){var u=s.page[l].file,c=n+u,h=!1;for(var f in this.resources){var d=this.resources[f];if(d.url===c){d.metadata.pageFile=u,d.texture?a(d):d.onAfterMiddleware.add(a),h=!0;break}}if(!h){var p={crossOrigin:t.crossOrigin,loadType:an.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:u},t.metadata.imageMetadata),parentResource:t};this.add(c,p,a)}}},i.getBaseUrl=function(t,e){var r=e.isDataUrl?"":i.dirname(e.url);return e.isDataUrl&&(r==="."&&(r=""),t.baseUrl&&r&&t.baseUrl.charAt(t.baseUrl.length-1)==="/"&&(r+="/")),r=r.replace(t.baseUrl,""),r&&r.charAt(r.length-1)!=="/"&&(r+="/"),r},i.dirname=function(t){var e=t.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return e===t?".":e===""?"/":e},i})();/*!
 * @pixi/filter-alpha - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-alpha is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Ol=function(i,t){return Ol=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Ol(i,t)};function Jb(i,t){Ol(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var Qb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`,e_=(function(i){Jb(t,i);function t(e){e===void 0&&(e=1);var r=i.call(this,_y,Qb,{uAlpha:1})||this;return r.alpha=e,r}return Object.defineProperty(t.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e},enumerable:!1,configurable:!0}),t})(Jt);/*!
 * @pixi/filter-blur - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-blur is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Fl=function(i,t){return Fl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Fl(i,t)};function Jy(i,t){Fl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var t_=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function r_(i,t){var e=Math.ceil(i/2),r=t_,n="",s;t?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var o=0;o<i;o++){var a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",o-(e-1)+".0"),n+=a,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}var i_={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},n_=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function s_(i){for(var t=i_[i],e=t.length,r=n_,n="",s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",o,a=0;a<i;a++){var l=s.replace("%index%",a.toString());o=a,a>=e&&(o=i-a-1),l=l.replace("%value%",t[o].toString()),n+=l,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}var ff;(function(i){i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2"})(ff||(ff={}));var df;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS"})(df||(df={}));var pf;(function(i){i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL"})(pf||(pf={}));var yf;(function(i){i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR"})(yf||(yf={}));var mf;(function(i){i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(mf||(mf={}));var vf;(function(i){i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(vf||(vf={}));var gf;(function(i){i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(gf||(gf={}));var bf;(function(i){i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.FLOAT=5126]="FLOAT",i[i.HALF_FLOAT=36193]="HALF_FLOAT"})(bf||(bf={}));var _f;(function(i){i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR"})(_f||(_f={}));var xf;(function(i){i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(xf||(xf={}));var wf;(function(i){i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON"})(wf||(wf={}));var Tf;(function(i){i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"})(Tf||(Tf={}));var mn;(function(i){i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT"})(mn||(mn={}));var If;(function(i){i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL"})(If||(If={}));var Ef;(function(i){i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp"})(Ef||(Ef={}));var Sf;(function(i){i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE"})(Sf||(Sf={}));var Cf;(function(i){i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH"})(Cf||(Cf={}));var Ml=(function(i){Jy(t,i);function t(e,r,n,s,o){r===void 0&&(r=8),n===void 0&&(n=4),s===void 0&&(s=ne.FILTER_RESOLUTION),o===void 0&&(o=5);var a=this,l=r_(o,e),u=s_(o);return a=i.call(this,l,u)||this,a.horizontal=e,a.resolution=s,a._quality=0,a.quality=n,a.blur=r,a}return t.prototype.apply=function(e,r,n,s){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/r.width):this.uniforms.strength=1/n.height*(n.height/r.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/r.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)e.applyFilter(this,r,n,s);else{var o=e.getFilterTexture(),a=e.renderer,l=r,u=o;this.state.blend=!1,e.applyFilter(this,l,u,mn.CLEAR);for(var c=1;c<this.passes-1;c++){e.bindAndClear(l,mn.BLIT),this.uniforms.uSampler=u;var h=u;u=l,l=h,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,u,n,s),e.returnFilterTexture(o)}},Object.defineProperty(t.prototype,"blur",{get:function(){return this.strength},set:function(e){this.padding=1+Math.abs(e)*2,this.strength=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"quality",{get:function(){return this._quality},set:function(e){this._quality=e,this.passes=e},enumerable:!1,configurable:!0}),t})(Jt),o_=(function(i){Jy(t,i);function t(e,r,n,s){e===void 0&&(e=8),r===void 0&&(r=4),n===void 0&&(n=ne.FILTER_RESOLUTION),s===void 0&&(s=5);var o=i.call(this)||this;return o.blurXFilter=new Ml(!0,e,r,n,s),o.blurYFilter=new Ml(!1,e,r,n,s),o.resolution=n,o.quality=r,o.blur=e,o.repeatEdgePixels=!1,o}return t.prototype.apply=function(e,r,n,s){var o=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(o&&a){var l=e.getFilterTexture();this.blurXFilter.apply(e,r,l,mn.CLEAR),this.blurYFilter.apply(e,l,n,s),e.returnFilterTexture(l)}else a?this.blurYFilter.apply(e,r,n,s):this.blurXFilter.apply(e,r,n,s)},t.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2},Object.defineProperty(t.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(e){this.blurXFilter.quality=this.blurYFilter.quality=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(e){this.blurXFilter.blur=e,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(e){this.blurYFilter.blur=e,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(e){this.blurYFilter.blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(e){this._repeatEdgePixels=e,this.updatePadding()},enumerable:!1,configurable:!0}),t})(Jt);/*!
 * @pixi/filter-color-matrix - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-color-matrix is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Rl=function(i,t){return Rl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Rl(i,t)};function a_(i,t){Rl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var l_=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,Ll=(function(i){a_(t,i);function t(){var e=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return e=i.call(this,Ru,l_,r)||this,e.alpha=1,e}return t.prototype._loadMatrix=function(e,r){r===void 0&&(r=!1);var n=e;r&&(this._multiply(n,this.uniforms.m,e),n=this._colorMatrix(n)),this.uniforms.m=n},t.prototype._multiply=function(e,r,n){return e[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],e[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],e[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],e[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],e[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],e[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],e[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],e[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],e[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],e[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],e[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],e[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],e[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],e[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],e[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],e[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],e[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],e[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],e[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],e[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],e},t.prototype._colorMatrix=function(e){var r=new Float32Array(e);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},t.prototype.brightness=function(e,r){var n=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(n,r)},t.prototype.greyscale=function(e,r){var n=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(n,r)},t.prototype.blackAndWhite=function(e){var r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.hue=function(e,r){e=(e||0)/180*Math.PI;var n=Math.cos(e),s=Math.sin(e),o=Math.sqrt,a=1/3,l=o(a),u=n+(1-n)*a,c=a*(1-n)-l*s,h=a*(1-n)+l*s,f=a*(1-n)+l*s,d=n+a*(1-n),p=a*(1-n)-l*s,v=a*(1-n)-l*s,y=a*(1-n)+l*s,g=n+a*(1-n),E=[u,c,h,0,0,f,d,p,0,0,v,y,g,0,0,0,0,0,1,0];this._loadMatrix(E,r)},t.prototype.contrast=function(e,r){var n=(e||0)+1,s=-.5*(n-1),o=[n,0,0,0,s,0,n,0,0,s,0,0,n,0,s,0,0,0,1,0];this._loadMatrix(o,r)},t.prototype.saturate=function(e,r){e===void 0&&(e=0);var n=e*2/3+1,s=(n-1)*-.5,o=[n,s,s,0,0,s,n,s,0,0,s,s,n,0,0,0,0,0,1,0];this._loadMatrix(o,r)},t.prototype.desaturate=function(){this.saturate(-1)},t.prototype.negative=function(e){var r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.sepia=function(e){var r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.technicolor=function(e){var r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.polaroid=function(e){var r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.toBGR=function(e){var r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.kodachrome=function(e){var r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.browni=function(e){var r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.vintage=function(e){var r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.colorTone=function(e,r,n,s,o){e=e||.2,r=r||.15,n=n||16770432,s=s||3375104;var a=(n>>16&255)/255,l=(n>>8&255)/255,u=(n&255)/255,c=(s>>16&255)/255,h=(s>>8&255)/255,f=(s&255)/255,d=[.3,.59,.11,0,0,a,l,u,e,0,c,h,f,r,0,a-c,l-h,u-f,0,0];this._loadMatrix(d,o)},t.prototype.night=function(e,r){e=e||.1;var n=[e*-2,-e,0,0,0,-e,0,e,0,0,0,e,e*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)},t.prototype.predator=function(e,r){var n=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(n,r)},t.prototype.lsd=function(e){var r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,e)},t.prototype.reset=function(){var e=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(e,!1)},Object.defineProperty(t.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(e){this.uniforms.m=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(e){this.uniforms.uAlpha=e},enumerable:!1,configurable:!0}),t})(Jt);Ll.prototype.grayscale=Ll.prototype.greyscale;/*!
 * @pixi/filter-displacement - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-displacement is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Nl=function(i,t){return Nl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Nl(i,t)};function u_(i,t){Nl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var c_=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,h_=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`,f_=(function(i){u_(t,i);function t(e,r){var n=this,s=new Le;return e.renderable=!1,n=i.call(this,h_,c_,{mapSampler:e._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this,n.maskSprite=e,n.maskMatrix=s,r==null&&(r=20),n.scale=new ze(r,r),n}return t.prototype.apply=function(e,r,n,s){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var o=this.maskSprite.worldTransform,a=Math.sqrt(o.a*o.a+o.b*o.b),l=Math.sqrt(o.c*o.c+o.d*o.d);a!==0&&l!==0&&(this.uniforms.rotation[0]=o.a/a,this.uniforms.rotation[1]=o.b/a,this.uniforms.rotation[2]=o.c/l,this.uniforms.rotation[3]=o.d/l),e.applyFilter(this,r,n,s)},Object.defineProperty(t.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(e){this.uniforms.mapSampler=e},enumerable:!1,configurable:!0}),t})(Jt);/*!
 * @pixi/filter-fxaa - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-fxaa is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Bl=function(i,t){return Bl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Bl(i,t)};function d_(i,t){Bl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var p_=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputPixel;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,y_=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputPixel;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,m_=(function(i){d_(t,i);function t(){return i.call(this,p_,y_)||this}return t})(Jt);/*!
 * @pixi/filter-noise - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-noise is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Dl=function(i,t){return Dl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Dl(i,t)};function v_(i,t){Dl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var g_=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`,b_=(function(i){v_(t,i);function t(e,r){e===void 0&&(e=.5),r===void 0&&(r=Math.random());var n=i.call(this,Ru,g_,{uNoise:0,uSeed:0})||this;return n.noise=e,n.seed=r,n}return Object.defineProperty(t.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(e){this.uniforms.uNoise=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(e){this.uniforms.uSeed=e},enumerable:!1,configurable:!0}),t})(Jt);/*!
 * @pixi/mixin-cache-as-bitmap - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mixin-cache-as-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Qy=new Le;Ue.prototype._cacheAsBitmap=!1;Ue.prototype._cacheData=null;var __=(function(){function i(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}return i})();Object.defineProperties(Ue.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(i){if(this._cacheAsBitmap!==i){this._cacheAsBitmap=i;var t;i?(this._cacheData||(this._cacheData=new __),t=this._cacheData,t.originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(t=this._cacheData,t.sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea)}}}});Ue.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))};Ue.prototype._initCachedDisplayObject=function(t){if(!(this._cacheData&&this._cacheData.sprite)){var e=this.alpha;this.alpha=1,t.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters){var n=this.filters[0].padding;r.pad(n)}r.ceil(ne.RESOLUTION);var s=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,u=Ur.create({width:r.width,height:r.height}),c="cacheAsBitmap_"+kr();this._cacheData.textureCacheId=c,Ee.addToCache(u.baseTexture,c),le.addToCache(u,c);var h=this.transform.localTransform.copyTo(Qy).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,t.render(this,u,!0,h,!1),t.projection.transform=l,t.renderTexture.bind(s,o,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var f=new $r(u);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(r.x/r.width),f.anchor.y=-(r.y/r.height),f.alpha=e,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)}};Ue.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))};Ue.prototype._initCachedDisplayObjectCanvas=function(t){if(!(this._cacheData&&this._cacheData.sprite)){var e=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;var n=t.context,s=t._projTransform;e.ceil(ne.RESOLUTION);var o=Ur.create({width:e.width,height:e.height}),a="cacheAsBitmap_"+kr();this._cacheData.textureCacheId=a,Ee.addToCache(o.baseTexture,a),le.addToCache(o,a);var l=Qy;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=e.x,l.ty-=e.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,o,!0,l,!1),t.context=n,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var u=new $r(o);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(e.x/e.width),u.anchor.y=-(e.y/e.height),u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)}};Ue.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Ue.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Ue.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Ee.removeFromCache(this._cacheData.textureCacheId),le.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Ue.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)};/*!
 * @pixi/mixin-get-child-by-name - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mixin-get-child-by-name is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Ue.prototype.name=null;st.prototype.getChildByName=function(t,e){for(var r=0,n=this.children.length;r<n;r++)if(this.children[r].name===t)return this.children[r];if(e)for(var r=0,n=this.children.length;r<n;r++){var s=this.children[r];if(s.getChildByName){var o=this.children[r].getChildByName(t,!0);if(o)return o}}return null};/*!
 * @pixi/mixin-get-global-position - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mixin-get-global-position is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Ue.prototype.getGlobalPosition=function(t,e){return t===void 0&&(t=new ze),e===void 0&&(e=!1),this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};/*!
 * @pixi/mesh-extras - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mesh-extras is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var kl=function(i,t){return kl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},kl(i,t)};function Di(i,t){kl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var em=(function(i){Di(t,i);function t(e,r,n,s){e===void 0&&(e=100),r===void 0&&(r=100),n===void 0&&(n=10),s===void 0&&(s=10);var o=i.call(this)||this;return o.segWidth=n,o.segHeight=s,o.width=e,o.height=r,o.build(),o}return t.prototype.build=function(){for(var e=this.segWidth*this.segHeight,r=[],n=[],s=[],o=this.segWidth-1,a=this.segHeight-1,l=this.width/o,u=this.height/a,c=0;c<e;c++){var h=c%this.segWidth,f=c/this.segWidth|0;r.push(h*l,f*u),n.push(h/o,f/a)}for(var d=o*a,c=0;c<d;c++){var p=c%o,v=c/o|0,y=v*this.segWidth+p,g=v*this.segWidth+p+1,E=(v+1)*this.segWidth+p,T=(v+1)*this.segWidth+p+1;s.push(y,g,E,g,T,E)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},t})(Sn),tm=(function(i){Di(t,i);function t(e,r,n){e===void 0&&(e=200),n===void 0&&(n=0);var s=i.call(this,new Float32Array(r.length*4),new Float32Array(r.length*4),new Uint16Array((r.length-1)*6))||this;return s.points=r,s._width=e,s.textureScale=n,s.build(),s}return Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),t.prototype.build=function(){var e=this.points;if(e){var r=this.getBuffer("aVertexPosition"),n=this.getBuffer("aTextureCoord"),s=this.getIndex();if(!(e.length<1)){r.data.length/4!==e.length&&(r.data=new Float32Array(e.length*4),n.data=new Float32Array(e.length*4),s.data=new Uint16Array((e.length-1)*6));var o=n.data,a=s.data;o[0]=0,o[1]=0,o[2]=0,o[3]=1;for(var l=0,u=e[0],c=this._width*this.textureScale,h=e.length,f=0;f<h;f++){var d=f*4;if(this.textureScale>0){var p=u.x-e[f].x,v=u.y-e[f].y,y=Math.sqrt(p*p+v*v);u=e[f],l+=y/c}else l=f/(h-1);o[d]=l,o[d+1]=0,o[d+2]=l,o[d+3]=1}for(var g=0,f=0;f<h-1;f++){var d=f*2;a[g++]=d,a[g++]=d+1,a[g++]=d+2,a[g++]=d+2,a[g++]=d+1,a[g++]=d+3}n.update(),s.update(),this.updateVertices()}}},t.prototype.updateVertices=function(){var e=this.points;if(!(e.length<1)){for(var r=e[0],n,s=0,o=0,a=this.buffers[0].data,l=e.length,u=0;u<l;u++){var c=e[u],h=u*4;u<e.length-1?n=e[u+1]:n=c,o=-(n.x-r.x),s=n.y-r.y;var f=Math.sqrt(s*s+o*o),d=this.textureScale>0?this.textureScale*this._width/2:this._width/2;s/=f,o/=f,s*=d,o*=d,a[h]=c.x+s,a[h+1]=c.y+o,a[h+2]=c.x-s,a[h+3]=c.y-o,r=c}this.buffers[0].update()}},t.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},t})(Sn),x_=(function(i){Di(t,i);function t(e,r,n){n===void 0&&(n=0);var s=this,o=new tm(e.height,r,n),a=new En(e);return n>0&&(e.baseTexture.wrapMode=Rt.REPEAT),s=i.call(this,o,a)||this,s.autoUpdate=!0,s}return t.prototype._render=function(e){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),i.prototype._render.call(this,e)},t})(Ai),rm=(function(i){Di(t,i);function t(e,r,n){var s=this,o=new em(e.width,e.height,r,n),a=new En(le.WHITE);return s=i.call(this,o,a)||this,s.texture=e,s}return t.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var e=this.geometry;e.width=this.shader.texture.width,e.height=this.shader.texture.height,e.build()},Object.defineProperty(t.prototype,"texture",{get:function(){return this.shader.texture},set:function(e){this.shader.texture!==e&&(this.shader.texture=e,this._textureID=-1,e.baseTexture.valid?this.textureUpdated():e.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),t.prototype._render=function(e){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),i.prototype._render.call(this,e)},t.prototype.destroy=function(e){this.shader.texture.off("update",this.textureUpdated,this),i.prototype.destroy.call(this,e)},t})(Ai),w_=(function(i){Di(t,i);function t(e,r,n,s,o){e===void 0&&(e=le.EMPTY);var a=this,l=new Sn(r,n,s);l.getBuffer("aVertexPosition").static=!1;var u=new En(e);return a=i.call(this,l,u,null,o)||this,a.autoUpdate=!0,a}return Object.defineProperty(t.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(e){this.geometry.getBuffer("aVertexPosition").data=e},enumerable:!1,configurable:!0}),t.prototype._render=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),i.prototype._render.call(this,e)},t})(Ai),Zn=10,T_=(function(i){Di(t,i);function t(e,r,n,s,o){r===void 0&&(r=Zn),n===void 0&&(n=Zn),s===void 0&&(s=Zn),o===void 0&&(o=Zn);var a=i.call(this,le.WHITE,4,4)||this;return a._origWidth=e.orig.width,a._origHeight=e.orig.height,a._width=a._origWidth,a._height=a._origHeight,a._leftWidth=r,a._rightWidth=s,a._topHeight=n,a._bottomHeight=o,a.texture=e,a}return t.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(t.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(e){this.geometry.getBuffer("aVertexPosition").data=e},enumerable:!1,configurable:!0}),t.prototype.updateHorizontalVertices=function(){var e=this.vertices,r=this._getMinScale();e[9]=e[11]=e[13]=e[15]=this._topHeight*r,e[17]=e[19]=e[21]=e[23]=this._height-this._bottomHeight*r,e[25]=e[27]=e[29]=e[31]=this._height},t.prototype.updateVerticalVertices=function(){var e=this.vertices,r=this._getMinScale();e[2]=e[10]=e[18]=e[26]=this._leftWidth*r,e[4]=e[12]=e[20]=e[28]=this._width-this._rightWidth*r,e[6]=e[14]=e[22]=e[30]=this._width},t.prototype._getMinScale=function(){var e=this._leftWidth+this._rightWidth,r=this._width>e?1:this._width/e,n=this._topHeight+this._bottomHeight,s=this._height>n?1:this._height/n,o=Math.min(r,s);return o},Object.defineProperty(t.prototype,"width",{get:function(){return this._width},set:function(e){this._width=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},set:function(e){this._height=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(e){this._leftWidth=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(e){this._rightWidth=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"topHeight",{get:function(){return this._topHeight},set:function(e){this._topHeight=e,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(e){this._bottomHeight=e,this._refresh()},enumerable:!1,configurable:!0}),t.prototype._refresh=function(){var e=this.texture,r=this.geometry.buffers[1].data;this._origWidth=e.orig.width,this._origHeight=e.orig.height;var n=1/this._origWidth,s=1/this._origHeight;r[0]=r[8]=r[16]=r[24]=0,r[1]=r[3]=r[5]=r[7]=0,r[6]=r[14]=r[22]=r[30]=1,r[25]=r[27]=r[29]=r[31]=1,r[2]=r[10]=r[18]=r[26]=n*this._leftWidth,r[4]=r[12]=r[20]=r[28]=1-n*this._rightWidth,r[9]=r[11]=r[13]=r[15]=s*this._topHeight,r[17]=r[19]=r[21]=r[23]=1-s*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},t})(rm);/*!
 * @pixi/sprite-animated - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/sprite-animated is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Ul=function(i,t){return Ul=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Ul(i,t)};function I_(i,t){Ul(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var E_=(function(i){I_(t,i);function t(e,r){r===void 0&&(r=!0);var n=i.call(this,e[0]instanceof le?e[0]:e[0].texture)||this;return n._textures=null,n._durations=null,n._autoUpdate=r,n._isConnectedToTicker=!1,n.animationSpeed=1,n.loop=!0,n.updateAnchor=!1,n.onComplete=null,n.onFrameChange=null,n.onLoop=null,n._currentTime=0,n._playing=!1,n._previousFrame=null,n.textures=e,n}return t.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Ye.shared.remove(this.update,this),this._isConnectedToTicker=!1))},t.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Ye.shared.add(this.update,this,Bt.HIGH),this._isConnectedToTicker=!0))},t.prototype.gotoAndStop=function(e){this.stop();var r=this.currentFrame;this._currentTime=e,r!==this.currentFrame&&this.updateTexture()},t.prototype.gotoAndPlay=function(e){var r=this.currentFrame;this._currentTime=e,r!==this.currentFrame&&this.updateTexture(),this.play()},t.prototype.update=function(e){if(this._playing){var r=this.animationSpeed*e,n=this.currentFrame;if(this._durations!==null){var s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];var o=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n?this.onLoop():this.animationSpeed<0&&this.currentFrame>n&&this.onLoop()),this.updateTexture())}},t.prototype.updateTexture=function(){var e=this.currentFrame;this._previousFrame!==e&&(this._previousFrame=e,this._texture=this._textures[e],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},t.prototype.destroy=function(e){this.stop(),i.prototype.destroy.call(this,e),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},t.fromFrames=function(e){for(var r=[],n=0;n<e.length;++n)r.push(le.from(e[n]));return new t(r)},t.fromImages=function(e){for(var r=[],n=0;n<e.length;++n)r.push(le.from(e[n]));return new t(r)},Object.defineProperty(t.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"textures",{get:function(){return this._textures},set:function(e){if(e[0]instanceof le)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(var r=0;r<e.length;r++)this._textures.push(e[r].texture),this._durations.push(e[r].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentFrame",{get:function(){var e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isConnectedToTicker?(Ye.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Ye.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),t})($r);/*!
 * pixi.js - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Xl=function(i,t){return Xl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,r){e.__proto__=r}||function(e,r){for(var n in r)r.hasOwnProperty(n)&&(e[n]=r[n])},Xl(i,t)};function Af(i,t){Xl(i,t);function e(){this.constructor=i}i.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}var ee="5.0.0";function S_(){var i=this;Object.defineProperties(i,{SVG_SIZE:{get:function(){return W(ee,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),i.SVGResource.SVG_SIZE}},TransformStatic:{get:function(){return W(ee,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),i.Transform}},TransformBase:{get:function(){return W(ee,"PIXI.TransformBase class has been removed, use PIXI.Transform"),i.Transform}},TRANSFORM_MODE:{get:function(){return W(ee,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function(){return W(ee,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),i.Renderer}},CanvasRenderTarget:{get:function(){return W(ee,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),i.utils.CanvasRenderTarget}},loader:{get:function(){return W(ee,"PIXI.loader instance has moved to PIXI.Loader.shared"),i.Loader.shared}},FilterManager:{get:function(){return W(ee,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),i.systems.FilterSystem}},CanvasTinter:{get:function(){return W("5.2.0","PIXI.CanvasTinter namespace has moved to PIXI.canvasUtils"),i.canvasUtils}},GroupD8:{get:function(){return W("5.2.0","PIXI.GroupD8 namespace has moved to PIXI.groupD8"),i.groupD8}}}),i.accessibility={},Object.defineProperties(i.accessibility,{AccessibilityManager:{get:function(){return W("5.3.0","PIXI.accessibility.AccessibilityManager moved to PIXI.AccessibilityManager"),i.AccessibilityManager}}}),i.interaction={},Object.defineProperties(i.interaction,{InteractionManager:{get:function(){return W("5.3.0","PIXI.interaction.InteractionManager moved to PIXI.InteractionManager"),i.InteractionManager}},InteractionData:{get:function(){return W("5.3.0","PIXI.interaction.InteractionData moved to PIXI.InteractionData"),i.InteractionData}},InteractionEvent:{get:function(){return W("5.3.0","PIXI.interaction.InteractionEvent moved to PIXI.InteractionEvent"),i.InteractionEvent}}}),i.prepare={},Object.defineProperties(i.prepare,{BasePrepare:{get:function(){return W("5.2.1","PIXI.prepare.BasePrepare moved to PIXI.BasePrepare"),i.BasePrepare}},Prepare:{get:function(){return W("5.2.1","PIXI.prepare.Prepare moved to PIXI.Prepare"),i.Prepare}},CanvasPrepare:{get:function(){return W("5.2.1","PIXI.prepare.CanvasPrepare moved to PIXI.CanvasPrepare"),i.CanvasPrepare}}}),i.extract={},Object.defineProperties(i.extract,{Extract:{get:function(){return W("5.2.1","PIXI.extract.Extract moved to PIXI.Extract"),i.Extract}},CanvasExtract:{get:function(){return W("5.2.1","PIXI.extract.CanvasExtract moved to PIXI.CanvasExtract"),i.CanvasExtract}}}),i.extras={},Object.defineProperties(i.extras,{TilingSprite:{get:function(){return W(ee,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),i.TilingSprite}},TilingSpriteRenderer:{get:function(){return W(ee,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),i.TilingSpriteRenderer}},AnimatedSprite:{get:function(){return W(ee,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),i.AnimatedSprite}},BitmapText:{get:function(){return W(ee,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),i.BitmapText}}}),i.TilingSprite.fromFrame=function(f,d,p){return W("5.3.0","TilingSprite.fromFrame is deprecated, use TilingSprite.from"),i.TilingSprite.from(f,{width:d,height:p})},i.TilingSprite.fromImage=function(f,d,p,v){return v===void 0&&(v={}),W("5.3.0","TilingSprite.fromImage is deprecated, use TilingSprite.from"),v&&typeof v!="object"&&(v={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),v.width=d,v.height=p,i.TilingSprite.from(f,v)},Object.defineProperties(i.utils,{getSvgSize:{get:function(){return W(ee,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),i.resources.SVGResource.getSize}}}),i.mesh={},Object.defineProperties(i.mesh,{Mesh:{get:function(){return W(ee,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),i.SimpleMesh}},NineSlicePlane:{get:function(){return W(ee,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),i.NineSlicePlane}},Plane:{get:function(){return W(ee,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),i.SimplePlane}},Rope:{get:function(){return W(ee,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),i.SimpleRope}},RawMesh:{get:function(){return W(ee,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),i.Mesh}},CanvasMeshRenderer:{get:function(){return W(ee,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),i.CanvasMeshRenderer}},MeshRenderer:{get:function(){return W(ee,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),i.MeshRenderer}}}),i.particles={},Object.defineProperties(i.particles,{ParticleContainer:{get:function(){return W(ee,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),i.ParticleContainer}},ParticleRenderer:{get:function(){return W(ee,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),i.ParticleRenderer}}}),i.ticker={},Object.defineProperties(i.ticker,{Ticker:{get:function(){return W(ee,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),i.Ticker}},shared:{get:function(){return W(ee,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),i.Ticker.shared}}}),i.loaders={},Object.defineProperties(i.loaders,{Loader:{get:function(){return W(ee,"PIXI.loaders.Loader class has moved to PIXI.Loader"),i.Loader}},Resource:{get:function(){return W(ee,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),i.LoaderResource}},bitmapFontParser:{get:function(){return W(ee,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),i.BitmapFontLoader.use}},parseBitmapFontData:{get:function(){W(ee,"PIXI.loaders.parseBitmapFontData function has removed")}},spritesheetParser:{get:function(){return W(ee,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),i.SpritesheetLoader.use}},getResourcePath:{get:function(){return W(ee,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),i.SpritesheetLoader.getResourcePath}}}),i.Loader.addPixiMiddleware=function(f){return W(ee,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),i.loaders.Loader.registerPlugin({use:f()})};var t=function(h){return"on"+h.charAt(0).toUpperCase()+h.slice(1)};Object.assign(i.Loader.prototype,{on:function(h){var f=t(h);W(ee,"PIXI.Loader#on is completely deprecated, use PIXI.Loader#"+f+".add")},once:function(h){var f=t(h);W(ee,"PIXI.Loader#once is completely deprecated, use PIXI.Loader#"+f+".once")},off:function(h){var f=t(h);W(ee,"PIXI.Loader#off is completely deprecated, use PIXI.Loader#"+f+".detach")}}),Object.defineProperty(i.extract,"WebGLExtract",{get:function(){return W(ee,"PIXI.extract.WebGLExtract method has moved to PIXI.Extract"),i.Extract}}),Object.defineProperty(i.prepare,"WebGLPrepare",{get:function(){return W(ee,"PIXI.prepare.WebGLPrepare class has moved to PIXI.Prepare"),i.Prepare}}),i.Container.prototype._renderWebGL=function(f){W(ee,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(f)},i.Container.prototype.renderWebGL=function(f){W(ee,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(f)},i.DisplayObject.prototype.renderWebGL=function(f){W(ee,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(f)},i.Container.prototype.renderAdvancedWebGL=function(f){W(ee,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(f)},Object.defineProperties(i.settings,{TRANSFORM_MODE:{get:function(){return W(ee,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function(){W(ee,"PIXI.settings.TRANSFORM_MODE property has been removed")}}});var e=i.BaseTexture;e.prototype.loadSource=function(f){W(ee,"PIXI.BaseTexture.loadSource method has been deprecated");var d=i.resources.autoDetectResource(f);d.internal=!0,this.setResource(d),this.update()};var r=!1;Object.defineProperties(e.prototype,{hasLoaded:{get:function(){return W(ee,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function(){var h;return W(ee,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),(h=this.resource)===null||h===void 0?void 0:h.url},set:function(h){W(ee,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=h)}},source:{get:function(){return W(ee,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource.source},set:function(h){W(ee,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=h)}},premultiplyAlpha:{get:function(){return W("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode!==0},set:function(h){W("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(h)}},_id:{get:function(){return r||(W("5.2.0","PIXI.BaseTexture._id batch local field has been changed to `_batchLocation`"),r=!0),this._batchLocation},set:function(h){this._batchLocation=h}}}),e.fromImage=function(f,d,p,v){W(ee,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from");var y={scale:v,crossorigin:d};return e.from(f,{scaleMode:p,resourceOptions:y})},e.fromCanvas=function(f,d){return W(ee,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),e.from(f,{scaleMode:d})},e.fromSVG=function(f,d,p,v){W(ee,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from");var y={scale:v,crossorigin:d};return e.from(f,{scaleMode:p,resourceOptions:y})},Object.defineProperties(i.resources.ImageResource.prototype,{premultiplyAlpha:{get:function(){return W("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode!==0},set:function(h){W("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(h)}}}),i.Point.prototype.copy=function(f){return W(ee,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(f)},i.ObservablePoint.prototype.copy=function(f){return W(ee,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(f)},i.Rectangle.prototype.copy=function(f){return W(ee,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(f)},i.Matrix.prototype.copy=function(f){return W(ee,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(f)},i.systems.StateSystem.prototype.setState=function(f){return W("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(f)},Object.assign(i.systems.FilterSystem.prototype,{getRenderTarget:function(h,f){return W(ee,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(null,f)},returnRenderTarget:function(h){W(ee,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(h)},calculateScreenSpaceMatrix:function(h){W(ee,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var f=h.identity(),d=this.activeState,p=d.sourceFrame,v=d.destinationFrame;return f.translate(p.x/v.width,p.y/v.height),f.scale(v.width,v.height),f},calculateNormalizedScreenSpaceMatrix:function(h){W(ee,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var f=this.activeState,d=f.sourceFrame,p=f.destinationFrame,v=h.identity();v.translate(d.x/p.width,d.y/p.height);var y=p.width/d.width,g=p.height/d.height;return v.scale(y,g),v}}),Object.defineProperties(i.RenderTexture.prototype,{sourceFrame:{get:function(){return W(ee,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function(){return W(ee,"PIXI.RenderTexture.size property has been removed"),this._frame}}});var n=(function(h){Af(f,h);function f(d,p,v,y){var g=this;return W(ee,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),g=h.call(this,!0,d,p,v,y)||this,g}return f})(i.filters.BlurFilterPass),s=(function(h){Af(f,h);function f(d,p,v,y){var g=this;return W(ee,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),g=h.call(this,!1,d,p,v,y)||this,g}return f})(i.filters.BlurFilterPass);Object.assign(i.filters,{BlurXFilter:n,BlurYFilter:s});var o=i.Sprite,a=i.Texture,l=i.Graphics;l.prototype.generateCanvasTexture||(l.prototype.generateCanvasTexture=function(){W(ee,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(l.prototype,"graphicsData",{get:function(){return W(ee,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}});function u(h,f,d,p){return W(ee,"PIXI.Sprite."+h+" method is deprecated, use PIXI.Sprite.from"),o.from(f,{resourceOptions:{scale:p,crossorigin:d}})}o.fromImage=u.bind(null,"fromImage"),o.fromSVG=u.bind(null,"fromSVG"),o.fromCanvas=u.bind(null,"fromCanvas"),o.fromVideo=u.bind(null,"fromVideo"),o.fromFrame=u.bind(null,"fromFrame");function c(h,f,d,p){return W(ee,"PIXI.Texture."+h+" method is deprecated, use PIXI.Texture.from"),a.from(f,{resourceOptions:{scale:p,crossorigin:d}})}a.fromImage=c.bind(null,"fromImage"),a.fromSVG=c.bind(null,"fromSVG"),a.fromCanvas=c.bind(null,"fromCanvas"),a.fromVideo=c.bind(null,"fromVideo"),a.fromFrame=c.bind(null,"fromFrame"),Object.defineProperty(i.AbstractRenderer.prototype,"autoResize",{get:function(){return W(ee,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function(h){W(ee,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=h}}),Object.defineProperty(i.Renderer.prototype,"textureManager",{get:function(){return W(ee,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),i.utils.mixins={mixin:function(){W(ee,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function(){W(ee,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function(){W(ee,"PIXI.utils.mixins.performMixins function is no longer available")}},Object.defineProperty(i.BitmapText.prototype,"font",{get:function(){return W("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),{name:this._fontName,size:this._fontSize,tint:this._tint,align:this._align}},set:function(h){if(W("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),!!h){var f={font:h};this._upgradeStyle(f),f.fontSize=f.fontSize||i.BitmapFont.available[f.fontName].size,this._fontName=f.fontName,this._fontSize=f.fontSize,this.dirty=!0}}})}kt.registerPlugin("accessibility",Rp);kt.registerPlugin("extract",Sy);kt.registerPlugin("interaction",Dp);kt.registerPlugin("particle",My);kt.registerPlugin("prepare",zy);kt.registerPlugin("batch",Ey);kt.registerPlugin("tilingSprite",jy);Xr.registerPlugin(Zy);Xr.registerPlugin(Vy);In.registerPlugin(Lp);In.registerPlugin(Oy);var C_="5.3.12",A_={AlphaFilter:e_,BlurFilter:o_,BlurFilterPass:Ml,ColorMatrixFilter:Ll,DisplacementFilter:f_,FXAAFilter:m_,NoiseFilter:b_};const P_=Object.freeze(Object.defineProperty({__proto__:null,get ALPHA_MODES(){return qt},AbstractBatchRenderer:wy,AbstractRenderer:gy,AccessibilityManager:Rp,AnimatedSprite:E_,AppLoaderPlugin:Oy,Application:In,Attribute:pl,get BLEND_MODES(){return se},get BUFFER_BITS(){return hn},BasePrepare:Gy,BaseRenderTexture:on,BaseTexture:Ee,BatchDrawCall:Fs,BatchGeometry:Lu,BatchPluginFactory:Iy,BatchRenderer:Ey,BatchShaderGenerator:Ty,BatchTextureArray:Ms,BitmapFont:sr,BitmapFontData:yn,BitmapFontLoader:Zy,BitmapText:Zb,Bounds:pn,Buffer:Be,get CLEAR_MODES(){return Et},Circle:Ap,Container:st,CountLimiter:Hy,DEG_TO_RAD:Cp,get DRAW_MODES(){return ft},DisplayObject:Ue,get ENV(){return Nt},Ellipse:Pp,Extract:Sy,get FORMATS(){return wi},FillStyle:Nu,Filter:Jt,FilterState:qp,Framebuffer:Os,get GC_MODES(){return As},GLFramebuffer:Zp,GLProgram:dy,GLTexture:bs,GRAPHICS_CURVES:Si,Geometry:zr,Graphics:js,GraphicsData:wl,GraphicsGeometry:Uy,IGLUniformData:G0,InteractionData:hl,InteractionEvent:Np,InteractionManager:Dp,InteractionTrackingData:vs,get LINE_CAP(){return Yt},get LINE_JOIN(){return Gt},LineStyle:Xy,Loader:Xr,LoaderResource:an,get MASK_TYPES(){return it},get MIPMAP_MODES(){return Ti},get MSAA_QUALITY(){return Br},MaskData:ey,Matrix:Le,Mesh:Ai,MeshBatchUvs:Wy,MeshGeometry:Sn,MeshMaterial:En,NineSlicePlane:T_,ObjectRenderer:Ni,ObservablePoint:Lr,PI_2:Ii,get PRECISION(){return At},ParticleContainer:yb,ParticleRenderer:My,PlaneGeometry:em,Point:ze,Polygon:mi,Prepare:zy,Program:Bi,Quad:Vp,QuadUv:Mu,RAD_TO_DEG:Sp,get RENDERER_TYPE(){return xi},Rectangle:ge,RenderTexture:Ur,RenderTexturePool:zp,Renderer:kt,RopeGeometry:tm,RoundedRectangle:Op,Runner:qe,get SCALE_MODES(){return Ct},get SHAPES(){return Re},Shader:Wt,SimpleMesh:w_,SimplePlane:rm,SimpleRope:x_,Sprite:$r,SpriteMaskFilter:oy,Spritesheet:$y,SpritesheetLoader:Vy,State:mr,System:lt,get TARGETS(){return hr},get TEXT_GRADIENT(){return Ci},get TYPES(){return De},TemporaryDisplayObject:Su,Text:Du,TextMetrics:wt,TextStyle:Hr,Texture:le,TextureLoader:Py,TextureMatrix:Vs,TextureUvs:Fu,Ticker:Ye,TickerPlugin:Lp,TilingSprite:Xb,TilingSpriteRenderer:jy,TimeLimiter:Ub,Transform:Iu,get UPDATE_PRIORITY(){return Bt},UniformGroup:fr,VERSION:C_,ViewableBuffer:xy,get WRAP_MODES(){return Rt},accessibleTarget:Mp,autoDetectRenderer:by,checkMaxIfStatementsInShader:sy,defaultFilterVertex:Ru,defaultVertex:_y,filters:A_,graphicsUtils:_b,groupD8:Fe,interactiveTarget:Bp,isMobile:_t,resources:Yp,settings:ne,systems:K0,uniformParsers:gs,useDeprecated:S_,utils:n0},Symbol.toStringTag,{value:"Module"}));var be;(function(i){var t=(function(){function e(r){this.tileAnim=[0,0],this.dontUseTransform=!1,this.renderer=r,this.tileAnim=[0,0]}return e})();i.CanvasTileRenderer=t})(be||(be={}));var $t=(function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])};return function(t,e){i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}})(),be;(function(i){var t=(function(e){$t(r,e);function r(n,s,o){var a=e.call(this)||this;return a.modificationMarker=0,a.shadowColor=new Float32Array([0,0,0,.5]),a._globalMat=null,a.initialize.apply(a,arguments),a}return r.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},r.prototype.initialize=function(n,s,o){o===!0&&(o=0),this.z=this.zIndex=n,this.texPerChild=o||i.Constant.boundCountPerBuffer*i.Constant.maxTextures,s&&this.setBitmaps(s)},r.prototype.setBitmaps=function(n){var s=this.texPerChild,o=this.children.length,a=Math.ceil(n.length/s),l;for(l=0;l<o;l++)this.children[l].textures=n.slice(l*s,(l+1)*s);for(l=o;l<a;l++){var u=new i.RectTileLayer(this.zIndex,n.slice(l*s,(l+1)*s));u.compositeParent=!0,u.offsetX=i.Constant.boundSize,u.offsetY=i.Constant.boundSize,this.addChild(u)}},r.prototype.clear=function(){for(var n=0;n<this.children.length;n++)this.children[n].clear();this.modificationMarker=0},r.prototype.addRect=function(n,s,o,a,l,u,c){var h=n/this.texPerChild>>0,f=n%this.texPerChild;this.children[h]&&this.children[h].textures&&this.children[h].addRect(f,s,o,a,l,u,c)},r.prototype.addFrame=function(n,s,o,a,l){var u,c=null,h=0,f=this.children;if(typeof n=="number"){var d=n/this.texPerChild>>0;if(c=f[d],c)h=n%this.texPerChild;else{if(c=f[0],!c)return!1;h=0}u=c.textures[h]}else{typeof n=="string"?u=le.from(n):u=n;for(var p=0;p<f.length;p++){for(var v=f[p],y=v.textures,g=0;g<y.length;g++)if(y[g].baseTexture===u.baseTexture){c=v,h=g;break}if(c)break}if(!c){for(var p=0;p<f.length;p++){var v=f[p];if(v.textures.length<this.texPerChild){c=v,h=v.textures.length,v.textures.push(u);break}}c||(c=new i.RectTileLayer(this.zIndex,u),c.compositeParent=!0,c.offsetX=i.Constant.boundSize,c.offsetY=i.Constant.boundSize,f.push(c),h=0)}}return c.addRect(h,u.frame.x,u.frame.y,s,o,u.frame.width,u.frame.height,a,l),!0},r.prototype.renderCanvas=function(n){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){var s=n.plugins.tilemap;if(!s.dontUseTransform){var o=this.worldTransform;n.context.setTransform(o.a,o.b,o.c,o.d,o.tx*n.resolution,o.ty*n.resolution)}for(var a=this.children,l=0;l<a.length;l++)a[l].renderCanvasCore(n)}},r.prototype.render=function(n){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){var s=n.plugins.tilemap,o=s.getShader();n.batch.setObjectRenderer(s),this._globalMat=o.uniforms.projTransMatrix,n.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),o.uniforms.shadowColor=this.shadowColor,o.uniforms.animationFrame=s.tileAnim,n.shader.bind(o,!1);for(var a=this.children,l=0;l<a.length;l++)a[l].renderWebGLCore(n,s)}},r.prototype.isModified=function(n){var s=this.children;if(this.modificationMarker!==s.length)return!0;for(var o=0;o<s.length;o++)if(s[o].isModified(n))return!0;return!1},r.prototype.clearModify=function(){var n=this.children;this.modificationMarker=n.length;for(var s=0;s<n.length;s++)n[s].clearModify()},r})(st);i.CompositeRectTileLayer=t})(be||(be={}));var be;(function(i){i.Constant={maxTextures:4,bufferSize:2048,boundSize:1024,boundCountPerBuffer:4,use32bitIndex:!1,SCALE_MODE:Ct.LINEAR,DO_CLEAR:!0}})(be||(be={}));var be;(function(i){(function(t){$t(e,t);function e(r){var n=t.call(this)||this;return n.zIndex=r,n}return e.prototype.renderCanvas=function(r){var n=null;r.plugins.tilemap.dontUseTransform&&(n=this.transform.worldTransform,this.transform.worldTransform=Le.IDENTITY),r.plugins.graphics.render(this),r.plugins.tilemap.dontUseTransform&&(this.transform.worldTransform=n),r.context.globalAlpha=1},e.prototype.isModified=function(r){return!1},e.prototype.clearModify=function(){},e})(js)})(be||(be={}));var be;(function(i){var t=(function(e){$t(r,e);function r(n){var s=e.call(this,n.bufferSize,n.bufferSize)||this;s.DO_CLEAR=!1,s.boundSize=0,s._clearBuffer=null,s.baseTex=null,s.boundSprites=[],s.dirties=[];var o=s.boundSprites,a=s.dirties;s.boundSize=n.boundSize;for(var l=0;l<n.boundCountPerBuffer;l++){var u=new $r;u.position.x=n.boundSize*(l&1),u.position.y=n.boundSize*(l>>1),o.push(u),a.push(0)}return s.DO_CLEAR=!!n.DO_CLEAR,s}return r.prototype.bind=function(n){if(this.baseTex)throw new Error("Only one baseTexture is allowed for this resource!");this.baseTex=n,e.prototype.bind.call(this,n)},r.prototype.setTexture=function(n,s){var o=this.boundSprites[n];o.texture.baseTexture!==s.baseTexture&&(o.texture=s,this.baseTex.update(),this.dirties[n]=this.baseTex.dirtyId)},r.prototype.upload=function(n,s,o){var a=n.gl,l=this,u=l.width,c=l.height;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),o.dirtyId<0&&(o.width=u,o.height=c,a.texImage2D(s.target,0,s.format,u,c,0,s.format,s.type,null));var h=this.DO_CLEAR;h&&!this._clearBuffer&&(this._clearBuffer=new Uint8Array(i.Constant.boundSize*i.Constant.boundSize*4));for(var f=this.boundSprites,d=0;d<f.length;d++){var p=f[d],v=p.texture.baseTexture;if(!(o.dirtyId>=this.dirties[d])){var y=v.resource;!v.valid||!y||!y.source||(h&&(v.width<this.boundSize||v.height<this.boundSize)&&a.texSubImage2D(s.target,0,p.position.x,p.position.y,this.boundSize,this.boundSize,s.format,s.type,this._clearBuffer),a.texSubImage2D(s.target,0,p.position.x,p.position.y,s.format,s.type,y.source))}}return!0},r})(Yp.Resource);i.MultiTextureResource=t})(be||(be={}));var be;(function(i){var t=(function(e){$t(r,e);function r(n,s){var o=e.call(this)||this;return o.zIndex=0,o.modificationMarker=0,o.shadowColor=new Float32Array([0,0,0,.5]),o._globalMat=null,o.pointsBuf=[],o.hasAnim=!1,o.offsetX=0,o.offsetY=0,o.compositeParent=!1,o.vbId=0,o.vb=null,o.vbBuffer=null,o.vbArray=null,o.vbInts=null,o.initialize(n,s),o}return r.prototype.initialize=function(n,s){s?!(s instanceof Array)&&s.baseTexture&&(s=[s]):s=[],this.textures=s,this.zIndex=n},r.prototype.clear=function(){this.pointsBuf.length=0,this.modificationMarker=0,this.hasAnim=!1},r.prototype.addFrame=function(n,s,o,a,l){var u,c=0;if(typeof n=="number")c=n,u=this.textures[c];else{typeof n=="string"?u=le.from(n):u=n;for(var h=!1,f=this.textures,d=0;d<f.length;d++)if(f[d].baseTexture===u.baseTexture){c=d,h=!0;break}if(!h)return!1}return this.addRect(c,u.frame.x,u.frame.y,s,o,u.frame.width,u.frame.height,a,l),!0},r.prototype.addRect=function(n,s,o,a,l,u,c,h,f){h===void 0&&(h=0),f===void 0&&(f=0);var d=this.pointsBuf;if(this.hasAnim=this.hasAnim||h>0||f>0,u===c)d.push(s),d.push(o),d.push(a),d.push(l),d.push(u),d.push(c),d.push(h|0),d.push(f|0),d.push(n);else{var p=void 0;if(u%c===0)for(p=0;p<u/c;p++)d.push(s+p*c),d.push(o),d.push(a+p*c),d.push(l),d.push(c),d.push(c),d.push(h|0),d.push(f|0),d.push(n);else if(c%u===0)for(p=0;p<c/u;p++)d.push(s),d.push(o+p*u),d.push(a),d.push(l+p*u),d.push(u),d.push(u),d.push(h|0),d.push(f|0),d.push(n);else d.push(s),d.push(o),d.push(a),d.push(l),d.push(u),d.push(c),d.push(h|0),d.push(f|0),d.push(n)}},r.prototype.renderCanvas=function(n){var s=n.plugins.tilemap;if(!s.dontUseTransform){var o=this.worldTransform;n.context.setTransform(o.a,o.b,o.c,o.d,o.tx*n.resolution,o.ty*n.resolution)}this.renderCanvasCore(n)},r.prototype.renderCanvasCore=function(n){if(this.textures.length!==0){var s=this.pointsBuf;n.context.fillStyle="#000000";for(var o=0,a=s.length;o<a;o+=9){var l=s[o],u=s[o+1],c=s[o+2],h=s[o+3],f=s[o+4],d=s[o+5];l+=s[o+6]*n.plugins.tilemap.tileAnim[0],u+=s[o+7]*n.plugins.tilemap.tileAnim[1];var p=s[o+8];p>=0?n.context.drawImage(this.textures[p].baseTexture.source,l,u,f,d,c,h,f,d):(n.context.globalAlpha=.5,n.context.fillRect(c,h,f,d),n.context.globalAlpha=1)}}},r.prototype.destroyVb=function(){this.vb&&(this.vb.destroy(),this.vb=null)},r.prototype.render=function(n){var s=n.plugins.tilemap,o=s.getShader();n.batch.setObjectRenderer(s),this._globalMat=o.uniforms.projTransMatrix,n.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),o.uniforms.shadowColor=this.shadowColor,o.uniforms.animationFrame=s.tileAnim,n.shader.bind(o,!1),this.renderWebGLCore(n,s)},r.prototype.renderWebGLCore=function(n,s){var o=this.pointsBuf;if(o.length!==0){var a=o.length/9,l=s.getShader(),u=this.textures;if(u.length!==0){s.bindTextures(n,l,u);var c=this.vb;c||(c=s.createVb(),this.vb=c,this.vbId=c.id,this.vbBuffer=null,this.modificationMarker=0),s.checkIndexBuffer(a,c);var h=i.Constant.boundCountPerBuffer,f=c.getBuffer("aVertexPosition"),d=a*c.vertPerQuad;if(d!==0){if(this.modificationMarker!==d){this.modificationMarker=d;var p=c.stride*d;if(!this.vbBuffer||this.vbBuffer.byteLength<p){for(var v=c.stride;v<p;)v*=2;this.vbBuffer=new ArrayBuffer(v),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),f.update(this.vbBuffer)}var y=this.vbArray;this.vbInts;for(var g=0,E=0,T=this.offsetX,R=this.offsetY,_=0;_<o.length;_+=9){var F=.5;this.compositeParent&&(h>1?(E=o[_+8]>>2,T=this.offsetX*(o[_+8]&1),R=this.offsetY*(o[_+8]>>1&1)):(E=o[_+8],T=0,R=0));var P=o[_+2],H=o[_+3],M=o[_+4],N=o[_+5],Y=o[_]+T,D=o[_+1]+R,Z=o[_+6],Q=o[_+7];y[g++]=P,y[g++]=H,y[g++]=Y,y[g++]=D,y[g++]=Y+F,y[g++]=D+F,y[g++]=Y+M-F,y[g++]=D+N-F,y[g++]=Z,y[g++]=Q,y[g++]=E,y[g++]=P+M,y[g++]=H,y[g++]=Y+M,y[g++]=D,y[g++]=Y+F,y[g++]=D+F,y[g++]=Y+M-F,y[g++]=D+N-F,y[g++]=Z,y[g++]=Q,y[g++]=E,y[g++]=P+M,y[g++]=H+N,y[g++]=Y+M,y[g++]=D+N,y[g++]=Y+F,y[g++]=D+F,y[g++]=Y+M-F,y[g++]=D+N-F,y[g++]=Z,y[g++]=Q,y[g++]=E,y[g++]=P,y[g++]=H+N,y[g++]=Y,y[g++]=D+N,y[g++]=Y+F,y[g++]=D+F,y[g++]=Y+M-F,y[g++]=D+N-F,y[g++]=Z,y[g++]=Q,y[g++]=E}f.update(y)}n.geometry.bind(c,l),n.geometry.draw(ft.TRIANGLES,a*6,0)}}}},r.prototype.isModified=function(n){return!!(this.modificationMarker!==this.pointsBuf.length||n&&this.hasAnim)},r.prototype.clearModify=function(){this.modificationMarker=this.pointsBuf.length},r.prototype.destroy=function(n){e.prototype.destroy.call(this,n),this.destroyVb()},r})(st);i.RectTileLayer=t})(be||(be={}));var be;(function(i){var t=`
varying vec2 vTextureCoord;
varying vec4 vFrame;
varying float vTextureId;
uniform vec4 shadowColor;
uniform sampler2D uSamplers[%count%];
uniform vec2 uSamplerSize[%count%];

void main(void){
   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);
   float textureId = floor(vTextureId + 0.5);

   vec4 color;
   %forloop%
   gl_FragColor = color;
}
`,e=`
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aFrame;
attribute vec2 aAnim;
attribute float aTextureId;

uniform mat3 projTransMatrix;
uniform vec2 animationFrame;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vFrame;

void main(void){
   gl_Position = vec4((projTransMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vec2 anim = aAnim * animationFrame;
   vTextureCoord = aTextureCoord + anim;
   vFrame = aFrame + vec4(anim, anim);
   vTextureId = aTextureId;
}
`,r=(function(o){$t(a,o);function a(l,u,c){var h=o.call(this,new Bi(u,c),{animationFrame:new Float32Array(2),uSamplers:[],uSamplerSize:[],projTransMatrix:new Le})||this;return h.maxTextures=0,h.maxTextures=l,i.shaderGenerator.fillSamplers(h,h.maxTextures),h}return a})(Wt);i.TilemapShader=r;var n=(function(o){$t(a,o);function a(l){var u=o.call(this,l,e,i.shaderGenerator.generateFragmentSrc(l,t))||this;return i.shaderGenerator.fillSamplers(u,u.maxTextures),u}return a})(r);i.RectTileShader=n;var s=(function(o){$t(a,o);function a(){var l=o.call(this)||this;l.vertSize=11,l.vertPerQuad=4,l.stride=l.vertSize*4,l.lastTimeAccess=0;var u=l.buf=new Be(new Float32Array(2),!0,!1);return l.addAttribute("aVertexPosition",u,0,!1,0,l.stride,0).addAttribute("aTextureCoord",u,0,!1,0,l.stride,8).addAttribute("aFrame",u,0,!1,0,l.stride,16).addAttribute("aAnim",u,0,!1,0,l.stride,32).addAttribute("aTextureId",u,0,!1,0,l.stride,40),l}return a})(zr);i.RectTileGeom=s})(be||(be={}));var be;(function(i){var t=(function(e){$t(r,e);function r(n){var s=e.call(this,n)||this;return s.sn=-1,s.indexBuffer=null,s.ibLen=0,s.tileAnim=[0,0],s.texLoc=[],s.texResources=[],s.rectShader=new i.RectTileShader(i.Constant.maxTextures),s.indexBuffer=new Be(void 0,!0,!0),s.checkIndexBuffer(2e3),s.initBounds(),s}return r.prototype.initBounds=function(){if(!(i.Constant.boundCountPerBuffer<=1))for(var n=i.Constant.maxTextures,s=0;s<n;s++){var o=new i.MultiTextureResource(i.Constant),a=new Ee(o);a.scaleMode=i.Constant.SCALE_MODE,a.wrapMode=Rt.CLAMP,this.texResources.push(o)}},r.prototype.bindTexturesWithoutRT=function(n,s,o){var a=s.uniforms.uSamplerSize;this.texLoc.length=0;for(var l=0;l<o.length;l++){var u=o[l];if(!u||!u.valid)return;n.texture.bind(o[l],l),a[l*2]=1/o[l].baseTexture.width,a[l*2+1]=1/o[l].baseTexture.height}s.uniforms.uSamplerSize=a},r.prototype.bindTextures=function(n,s,o){var a=o.length,l=i.Constant.maxTextures;if(!(a>i.Constant.boundCountPerBuffer*l)){if(i.Constant.boundCountPerBuffer<=1){this.bindTexturesWithoutRT(n,s,o);return}for(var u=0;u<a;u++){var c=o[u];if(!(!c||!c.valid)){var h=this.texResources[u>>2];h.setTexture(u&3,c)}}var f=u+3>>2;for(u=0;u<f;u++)n.texture.bind(this.texResources[u].baseTex,u)}},r.prototype.start=function(){},r.prototype.createVb=function(){var n=new i.RectTileGeom;return n.addIndex(this.indexBuffer),n.lastTimeAccess=Date.now(),n},r.prototype.checkIndexBuffer=function(n,s){var o=n*6;o<=this.ibLen||(this.ibLen=o,this.indexBuffer.update(Tu(n,i.Constant.use32bitIndex)))},r.prototype.getShader=function(){return this.rectShader},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.rectShader=null},r})(Ni);i.TileRenderer=t,kt.registerPlugin("tilemap",t)})(be||(be={}));var be;(function(i){var t=(function(e){$t(r,e);function r(n,s){var o=e.call(this)||this;return o._lastAnimationFrame=-1,o.tilemap=n,o.z=s,o}return r.prototype.clear=function(){for(var n=this.children,s=0;s<n.length;s++)n[s].clear();this._previousLayers=0},r.prototype.cacheIfDirty=function(){var n=this.tilemap,s=this.children,o=this._previousLayers!==s.length;this._previousLayers=s.length;var a=this.canvasBuffer,l=this._tempRender;a||(a=this.canvasBuffer=document.createElement("canvas"),l=this._tempRender=new(void 0)(100,100,{view:a}),l.context=l.rootContext,l.plugins.tilemap.dontUseTransform=!0),(a.width!==n._layerWidth||a.height!==n._layerHeight)&&(a.width=n._layerWidth,a.height=n._layerHeight,o=!0);var u;if(!o){for(u=0;u<s.length;u++)if(s[u].isModified(this._lastAnimationFrame!==n.animationFrame)){o=!0;break}}if(this._lastAnimationFrame=n.animationFrame,o)for(n._hackRenderer&&n._hackRenderer(l),l.context.clearRect(0,0,a.width,a.height),u=0;u<s.length;u++)s[u].clearModify(),s[u].renderCanvas(l);for(this.layerTransform=this.worldTransform,u=0;u<s.length;u++){this.layerTransform=s[u].worldTransform;break}},r.prototype.renderCanvas=function(n){this.cacheIfDirty();var s=this.layerTransform;n.context.setTransform(s.a,s.b,s.c,s.d,s.tx*n.resolution,s.ty*n.resolution),this.tilemap,n.context.drawImage(this.canvasBuffer,0,0)},r})(st);i.ZLayer=t})(be||(be={}));const O_=i=>(i&&Object.isExtensible(i)&&!i.tilemap&&(i.tilemap=be),be);var be;(function(i){(function(t){function e(s,o){for(var a=[],l=0;l<o;l++)a[l]=l;s.uniforms.uSamplers=a;for(var u=[],l=0;l<o;l++)u.push(1/i.Constant.bufferSize),u.push(1/i.Constant.bufferSize);s.uniforms.uSamplerSize=u}t.fillSamplers=e;function r(s,o){return o.replace(/%count%/gi,s+"").replace(/%forloop%/gi,this.generateSampleSrc(s))}t.generateFragmentSrc=r;function n(s){var o="";o+=`
`,o+=`
`,o+="if(vTextureId <= -1.0) {",o+=`
	color = shadowColor;`,o+=`
}`;for(var a=0;a<s;a++)o+=`
else `,a<s-1&&(o+="if(textureId == "+a+".0)"),o+=`
{`,o+=`
	color = texture2D(uSamplers[`+a+"], textureCoord * uSamplerSize["+a+"]);",o+=`
}`;return o+=`
`,o+=`
`,o}t.generateSampleSrc=n})(i.shaderGenerator||(i.shaderGenerator={}))})(be||(be={}));const J={...P_};O_(J);J.settings&&(J.settings.CREATE_IMAGE_BITMAP=!1,J.SCALE_MODES&&(J.settings.SCALE_MODE=J.SCALE_MODES.NEAREST),typeof J.settings.SPRITE_MAX_TEXTURES=="number"&&(J.settings.SPRITE_MAX_TEXTURES=Math.min(J.settings.SPRITE_MAX_TEXTURES,16)));J.Text&&(J.Text.defaultResolution=1);typeof window<"u"&&(window.PIXI=J);var xs={exports:{}},F_=xs.exports,Pf;function M_(){return Pf||(Pf=1,(function(i,t){(function(e,r){i.exports=r()})(F_,function(){var e=function(){function r(d){return o.appendChild(d.dom),d}function n(d){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===d?"block":"none";s=d}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),n(++s%o.children.length)},!1);var a=(performance||Date).now(),l=a,u=0,c=r(new e.Panel("FPS","#0ff","#002")),h=r(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=r(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:o,addPanel:r,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){u++;var d=(performance||Date).now();if(h.update(d-a,200),d>l+1e3&&(c.update(1e3*u/(d-l),100),l=d,u=0,f)){var p=performance.memory;f.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:o,setMode:n}};return e.Panel=function(r,n,s){var o=1/0,a=0,l=Math.round,u=l(window.devicePixelRatio||1),c=80*u,h=48*u,f=3*u,d=2*u,p=3*u,v=15*u,y=74*u,g=30*u,E=document.createElement("canvas");E.width=c,E.height=h,E.style.cssText="width:80px;height:48px";var T=E.getContext("2d");return T.font="bold "+9*u+"px Helvetica,Arial,sans-serif",T.textBaseline="top",T.fillStyle=s,T.fillRect(0,0,c,h),T.fillStyle=n,T.fillText(r,f,d),T.fillRect(p,v,y,g),T.fillStyle=s,T.globalAlpha=.9,T.fillRect(p,v,y,g),{dom:E,update:function(R,_){o=Math.min(o,R),a=Math.max(a,R),T.fillStyle=s,T.globalAlpha=1,T.fillRect(0,0,c,v),T.fillStyle=n,T.fillText(l(R)+" "+r+" ("+l(o)+"-"+l(a)+")",f,d),T.drawImage(E,p+u,v,y-u,g,p,v,y-u,g),T.fillRect(p+y-u,v,u,g),T.fillStyle=s,T.globalAlpha=.9,T.fillRect(p+y-u,v,u,l((1-R/_)*g))}}},e})})(xs)),xs.exports}var R_=M_();const L_=Mi(R_),N_=650,B_=6,Of=(i,t=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return t},D_=i=>{i&&(i.cameraShake={remaining:0,duration:0,intensity:0,offsetX:0,offsetY:0})},k_=(i,t={})=>{if(!i||!i.cameraShake)return;const e=Math.max(0,Of(t.duration,N_)),r=Math.max(0,Of(t.intensity,B_));i.cameraShake.remaining=e,i.cameraShake.duration=e,i.cameraShake.intensity=r},U_=(i,t=0)=>{if(!i||!i.cameraShake)return{x:0,y:0};const e=i.cameraShake,r=Number.isFinite(t)&&t>0?t:0;if(e.remaining<=0||e.intensity<=0)return e.remaining=0,e.offsetX=0,e.offsetY=0,{x:0,y:0};e.remaining=Math.max(0,e.remaining-r);const n=e.duration>0?e.remaining/e.duration:0,s=e.intensity*n,o=Math.random()*Math.PI*2;return e.offsetX=Math.cos(o)*s,e.offsetY=Math.sin(o)*s,e.remaining<=0&&(e.offsetX=0,e.offsetY=0),{x:e.offsetX,y:e.offsetY}},X_=2400,Ff=24,H_=100,G_=80,Y_=Object.freeze({offsetX:28,offsetY:8,width:138,height:138}),z_=70,$_=69,im=.5,Hl=.8,lr=2,Ht=101,Uu=200,Xu=201,Hu=202,Gu=203,Ar=103,V_=1,ir=-1,q_=650,j_=650,W_=500,Mf=5e3,K_=5e3,nm=5,Z_=8,J_=5,Pi=40,Q_=95e6,tn=5e5,Rf=2,Lf=1,Yu=1,Ws=2,ki=3,ex=.1,Ot=0,Xe=1,Ks=2,Gl=3,Je=4,tx=100,rx=50,Ce=0,ur=1,Nf=2,sm=200,di=300,Bf=412,ix=112,Jn=401,nx=101,Qn=409,sx=109,es=400,ox=100,Ba=402,ax=102,ts=411,lx=111,Da=404,ux=104,ka=405,cx=105,Df=403,hx=103,kf=410,fx=110,Uf=408,dx=108,Xf=407,px=107,Hf=406,yx=106,vn=0,Zs=1,vi=2,Ie=3,et=4,gi=5,Js=6,dt=7,Ft=8,tt=9,xt=10,pt=11,zu=12,Gf=Object.freeze({[Ft]:40,[tt]:32,[xt]:16,[pt]:40}),Yf=Object.freeze({[Ft]:20,[tt]:8,[xt]:16,[pt]:20}),mx={[vn]:4,[Zs]:4,[vi]:5,[Ie]:20,[et]:10,[gi]:1,[Js]:4,[dt]:5,[Ft]:20,[tt]:10,[xt]:5,[pt]:5,[zu]:4},Qs=[{key:"CAN_BUILD_HOSPITAL",type:sm,label:"Hospital",icon:12,image:Ks,parent:Ba,initial:Ce},{key:"CAN_BUILD_HOUSE",type:di,label:"Housing",icon:0,image:Gl,parent:0,initial:ur},{key:"CAN_BUILD_LASER_RESEARCH",type:Bf,label:"Laser Research",icon:1,image:Je,parent:di,initial:ur},{key:"CAN_BUILD_LASER_FACTORY",type:ix,label:"Laser Factory",icon:1,image:Xe,parent:Bf,initial:Ce},{key:"CAN_BUILD_BAZOOKA_RESEARCH",type:Jn,label:"Bazooka Research",icon:2,image:Je,parent:di,initial:ur},{key:"CAN_BUILD_BAZOOKA_FACTORY",type:nx,label:"Bazooka Factory",icon:2,image:Xe,parent:Jn,initial:Ce},{key:"CAN_BUILD_TURRET_RESEARCH",type:Qn,label:"Turret Research",icon:9,image:Je,parent:di,initial:ur},{key:"CAN_BUILD_TURRET_FACTORY",type:sx,label:"Turret Factory",icon:9,image:Xe,parent:Qn,initial:Ce},{key:"CAN_BUILD_CLOAK_RESEARCH",type:es,label:"Cloak Research",icon:1,image:Je,parent:Jn,initial:Ce},{key:"CAN_BUILD_CLOAK_FACTORY",type:ox,label:"Cloak Factory",icon:1,image:Xe,parent:es,initial:Ce},{key:"CAN_BUILD_MEDKIT_RESEARCH",type:Ba,label:"MedKit Research",icon:3,image:Je,parent:Jn,initial:Ce},{key:"CAN_BUILD_MEDKIT_FACTORY",type:ax,label:"MedKit Factory",icon:3,image:Xe,parent:Ba,initial:Ce},{key:"CAN_BUILD_PLASMA_RESEARCH",type:ts,label:"Plasma Turret Research",icon:10,image:Je,parent:Qn,initial:Ce},{key:"CAN_BUILD_PLASMA_FACTORY",type:lx,label:"Plasma Turret Factory",icon:10,image:Xe,parent:ts,initial:Ce},{key:"CAN_BUILD_MINE_RESEARCH",type:Da,label:"Mine Research",icon:5,image:Je,parent:Qn,initial:Ce},{key:"CAN_BUILD_MINE_FACTORY",type:ux,label:"Mine Factory",icon:5,image:Xe,parent:Da,initial:Ce},{key:"CAN_BUILD_ORB_RESEARCH",type:ka,label:"Orb Research",icon:6,image:Je,parent:es,initial:Ce},{key:"CAN_BUILD_ORB_FACTORY",type:cx,label:"Orb Factory",icon:6,image:Xe,parent:ka,initial:Ce},{key:"CAN_BUILD_BOMB_RESEARCH",type:Df,label:"Time Bomb Research",icon:4,image:Je,parent:es,initial:Ce},{key:"CAN_BUILD_BOMB_FACTORY",type:hx,label:"Time Bomb Factory",icon:4,image:Xe,parent:Df,initial:Ce},{key:"CAN_BUILD_SLEEPER_RESEARCH",type:kf,label:"Sleeper Research",icon:8,image:Je,parent:ts,initial:Ce},{key:"CAN_BUILD_SLEEPER_FACTORY",type:fx,label:"Sleeper Factory",icon:8,image:Xe,parent:kf,initial:Ce},{key:"CAN_BUILD_WALL_RESEARCH",type:Uf,label:"Wall Research",icon:11,image:Je,parent:ts,initial:Ce},{key:"CAN_BUILD_WALL_FACTORY",type:dx,label:"Wall Factory",icon:11,image:Xe,parent:Uf,initial:Ce},{key:"CAN_BUILD_DFG_RESEARCH",type:Xf,label:"DFG Research",icon:8,image:Je,parent:Da,initial:Ce},{key:"CAN_BUILD_DFG_FACTORY",type:px,label:"DFG Factory",icon:8,image:Xe,parent:Xf,initial:Ce},{key:"CAN_BUILD_FLARE_RESEARCH",type:Hf,label:"Flare Gun Research",icon:7,image:Je,parent:ka,initial:Ce},{key:"CAN_BUILD_FLARE_FACTORY",type:yx,label:"Flare Gun Factory",icon:7,image:Xe,parent:Hf,initial:Ce}],vx=Qs.map(i=>({id:i.type,parentid:i.parent??0})),cr=Qs.reduce((i,t)=>(i[t.key]={ICON:t.icon,IMAGE:t.image,TYPE:t.type,LABEL:t.label},i),{}),gx=Object.freeze(Qs.reduce((i,t)=>(i[t.key]=t.initial??Ce,i),{})),Oi={0:{name:"Balkh",tileX:415,tileY:479},1:{name:"Iqaluit",tileX:351,tileY:479},2:{name:"Reykjavik",tileX:287,tileY:479},3:{name:"Jumarity",tileX:223,tileY:479},4:{name:"Helsinki",tileX:159,tileY:479},5:{name:"Copenhagen",tileX:95,tileY:479},6:{name:"Kiev",tileX:31,tileY:479},7:{name:"Barentsburg",tileX:479,tileY:478},8:{name:"Nunivak",tileX:415,tileY:415},9:{name:"Algiers",tileX:351,tileY:415},10:{name:"Paga Pago",tileX:287,tileY:415},11:{name:"St. Johns",tileX:223,tileY:415},12:{name:"Parana",tileX:159,tileY:415},13:{name:"San Salvador de Jujuy",tileX:95,tileY:415},14:{name:"Tallinn",tileX:31,tileY:415},15:{name:"Bergen",tileX:479,tileY:414},16:{name:"Bangui",tileX:415,tileY:351},17:{name:"Annaba",tileX:351,tileY:351},18:{name:"Andorra-la-Vella",tileX:287,tileY:351},19:{name:"Bahia Blanca",tileX:223,tileY:351},20:{name:"Posadas",tileX:159,tileY:351},21:{name:"Santa Fe",tileX:95,tileY:351},22:{name:"Buckland",tileX:31,tileY:351},23:{name:"Kabul",tileX:479,tileY:350},24:{name:"Lahij",tileX:415,tileY:287},25:{name:"Banta",tileX:351,tileY:287},26:{name:"Benguela",tileX:287,tileY:287},27:{name:"Buenos Aires",tileX:223,tileY:287},28:{name:"Resistencia",tileX:159,tileY:287},29:{name:"Santiago del Estero",tileX:95,tileY:287},30:{name:"Armidale",tileX:31,tileY:287},31:{name:"Harbin",tileX:479,tileY:286},32:{name:"Fajardo",tileX:415,tileY:223},33:{name:"Blida",tileX:351,tileY:223},34:{name:"Huambo",tileX:287,tileY:223},35:{name:"Cordoba",tileX:223,tileY:223},36:{name:"Rio Cuarto",tileX:159,tileY:223},37:{name:"Kumayari",tileX:95,tileY:223},38:{name:"Kuala Lumpur",tileX:31,tileY:223},39:{name:"Mango",tileX:479,tileY:222},40:{name:"Arequipa",tileX:415,tileY:159},41:{name:"Constantine",tileX:351,tileY:159},42:{name:"Luanda",tileX:287,tileY:159},43:{name:"Corrientes",tileX:223,tileY:159},44:{name:"Rosario",tileX:159,tileY:159},45:{name:"Kirovakan",tileX:95,tileY:159},46:{name:"Jakarta",tileX:31,tileY:159},47:{name:"Skopje",tileX:479,tileY:158},48:{name:"Bogota",tileX:415,tileY:95},49:{name:"Canberra",tileX:351,tileY:95},50:{name:"Pretoria",tileX:287,tileY:95},51:{name:"Maracay",tileX:223,tileY:95},52:{name:"Cambridge",tileX:159,tileY:95},53:{name:"Laketown",tileX:95,tileY:95},54:{name:"Hanoi",tileX:31,tileY:95},55:{name:"Bishkek",tileX:479,tileY:94},56:{name:"Tirana",tileX:479,tileY:31},57:{name:"Dakar",tileX:415,tileY:31},58:{name:"Aquin",tileX:351,tileY:31},59:{name:"Bismarck",tileX:287,tileY:31},60:{name:"Albany",tileX:223,tileY:31},61:{name:"Manukau",tileX:159,tileY:31},62:{name:"Utrecht",tileX:95,tileY:31},63:{name:"Admin Inn",tileX:31,tileY:31}},rn=48,bx=3,_x=2,xx=rn/2,wx=48,zf=wx/2,Tx=6.5,Ix=5.5,om=i=>{if(i==null)return null;const t=Number(i);return Number.isFinite(t)?String(Math.max(0,Math.floor(t))):null},Ex=i=>{if(!i||typeof i!="object")return null;const t=Number(i.pixelX),e=Number(i.pixelY),r=Number(i.tileX),n=Number(i.tileY),s=Number.isFinite(t),o=Number.isFinite(e),a=Number.isFinite(r),l=Number.isFinite(n);if(s&&o)return{x:t,y:e,tileX:a?r:null,tileY:l?n:null};if(a&&l){const u=r*rn,c=n*rn,h=u+bx*rn/2,f=c+_x*rn+xx;return{x:h-zf-Tx,y:f-zf-Ix,tileX:r,tileY:n}}return{x:0,y:0,tileX:a?r:null,tileY:l?n:null}},eo=i=>{const t=om(i);if(t===null)return null;const e=Oi?.[t],r=Ex(e);if(!r)return null;const n=e?.name||`City ${Number(t)+1}`;return{...r,name:n}},Ae=i=>{const t=om(i);if(t!==null){const r=Oi?.[t];if(r?.name)return r.name}const e=Number(i);return Number.isFinite(e)?`City ${Math.max(1,Math.floor(e)+1)}`:"City"},Sx=(i,t,e=3)=>{const r=Number(i),n=Number(t);if(!Number.isFinite(r)||!Number.isFinite(n))return null;let s=null,o=1/0;if(Object.keys(Oi||{}).forEach(l=>{const u=Oi[l];if(!u)return;const c=Number(u.tileX),h=Number(u.tileY);if(!Number.isFinite(c)||!Number.isFinite(h))return;const f=Math.abs(c-r),d=Math.abs(h-n),p=Math.max(f,d);if(!(p>e)){if(p<o)o=p,s=l;else if(p===o){const v=Number(s),y=Number(l);Number.isFinite(y)&&(!Number.isFinite(v)||y<v)&&(s=l)}}}),s==null)return null;const a=Number(s);return Number.isFinite(a)?a:null};function Cx(i){for(var t=0;t<512;t++){i.map[t]=[];for(var e=0;e<512;e++)i.map[t][e]=0}}function Ax(i){for(var t=0;t<512;t++){i.tiles[t]=[];for(var e=0;e<512;e++)i.tiles[t][e]=0}}function Px(i,t){const r=new Uint8Array(t);for(let n=0;n<512;n++)for(let s=0;s<512;s++){const o=511-n,a=511-s;i.map[n][s]=r[o+a*512]}for(let n=0;n<i.map.length;n++)for(let s=0;s<i.map.length;s++)if(i.map[s][n]===ki){const o=Sx(s,n);i.buildingFactory.newBuilding(null,s,n,Ot,{notifyServer:!1,city:o??0,updateCity:!1,itemsLeft:0})}else if(i.map[s][n]===Yu||i.map[s][n]===Ws){const o=i.map[s][n],a=s===0||i.map[s-1][n]!==o?1:0,l=s===511||i.map[s+1][n]!==o?1:0,u=n===0||i.map[s][n-1]!==o?1:0,c=n===511||i.map[s][n+1]!==o?1:0;i.tiles[s][n]=(a+l*2+c*4+u*8)*48}}const Ox=(i,t)=>{Cx(i),Ax(i),Px(i,t)},Fx=[{cityId:55,name:"Sentinel Anchorage"},{cityId:56,name:"Bastion Ridge"},{cityId:57,name:"Citadel Spire"},{cityId:58,name:"Rampart Cove"},{cityId:59,name:"Bulwark Flats"},{cityId:60,name:"Outrider Yard"}],$f={cities:Fx},Mx=()=>({...gx}),Rx=()=>({canBuild:Mx(),cash:Q_,income:0,itemProduction:0,research:0,hospital:0,construction:0,grossIncome:0});function Lx(i){if(!i||!Array.isArray(i.cities))return;(Array.isArray($f?.cities)?$f.cities:[]).forEach(e=>{const r=Number(e?.cityId);if(!Number.isFinite(r))return;const n=i.cities[r];n&&(e?.name&&(n.name=e.name),n.isFakeCandidate=!0)})}function Nx(i){i.cities=[],Object.keys(Oi||{}).forEach(t=>{const e=Number(t);if(!Number.isFinite(e))return;const r=Oi[t],n=eo(e),s=Rx();s.id=e;const o=Number(r?.tileX),a=Number(r?.tileY),l=Number.isFinite(o)?o:n?.tileX??0,u=Number.isFinite(a)?a:n?.tileY??0;s.tileX=l,s.tileY=u,s.x=l*48,s.y=u*48,s.name=Ae(e),i.cities[e]=s})}const Bx=i=>{Nx(i),Lx(i)},Kt=(i,t)=>{if(!i||!t)return!1;const e=i.x,r=i.y,n=e+i.w,s=r+i.h,o=t.x,a=t.y,l=o+t.w,u=a+t.h;return!(n<=o||l<=e||s<=a||u<=r)},am=i=>i.x<0?Uu:i.x>510*48?Xu:i.y<0?Hu:i.y>510*48?Gu:!1,lm=(i,t)=>{var e=i.itemFactory.getHead();const r=i.player?.city??null;for(;e;){var n={x:e.x,y:e.y,w:48,h:48};if(Kt(t,n)){if(e.type===et&&e.active!==!1){const s=e.teamId??null;if(s===null||s!==r)return i.player.collidedItem=e,Ht}else if(e.type===dt&&e.active!==!1){const s=e.teamId??e.city??null;if(s===null||s!==r)return i.player.collidedItem=e,Ar}else if(e.active!==!1&&e.type!==dt)return lr}e=e.next}return!1},um=(i,t)=>{var e=i.map,r=Math.floor(t.x/48),n=Math.floor((t.x+t.w)/48),s=Math.floor(t.y/48),o=Math.floor((t.y+t.h)/48);if(r&&n&&s&&o)try{if(e[r][s]!=0&&e[r][s]!=3||e[r][o]!=0&&e[r][o]!=3||e[n][s]!=0&&e[n][s]!=3||e[n][o]!=0&&e[n][o]!=3)return lr}catch{console.error("Invalid map reference")}return!1},pr=i=>{var t=8;return{x:parseInt(i.offset.x+t),y:parseInt(i.offset.y+t),w:48-t-t,h:48-t-t}},Ki=48,Dx=i=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const t=Number(i);if(Number.isFinite(t))return t}return NaN},kx=new Set([sm,301]),$u=i=>{const t=i&&typeof i=="object"?i.type:i,e=Dx(t);return Number.isFinite(e)?kx.has(e)?!0:Math.floor(e/100)===Ks&&e>=200&&e<300:!1},Ux=i=>{if(!i)return null;const t=Number.isFinite(i.x)?i.x:parseInt(i.x,10)||0,e=Number.isFinite(i.y)?i.y:parseInt(i.y,10)||0;return{x:t*Ki,y:e*Ki+Ki*2,w:Ki*3,h:Ki}};var Xx=(i,t)=>{for(var e=i.buildingFactory.getHead();e;){var r={x:e.x*48,y:e.y*48,w:144,h:144};const n=Number(e.type),s=Number.isFinite(n)?Math.floor(n/100):NaN;if((n===Ot||s===Xe||$u(n))&&(r.h=Math.max(0,r.h-48)),Kt(t,r))return lr;e=e.next}return!1};const Hx=i=>{var t=pr(i.player);i.player.collidedItem=null;var e=am(t);return e||(e=um(i,t)),e||(e=Xx(i,t)),e||(e=lm(i,t)),e},Ua=()=>typeof window<"u",ni=(i,t=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const e=Number(i);if(Number.isFinite(e))return e}return t},he={LASER:"laser",ROCKET:"rocket",TURRET:"turret",FLARE:"flare",ENGINE:"engine",EXPLOSION:"explosion",BUILD:"build",DEMOLISH:"demolish",HIT:"hit",DIE:"die",BUZZ:"buzz",CLICK:"click",SCREECH:"screech",CLOAK:"cloak",FIRE:"fire"},Gx={[he.LASER]:{src:new URL("/wav/laser.wav",import.meta.url).href,volume:.58,maxDistance:2e3,spatial:!0},[he.ROCKET]:{src:new URL("/wav/bturr.wav",import.meta.url).href,volume:.68,maxDistance:2100,spatial:!0},[he.TURRET]:{src:new URL("/wav/turretfire.wav",import.meta.url).href,volume:.62,maxDistance:1900,spatial:!0},[he.FLARE]:{src:new URL("/flare.wav",import.meta.url).href,volume:.55,maxDistance:1900,spatial:!0},[he.ENGINE]:{src:new URL("/wav/engine.wav",import.meta.url).href,volume:.3,loop:!0,spatial:!1},[he.EXPLOSION]:{src:new URL("/wav/explode.wav",import.meta.url).href,volume:.7,maxDistance:2400,spatial:!0},[he.BUILD]:{src:new URL("/wav/build.wav",import.meta.url).href,volume:.55,maxDistance:1400,spatial:!0},[he.DEMOLISH]:{src:new URL("/wav/demo.wav",import.meta.url).href,volume:.65,maxDistance:1800,spatial:!0},[he.HIT]:{src:new URL("/wav/hit.wav",import.meta.url).href,volume:.7,spatial:!1},[he.DIE]:{src:new URL("/wav/die.wav",import.meta.url).href,volume:.75,spatial:!1},[he.BUZZ]:{src:new URL("/wav/buzz.wav",import.meta.url).href,volume:.5,spatial:!1},[he.CLICK]:{src:new URL("/wav/click.wav",import.meta.url).href,volume:.5,spatial:!1},[he.SCREECH]:{src:new URL("/wav/screech.wav",import.meta.url).href,volume:.7,spatial:!1},[he.CLOAK]:{src:new URL("/cloak.wav",import.meta.url).href,volume:.6,spatial:!1},[he.FIRE]:{src:new URL("/wav/fire.wav",import.meta.url).href,volume:.55,maxDistance:1600,spatial:!0}},Yx=2400,Vf=.001,rs=(i,t,e)=>Math.max(t,Math.min(e,i));class zx{constructor(t={}){this.enabled=t.enabled!==void 0?!!t.enabled:!0,this.defaultMaxDistance=ni(t.defaultMaxDistance,Yx),this.definitions=t.definitions||Gx,this.buffers=new Map,this.loading=new Map,this.loopSources=new Map,this.listenerPosition={x:0,y:0},this.pendingQueue=[],this.unlockBound=!1,this.context=null}isSupported(){return!(!Ua()||typeof window.AudioContext>"u"&&typeof window.webkitAudioContext>"u")}getContext(){if(!this.enabled)return null;if(!this.isSupported())return this.enabled=!1,null;if(this.context)return this.context;const t=window.AudioContext||window.webkitAudioContext;return t?(this.context=new t,this.context):(this.enabled=!1,null)}async resumeContext(){const t=this.getContext();if(!t)return!1;if(t.state==="suspended")try{await t.resume()}catch(e){return console.warn("Unable to resume audio context",e),!1}return t.state==="running"}enqueuePlayback(t){typeof t=="function"&&(this.pendingQueue.push(t),this.bindGestureUnlock())}flushQueue(){if(!this.pendingQueue.length)return;this.pendingQueue.splice(0,this.pendingQueue.length).forEach(e=>{try{e()}catch(r){console.warn("Deferred audio callback failed",r)}})}bindGestureUnlock(){if(!Ua()||this.unlockBound)return;const t=async()=>{await this.resumeContext(),this.flushQueue()},e=async r=>{try{await t(r)}finally{this.unbindGestureUnlock()}};this.unlockBound=!0,this.unlockHandler=e,["pointerdown","touchstart","keydown"].forEach(r=>{window.addEventListener(r,e,{once:!0,passive:!0})})}unbindGestureUnlock(){if(!Ua()||!this.unlockBound||!this.unlockHandler){this.unlockBound=!1,this.unlockHandler=null;return}["pointerdown","touchstart","keydown"].forEach(t=>{window.removeEventListener(t,this.unlockHandler)}),this.unlockBound=!1,this.unlockHandler=null}async preloadAll(){const t=Object.entries(this.definitions);await Promise.all(t.map(([e,r])=>this.loadDefinition(e,r)))}async loadDefinition(t,e){if(!this.enabled)return null;if(this.buffers.has(t))return this.buffers.get(t);if(!e||!e.src)return null;if(this.loading.has(t))return this.loading.get(t);const r=this.fetchAndDecode(e.src).then(n=>(n&&this.buffers.set(t,n),n)).finally(()=>{this.loading.delete(t)});return this.loading.set(t,r),r}async fetchAndDecode(t){try{const e=this.getContext();if(!e)return null;const r=await fetch(t);if(!r.ok)throw new Error(`Failed to fetch audio: ${r.status}`);const n=await r.arrayBuffer();return await e.decodeAudioData(n)}catch(e){return console.warn("Failed to load audio asset",t,e),null}}setListenerPosition(t,e){this.listenerPosition={x:ni(t,this.listenerPosition.x),y:ni(e,this.listenerPosition.y)}}calculateSpatialParams(t,e,r={}){const n=this.definitions[t]||{};if(!(r.spatial??n.spatial??!1)||!e)return{volume:r.volume??n.volume??1,pan:0};const o=this.listenerPosition||{x:0,y:0},a=ni(e.x,0)-o.x,l=ni(e.y,0)-o.y,u=Math.sqrt(a*a+l*l),c=ni(r.maxDistance,n.maxDistance??this.defaultMaxDistance);if(c<=0)return{volume:0,pan:0};const f=1-rs(u/c,0,1),d=r.volume??n.volume??1,p=rs(d*(f*f),0,d),v=rs(a/c,-1,1);return{volume:p,pan:v}}buildNodeGraph(t,e,r){const n=t.createGain();if(n.gain.value=Math.max(r.volume,Vf),t.createStereoPanner){const s=t.createStereoPanner();s.pan.value=rs(r.pan??0,-1,1),e.connect(s),s.connect(n)}else e.connect(n);return n.connect(t.destination),n}playEffect(t,e={}){if(!this.enabled)return null;const r=this.definitions[t];if(!r)return null;const n=this.getContext();if(!n)return null;const s=()=>{const a=this.buffers.get(t);if(!a)return null;const l=n.createBufferSource();l.buffer=a,l.loop=!!(e.loop||r.loop);const u=this.calculateSpatialParams(t,e.position,e);if(u.volume=e.volume??u.volume??r.volume??1,u.volume<=Vf)return null;const c=this.buildNodeGraph(n,l,u);return l.start(0),l.loop?this.loopSources.set(t,{source:l,gainNode:c,options:{...e}}):l.onended=()=>{this.loopSources.get(t)?.source===l&&this.loopSources.delete(t)},l};return n.state==="suspended"?(this.enqueuePlayback(()=>this.playEffect(t,e)),null):this.buffers.get(t)?s():(this.loadDefinition(t,r).then(()=>{s()}),null)}stopEffect(t){const e=this.loopSources.get(t);if(e){try{e.source.stop()}catch(r){console.debug("Failed stopping loop",t,r)}this.loopSources.delete(t)}}setLoopState(t,e,r={}){return e?this.loopSources.has(t)?this.loopSources.get(t).source:this.playEffect(t,{...r,loop:!0,spatial:!1}):(this.stopEffect(t),null)}}const $x={},Vx=i=>{if(i==null)return!1;if(typeof i=="boolean")return i;if(typeof i=="number")return i!==0;if(typeof i=="string"){const t=i.trim().toLowerCase();return t?t==="1"||t==="true"||t==="yes"||t==="on":!1}return!1},qx=typeof import.meta<"u"&&$x?void 0:null,jx=typeof globalThis<"u"&&globalThis.__BC_PROFILE_COLLISIONS__||!1,gn=Vx(qx)||!!jx,Wx=5e3,Me={totalCalls:0,totalTime:0,contexts:new Map,lastLog:0},Kx=(i,t)=>{Me.totalCalls+=1,Me.totalTime+=t;const e=Me.contexts.get(i)||{calls:0,time:0};e.calls+=1,e.time+=t,Me.contexts.set(i,e)},qf=i=>Number.isFinite(i)?i.toFixed(2):"0.00",cm=()=>{if(!gn||typeof performance>"u")return;const i=performance.now();if(Me.lastLog&&i-Me.lastLog<Wx||(Me.lastLog=i,Me.totalCalls===0))return;const t=Me.totalTime/Me.totalCalls,e=[`calls=${Me.totalCalls}`,`avg=${qf(t)}ms`];Array.from(Me.contexts.entries()).sort((n,s)=>s[1].time-n[1].time).slice(0,3).forEach(([n,s])=>{const o=s.time/s.calls;e.push(`${n}: ${s.calls} calls @ ${qf(o)}ms`)}),console.debug(`[collision] ${e.join(" | ")}`)},Zx=(i,t)=>{if(!gn||typeof performance>"u")return t();const e=performance.now(),r=t(),n=performance.now()-e;return Kx(i||"collision",n),cm(),r},Jx={enabled:gn,getStats(){if(!gn)return null;const i=Array.from(Me.contexts.entries()).map(([t,e])=>({label:t,calls:e.calls,totalTime:e.time,averageTime:e.time/e.calls}));return{totalCalls:Me.totalCalls,totalTime:Me.totalTime,averageTime:Me.totalCalls?Me.totalTime/Me.totalCalls:0,contexts:i}},reset(){Me.totalCalls=0,Me.totalTime=0,Me.contexts.clear(),Me.lastLog=0},logNow:cm};gn&&typeof globalThis<"u"&&(globalThis.collisionProfiler=Jx);const or=48,hm=12,Qx=150,ew=2,tw=new Set([lr,Uu,Xu,Hu,Gu]),fm=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},{dx:1,dy:1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:-1,dy:-1}],jf=6,rw=96,is=20,Yl=32,iw=Array.from({length:Yl},(i,t)=>{const e=-t/16*Math.PI;return{sin:Math.sin(e),cos:Math.cos(e)}}),nw=i=>{if(!Number.isFinite(i))return 0;let t=Math.round(i)%Yl;return t<0&&(t+=Yl),t},sw=i=>iw[nw(i)],Wf=i=>i>is?is:i<-is?-is:i,ar=(i,t,{cacheResult:e=!1}={})=>{const r=Zx(t,()=>Hx(i));return e&&i?.player&&(i.player.lastCollisionCode=r,i.player.lastCollisionFrame=i._frameId||0),r},Mt=i=>{!i||!i.player||(i.player.lastSafeOffset={x:i.player.offset.x,y:i.player.offset.y})},ow=i=>{if(!i||!i.player||!i.buildingFactory||typeof i.buildingFactory.findBuildingAtTile!="function")return;const t=pr(i.player),e=t.x+t.w/2,r=t.y+t.h/2,n=Math.floor(e/or),s=Math.floor(r/or),o=i.buildingFactory.findBuildingAtTile(n,s);if(!$u(o))return;const a=Ux(o);if(!a||!Kt(t,a)||!Number.isFinite(i.player.health)||i.player.health>=Pi)return;const l=i.tick||Date.now(),u=Number.isFinite(i.player.lastHospitalHealAt)?i.player.lastHospitalHealAt:0;if(l<u+Qx)return;const c=i.player.health;i.player.health=Math.min(Pi,c+ew),i.player.lastHospitalHealAt=l,i.player.health!==c&&(i.forceDraw=!0)},Pr=i=>tw.has(i),Or=(i,t)=>{t&&(i.itemFactory.triggerMine(t),i.forceDraw=!0,i.player.collidedItem=null)},li=(i,t)=>{t&&(typeof i.itemFactory?.triggerDFG=="function"&&i.itemFactory.triggerDFG(t),i.player.collidedItem=null)};var aw=i=>{i.tick>i.player.timeTurn&&(i.player.direction+=i.player.isTurning,i.player.direction<0&&(i.player.direction=31),i.player.direction>31&&(i.player.direction=0),i.player.timeTurn=i.tick+50)},lw=i=>{i.player.offset.x,i.player.offset.y;const t=sw(i.player.direction),e=i.player.isMoving*(i.timePassed*im),r=(o,a,l,u)=>{const c=i.player.offset[o];switch(i.player.offset[o]+=a,ar(i,`move:${o}`)){case l:i.player.offset[o]=0;break;case u:i.player.offset[o]=511*48;break;case lr:i.player.offset[o]=c;break;case Ht:Or(i,i.player.collidedItem);break;case Ar:li(i,i.player.collidedItem);break}},n=Wf(t.sin*e);r("x",n,Uu,Xu);const s=Wf(t.cos*e);r("y",s,Hu,Gu),i&&i.debug&&i.debug.logMovement};const uw=(i,t)=>{for(let e=jf;e<=rw;e+=jf)for(const r of fm){const n=t.x+r.dx*e,s=t.y+r.dy*e;i.player.offset.x=n,i.player.offset.y=s;const o=ar(i,"unstick:probe");if(o===Ht)return Or(i,i.player.collidedItem),Mt(i),!0;if(!Pr(o))return Mt(i),!0}return!1},Kf=(i,t,e=hm)=>{if(!i||!i.player||!Array.isArray(i.map))return null;const r=i.map.length,n=r>0&&Array.isArray(i.map[0])?i.map[0].length:0;if(r===0||n===0)return null;const s=Math.floor((t.x+or/2)/or),o=Math.floor((t.y+or/2)/or),a=[{x:s,y:o,distance:0}];let l=0;const u=new Set,c={x:i.player.offset.x,y:i.player.offset.y},h=i.player.collidedItem;for(;l<a.length;){const f=a[l++],d=`${f.x},${f.y}`;if(u.has(d)||(u.add(d),f.distance>e)||f.x<0||f.y<0||f.x>=r||f.y>=n)continue;const p={x:f.x*or,y:f.y*or};i.player.offset.x=p.x,i.player.offset.y=p.y;const v=ar(i,"unstick:bfs"),y=i.player.collidedItem;if(i.player.offset.x=c.x,i.player.offset.y=c.y,i.player.collidedItem=h,v!==Ht){if(!Pr(v))return{offset:p,collision:v,collidedItem:y}}fm.forEach(({dx:g,dy:E})=>{const T={x:f.x+g,y:f.y+E,distance:f.distance+1},R=`${T.x},${T.y}`;u.has(R)||a.push(T)})}return null},cw=i=>{if(!i||!i.player)return;const t=eo(i.player.city);if(t){i.player.offset.x=t.x,i.player.offset.y=t.y;return}const e=i.cities?.[i.player.city];if(e){i.player.offset.x=e.x+48,i.player.offset.y=e.y+100;return}i.player.offset.x=0,i.player.offset.y=0},hw=i=>{if(!i||!i.player)return;const t=ar(i,"ensure:initial");if(t===Ht){Or(i,i.player.collidedItem);return}if(t===Ar){li(i,i.player.collidedItem);return}if(!Pr(t)){Mt(i);return}const e={x:i.player.offset.x,y:i.player.offset.y},r=i.player.lastSafeOffset?{...i.player.lastSafeOffset}:null;if(uw(i,e))return;const n=Kf(i,e);if(n){i.player.offset.x=n.offset.x,i.player.offset.y=n.offset.y;const a=ar(i,"unstick:nearest_result");if(a===Ht){Or(i,i.player.collidedItem);return}if(a===Ar){li(i,i.player.collidedItem);return}if(!Pr(a)){Mt(i);return}}if(r&&(r.x!==e.x||r.y!==e.y)){i.player.offset.x=r.x,i.player.offset.y=r.y;const a=ar(i,"unstick:fallback");if(a===Ht){Or(i,i.player.collidedItem),Mt(i);return}if(a===Ar){li(i,i.player.collidedItem),Mt(i);return}if(!Pr(a)){Mt(i);return}}i.player.offset.x=e.x,i.player.offset.y=e.y,cw(i);const s=ar(i,"respawn:initial");if(s===Ht){Or(i,i.player.collidedItem);return}if(s===Ar){li(i,i.player.collidedItem);return}if(!Pr(s)){Mt(i);return}const o=Kf(i,i.player.offset,hm*2);if(o){i.player.offset.x=o.offset.x,i.player.offset.y=o.offset.y;const a=ar(i,"respawn:post");if(a===Ht){Or(i,i.player.collidedItem);return}if(a===Ar){li(i,i.player.collidedItem);return}if(!Pr(a)){Mt(i);return}}dm(i)};var dm=i=>{i.player.offset.x=0,i.player.offset.y=0,i.player.engineLoopActive&&(i.player.engineLoopActive=!1),i.audio&&i.audio.setLoopState(he.ENGINE,!1),Mt(i)};const fw=i=>{const t=i.tick||Date.now();i.player.isCloaked&&i.player.cloakExpiresAt&&t>=i.player.cloakExpiresAt&&(i.player.isCloaked=!1,i.player.cloakExpiresAt=0,i.forceDraw=!0);let e=!1;if(i.player.isFrozen&&(!i.player.frozenUntil||t>=i.player.frozenUntil?(i.player.isFrozen=!1,i.player.frozenUntil=0,i.player.frozenBy=null):e=!0),i.player.isTurning&&aw(i),!e&&i.player.isMoving?lw(i):e&&(i.player.isMoving=0),ow(i),e||hw(i),i&&i.audio&&i.player&&Number.isFinite(i.player.offset?.x)&&Number.isFinite(i.player.offset?.y)){const r=i.player.offset.x+24,n=i.player.offset.y+24;i.audio.setListenerPosition(r,n);const s=!e&&!!i.player.isMoving&&i.player.health>0;s&&!i.player.engineLoopActive?(i.audio.setLoopState(he.ENGINE,!0,{volume:.3}),i.player.engineLoopActive=!0):(!s||i.player.health<=0)&&i.player.engineLoopActive&&(i.audio.setLoopState(he.ENGINE,!1),i.player.engineLoopActive=!1)}i.player.health===0&&dm(i)},ns=[{x:0,y:-23.45},{x:4.272478,y:-21.479198},{x:8.495572,y:-20.510126},{x:10.472499,y:-15.673202},{x:13.470384,y:-13.470384},{x:14.467571,y:-9.666922},{x:16.49125,y:-6.830899},{x:15.496407,y:-3.082427},{x:16.45,y:0},{x:14.466583,y:2.877582},{x:14.458715,y:5.988996},{x:12.472044,y:8.333553},{x:10.46518,y:10.46518},{x:7.666869,y:11.474281},{x:5.166226,y:12.472374},{x:2.682492,y:13.485798},{x:0,y:13.45},{x:-2.682492,y:13.485798},{x:-5.491507,y:13.257671},{x:-8.333553,y:12.472044},{x:-10.46518,y:10.46518},{x:-14.176557,y:9.472472},{x:-15.474982,y:6.409947},{x:-17.556057,y:3.492117},{x:-17.45,y:0},{x:-21.479198,y:-4.272478},{x:-17.461323,y:-7.232717},{x:-20.163138,y:-13.472578},{x:-14.495689,y:-14.495689},{x:-13.694806,y:-20.495726},{x:-8.89739,y:-21.480199},{x:-4.672413,y:-23.489807}],Xa=[{x:0,y:-23.45},{x:8.495572,y:-20.510126},{x:13.470384,y:-13.470384},{x:16.49125,y:-6.830899},{x:16.45,y:0},{x:14.458715,y:5.988996},{x:10.46518,y:10.46518},{x:5.166226,y:12.472374},{x:0,y:13.45},{x:-5.491507,y:13.257671},{x:-10.46518,y:10.46518},{x:-15.474982,y:6.409947},{x:-17.45,y:0},{x:-17.461323,y:-7.232717},{x:-14.495689,y:-14.495689},{x:-8.89739,y:-21.480199}],Zf=32,Jf=24,Cr=i=>{if(!Number.isFinite(i))return 0;const e=Math.round(i)%Zf;return e<0?e+Zf:e},Qf=(i,t,e={})=>{const r=Cr(t);if(!i)return{x:0,y:0,direction:r};const n=(Number(i.x)||0)+Jf,s=(Number(i.y)||0)+Jf,o=r%ns.length,a=Math.floor(o),l=(a+1)%ns.length,u=o-a,c=ns[a],h=ns[l],f={x:(c?.x??0)*(1-u)+(h?.x??0)*u,y:(c?.y??0)*(1-u)+(h?.y??0)*u},d=Number.isFinite(e.frameIndex)?Math.max(0,Math.min(Xa.length-1,Math.floor(e.frameIndex))):Math.floor(r/2)%Xa.length,p=f||Xa[d]||{x:0,y:-20},v=n+p.x,y=s+p.y,g=Math.hypot(p.x,p.y),E=g>0?p.x/g:0,T=g>0?p.y/g:-1;return{x:v,y,direction:r,vector:{x:E,y:T},frameIndex:d}},Ls=(i,t,e)=>{if(!i||!Array.isArray(i.explosions))return;const r=Number(t),n=Number(e);!Number.isFinite(r)||!Number.isFinite(n)||i.explosions.push({x:r,y:n,frame:0,nextFrameTick:null,variant:"muzzle"})},dw=new Set([tt,pt,et,Ft,xt]);var ss=0;const ed=i=>{if(!i)return!1;const t=i.target;if(!t)return!1;const e=t.tagName?t.tagName.toLowerCase():"";return!!(e==="input"||e==="textarea"||e==="select"||t.isContentEditable)},Ha=(i,t)=>{if(!i||!i.player||i.player.id===void 0||i.player.id===null||!i.iconFactory||typeof i.iconFactory.findOwnedIconByType!="function")return!1;const e=i.iconFactory.findOwnedIconByType(i.player.id,t);if(!e)return!1;if(e.quantity===void 0||e.quantity===null)return!0;const r=Number.isFinite(e.quantity)?e.quantity:parseInt(e.quantity,10);return Number.isFinite(r)?r>0:!0},td=(i,t,e)=>{!i||!i.audio||!t||(e&&Number.isFinite(e.x)&&Number.isFinite(e.y)?i.audio.playEffect(t,{position:e}):i.audio.playEffect(t))};var ht=i=>{var t={};return t.code=i,t.isDown=!1,t.isUp=!0,t.press=void 0,t.release=void 0,t.downHandler=function(e){ed(e)||e.keyCode===t.code&&(t.isUp&&t.press&&t.press(),t.isDown=!0,t.isUp=!1,e.preventDefault())},t.upHandler=function(e){ed(e)||e.keyCode===t.code&&(t.isDown&&t.release&&t.release(),t.isDown=!1,t.isUp=!0,e.preventDefault())},window.addEventListener("keydown",t.downHandler.bind(t),!1),window.addEventListener("keyup",t.upHandler.bind(t),!1),t};const pw=i=>{var t=ht(37),e=ht(38),r=ht(39),n=ht(40),s=ht(16),o=ht(17),a=ht(85),l=ht(68),u=ht(83),c=ht(66),h=ht(72),f=ht(67),d=ht(70);t.press=function(){i.player.isTurning=-1},t.release=function(){i.player.isTurning=0},r.press=function(){i.player.isTurning=1},r.release=function(){i.player.isTurning=0},e.press=function(){i.player.isMoving=-1},e.release=function(){i.player.isMoving=0},n.press=function(){i.player.isMoving=1},n.release=function(){i.player.isMoving=0},a.press=function(){i.iconFactory.pickupIcon()},u.press=function(){console.log("Generating building output"),i.buildingFactory.outputBuildings()},l.press=function(){var p=i.iconFactory.dropSelectedIcon(),v,y,g=-i.player.direction,E=Math.sin(g/16*3.14)*-1,T=Math.cos(g/16*3.14)*-1;if(p&&dw.has(p.type))v=i.player.offset.x+12,y=i.player.offset.y+24;else{var g=-i.player.direction,E=Math.sin(g/16*3.14)*-1,T=Math.cos(g/16*3.14)*-1;v=i.player.offset.x+E*20,y=i.player.offset.y+20+T*20}if(p){var R=i.itemFactory.newItem(p,v,y,p.type);if(R&&(i.player.offset.x+=30,i.player.offset.x+=30),!R){const _=i.iconFactory.newIcon(null,parseInt(v),parseInt(y),p.type,{skipProductionUpdate:!0,teamId:i.player.city??null,city:i.player.city??null,isSharedDrop:!0,synced:!1});_&&i.socketListener&&typeof i.socketListener.dropIcon=="function"&&i.socketListener.dropIcon({id:_.id,type:_.type,x:_.x,y:_.y,cityId:_.city??null,teamId:_.teamId??null,quantity:_.quantity??1})}}},c.press=function(){if(i.iconFactory&&typeof i.iconFactory.getSelectedIcon=="function"){const p=i.iconFactory.getSelectedIcon(i.player.id);if(p&&p.type===Ie){p.armed=!p.armed,p.selected||(p.selected=!0),i.player.bombsArmed=p.armed,i.forceDraw=!0,console.log(`Bombs ${p.armed?"activated":"deactivated"}`);return}}i.player.bombsArmed=!i.player.bombsArmed,console.log(`Bombs ${i.player.bombsArmed?"activated":"deactivated"}`)},h.press=function(){!i?.itemFactory||typeof i.itemFactory.useMedkit!="function"||i.itemFactory.useMedkit()},f.press=function(){!i?.itemFactory||typeof i.itemFactory.activateCloak!="function"||i.itemFactory.activateCloak()},d.press=function(){typeof i?.toggleFullscreen=="function"&&i.toggleFullscreen()},o.press=function(){if(!Ha(i,Js)||i.tick<=ss||!i||!i.player||i.player.isFrozen&&(i.player.frozenUntil??0)>i.tick)return;const p=Cr(i.player.direction),v=Cr(p+16),y=Cr(p+20),g=Cr(p+12),E=Qf(i.player.offset,v),T=E.x,R=E.y,_=i.player.city??null;ss=i.tick+W_,Ls(i,T,R),[y,v,g].forEach(F=>{const P=Cr(F),H={shooter:i.player.id,x:T,y:R,type:3,angle:-P,team:_};i.bulletFactory.newBullet(i.player.id,T,R,3,-P,_),i.socketListener.sendBulletShot(H)}),td(i,he.FLARE,{x:T,y:R})},s.press=function(){if(i?.player?.isFrozen&&(i.player.frozenUntil??0)>(i.tick||Date.now()))return;const p=Ha(i,Zs),v=Ha(i,zu),y=(i?.player?.isMoving??0)===0,g=p&&y;if(!g&&!v){console.log(p&&!y?"Cougar Missiles only fire while stationary.":"Weapon unavailable: pick up a Laser or Cougar Missile.");return}const E=g?j_:q_,T=g?1:0;if(console.log("shift key pressed"),i.tick>ss){ss=i.tick+E;const R=Cr(i.player.direction),_=Qf(i.player.offset,R),F=-R,P=_.x,H=_.y,M=i.player.city??null;Ls(i,P,H),i.bulletFactory.newBullet(i.player.id,P,H,T,F,M);const N=g?he.ROCKET:he.LASER;td(i,N,{x:P,y:H}),i.socketListener.sendBulletShot({shooter:i.player.id,x:P,y:H,type:T,angle:F,team:M})}}},yw=i=>{let t=new J.Container;t.hitArea=new J.Rectangle(0,0,i.maxMapX,i.maxMapY),t.interactive=!0,t.interactiveChildren=!1,t.cursor="cursor",i.stage.addChild(t),i.interactionLayer=t,t.on("mousedown",e=>{if(console.log("Got mouse down event"),!i?.player?.isMayor){i.notify?i.notify({title:"Construction Restricted",message:"Only mayors can place or demolish city structures.",variant:"warn",timeout:3200}):console.warn("Construction restricted: only mayors may build or demolish."),i.clearGhostBuilding&&i.clearGhostBuilding(),i.showBuildMenu=!1,i.isDemolishing=!1;return}if(i.isBuilding&&i.isDragging){var r=72,n=e.data.global.x-r,s=e.data.global.y-r,o=Math.floor(i.player.offset.x%48),a=Math.floor(i.player.offset.y%48),l=Math.floor((i.player.offset.x-i.player.defaultOffset.x+o+n)/48),u=Math.floor((i.player.offset.y-i.player.defaultOffset.y+a+s)/48);i.buildingFactory.newBuilding(i.player.id,l,u,i.isBuilding)&&(i.map[l][u]=ki,i.tiles[l][u]=i.isBuilding,i.forceDraw=!0,i.clearGhostBuilding&&i.clearGhostBuilding());return}if(i.isDemolishing||(i.showBuildMenu=!i.showBuildMenu,i.forceDraw=!0,i.buildMenuOffset={x:e.data.global.x,y:e.data.global.y}),i.isDemolishing){console.log("Trying to demolish building");var c=Math.floor(i.player.offset.x%48),h=Math.floor(i.player.offset.y%48),f=Math.floor((i.player.offset.x-i.player.defaultOffset.x+c+e.data.global.x)/48),d=Math.floor((i.player.offset.y-i.player.defaultOffset.y+h+e.data.global.y)/48);i.buildingFactory.demolishBuilding(f,d),i.isDemolishing=!1,i.stage.cursor="cursor",i.interactionLayer.cursor="cursor"}}),t.on("rightdown",e=>{e.stopPropagation&&e.stopPropagation(),e.data&&e.data.originalEvent&&e.data.originalEvent.preventDefault&&e.data.originalEvent.preventDefault(),i.isBuilding&&i.clearGhostBuilding&&i.clearGhostBuilding(),i.isDemolishing&&(i.isDemolishing=!1,i.stage.cursor="cursor",i.interactionLayer.cursor="cursor");const r=e&&e.data?e.data.global:null;if(!r){typeof i.clearPanelMessage=="function"&&i.clearPanelMessage();return}if(r.x<0||r.y<0||r.x>i.maxMapX||r.y>i.maxMapY){typeof i.clearPanelMessage=="function"&&i.clearPanelMessage();return}const n=Math.floor(i.player.offset.x%48),s=Math.floor(i.player.offset.y%48),o=Math.floor((i.player.offset.x-i.player.defaultOffset.x+n+r.x)/48),a=Math.floor((i.player.offset.y-i.player.defaultOffset.y+s+r.y)/48),l=i.buildingFactory,u=l&&l.findBuildingAtTile?l.findBuildingAtTile(o,a):null;if(!u){typeof i.clearPanelMessage=="function"&&i.clearPanelMessage();return}const c=Number.isFinite(u.city)?u.city:parseInt(u.city,10),h=Number.isFinite(c)?c:0;i.socketListener&&typeof i.socketListener.requestCityInfo=="function"&&i.socketListener.requestCityInfo(h),typeof i.showCityInfo=="function"&&i.showCityInfo(h,{source:"local",building:u})}),typeof window<"u"&&(window.__battlecityContextMenuHandler||(window.__battlecityContextMenuHandler=e=>{const r=document.getElementById("game");r&&r.contains(e.target)&&e.preventDefault()},window.addEventListener("contextmenu",window.__battlecityContextMenuHandler)))};var rd=0,id=0,nd=0,sd=0;const pm=(i,t)=>{var e=i.player.offset.x%128,r=i.player.offset.y%128;if(i.player.offset.x/128>id||i.player.offset.x/128<rd||i.player.offset.y/128>sd||i.player.offset.y/128<nd){rd=i.player.offset.x/128-5,id=i.player.offset.x/128+5,nd=i.player.offset.y/128-5,sd=i.player.offset.y/128+5,t.clear();for(var n=-12;n<12;n++)for(var s=-12;s<12;s++)t.addFrame(i.textures.groundTexture,n*128,s*128);t.position.set(i.player.defaultOffset.x+i.player.offset.x-e,i.player.defaultOffset.y+i.player.offset.y-r)}t.pivot.set(i.player.offset.x,i.player.offset.y)},zl=0,$l=180,mw=(i=zl,t=$l)=>{const e=Math.max(0,Number.isFinite(i)?i:zl),r=Math.max(e,Number.isFinite(t)?t:$l);return r===0?0:r===e?r:e+Math.floor(Math.random()*(r-e))},to=(i,t={})=>{if(!i||typeof i.destroy!="function")return;const{minDelay:e=zl,maxDelay:r=$l,destroyChildren:n=!1,destroyTexture:s=!1,destroyBaseTexture:o=!1}=t,a=()=>{try{i.destroy({children:n,texture:s,baseTexture:o})}catch{}},l=mw(e,r);if(l<=0||typeof setTimeout!="function"){a();return}setTimeout(a,l)};var ym=0,mm=0,vm=0,gm=0;const de=48,os=24,nn=40,vw=Object.freeze({fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:15922943,align:"center",stroke:0,strokeThickness:4,lineHeight:16,wordWrap:!0,wordWrapWidth:120}),gw=2,bw=-32,od=new Map,Fr=(i,t,e,r,n,s)=>{if(!i)return null;const a=`${i.uid||i.cacheId||"base"}:${t}:${e}:${r}:${n}:${s}`;let l=od.get(a);return l||(l=new J.Texture(i,new J.Rectangle(e,r,n,s)),od.set(a,l)),l},_w=i=>{const t=Number.isFinite(i.player?.offset?.x)?i.player.offset.x:0,e=Number.isFinite(i.player?.offset?.y)?i.player.offset.y:0;return{rawX:t,rawY:e,pixelX:Math.floor(t),pixelY:Math.floor(e)}},ad=(i,t)=>{const e=i%t;return e<0?e+t:e},xw=i=>{if(i.tileLayer||(i.tileLayer=new J.tilemap.CompositeRectTileLayer(0,null,!0),i.addChild(i.tileLayer)),i.edgeOverlay)i.edgeOverlay.parent||i.addChild(i.edgeOverlay);else{const t=new J.Graphics;t.alpha=1,i.edgeOverlay=t,i.addChild(t)}if(!i.commandCenterLabelLayer){const t=new J.Container;t.name="commandCenterLabelLayer",i.commandCenterLabelLayer=t,i.addChild(t)}};var ww=(i,t,e,r,n,s)=>{const o=Fr(i.textures.lavaTexture?.baseTexture,`lava:${i.tiles[n][s]}`,i.tiles[n][s],0,de,de);o&&t.addFrame(o,e*de,r*de)},Tw=(i,t,e,r,n,s)=>{const o=Fr(i.textures.rockTexture?.baseTexture,`rock:${i.tiles[n][s]}`,i.tiles[n][s],0,de,de);o&&t.addFrame(o,e*de,r*de)},Iw=(i,t,e,r,n,s)=>{var o=i.tiles[n][s],a=o%100,l=parseInt(o/100,10);const u=i.buildingFactory.getBuildingByCoord(n,s),c=Fr(i.textures.buildings?.baseTexture,`building:${l}`,0,l*144,144,144);if(!c)return;t.addFrame(c,e*de,r*de,1,0);let h=null;try{h=Fr(i.textures.imageItems?.baseTexture,`buildingOverlay:${a}`,a*32,0,32,32)}catch{h=null}if(h)switch(l){case Je:t.addFrame(h,e*de+14,r*de+98);break;case Xe:t.addFrame(h,e*de+56,r*de+52);break}if(u&&u.population>0&&i.textures.population){const f=de,d=de,v=7-1,y=u?Math.floor(Number(u.type)/100):l,g=y===Gl,E=y===Ot,T=g?tx:rx;if(T>0){const R=Math.max(0,Math.min(T,u.population)),F=Math.min(v,Math.floor(R*v/T)),P=E?1:0,H=Fr(i.textures.population?.baseTexture,`population:${P}:${F}`,F*f,P*d,f,d);if(!H)return;const M={[Ot]:{x:96,y:49},[Xe]:{x:96,y:48},[Ks]:{x:96,y:48},[Gl]:{x:96,y:90},[Je]:{x:96,y:90}},{x:N=96,y:Y=48}=M[y]||M[l]||{x:96,y:48},D=e*de+N,Z=r*de+Y;t.addFrame(H,D,Z)}}if(l===Xe&&u&&u.smokeActive&&i.textures.smoke){const f=Math.max(0,(u.smokeFrame||1)-1),d=Fr(i.textures.smoke?.baseTexture,`smoke:${f}`,0,f*60,180,60);if(d){const p=e*de+6,v=r*de-15;t.addFrame(d,p,v)}}if(l===Xe&&u&&typeof u.itemsLeft=="number"&&i.textures.blackNumbers){const f=Math.max(0,Math.min(99,Math.floor(u.itemsLeft))),d=Math.floor(f/10),p=f%10,v=(y,g)=>{const E=Fr(i.textures.blackNumbers?.baseTexture,`digit:${y}`,y*16,0,16,16);E&&t.addFrame(E,e*de+g,r*de+84)};v(d,56),v(p,72)}};const ld=(i,t=0)=>{const e=Number(i);return Number.isFinite(e)?e:t},Ew=i=>{if(!i||!i.buildingFactory)return;const t=i.commandCenterLabelLayer;if(!t)return;i.commandCenterLabelCache||(i.commandCenterLabelCache=new Map);const e=i.commandCenterLabelCache,r=new Set;let n=typeof i.buildingFactory.getHead=="function"?i.buildingFactory.getHead():null;for(;n;){const s=Number(n.type),o=Number.isFinite(s)?Math.floor(s/100):null;if(s===Ot||o===Ot){const l=n.id||`${n.x}_${n.y}`;r.add(l);const u=ld(n.x,0),c=ld(n.y,0),h=(u+1.5)*de,f=(c+1.5)*de,d=Ae(n.city??0);let p=e.get(l);if(p)p.text!==d&&(p.label.text=d,p.text=d);else{const v=new J.Text(d,vw);v.anchor.set(.5),v.resolution=gw,t.addChild(v),p={label:v,text:d,worldX:h,worldY:f},e.set(l,p)}p.worldX=h,p.worldY=f}n=n.next}e.forEach((s,o)=>{r.has(o)||(s&&s.label&&(s.label.parent&&s.label.parent.removeChild(s.label),to(s.label,{minDelay:16,maxDelay:200})),e.delete(o))})},Sw=(i,t)=>{if(!i?.commandCenterLabelCache)return;const e=i.commandCenterLabelCache,r=nn*de,n=Number.isFinite(i.player?.defaultOffset?.x)?i.player.defaultOffset.x:0,s=Number.isFinite(i.player?.defaultOffset?.y)?i.player.defaultOffset.y:0;e.forEach(o=>{if(!o||!o.label)return;const a=Math.abs(o.worldX-t.rawX)<=r&&Math.abs(o.worldY-t.rawY)<=r;if(o.label.visible=a,a){const l=o.worldX+(n-t.rawX),u=o.worldY+(s-t.rawY)+bw;o.label.x=l,o.label.y=u}})},Cw=i=>{if(!i?.commandCenterLabelCache)return;const t=i.commandCenterLabelCache,e=i.tick||Date.now();t.forEach((r,n)=>{if(!r||!r.label){t.delete(n);return}!r.label.visible&&r.lastHiddenAt&&e-r.lastHiddenAt>1e3?(r.label.parent&&r.label.parent.removeChild(r.label),to(r.label,{minDelay:16,maxDelay:200}),t.delete(n)):r.label.visible?r.lastHiddenAt&&(r.lastHiddenAt=null):r.lastHiddenAt=e})};var Aw=i=>{const t=i.player.offset.x/de,e=i.player.offset.y/de;ym=t-os,mm=t+os,vm=e-os,gm=e+os},Pw=i=>{if(i.forceDraw)return!0;const t=i.player.offset.x/de,e=i.player.offset.y/de;return t>=mm||t<=ym||e>=gm||e<=vm};const bm=(i,t)=>{if(!i||!t||!i.map||!i.map.length)return;xw(t),Ew(i);const e=t.tileLayer,r=t.edgeOverlay;if(!e||!r)return;const n=_w(i);var s=Math.floor(ad(n.pixelX,de)),o=Math.floor(ad(n.pixelY,de));if(Pw(i)){Aw(i),e.clear(),r.clear(),r.beginFill(0,1);for(var a=Math.floor(n.rawX/de),l=Math.floor(n.rawY/de),u=i.map.length,c=Array.isArray(i.map[0])?i.map[0].length:0,h=-nn;h<nn;h++)for(var f=-nn;f<nn;f++){var d=a+h,p=l+f;if(d<0||p<0||d>=u||p>=c){r.drawRect(h*de,f*de,de,de);continue}i.map[d][p]==Yu&&ww(i,e,h,f,d,p),i.map[d][p]==Ws&&Tw(i,e,h,f,d,p),i.map[d][p]>=ki&&Iw(i,e,h,f,d,p)}r.endFill(),t.position.set(i.player.defaultOffset.x+n.pixelX-s,i.player.defaultOffset.y+n.pixelY-o)}t.pivot.set(n.pixelX,n.pixelY),Sw(i,n),Cw(i)},ud={small:{frameSize:48,totalFrames:10,duration:100,textureKey:"imageSExplosion",fallbackKey:"imageLEExplosion"},large:{frameSize:144,totalFrames:8,duration:90,textureKey:"imageLEExplosion",fallbackKey:"imageSExplosion"},muzzle:{frameSize:12,totalFrames:2,duration:45,textureKey:"imageMuzzleFlash",fallbackKey:"imageSExplosion"}},Ow=100,Fw=-6,as=Object.freeze({ally:15922943,enemy:16765286,rogue:16743034,neutral:16777215}),Mw=15e3,Vl=i=>{const t=Number(i);return Number.isFinite(t)?Math.max(0,Math.floor(t)):null},Rw=(i,t)=>{if(!t)return null;if(typeof t.callsign=="string"&&t.callsign.trim().length)return t.callsign.trim();if(t.id&&typeof i?.resolveCallsign=="function"){const e=i.resolveCallsign(t.id);if(typeof e=="string"&&e.trim().length)return e.trim()}return null},Lw=(i,t,e={})=>{const r=Rw(i,t),n=Vl(t?.city),s=Number.isFinite(n)?Ae(n):null,o=e.isRogue===!0||t?.city===-1,a=!!t?.isMayor;let l;o?l="Rogue":a?l="Mayor":l="Recruit";const u=r||"Unit";return o?`${l} ${u}`:s?`${l} ${u} of ${s}`:`${l} ${u}`},Nw=(i,t,e={})=>{if(e.isRogue)return as.rogue;const r=Vl(i?.city),n=Vl(t);return r!==null&&n!==null&&r===n?as.ally:r===null?as.neutral:as.enemy},Bw=i=>i?(i.__nameLabelCache||(i.__nameLabelCache=new Map),i.__nameLabelCache):null,Dw=(i,t={})=>t.cacheKey?t.cacheKey:i&&i.id!==void 0&&i.id!==null?`entity:${i.id}`:i&&i.callsign?`callsign:${i.callsign}`:null,kw=(i,t,e={})=>{const r=Bw(i);if(!r||!t)return null;const n=Dw(t,e);if(!n)return null;const s=Lw(i,t,e);if(!s||!s.trim())return null;const o=Nw(t,e.referenceCity,e);let a=r.get(n);if(a)a.text!==s&&(a.label.text=s,a.text=s),a.fillColor!==o&&(a.label.style.fill=o,a.fillColor=o,a.label.dirty=!0);else{const l=new J.Text(s,{fontFamily:"Arial",fontSize:12,fontWeight:"bold",fill:o,align:"center",stroke:0,strokeThickness:3});l.anchor.set(.5,1),a={label:l,text:s,fillColor:o},r.set(n,a)}return a.lastUsedTick=i.tick||Date.now(),a.label},Vu=(i,t,e,r={})=>{if(!e||!t)return;const n=kw(i,t,r);n&&(n.parent!==e&&e.addChild(n),n.x=e.width/2,n.y=-e.height/2-Fw)},Uw=(i,t)=>{if(!i)return 0;const e=!!i.isMayor;return typeof i.tank=="number"?i.tank:t&&i.id===t.id||(t&&i.city!==void 0?i.city===t.city:!0)?e?1:0:e?3:2},cd=new Map,Xw=(i,t,e)=>{const r=i.textures.tankTexture?.baseTexture;if(!r)return null;const s=`${r.uid||r.cacheId||"tank"}:${t}:${e}`;let o=cd.get(s);return o||(o=new J.Texture(r,new J.Rectangle(e*48,t*48,48,48)),cd.set(s,o)),o},qu=(i,t,e)=>{const r=t?.direction||0,n=Uw(t,e),s=Math.floor(r/2),o=Xw(i,n,s);return o?new J.Sprite(o):new J.Sprite};var Hw=(i,t)=>{var e=qu(i,i.player,i.player);e.x=i.player.defaultOffset.x,e.y=i.player.defaultOffset.y,Vu(i,i.player,e,{referenceCity:i.player.city,cacheKey:"player:self"}),t.addChild(e)},Gw=(i,t)=>{Object.keys(i.otherPlayers).forEach(e=>{var r=i.otherPlayers[e];if(r){if(r.isCloaked){const s=i.player?.id,o=(r.city??null)===(i.player?.city??null);if(e!==s&&!o)return}var n=qu(i,r,i.player);n.x=r.offset.x+(i.player.defaultOffset.x-i.player.offset.x/48*48),n.y=r.offset.y+(i.player.defaultOffset.y-i.player.offset.y/48*48),Vu(i,r,n,{referenceCity:i.player.city,isRogue:r.city===-1,cacheKey:r.id||e}),t.addChild(n)}})};const Yw=(i,t)=>{const e=i.rogueTankManager;!e||!Array.isArray(e.tanks)||e.tanks.length===0||e.tanks.forEach((r,n)=>{if(!r||!r.offset)return;const s=qu(i,r,i.player);s.x=r.offset.x+(i.player.defaultOffset.x-i.player.offset.x/48*48),s.y=r.offset.y+(i.player.defaultOffset.y-i.player.offset.y/48*48),Vu(i,r,s,{isRogue:!0,referenceCity:i.player.city,cacheKey:r.id||`rogue:${n}`}),t.addChild(s)})};var zw=(i,t)=>{for(var e=i.bulletFactory.getHead();e;){var r=i.textures.bulletTexture.clone(),n=e&&Number.isFinite(e.type)?e.type:0;n<0&&(n=0);var s=new J.Rectangle(e.animation*8,n*8,8,8);r.frame=s;var o=new J.Sprite(r);o.x=e.x+(i.player.defaultOffset.x-i.player.offset.x),o.y=e.y+(i.player.defaultOffset.y-i.player.offset.y),e.animation++,e.animation>3&&(e.animation=0),t.addChild(o),e=e.next}};const $w=(i,t)=>{if(!Array.isArray(i.explosions)||i.explosions.length===0)return;const e=i.tick||Date.now();for(let r=i.explosions.length-1;r>=0;r--){const n=i.explosions[r];if(!n){i.explosions.splice(r,1);continue}const s=n.variant||"large",o=ud[s]||ud.large,a=i.textures[o.textureKey]||i.textures[o.fallbackKey];if(!a||!a.baseTexture)continue;const l=o.frameSize,u=o.totalFrames,c=o.duration??Ow,h=Math.max(1,Math.floor(a.baseTexture.width/l)),f=Math.max(1,Math.floor(a.baseTexture.height/l)),d=Math.min(u,h*f);if(d<=0)continue;if(n.nextFrameTick?e>=n.nextFrameTick&&(n.frame=(n.frame||0)+1,n.nextFrameTick=e+c):n.nextFrameTick=e+c,(n.frame||0)>=d){i.explosions.splice(r,1);continue}const p=Math.max(0,n.frame||0),v=new J.Texture(a.baseTexture,new J.Rectangle(p%h*l,Math.floor(p/h)*l,l,l)),y=new J.Sprite(v),g=i.player.defaultOffset.x-i.player.offset.x,E=i.player.defaultOffset.y-i.player.offset.y;y.x=(n.x||0)+g,y.y=(n.y||0)+E,t.addChild(y)}},Vw=i=>{i.objectContainer.removeChildren(),Hw(i,i.objectContainer),Gw(i,i.objectContainer),Yw(i,i.objectContainer),zw(i,i.objectContainer),$w(i,i.objectContainer);const t=i.__nameLabelCache;if(t&&t.size){const e=i.tick||Date.now();for(const[r,n]of t.entries()){if(!n){t.delete(r);continue}const s=n.lastUsedTick||0;e-s<=Mw||(n.label&&(n.label.parent&&n.label.parent.removeChild(n.label),to(n.label,{minDelay:16,maxDelay:200})),t.delete(r))}}},_m={},qw=i=>{console.log("updateBotWaypoints",i),i&&i.id&&(_m[i.id]=i.waypoints)},jw=(i,t)=>{!i||!t||Object.values(_m).forEach(e=>{!e||e.length===0||(t.lineStyle(2,16711680,1),t.moveTo(e[0].x,e[0].y),e.forEach((r,n)=>{n>0&&t.lineTo(r.x,r.y),t.drawCircle(r.x,r.y,5)}))})};var Ww=(i,t)=>Kt(t,pr(i.player))?!0:Object.keys(i.otherPlayers).some(e=>Kt(pr(i.otherPlayers[e]),t)),Kw=(i,t)=>{for(var e=i.buildingFactory.getHead();e;){var r={x:e.x*48,y:e.y*48,w:144,h:144};if(Kt(t,r))return!0;e=e.next}return!1};const Zw=(i,t)=>{var e={x:t.x*48,y:t.y*48,w:140,h:140},r=am(pr(i.player));return r?(console.log("Collided with edges"),r):(r=um(i,e),r?(console.log("Collided with tiles"),r):(r=Kw(i,e),r||(r=Ww(i,e),r)?(console.log("Collided with buildings"),r):(r=lm(i,e),r)))};var xm="1.13.7",hd=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},ro=Array.prototype,ju=Object.prototype,fd=typeof Symbol<"u"?Symbol.prototype:null,Jw=ro.push,Cn=ro.slice,bn=ju.toString,Qw=ju.hasOwnProperty,wm=typeof ArrayBuffer<"u",eT=typeof DataView<"u",tT=Array.isArray,dd=Object.keys,pd=Object.create,yd=wm&&ArrayBuffer.isView,rT=isNaN,iT=isFinite,Tm=!{toString:null}.propertyIsEnumerable("toString"),md=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],nT=Math.pow(2,53)-1;function ot(i,t){return t=t==null?i.length-1:+t,function(){for(var e=Math.max(arguments.length-t,0),r=Array(e),n=0;n<e;n++)r[n]=arguments[n+t];switch(t){case 0:return i.call(this,r);case 1:return i.call(this,arguments[0],r);case 2:return i.call(this,arguments[0],arguments[1],r)}var s=Array(t+1);for(n=0;n<t;n++)s[n]=arguments[n];return s[t]=r,i.apply(this,s)}}function Vr(i){var t=typeof i;return t==="function"||t==="object"&&!!i}function sT(i){return i===null}function Im(i){return i===void 0}function Em(i){return i===!0||i===!1||bn.call(i)==="[object Boolean]"}function oT(i){return!!(i&&i.nodeType===1)}function Ke(i){var t="[object "+i+"]";return function(e){return bn.call(e)===t}}const Wu=Ke("String"),Sm=Ke("Number"),aT=Ke("Date"),lT=Ke("RegExp"),uT=Ke("Error"),Cm=Ke("Symbol"),Am=Ke("ArrayBuffer");var Pm=Ke("Function"),cT=hd.document&&hd.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof cT!="function"&&(Pm=function(i){return typeof i=="function"||!1});const rt=Pm,Om=Ke("Object");var Fm=eT&&(!/\[native code\]/.test(String(DataView))||Om(new DataView(new ArrayBuffer(8)))),Ku=typeof Map<"u"&&Om(new Map),hT=Ke("DataView");function fT(i){return i!=null&&rt(i.getInt8)&&Am(i.buffer)}const Ns=Fm?fT:hT,qr=tT||Ke("Array");function vr(i,t){return i!=null&&Qw.call(i,t)}var ql=Ke("Arguments");(function(){ql(arguments)||(ql=function(i){return vr(i,"callee")})})();const Zu=ql;function dT(i){return!Cm(i)&&iT(i)&&!isNaN(parseFloat(i))}function Mm(i){return Sm(i)&&rT(i)}function Rm(i){return function(){return i}}function Lm(i){return function(t){var e=i(t);return typeof e=="number"&&e>=0&&e<=nT}}function Nm(i){return function(t){return t?.[i]}}const Bs=Nm("byteLength"),pT=Lm(Bs);var yT=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function mT(i){return yd?yd(i)&&!Ns(i):pT(i)&&yT.test(bn.call(i))}const Bm=wm?mT:Rm(!1),at=Nm("length");function vT(i){for(var t={},e=i.length,r=0;r<e;++r)t[i[r]]=!0;return{contains:function(n){return t[n]===!0},push:function(n){return t[n]=!0,i.push(n)}}}function Dm(i,t){t=vT(t);var e=md.length,r=i.constructor,n=rt(r)&&r.prototype||ju,s="constructor";for(vr(i,s)&&!t.contains(s)&&t.push(s);e--;)s=md[e],s in i&&i[s]!==n[s]&&!t.contains(s)&&t.push(s)}function $e(i){if(!Vr(i))return[];if(dd)return dd(i);var t=[];for(var e in i)vr(i,e)&&t.push(e);return Tm&&Dm(i,t),t}function gT(i){if(i==null)return!0;var t=at(i);return typeof t=="number"&&(qr(i)||Wu(i)||Zu(i))?t===0:at($e(i))===0}function km(i,t){var e=$e(t),r=e.length;if(i==null)return!r;for(var n=Object(i),s=0;s<r;s++){var o=e[s];if(t[o]!==n[o]||!(o in n))return!1}return!0}function _e(i){if(i instanceof _e)return i;if(!(this instanceof _e))return new _e(i);this._wrapped=i}_e.VERSION=xm;_e.prototype.value=function(){return this._wrapped};_e.prototype.valueOf=_e.prototype.toJSON=_e.prototype.value;_e.prototype.toString=function(){return String(this._wrapped)};function vd(i){return new Uint8Array(i.buffer||i,i.byteOffset||0,Bs(i))}var gd="[object DataView]";function jl(i,t,e,r){if(i===t)return i!==0||1/i===1/t;if(i==null||t==null)return!1;if(i!==i)return t!==t;var n=typeof i;return n!=="function"&&n!=="object"&&typeof t!="object"?!1:Um(i,t,e,r)}function Um(i,t,e,r){i instanceof _e&&(i=i._wrapped),t instanceof _e&&(t=t._wrapped);var n=bn.call(i);if(n!==bn.call(t))return!1;if(Fm&&n=="[object Object]"&&Ns(i)){if(!Ns(t))return!1;n=gd}switch(n){case"[object RegExp]":case"[object String]":return""+i==""+t;case"[object Number]":return+i!=+i?+t!=+t:+i==0?1/+i===1/t:+i==+t;case"[object Date]":case"[object Boolean]":return+i==+t;case"[object Symbol]":return fd.valueOf.call(i)===fd.valueOf.call(t);case"[object ArrayBuffer]":case gd:return Um(vd(i),vd(t),e,r)}var s=n==="[object Array]";if(!s&&Bm(i)){var o=Bs(i);if(o!==Bs(t))return!1;if(i.buffer===t.buffer&&i.byteOffset===t.byteOffset)return!0;s=!0}if(!s){if(typeof i!="object"||typeof t!="object")return!1;var a=i.constructor,l=t.constructor;if(a!==l&&!(rt(a)&&a instanceof a&&rt(l)&&l instanceof l)&&"constructor"in i&&"constructor"in t)return!1}e=e||[],r=r||[];for(var u=e.length;u--;)if(e[u]===i)return r[u]===t;if(e.push(i),r.push(t),s){if(u=i.length,u!==t.length)return!1;for(;u--;)if(!jl(i[u],t[u],e,r))return!1}else{var c=$e(i),h;if(u=c.length,$e(t).length!==u)return!1;for(;u--;)if(h=c[u],!(vr(t,h)&&jl(i[h],t[h],e,r)))return!1}return e.pop(),r.pop(),!0}function bT(i,t){return jl(i,t)}function An(i){if(!Vr(i))return[];var t=[];for(var e in i)t.push(e);return Tm&&Dm(i,t),t}function Ju(i){var t=at(i);return function(e){if(e==null)return!1;var r=An(e);if(at(r))return!1;for(var n=0;n<t;n++)if(!rt(e[i[n]]))return!1;return i!==Gm||!rt(e[Qu])}}var Qu="forEach",Xm="has",ec=["clear","delete"],Hm=["get",Xm,"set"],_T=ec.concat(Qu,Hm),Gm=ec.concat(Hm),xT=["add"].concat(ec,Qu,Xm);const wT=Ku?Ju(_T):Ke("Map"),TT=Ku?Ju(Gm):Ke("WeakMap"),IT=Ku?Ju(xT):Ke("Set"),ET=Ke("WeakSet");function Ui(i){for(var t=$e(i),e=t.length,r=Array(e),n=0;n<e;n++)r[n]=i[t[n]];return r}function ST(i){for(var t=$e(i),e=t.length,r=Array(e),n=0;n<e;n++)r[n]=[t[n],i[t[n]]];return r}function Ym(i){for(var t={},e=$e(i),r=0,n=e.length;r<n;r++)t[i[e[r]]]=e[r];return t}function Wl(i){var t=[];for(var e in i)rt(i[e])&&t.push(e);return t.sort()}function tc(i,t){return function(e){var r=arguments.length;if(t&&(e=Object(e)),r<2||e==null)return e;for(var n=1;n<r;n++)for(var s=arguments[n],o=i(s),a=o.length,l=0;l<a;l++){var u=o[l];(!t||e[u]===void 0)&&(e[u]=s[u])}return e}}const zm=tc(An),Ds=tc($e),$m=tc(An,!0);function CT(){return function(){}}function Vm(i){if(!Vr(i))return{};if(pd)return pd(i);var t=CT();t.prototype=i;var e=new t;return t.prototype=null,e}function AT(i,t){var e=Vm(i);return t&&Ds(e,t),e}function PT(i){return Vr(i)?qr(i)?i.slice():zm({},i):i}function OT(i,t){return t(i),i}function qm(i){return qr(i)?i:[i]}_e.toPath=qm;function Pn(i){return _e.toPath(i)}function rc(i,t){for(var e=t.length,r=0;r<e;r++){if(i==null)return;i=i[t[r]]}return e?i:void 0}function jm(i,t,e){var r=rc(i,Pn(t));return Im(r)?e:r}function FT(i,t){t=Pn(t);for(var e=t.length,r=0;r<e;r++){var n=t[r];if(!vr(i,n))return!1;i=i[n]}return!!e}function ic(i){return i}function _n(i){return i=Ds({},i),function(t){return km(t,i)}}function nc(i){return i=Pn(i),function(t){return rc(t,i)}}function On(i,t,e){if(t===void 0)return i;switch(e??3){case 1:return function(r){return i.call(t,r)};case 3:return function(r,n,s){return i.call(t,r,n,s)};case 4:return function(r,n,s,o){return i.call(t,r,n,s,o)}}return function(){return i.apply(t,arguments)}}function Wm(i,t,e){return i==null?ic:rt(i)?On(i,t,e):Vr(i)&&!qr(i)?_n(i):nc(i)}function sc(i,t){return Wm(i,t,1/0)}_e.iteratee=sc;function ut(i,t,e){return _e.iteratee!==sc?_e.iteratee(i,t):Wm(i,t,e)}function MT(i,t,e){t=ut(t,e);for(var r=$e(i),n=r.length,s={},o=0;o<n;o++){var a=r[o];s[a]=t(i[a],a,i)}return s}function Km(){}function RT(i){return i==null?Km:function(t){return jm(i,t)}}function LT(i,t,e){var r=Array(Math.max(0,i));t=On(t,e,1);for(var n=0;n<i;n++)r[n]=t(n);return r}function Kl(i,t){return t==null&&(t=i,i=0),i+Math.floor(Math.random()*(t-i+1))}const xn=Date.now||function(){return new Date().getTime()};function Zm(i){var t=function(s){return i[s]},e="(?:"+$e(i).join("|")+")",r=RegExp(e),n=RegExp(e,"g");return function(s){return s=s==null?"":""+s,r.test(s)?s.replace(n,t):s}}const Jm={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},NT=Zm(Jm),BT=Ym(Jm),DT=Zm(BT),kT=_e.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Ga=/(.)^/,UT={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},XT=/\\|'|\r|\n|\u2028|\u2029/g;function HT(i){return"\\"+UT[i]}var GT=/^\s*(\w|\$)+\s*$/;function YT(i,t,e){!t&&e&&(t=e),t=$m({},t,_e.templateSettings);var r=RegExp([(t.escape||Ga).source,(t.interpolate||Ga).source,(t.evaluate||Ga).source].join("|")+"|$","g"),n=0,s="__p+='";i.replace(r,function(u,c,h,f,d){return s+=i.slice(n,d).replace(XT,HT),n=d+u.length,c?s+=`'+
((__t=(`+c+`))==null?'':_.escape(__t))+
'`:h?s+=`'+
((__t=(`+h+`))==null?'':__t)+
'`:f&&(s+=`';
`+f+`
__p+='`),u}),s+=`';
`;var o=t.variable;if(o){if(!GT.test(o))throw new Error("variable is not a bare identifier: "+o)}else s=`with(obj||{}){
`+s+`}
`,o="obj";s=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+s+`return __p;
`;var a;try{a=new Function(o,"_",s)}catch(u){throw u.source=s,u}var l=function(u){return a.call(this,u,_e)};return l.source="function("+o+`){
`+s+"}",l}function zT(i,t,e){t=Pn(t);var r=t.length;if(!r)return rt(e)?e.call(i):e;for(var n=0;n<r;n++){var s=i?.[t[n]];s===void 0&&(s=e,n=r),i=rt(s)?s.call(i):s}return i}var $T=0;function VT(i){var t=++$T+"";return i?i+t:t}function qT(i){var t=_e(i);return t._chain=!0,t}function Qm(i,t,e,r,n){if(!(r instanceof t))return i.apply(e,n);var s=Vm(i.prototype),o=i.apply(s,n);return Vr(o)?o:s}var Xi=ot(function(i,t){var e=Xi.placeholder,r=function(){for(var n=0,s=t.length,o=Array(s),a=0;a<s;a++)o[a]=t[a]===e?arguments[n++]:t[a];for(;n<arguments.length;)o.push(arguments[n++]);return Qm(i,r,this,this,o)};return r});Xi.placeholder=_e;const ev=ot(function(i,t,e){if(!rt(i))throw new TypeError("Bind must be called on a function");var r=ot(function(n){return Qm(i,r,t,this,e.concat(n))});return r}),mt=Lm(at);function jr(i,t,e,r){if(r=r||[],!t&&t!==0)t=1/0;else if(t<=0)return r.concat(i);for(var n=r.length,s=0,o=at(i);s<o;s++){var a=i[s];if(mt(a)&&(qr(a)||Zu(a)))if(t>1)jr(a,t-1,e,r),n=r.length;else for(var l=0,u=a.length;l<u;)r[n++]=a[l++];else e||(r[n++]=a)}return r}const jT=ot(function(i,t){t=jr(t,!1,!1);var e=t.length;if(e<1)throw new Error("bindAll must be passed function names");for(;e--;){var r=t[e];i[r]=ev(i[r],i)}return i});function WT(i,t){var e=function(r){var n=e.cache,s=""+(t?t.apply(this,arguments):r);return vr(n,s)||(n[s]=i.apply(this,arguments)),n[s]};return e.cache={},e}const tv=ot(function(i,t,e){return setTimeout(function(){return i.apply(null,e)},t)}),KT=Xi(tv,_e,1);function ZT(i,t,e){var r,n,s,o,a=0;e||(e={});var l=function(){a=e.leading===!1?0:xn(),r=null,o=i.apply(n,s),r||(n=s=null)},u=function(){var c=xn();!a&&e.leading===!1&&(a=c);var h=t-(c-a);return n=this,s=arguments,h<=0||h>t?(r&&(clearTimeout(r),r=null),a=c,o=i.apply(n,s),r||(n=s=null)):!r&&e.trailing!==!1&&(r=setTimeout(l,h)),o};return u.cancel=function(){clearTimeout(r),a=0,r=n=s=null},u}function JT(i,t,e){var r,n,s,o,a,l=function(){var c=xn()-n;t>c?r=setTimeout(l,t-c):(r=null,e||(o=i.apply(a,s)),r||(s=a=null))},u=ot(function(c){return a=this,s=c,n=xn(),r||(r=setTimeout(l,t),e&&(o=i.apply(a,s))),o});return u.cancel=function(){clearTimeout(r),r=s=a=null},u}function QT(i,t){return Xi(t,i)}function oc(i){return function(){return!i.apply(this,arguments)}}function eI(){var i=arguments,t=i.length-1;return function(){for(var e=t,r=i[t].apply(this,arguments);e--;)r=i[e].call(this,r);return r}}function tI(i,t){return function(){if(--i<1)return t.apply(this,arguments)}}function rv(i,t){var e;return function(){return--i>0&&(e=t.apply(this,arguments)),i<=1&&(t=null),e}}const rI=Xi(rv,2);function iv(i,t,e){t=ut(t,e);for(var r=$e(i),n,s=0,o=r.length;s<o;s++)if(n=r[s],t(i[n],n,i))return n}function nv(i){return function(t,e,r){e=ut(e,r);for(var n=at(t),s=i>0?0:n-1;s>=0&&s<n;s+=i)if(e(t[s],s,t))return s;return-1}}const ac=nv(1),sv=nv(-1);function ov(i,t,e,r){e=ut(e,r,1);for(var n=e(t),s=0,o=at(i);s<o;){var a=Math.floor((s+o)/2);e(i[a])<n?s=a+1:o=a}return s}function av(i,t,e){return function(r,n,s){var o=0,a=at(r);if(typeof s=="number")i>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(e&&s&&a)return s=e(r,n),r[s]===n?s:-1;if(n!==n)return s=t(Cn.call(r,o,a),Mm),s>=0?s+o:-1;for(s=i>0?o:a-1;s>=0&&s<a;s+=i)if(r[s]===n)return s;return-1}}const lv=av(1,ac,ov),iI=av(-1,sv);function Zl(i,t,e){var r=mt(i)?ac:iv,n=r(i,t,e);if(n!==void 0&&n!==-1)return i[n]}function nI(i,t){return Zl(i,_n(t))}function Zt(i,t,e){t=On(t,e);var r,n;if(mt(i))for(r=0,n=i.length;r<n;r++)t(i[r],r,i);else{var s=$e(i);for(r=0,n=s.length;r<n;r++)t(i[s[r]],s[r],i)}return i}function Gr(i,t,e){t=ut(t,e);for(var r=!mt(i)&&$e(i),n=(r||i).length,s=Array(n),o=0;o<n;o++){var a=r?r[o]:o;s[o]=t(i[a],a,i)}return s}function uv(i){var t=function(e,r,n,s){var o=!mt(e)&&$e(e),a=(o||e).length,l=i>0?0:a-1;for(s||(n=e[o?o[l]:l],l+=i);l>=0&&l<a;l+=i){var u=o?o[l]:l;n=r(n,e[u],u,e)}return n};return function(e,r,n,s){var o=arguments.length>=3;return t(e,On(r,s,4),n,o)}}const Ya=uv(1),bd=uv(-1);function Fi(i,t,e){var r=[];return t=ut(t,e),Zt(i,function(n,s,o){t(n,s,o)&&r.push(n)}),r}function sI(i,t,e){return Fi(i,oc(ut(t)),e)}function _d(i,t,e){t=ut(t,e);for(var r=!mt(i)&&$e(i),n=(r||i).length,s=0;s<n;s++){var o=r?r[s]:s;if(!t(i[o],o,i))return!1}return!0}function xd(i,t,e){t=ut(t,e);for(var r=!mt(i)&&$e(i),n=(r||i).length,s=0;s<n;s++){var o=r?r[s]:s;if(t(i[o],o,i))return!0}return!1}function Vt(i,t,e,r){return mt(i)||(i=Ui(i)),(typeof e!="number"||r)&&(e=0),lv(i,t,e)>=0}const oI=ot(function(i,t,e){var r,n;return rt(t)?n=t:(t=Pn(t),r=t.slice(0,-1),t=t[t.length-1]),Gr(i,function(s){var o=n;if(!o){if(r&&r.length&&(s=rc(s,r)),s==null)return;o=s[t]}return o==null?o:o.apply(s,e)})});function lc(i,t){return Gr(i,nc(t))}function aI(i,t){return Fi(i,_n(t))}function cv(i,t,e){var r=-1/0,n=-1/0,s,o;if(t==null||typeof t=="number"&&typeof i[0]!="object"&&i!=null){i=mt(i)?i:Ui(i);for(var a=0,l=i.length;a<l;a++)s=i[a],s!=null&&s>r&&(r=s)}else t=ut(t,e),Zt(i,function(u,c,h){o=t(u,c,h),(o>n||o===-1/0&&r===-1/0)&&(r=u,n=o)});return r}function lI(i,t,e){var r=1/0,n=1/0,s,o;if(t==null||typeof t=="number"&&typeof i[0]!="object"&&i!=null){i=mt(i)?i:Ui(i);for(var a=0,l=i.length;a<l;a++)s=i[a],s!=null&&s<r&&(r=s)}else t=ut(t,e),Zt(i,function(u,c,h){o=t(u,c,h),(o<n||o===1/0&&r===1/0)&&(r=u,n=o)});return r}var uI=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function hv(i){return i?qr(i)?Cn.call(i):Wu(i)?i.match(uI):mt(i)?Gr(i,ic):Ui(i):[]}function fv(i,t,e){if(t==null||e)return mt(i)||(i=Ui(i)),i[Kl(i.length-1)];var r=hv(i),n=at(r);t=Math.max(Math.min(t,n),0);for(var s=n-1,o=0;o<t;o++){var a=Kl(o,s),l=r[o];r[o]=r[a],r[a]=l}return r.slice(0,t)}function cI(i){return fv(i,1/0)}function hI(i,t,e){var r=0;return t=ut(t,e),lc(Gr(i,function(n,s,o){return{value:n,index:r++,criteria:t(n,s,o)}}).sort(function(n,s){var o=n.criteria,a=s.criteria;if(o!==a){if(o>a||o===void 0)return 1;if(o<a||a===void 0)return-1}return n.index-s.index}),"value")}function io(i,t){return function(e,r,n){var s=t?[[],[]]:{};return r=ut(r,n),Zt(e,function(o,a){var l=r(o,a,e);i(s,o,l)}),s}}const fI=io(function(i,t,e){vr(i,e)?i[e].push(t):i[e]=[t]}),dI=io(function(i,t,e){i[e]=t}),pI=io(function(i,t,e){vr(i,e)?i[e]++:i[e]=1}),yI=io(function(i,t,e){i[e?0:1].push(t)},!0);function mI(i){return i==null?0:mt(i)?i.length:$e(i).length}function vI(i,t,e){return t in e}const dv=ot(function(i,t){var e={},r=t[0];if(i==null)return e;rt(r)?(t.length>1&&(r=On(r,t[1])),t=An(i)):(r=vI,t=jr(t,!1,!1),i=Object(i));for(var n=0,s=t.length;n<s;n++){var o=t[n],a=i[o];r(a,o,i)&&(e[o]=a)}return e}),gI=ot(function(i,t){var e=t[0],r;return rt(e)?(e=oc(e),t.length>1&&(r=t[1])):(t=Gr(jr(t,!1,!1),String),e=function(n,s){return!Vt(t,s)}),dv(i,e,r)});function pv(i,t,e){return Cn.call(i,0,Math.max(0,i.length-(t==null||e?1:t)))}function za(i,t,e){return i==null||i.length<1?t==null||e?void 0:[]:t==null||e?i[0]:pv(i,i.length-t)}function ws(i,t,e){return Cn.call(i,t==null||e?1:t)}function bI(i,t,e){return i==null||i.length<1?t==null||e?void 0:[]:t==null||e?i[i.length-1]:ws(i,Math.max(0,i.length-t))}function _I(i){return Fi(i,Boolean)}function xI(i,t){return jr(i,t,!1)}const yv=ot(function(i,t){return t=jr(t,!0,!0),Fi(i,function(e){return!Vt(t,e)})}),wI=ot(function(i,t){return yv(i,t)});function Jl(i,t,e,r){Em(t)||(r=e,e=t,t=!1),e!=null&&(e=ut(e,r));for(var n=[],s=[],o=0,a=at(i);o<a;o++){var l=i[o],u=e?e(l,o,i):l;t&&!e?((!o||s!==u)&&n.push(l),s=u):e?Vt(s,u)||(s.push(u),n.push(l)):Vt(n,l)||n.push(l)}return n}const TI=ot(function(i){return Jl(jr(i,!0,!0))});function II(i){for(var t=[],e=arguments.length,r=0,n=at(i);r<n;r++){var s=i[r];if(!Vt(t,s)){var o;for(o=1;o<e&&Vt(arguments[o],s);o++);o===e&&t.push(s)}}return t}function Ql(i){for(var t=i&&cv(i,at).length||0,e=Array(t),r=0;r<t;r++)e[r]=lc(i,r);return e}const EI=ot(Ql);function SI(i,t){for(var e={},r=0,n=at(i);r<n;r++)t?e[i[r]]=t[r]:e[i[r][0]]=i[r][1];return e}function CI(i,t,e){t==null&&(t=i||0,i=0),e||(e=t<i?-1:1);for(var r=Math.max(Math.ceil((t-i)/e),0),n=Array(r),s=0;s<r;s++,i+=e)n[s]=i;return n}function AI(i,t){if(t==null||t<1)return[];for(var e=[],r=0,n=i.length;r<n;)e.push(Cn.call(i,r,r+=t));return e}function uc(i,t){return i._chain?_e(t).chain():t}function mv(i){return Zt(Wl(i),function(t){var e=_e[t]=i[t];_e.prototype[t]=function(){var r=[this._wrapped];return Jw.apply(r,arguments),uc(this,e.apply(_e,r))}}),_e}Zt(["pop","push","reverse","shift","sort","splice","unshift"],function(i){var t=ro[i];_e.prototype[i]=function(){var e=this._wrapped;return e!=null&&(t.apply(e,arguments),(i==="shift"||i==="splice")&&e.length===0&&delete e[0]),uc(this,e)}});Zt(["concat","join","slice"],function(i){var t=ro[i];_e.prototype[i]=function(){var e=this._wrapped;return e!=null&&(e=t.apply(e,arguments)),uc(this,e)}});const PI=Object.freeze(Object.defineProperty({__proto__:null,VERSION:xm,after:tI,all:_d,allKeys:An,any:xd,assign:Ds,before:rv,bind:ev,bindAll:jT,chain:qT,chunk:AI,clone:PT,collect:Gr,compact:_I,compose:eI,constant:Rm,contains:Vt,countBy:pI,create:AT,debounce:JT,default:_e,defaults:$m,defer:KT,delay:tv,detect:Zl,difference:yv,drop:ws,each:Zt,escape:NT,every:_d,extend:zm,extendOwn:Ds,filter:Fi,find:Zl,findIndex:ac,findKey:iv,findLastIndex:sv,findWhere:nI,first:za,flatten:xI,foldl:Ya,foldr:bd,forEach:Zt,functions:Wl,get:jm,groupBy:fI,has:FT,head:za,identity:ic,include:Vt,includes:Vt,indexBy:dI,indexOf:lv,initial:pv,inject:Ya,intersection:II,invert:Ym,invoke:oI,isArguments:Zu,isArray:qr,isArrayBuffer:Am,isBoolean:Em,isDataView:Ns,isDate:aT,isElement:oT,isEmpty:gT,isEqual:bT,isError:uT,isFinite:dT,isFunction:rt,isMap:wT,isMatch:km,isNaN:Mm,isNull:sT,isNumber:Sm,isObject:Vr,isRegExp:lT,isSet:IT,isString:Wu,isSymbol:Cm,isTypedArray:Bm,isUndefined:Im,isWeakMap:TT,isWeakSet:ET,iteratee:sc,keys:$e,last:bI,lastIndexOf:iI,map:Gr,mapObject:MT,matcher:_n,matches:_n,max:cv,memoize:WT,methods:Wl,min:lI,mixin:mv,negate:oc,noop:Km,now:xn,object:SI,omit:gI,once:rI,pairs:ST,partial:Xi,partition:yI,pick:dv,pluck:lc,property:nc,propertyOf:RT,random:Kl,range:CI,reduce:Ya,reduceRight:bd,reject:sI,rest:ws,restArguments:ot,result:zT,sample:fv,select:Fi,shuffle:cI,size:mI,some:xd,sortBy:hI,sortedIndex:ov,tail:ws,take:za,tap:OT,template:YT,templateSettings:kT,throttle:ZT,times:LT,toArray:hv,toPath:qm,transpose:Ql,unescape:DT,union:TI,uniq:Jl,unique:Jl,uniqueId:VT,unzip:Ql,values:Ui,where:aI,without:wI,wrap:QT,zip:EI},Symbol.toStringTag,{value:"Module"}));var ln=mv(PI);ln._=ln;const vt=48,eu=vt*20,OI=eu*eu,si=(i,t=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const e=Number(i);if(Number.isFinite(e))return e}return t},wd=(i,t,e,r)=>{const n=i-e,s=t-r;return n*n+s*s};var vv=function(i,t,e){e=typeof e<"u"?e:[],t=typeof t<"u"?t:{id:0};var r=ln.filter(i,function(n){return n.parentid==t.id});return ln.isEmpty(r)||(t.id==0?e=r:t.children=r,ln.each(r,function(n){vv(i,n)})),e},FI=vv(vx);const Td=Object.keys(cr).reduce((i,t)=>(i[cr[t].TYPE]=t,i),{}),$a=i=>i>=100&&i<200,Id=(i,t,e)=>{!i||!i.audio||!t||(e&&Number.isFinite(e.x)&&Number.isFinite(e.y)?i.audio.playEffect(t,{position:e}):i.audio.playEffect(t))};class MI{constructor(t){this.game=t,this.buildingListHead=null,this.buildingsById={},this.buildingsByCoord={},this.pendingBuildCosts=new Map,this.pendingDemolish=new Set}cycle(){}newBuilding(t,e,r,n,s={}){const{notifyServer:o=!0,id:a=`${e}_${r}`,population:l=0,attachedHouseId:u=null,updateCity:c,itemsLeft:h=0,city:f=this.game.player?.city??0}=s,d=`${e}_${r}`,p=Number.isFinite(f)?f:parseInt(f,10)||0,v=o&&t!==null&&t!==void 0&&this.game?.player&&t===this.game.player.id;if(v&&!this.game?.player?.isMayor)return this.game.notify?this.game.notify({title:"Construction Restricted",message:"Only mayors can authorise new construction.",variant:"warn",timeout:3600}):console.warn("Construction restricted: only mayors may build."),this.game.forceDraw=!0,!1;if(v){const E=this.game.cities?.[p];if(!E)return console.warn("Cannot place building without city state"),!1;if((Number.isFinite(E.cash)?E.cash:parseInt(E.cash,10)||0)<tn)return console.warn("City lacks funds for new building"),this.game.forceDraw=!0,!1}var y={id:a,owner:t,x:e,y:r,items:1,type:n,population:l,attachedHouseId:u,next:null,previous:null,coordKey:d,city:f,itemsLeft:h};if(Zw(this.game,y))return console.log("Collision"),!1;if(v&&n!==Ot){const E={x:(si(e,0)+1.5)*vt,y:(si(r,0)+1.5)*vt},T=this.measureCityLayout(p,E);if(T.buildingCount>0){const R=T.nearestDistanceSq;if(R!==null&&R>OI){if(typeof this.game.notify=="function"){const _=Ae(p),F=Math.round(eu/vt);this.game.notify({title:"Construction Denied",message:`New structures must be within ${F} tiles of your existing ${_} build grid. Try placing closer to your city.`,variant:"warn",timeout:6500})}return!1}}}if(o&&this.game.socketListener&&this.game.socketListener.sendNewBuilding&&this.game.socketListener.sendNewBuilding(y),this.buildingListHead&&(this.buildingListHead.previous=y,y.next=this.buildingListHead),(c!==void 0?c:!t||t===this.game.player.id)?this.adjustAllowedBuilds(y):this.applyResearchProgress(y.city,y.type),console.log("Created building"),console.log(y),this.buildingListHead=y,this.buildingsById[y.id]=y,this.buildingsByCoord[d]=y,this.syncFactoryItems(y),this.game.tiles[e]||(this.game.tiles[e]=[]),this.game.tiles[e][r]=n,this.game.map&&this.game.map[e]&&(this.game.map[e][r]=ki),Id(this.game,he.BUILD,{x:e*vt,y:r*vt}),v){const E=this.game.cities?.[p];if(E){const T=Number.isFinite(E.cash)?E.cash:parseInt(E.cash,10)||0;E.cash=Math.max(0,T-tn),E.construction=(Number.isFinite(E.construction)?E.construction:parseInt(E.construction,10)||0)+tn,E.updatedAt=Date.now(),this.pendingBuildCosts.set(y.id,{cityId:p,cost:tn}),this.game.forceDraw=!0}}return y}outputBuildings(){console.log("here");for(var t=this.getHead();t;)t.type!==0&&console.log(t.type+","+t.x+","+t.y),t=t.next;return!1}demolishBuilding(t,e){if(console.log("Trying to demolish building at "+t+" "+e),!this.game?.player?.isMayor){this.game.notify?this.game.notify({title:"Demolition Restricted",message:"Only mayors can order demolitions.",variant:"warn",timeout:3200}):console.warn("Demolition restricted: only mayors may demolish buildings."),this.game.isDemolishing=!1;return}const r=this.findBuildingAtTile(t,e);r&&(this.pendingDemolish.has(r.id)||this.game.socketListener?.sendDemolishBuilding&&(this.pendingDemolish.add(r.id),this.game.socketListener.sendDemolishBuilding(r.id)))}deleteBuilding(t,e=!0){if(this.game.map[t.x][t.y]=0,this.game.tiles[t.x][t.y]=0,this.pendingDemolish.has(t.id)&&this.pendingDemolish.delete(t.id),Array.isArray(this.game.explosions)){const s=Number.isFinite(t.x)?Number(t.x):0,o=Number.isFinite(t.y)?Number(t.y):0;this.game.explosions.push({x:s*48,y:o*48,frame:0,nextFrameTick:(this.game.tick||Date.now())+75,variant:"large"}),Id(this.game,he.DEMOLISH,{x:s*vt,y:o*vt})}if($a(t.type)){const s=this.getFactoryDropPosition(t),o=t.type%100,a=t.city??t.cityId??null,l=this.game.iconFactory.countUnownedIconsNear(s.x,s.y,o,48,a);l>0&&this.game.iconFactory.removeUnownedIconsNear(s.x,s.y,o,l,48,a),t.itemsLeft=0}(t.owner===null||t.owner===this.game.player.id)&&Object.keys(this.game.cities[this.game.player.city].canBuild).forEach(s=>{var o=cr[s].TYPE;console.log(o+" "+this.game.isBuilding),parseInt(o)==t.type&&o!=di&&(this.game.cities[this.game.player.city].canBuild[s]=ur)}),e&&this.game.socketListener&&this.game.socketListener.sendDemolishBuilding&&this.game.socketListener.sendDemolishBuilding(t.id);var r=t.next;t.next&&(t.next.previous=t.previous),t.previous?t.previous.next=t.next:this.buildingListHead=t.next,delete this.buildingsById[t.id];const n=t.coordKey||`${t.x}_${t.y}`;return delete this.buildingsByCoord[n],this.pendingBuildCosts.has(t.id)&&this.pendingBuildCosts.delete(t.id),r}handleDemolishDenied(t){const e=t?.id;e&&this.pendingDemolish.has(e)&&this.pendingDemolish.delete(e),t?.reason&&console.warn(`Demolish denied (${t.reason}) for building ${e||"(unknown)"}`)}removeBuildingById(t){let e=this.getHead();for(;e;){if(e.id===t){this.deleteBuilding(e,!1);break}e=e.next}}handleBuildDenied(t){if(!t)return;const e=t.id||`${t.x}_${t.y}`;if(!e)return;const r=this.pendingBuildCosts.get(e);if(r){const s=this.game.cities?.[r.cityId];if(s){const o=Number.isFinite(s.cash)?s.cash:parseInt(s.cash,10)||0;s.cash=o+r.cost;const a=Number.isFinite(s.construction)?s.construction:parseInt(s.construction,10)||0;s.construction=Math.max(0,a-r.cost),s.updatedAt=Date.now()}this.pendingBuildCosts.delete(e)}const n=this.getBuildingById(e);n&&n.owner===this.game.player.id&&this.deleteBuilding(n,!1),this.game.forceDraw=!0}searchTree(t,e){if(t.id==e)return t;if(t.children!=null){var r,n=null;for(r=0;n==null&&r<t.children.length;r++)n=this.searchTree(t.children[r],e);return n}return null}adjustAllowedBuilds(t){if(t.type==Ot)return;const e=t.city??this.game.player.city,r=this.game.isBuilding||t.type;this.applyResearchProgress(e,r)}getHead(){return this.buildingListHead}getBuildingById(t){return this.buildingsById[t]}getBuildingByCoord(t,e){return this.buildingsByCoord[`${t}_${e}`]}findBuildingAtTile(t,e){let r=this.getHead();const n=Number.isFinite(t)?t:parseInt(t,10),s=Number.isFinite(e)?e:parseInt(e,10);if(!Number.isFinite(n)||!Number.isFinite(s))return null;for(;r;){const o=Number.isFinite(r.x)?r.x:parseInt(r.x,10)||0,a=Number.isFinite(r.y)?r.y:parseInt(r.y,10)||0;if(n>=o&&n<=o+2&&s>=a&&s<=a+2)return r;r=r.next}return null}measureCityLayout(t,e=null){const r=Number.isFinite(t)?t:parseInt(t,10),n=this.game.cities?.[r],s=si(n?.x,0),o=si(n?.y,0),a={x:s+vt*1.5,y:o+vt*1.5};let l=this.getHead(),u=0,h=Number.isFinite(e?.x)&&Number.isFinite(e?.y)?1/0:null,f=0;for(;l;){const d=Number.isFinite(l.city)?l.city:parseInt(l.city,10);if(Number.isFinite(d)&&Number.isFinite(r)&&d!==r){l=l.next;continue}const p=(si(l.x,0)+1.5)*vt,v=(si(l.y,0)+1.5)*vt,y=wd(p,v,a.x,a.y);if(y>u&&(u=y),h!==null){const g=wd(p,v,e.x,e.y);g<h&&(h=g)}f+=1,l=l.next}return{cityCenter:a,maxRadiusSq:u,nearestDistanceSq:h,buildingCount:f}}countBuildingsForCity(t){const e=Number.isFinite(t)?t:parseInt(t,10);if(!Number.isFinite(e))return 0;let r=0,n=this.getHead();for(;n;)(Number.isFinite(n.city)?n.city:parseInt(n.city,10)||0)===e&&(r+=1),n=n.next;return r}applyPopulationUpdate(t){if(!t||!t.id)return;if(t.removed){this.removeBuildingById(t.id),this.game.forceDraw=!0;return}let e=this.getBuildingById(t.id);!e&&t.x!==void 0&&t.y!==void 0&&t.type!==void 0&&(e=this.newBuilding(t.ownerId||null,t.x,t.y,t.type,{notifyServer:!1,id:t.id,population:t.population||0,attachedHouseId:t.attachedHouseId||null,updateCity:!1,itemsLeft:t.itemsLeft||0,city:t.city??0}),e&&this.applyResearchProgress(e.city??0,e.type)),e&&(e.coordKey=e.coordKey||`${e.x}_${e.y}`,typeof t.population=="number"&&(e.population=t.population),t.attachedHouseId!==void 0&&(e.attachedHouseId=t.attachedHouseId),t.city!==void 0&&(e.city=t.city),t.smokeActive!==void 0&&(e.smokeActive=t.smokeActive),t.smokeFrame!==void 0&&(e.smokeFrame=t.smokeFrame),t.itemsLeft!==void 0&&(e.itemsLeft=t.itemsLeft),this.syncFactoryItems(e),t.id&&this.pendingBuildCosts.has(t.id)&&this.pendingBuildCosts.delete(t.id),this.game.forceDraw=!0)}applyResearchProgress(t,e){if(e==null||t==null||t===void 0)return;const r=parseInt(t,10),n=this.game.cities?.[r];if(!n||!n.canBuild)return;const s=Number(e),o=Td[s];if(!o||n.canBuild[o]===void 0)return;s!==di&&(n.canBuild[o]=Nf);const a=this.searchTree(FI[0],s);a&&a.children&&a.children.forEach(l=>{const u=Td[l.id];u&&n.canBuild[u]!==Nf&&(n.canBuild[u]=ur)})}assignIconSource(t){if(!t||typeof t.type!="number")return null;if(t.sourceBuildingId&&this.buildingsById[t.sourceBuildingId])return this.buildingsById[t.sourceBuildingId];const e=this.findFactoryForIcon(t.type,t.x,t.y);return e&&(t.sourceBuildingId=e.id),e}findFactoryForIcon(t,e,r){let n=null,s=1/0,o=this.getHead();for(;o;){if($a(o.type)&&o.type%100===t){const a=this.getFactoryDropPosition(o),l=a.x-e,u=a.y-r,c=Math.sqrt(l*l+u*u);c<s&&c<=96&&(n=o,s=c)}o=o.next}return n}handleIconProduced(t){const e=this.assignIconSource(t);e&&(e.itemsLeft=(e.itemsLeft||0)+1,this.syncFactoryItems(e))}handleIconCollected(t){const e=this.assignIconSource(t);e&&(typeof e.itemsLeft=="number"&&e.itemsLeft>0&&(e.itemsLeft-=1),this.game.socketListener&&typeof this.game.socketListener.collectFactoryItem=="function"&&e.id&&this.game.socketListener.collectFactoryItem({buildingId:e.id,type:t.type,quantity:Math.max(1,t.quantity??1)}),this.syncFactoryItems(e))}getFactoryDropPosition(t){return{x:t.x*48+56,y:t.y*48+102}}syncFactoryItems(t){if(!t||!$a(t.type)||!this.game.iconFactory||typeof this.game.iconFactory.countUnownedIconsNear!="function"||typeof this.game.iconFactory.removeUnownedIconsNear!="function")return;const e=t.itemsLeft||0,r=t.type%100,n=this.getFactoryDropPosition(t),s=t.city??t.cityId??null,o=this.game.iconFactory.countUnownedIconsNear(n.x,n.y,r,48,s);if(o>e)this.game.iconFactory.removeUnownedIconsNear(n.x,n.y,r,o-e,48,s);else if(o<e){const a=e-o;for(let l=0;l<a;l++)this.game.iconFactory.newIcon(null,n.x,n.y,r,{sourceBuildingId:t.id,teamId:s,skipProductionUpdate:!0})}}}const pi=48,Ed=4,RI=new Set([Ws,ki]);var Fn=(i,t)=>{var e={x:t.x,y:t.y,w:4,h:4};return Kt(i,e)};const LI=i=>({x:i.x,y:i.y,w:Ed,h:Ed}),NI=(i,t)=>{const e=Array.isArray(i.map)?i.map.length:0,r=e>0&&Array.isArray(i.map[0])?i.map[0].length:0;if(!e||!r)return t;const n=Math.max(0,e*pi-t.w),s=Math.max(0,r*pi-t.h);return{x:Math.max(0,Math.min(t.x,n)),y:Math.max(0,Math.min(t.y,s)),w:t.w,h:t.h}},BI=(i,t)=>{const e=Array.isArray(i.map)?i.map:null;if(!e||!Array.isArray(e[0]))return!1;const r=e.length-1,n=Array.isArray(e[0])?e[0].length-1:-1;if(r<0||n<0)return!1;const s=Math.max(0,Math.floor(t.x/pi)),o=Math.min(r,Math.floor((t.x+t.w-1)/pi)),a=Math.max(0,Math.floor(t.y/pi)),l=Math.min(n,Math.floor((t.y+t.h-1)/pi));for(let u=s;u<=o;u+=1){const c=e[u];if(Array.isArray(c))for(let h=a;h<=l;h+=1){const f=c[h];if(RI.has(f))return!0}}return!1},DI=(i,t)=>{const e=NI(i,LI(t));return BI(i,e)},kI=(i,t)=>Object.keys(i.otherPlayers).some(e=>{const r=i.otherPlayers[e];if(!r||!r.offset||t.shooter&&t.shooter===e)return!1;const n=t.team??null,s=r.city??null;return n!==null&&s===n?!1:Fn(pr(r),t)})||UI(i,t);function UI(i,t){const e=i.rogueTankManager;if(!e||!Array.isArray(e.tanks))return!1;const r=t.team??null;for(let n=0;n<e.tanks.length;n+=1){const s=e.tanks[n];if(!s||!s.offset||t.shooter&&t.shooter===s.id)continue;const o=s.city??null;if(!(r!==null&&o===r)&&Fn(pr(s),t))return e.handleBulletCollision(t,s),!0}return!1}const XI=(i,t)=>{const e=t.team??null,r=i.player?.city??null;return e!==null&&e===r||t.shooter&&t.shooter===i.player.id?!1:Fn(pr(i.player),t)},HI=(i,t)=>{for(var e=i.itemFactory.getHead();e;){var r={x:e.x,y:e.y,w:48,h:48};if(t.sourceId&&e.id&&t.sourceId===e.id){e=e.next;continue}if(Fn(r,t))return e;e=e.next}return null},GI=(i,t)=>{for(var e=i.buildingFactory.getHead();e;){var r={x:e.x*48,y:e.y*48,w:144,h:96};const n=Number.isFinite(e.type)?e.type:parseInt(e.type,10),s=Number.isFinite(n)?Math.floor(n/100):NaN,o=n===Ot,a=s===Xe,l=$u(e);if((o||a||l||s===Ks)&&(r.h=r.h-48),Fn(r,t))return!0;e=e.next}return!1},Sd={0:nm,1:Z_,3:J_},Cd={0:Hl,1:Hl,3:ex},YI=i=>Object.prototype.hasOwnProperty.call(Sd,i)?Sd[i]:nm,Ad=i=>Object.prototype.hasOwnProperty.call(Cd,i)?Cd[i]:Hl;class zI{constructor(t){this.game=t,this.bulletListHead=null}cycle(){for(var t=this.bulletListHead;t;){var e=t.angle;const s=t.speed??Ad(t.type);var r=Math.sin(e/16*3.14)*-1*this.game.timePassed*s,n=Math.cos(e/16*3.14)*-1*this.game.timePassed*s;t.x+=r,t.y+=n,(t.x<0||t.x>24576||t.y<0||t.y>24576)&&(t.life=ir),DI(this.game,t)&&(t.life=ir);const o=HI(this.game,t);o&&(this.game.itemFactory&&typeof this.game.itemFactory.handleBulletHit=="function"?(this.game.itemFactory.handleBulletHit(o,t)||{}).consumed!==!1&&(t.life=ir):t.life=ir),GI(this.game,t)&&(t.life=ir),kI(this.game,t)&&(t.life=ir),XI(this.game,t)&&(t.life=ir),t.life==ir?t=this.deleteBullet(t):t=t.next}}deleteBullet(t){var e=t.next;return t.next&&(t.next.previous=t.previous),t.previous?t.previous.next=t.next:this.bulletListHead=t.next,e}newBullet(t,e,r,n,s,o=null,a={}){const l=Number.isFinite(n)?n:0,u=a||{},c=Number.isFinite(u.damage)?u.damage:YI(l);var h={shooter:t,x:e,y:r,life:V_,damage:c,animation:0,type:l,angle:s,team:o,speed:Ad(l),sourceId:u.sourceId??null,sourceType:u.sourceType??null,targetId:u.targetId??null,next:null,previous:null};return this.bulletListHead&&(this.bulletListHead.previous=h,h.next=this.bulletListHead),this.bulletListHead=h,h}getHead(){return this.bulletListHead}}class $I{constructor(t){this.game=t,this.iconListHead=null,this.iconsById=new Map}generateIconId(t="icon"){const e=this.game?.socketListener?.io?.id??"local";return`${t}_${e}_${Date.now()}_${Math.random().toString(16).slice(-6)}`}normalizeIconId(t){return typeof t=="string"&&t.trim().length>0?t.trim():null}registerIcon(t){!t||!t.id||this.iconsById.set(t.id,t)}unregisterIcon(t){!t||!t.id||this.iconsById.delete(t.id)}getIconById(t){const e=this.normalizeIconId(t);return e&&this.iconsById.get(e)||null}removeIconById(t,e={}){const r=this.getIconById(t);return!r||e.onlyUnowned&&r.owner!=null?!1:(this.deleteIcon(r),!0)}cycle(){}getLimitForType(t){const e=mx?.[t];return typeof e=="number"?e:1/0}getOwnedQuantity(t,e){if(t==null)return 0;let r=0,n=this.getHead();for(;n;){if(n.owner===t&&n.type===e){const s=Number.isFinite(n.quantity)?n.quantity:parseInt(n.quantity,10)||1;r+=Math.max(1,s)}n=n.next}return r}getAllowedQuantity(t,e,r){const n=Math.max(1,parseInt(r,10)||1);if(t==null)return n;const s=this.getLimitForType(e);if(!Number.isFinite(s))return n;const o=this.getOwnedQuantity(t,e),a=s-o;return a<=0?0:Math.min(n,a)}newIcon(t,e,r,n,s={}){const o=s.quantity!==void 0?s.quantity:1;let a=Math.max(1,parseInt(o,10)||1);if(t!=null){const d=this.getAllowedQuantity(t,n,a);if(d<=0)return null;a=d}const l=s.city!==void 0?s.city:t!=null&&t===this.game.player?.id?this.game.player.city??null:null,u=s.teamId!==void 0?s.teamId:t!=null&&t===this.game.player?.id?this.game.player.city??null:null,c=this.normalizeIconId(s.id),h=!c&&s.isSharedDrop;var f={id:c||(h?this.generateIconId("drop"):null),owner:t,x:e,y:r,type:n,next:null,previous:null,sourceBuildingId:s.sourceBuildingId??null,quantity:a,selected:!!s.selected,armed:!!s.armed,city:l,teamId:u,isSharedDrop:!!s.isSharedDrop,synced:s.synced!==void 0?!!s.synced:!0};if(console.log("creating icon"),console.log(f),this.game.forceDraw=!0,this.iconListHead&&(this.iconListHead.previous=f,f.next=this.iconListHead),this.iconListHead=f,f.quantity=Math.max(1,parseInt(f.quantity,10)||1),this.registerIcon(f),this.game.buildingFactory&&f.owner==null&&!f.isSharedDrop){if(!f.sourceBuildingId&&typeof this.game.buildingFactory.assignIconSource=="function"){const d=this.game.buildingFactory.assignIconSource(f);d&&(f.sourceBuildingId=d.id)}!s.skipProductionUpdate&&typeof this.game.buildingFactory.handleIconProduced=="function"&&this.game.buildingFactory.handleIconProduced(f)}if(f.owner===this.game.player?.id&&f.selected){let d=this.iconListHead;for(;d;)d!==f&&d.owner===f.owner&&(d.selected=!1,d.type===Ie&&(d.armed=!1)),d=d.next;f.type===Ie&&(f.armed=!!f.armed,this.game.player.bombsArmed=f.armed),this.game.forceDraw=!0}return f}pickupIcon(){var t=this.findIconByLocation();if(t){const e=this.game.player.id,r=!!t.isSharedDrop;if(r&&t.synced===!1)return;const n=t.quantity??1,s=this.getAllowedQuantity(e,t.type,n);if(s<=0||s<n)return;const o=this.findOwnedIconByType(e,t.type),a=r?t.id:null,l=r?t.teamId??null:null;t.owner=e,t.city=this.game.player.city??null,t.teamId=this.game.player.city??null,t.quantity=n,t.isSharedDrop=!1,t.synced=!0,a&&(this.unregisterIcon(t),t.id=null),this.game.buildingFactory&&typeof this.game.buildingFactory.handleIconCollected=="function"&&!r&&this.game.buildingFactory.handleIconCollected(t);let u=t;if(o&&o!==t){const h=this.getLimitForType(t.type),f=(o.quantity??1)+n;o.quantity=Number.isFinite(h)?Math.min(h,Math.max(1,f)):Math.max(1,f),this.deleteIcon(t),u=o}u.selected=!0,u.type===Ie&&u.armed||(u.armed=!1);let c=this.getHead();for(;c;)c!==u&&c.owner===e&&(c.selected=!1,c.type===Ie&&(c.armed=!1)),c=c.next;u.type===Ie?this.game.player.bombsArmed=u.armed:this.game.player.bombsArmed=!1,a&&this.game.socketListener&&typeof this.game.socketListener.collectDroppedIcon=="function"&&this.game.socketListener.collectDroppedIcon({id:a,type:t.type,cityId:this.game.player.city??null,teamId:l??this.game.player.city??null,quantity:n}),this.game.forceDraw=!0}}dropSelectedIcon(){for(var t=this.getHead(),e=null;t;){if(t.owner==this.game.player.id&&t.selected){e=t;break}t=t.next}if(!e)return null;const r=e.quantity??1,n={type:e.type,armed:!!e.armed,owner:this.game.player.id,city:this.game.player.city??null,teamId:this.game.player.city??null,quantity:1};return r>1?(e.quantity=r-1,e.selected=!0):this.deleteIcon(e),n.type===Ie&&(r>1?(e.armed=n.armed,this.game.player.bombsArmed=e.armed):this.game.player.bombsArmed=!1),this.game.forceDraw=!0,n}toggleSelected(t){t.selected=!t.selected;for(var e=this.getHead();e;)e.owner==t.owner&&e!=t&&(console.log("setting other icons selected to false"),e.selected=!1),e=e.next;t.type===Ie?(t.armed=t.selected,this.game.player.bombsArmed=t.armed):t.selected&&(this.game.player.bombsArmed=!1)}findIconByLocation(){var t=this.getHead(),e=24;const r=this.game.player?.city??null;for(;t;){const n=t.teamId===null||t.teamId===void 0||t.teamId===r;if(t.owner==null&&n&&t.x>=this.game.player.offset.x-e&&t.x<=this.game.player.offset.x+e&&t.y>=this.game.player.offset.y-e&&t.y<=this.game.player.offset.y+e)return t;t=t.next}return null}findOwnedIconByType(t,e){for(var r=this.getHead();r;){if(r.owner===t&&r.type===e)return r;r=r.next}return null}consumeOwnedIcon(t,e,r=1){if(t==null)return null;const n=this.findOwnedIconByType(t,e);if(!n)return null;const s=Number.isFinite(n.quantity)?n.quantity:parseInt(n.quantity,10)||1,o=Math.max(1,parseInt(r,10)||1);return s<=o?this.deleteIcon(n):n.quantity=s-o,this.game.forceDraw=!0,n}getSelectedIcon(t){for(var e=this.getHead();e;){if(e.owner===t&&e.selected)return e;e=e.next}return null}deleteIcon(t){var e=t.next;return t.next&&(t.next.previous=t.previous),t.previous?t.previous.next=t.next:this.iconListHead=t.next,this.game.player&&this.game.player.id===t.owner&&t.type===Ie&&(this.game.player.bombsArmed=t.armed),this.unregisterIcon(t),t.id=null,e}purgeCityItems(t,e=null){const r=Number.isFinite(e)?Math.floor(e):null,n=Number.isFinite(t)?Math.floor(t):null;let s=0,o=this.getHead();for(;o;){if(!(r===null||o.type===r)){o=o.next;continue}const l=Number.isFinite(o.city)?Math.floor(o.city):Number.isFinite(o.teamId)?Math.floor(o.teamId):null;if(n!==null&&l!==null&&l!==n){o=o.next;continue}o=this.deleteIcon(o),s+=1}return s>0&&(r===Ie&&this.game?.player&&(this.game.player.bombsArmed=!1),this.game.forceDraw=!0),s}getHead(){return this.iconListHead}countUnownedIconsNear(t,e,r,n=48,s=null){let o=0,a=this.getHead();for(;a;){const l=s==null||a.teamId===null||a.teamId===void 0||a.teamId===s;if(a.owner==null&&a.type===r&&l&&!a.isSharedDrop){const u=Math.abs(a.x-t),c=Math.abs(a.y-e);u<=n&&c<=n&&o++}a=a.next}return o}removeUnownedIconsNear(t,e,r,n,s=48,o=null){let a=0,l=this.getHead();for(;l&&a<n;){const u=l.next,c=o==null||l.teamId===null||l.teamId===void 0||l.teamId===o;if(l.owner==null&&l.type===r&&c&&!l.isSharedDrop){const h=Math.abs(l.x-t),f=Math.abs(l.y-e);h<=s&&f<=s&&(this.deleteIcon(l),a++)}l=u}return a}}const VI=(i,t,e)=>{if(typeof e=="function"){const r=e(i,t);if(Number.isFinite(r))return Math.max(0,Math.floor(r))}if(typeof i=="number"&&Number.isFinite(i))return Math.max(0,Math.floor(i));if(typeof i=="string"&&i.trim().length>0){const r=Number(i);if(Number.isFinite(r))return Math.max(0,Math.floor(r))}return null},qI=(i,t,e)=>{if(!(!i||!t||typeof t!="object")){if(Object.prototype.hasOwnProperty.call(t,"ownerId")){const r=t.ownerId??null;i.ownerId=r,i.owner=r}if(Object.prototype.hasOwnProperty.call(t,"teamId"))if(t.teamId===null)i.teamId=null,i.city=null;else{const r=i.city??i.teamId??null,n=VI(t.teamId,r,e);n!==null&&(i.teamId=n,i.city=n)}}},jI=new Set([Ft,tt,xt,pt]),WI=new Set([tt,xt,pt,Ft]),KI=new Set([vn,Zs,vi,Ie,et,gi,Js,dt]),Pd=new Set([et,Ie,dt]),ZI=i=>Object.prototype.hasOwnProperty.call(Gf,i)?Gf[i]:null,JI=i=>Object.prototype.hasOwnProperty.call(Yf,i)?Yf[i]:null,ls=(i,t,e)=>{!i||!i.audio||!t||(e&&Number.isFinite(e.x)&&Number.isFinite(e.y)?i.audio.playEffect(t,{position:e}):i.audio.playEffect(t))};class QI{constructor(t){this.game=t,this.itemListHead=null,this.calculateTick=0,this.itemsById=new Map,this.pendingHazards=new Set,this.pendingDefenseIds=new Set,this.socketBound=!1,this.nextLocalId=0,this.nextDefenseId=0,this.validIcons=[tt,pt,xt,Ft,et,Ie,dt,gi],this.validShooters=[tt,pt,xt],this.pendingOrbItems=[],this.game.socketListener&&this.bindSocketEvents(this.game.socketListener)}bindSocketEvents(t){!t||this.socketBound||(this.socketBound=!0,t.on("hazard:spawn",e=>this.onHazardSpawn(e)),t.on("hazard:update",e=>this.onHazardUpdate(e)),t.on("hazard:remove",e=>this.onHazardRemove(e)),t.on("orb:result",e=>this.onOrbResult(e)))}generateHazardId(){return this.nextLocalId+=1,`hazard_${this.game.socketListener?.io?.id??"local"}_${Date.now()}_${this.nextLocalId}`}generateDefenseId(){return this.nextDefenseId+=1,`defense_${this.game.socketListener?.io?.id??"local"}_${Date.now()}_${this.nextDefenseId}`}insertItem(t){this.itemListHead&&(this.itemListHead.previous=t,t.next=this.itemListHead),this.itemListHead=t,this.itemsById.set(t.id,t),this.game.forceDraw=!0}detachItem(t){t&&(t.next&&(t.next.previous=t.previous),t.previous?t.previous.next=t.next:this.itemListHead===t&&(this.itemListHead=t.next),t.next=null,t.previous=null,this.itemsById.delete(t.id))}cycle(){if(this.game.tick>this.calculateTick){this.calculateTick=this.game.tick+200;for(var t=this.getHead();t;)this.validShooters.includes(t.type)&&(this.targetNearestPlayer(t),this.fireBullet(t)),t=t.next}this.processBombs()}fireBullet(t){if(this.validShooters.includes(t.type)&&this.game.tick>t.lastFired&&t.target){t.lastFired=this.game.tick+250;var e=t.angle*3.14/180,r=-(32/6*e),n=Math.sin(t.angle*3.14/180),s=Math.cos(t.angle*3.14/180)*-1,o=t.x+20+n*23,a=t.y+24+s*23;const l=t.ownerId??t.owner??this.game.player.id,u=t.teamId??this.game.player.city??null;Ls(this.game,o,a),this.game.bulletFactory.newBullet(l,o,a,0,r,u,{sourceId:t.id??null,sourceType:this.resolveItemSourceType(t),targetId:t.target??null}),ls(this.game,this.resolveDefenseShotSound(t),{x:o,y:a}),this.emitItemBulletShot(t,{x:o,y:a,angle:r,team:u})}}useMedkit(){const t=this.game?.player?.id;if(t==null)return!1;if(this.game?.player?.health>=Pi)return console.log("Health already full; medkit not consumed."),!1;if(!this.game.iconFactory||typeof this.game.iconFactory.findOwnedIconByType!="function")return!1;const e=this.game.iconFactory.findOwnedIconByType(t,vi);if(!e)return console.log("No MedKit available to use."),!1;const r=e.id??null;return this.game.iconFactory.consumeOwnedIcon(t,vi,1),this.game.player&&(this.game.player.health=Pi,this.game.forceDraw=!0),this.game.socketListener&&typeof this.game.socketListener.useItem=="function"&&this.game.socketListener.useItem("medkit",{iconId:r,type:vi}),!0}activateCloak(){const t=this.game?.player?.id;if(t==null||!this.game.iconFactory||typeof this.game.iconFactory.findOwnedIconByType!="function")return!1;const e=this.game.iconFactory.findOwnedIconByType(t,vn);if(!e)return console.log("Cloak unavailable."),!1;const n=(this.game.tick||Date.now())+Mf;this.game.player&&(this.game.player.isCloaked=!0,this.game.player.cloakExpiresAt=n,this.game.forceDraw=!0);const s=this.game.player?.offset;return s&&Number.isFinite(s.x)&&Number.isFinite(s.y)?ls(this.game,he.CLOAK,{x:s.x+24,y:s.y+24}):ls(this.game,he.CLOAK),this.game.socketListener&&typeof this.game.socketListener.useItem=="function"&&this.game.socketListener.useItem("cloak",{iconId:e.id??null,type:vn,duration:Mf}),!0}freezeCurrentPlayer(t=K_,e="dfg"){if(!this.game||!this.game.player)return;const r=this.game.tick||Date.now();this.game.player.isFrozen=!0,this.game.player.frozenUntil=r+Math.max(0,t),this.game.player.frozenBy=e,this.game.player.isMoving=0,this.game.player.isTurning=0,this.game.forceDraw=!0}triggerDFG(t){!t||t.type!==dt||(t.active=!1,t.armed=!1,t.hidden=!0,this.freezeCurrentPlayer(),this.game.forceDraw=!0)}targetNearestPlayer(t){var e=null;const r=t.teamId??null,n=(o,a)=>{if(!o||!o.offset)return;const l=o.city??null;if(!(r!==null&&l===r)){var u=o.offset.x-t.x,c=o.offset.y-t.y,h=Math.sqrt(u*u+c*c);h>400||(!e||h<e.distance)&&(e={id:a,x:o.offset.x,y:o.offset.y,distance:h,team:l})}};if(n(this.game.player,this.game.player.id),Object.keys(this.game.otherPlayers).forEach(o=>{n(this.game.otherPlayers[o],o)}),this.game.rogueTankManager&&Array.isArray(this.game.rogueTankManager.tanks)&&this.game.rogueTankManager.tanks.forEach(o=>{!o||!o.offset||n(o,o.id||`rogue_${o.offset.x}_${o.offset.y}`)}),e){t.target=e.id,t.targetTeam=e.team??null;var s=Math.atan2(e.x-t.x,e.y-t.y);s=Math.ceil(s*180/3.14),e.x>=t.x?t.angle=180-s:e.x<=t.x?t.angle=s*-1+170:t.angle=s}else t.target=null,t.targetTeam=null}ensureItemDurability(t,e=null){if(!t)return;const r=Number.isFinite(e)?e:t.type,n=ZI(r);n!=null&&(Number.isFinite(t.maxLife)||(t.maxLife=n),Number.isFinite(t.life)||(t.life=n));const s=JI(r);s!=null&&(Number.isFinite(t.burnThreshold)||(t.burnThreshold=s)),Object.prototype.hasOwnProperty.call(t,"isBurning")||(t.isBurning=!1),Number.isFinite(t.life)&&Number.isFinite(t.burnThreshold)&&Number.isFinite(t.maxLife)&&t.life<t.maxLife&&t.life<=t.burnThreshold&&this.markItemBurning(t)}markItemBurning(t){t&&(t.isBurning||(t.isBurning=!0,t.lifeState="burning",Number.isFinite(t.animation)||(t.animation=1),Number.isFinite(t.animationTick)||(t.animationTick=0)))}isHazardType(t){return Pd.has(t)}shouldRemoveOnHit(t){return KI.has(t)?!0:!jI.has(t)}destroyItem(t,e={}){if(!t)return;const r=Number.isFinite(e.impactX)?e.impactX:t.x,n=Number.isFinite(e.impactY)?e.impactY:t.y;e.spawnExplosion!==!1&&this.spawnExplosion(r,n),this.deleteItem(t,{notifyServer:e.notifyServer,reason:e.reason||"destroyed"}),this.game.forceDraw=!0}handleBulletHit(t,e){if(!t||!e)return{consumed:!1};if(e.sourceId&&t.id&&e.sourceId===t.id)return{consumed:!1};const r=Number.isFinite(e.x)?e.x:t.x,n=Number.isFinite(e.y)?e.y:t.y,s=Number.isFinite(e.damage)?e.damage:5,o={consumed:!0,destroyed:!1,type:t.type};return this.shouldRemoveOnHit(t.type)?(this.destroyItem(t,{impactX:r,impactY:n}),o.destroyed=!0,o):(this.ensureItemDurability(t),Number.isFinite(t.life)?(t.life-=s,t.life<=0?(this.destroyItem(t,{impactX:r,impactY:n}),o.destroyed=!0,o):(Number.isFinite(t.burnThreshold)&&t.life<=t.burnThreshold&&this.markItemBurning(t),this.spawnExplosion(r,n),this.game.forceDraw=!0,o)):(this.destroyItem(t,{impactX:r,impactY:n}),o.destroyed=!0,o))}newItem(t,e,r,n,s={}){if(!this.validIcons.includes(n))return null;let o=null,a=null;if(t&&typeof t=="object"?(o=t.owner??t.id??null,a=t.city??null):t!==void 0&&(o=t),a===null&&o!==null&&(a=this.game.player?.city??null),s.teamId!==void 0&&s.teamId!==null){const E=Number(s.teamId);Number.isFinite(E)&&(a=Math.floor(E))}if(!Number.isFinite(a)&&s.city!==void 0&&s.city!==null){const E=Number(s.city);Number.isFinite(E)&&(a=Math.floor(E))}let l=e,u=r;(n===Ie||n===et)&&(l=Math.floor(e/48)*48,u=Math.floor(r/48)*48);const c=Pd.has(n),h=WI.has(n),f=s.notifyServer!==!1&&c,d=s.notifyServer!==!1&&!c&&h,p=f?this.generateHazardId():d?this.generateDefenseId():null,v=s.id||p||`item_${Date.now()}_${Math.random().toString(16).slice(2)}`,y=t&&typeof t=="object"&&t.armed!==void 0?!!t.armed:this.game.player?.bombsArmed??!1,g={id:v,owner:o,ownerId:o,teamId:a,city:a,x:l,y:u,target:null,targetTeam:null,type:n,lastFired:0,active:n===Ie?y:!0,armed:n===Ie?y:!0,detonateTick:s.detonateTick||null,next:null,previous:null,synced:!(f||d)};return g.isDefense=h,this.ensureItemDurability(g,n),this.insertItem(g),h&&!d&&this.pendingDefenseIds.delete(g.id),n===gi&&s.notifyServer!==!1&&this.queueOrbDrop(g,{ownerId:o,teamId:a}),f&&this.game.socketListener&&(this.pendingHazards.add(g.id),this.game.socketListener.spawnHazard({id:g.id,type:n,x:g.x,y:g.y,armed:g.active,ownerId:o,teamId:a})),d&&this.game.socketListener&&typeof this.game.socketListener.spawnDefense=="function"&&(this.pendingDefenseIds.add(g.id),this.game.socketListener.spawnDefense({id:g.id,type:n,x:g.x,y:g.y,ownerId:o,teamId:a,cityId:a,angle:g.angle??0})),n===Ie&&this.armBomb(g,g.active,{notifyServer:!1}),g}shouldNotifyServerForItem(t){if(!t||!this.game||!this.game.socketListener||typeof this.game.socketListener.sendBulletShot!="function")return!1;const e=this.game.player?.id??null;if(!e)return!1;const r=t.ownerId??t.owner??null;return t.isDefense||r==null?!0:r===e}resolveItemSourceType(t){return t?t.type===tt?"turret":t.type===pt?"plasma":t.type===xt?"sleeper":null:null}resolveDefenseShotSound(t){return t&&(t.type===tt||t.type===pt||t.type===xt)?he.TURRET:he.LASER}resolveItemTeam(t,e=null){if(!t)return e;const r=t.teamId??t.city??null;return Number.isFinite(r)?r:Number.isFinite(e)?e:this.game.player?.city??null}emitItemBulletShot(t,e){if(!this.shouldNotifyServerForItem(t))return;const r=this.game.socketListener;if(!r)return;const n=this.game.player?.id??null;if(!n)return;const s={shooter:n,x:e?.x??t.x,y:e?.y??t.y,type:e?.type??0,angle:e?.angle??0,team:this.resolveItemTeam(t,e?.team??null),sourceId:t.id??null,sourceType:this.resolveItemSourceType(t)||void 0,targetId:t.target??null};r.sendBulletShot(s)}deleteItem(t,e={}){if(!t)return null;const r=e.notifyServer!==!1,n=t.next;if(Array.isArray(this.pendingOrbItems)){const s=this.pendingOrbItems.indexOf(t);s!==-1&&this.pendingOrbItems.splice(s,1)}if(r&&this.isHazardType(t.type)&&this.game.socketListener&&typeof this.game.socketListener.removeHazard=="function")try{this.game.socketListener.removeHazard(t.id)}catch(s){console.debug("Failed to notify server about hazard removal",s)}if(r&&t.isDefense&&this.game.socketListener&&typeof this.game.socketListener.removeDefense=="function")try{this.game.socketListener.removeDefense(t.id)}catch(s){console.debug("Failed to notify server about defense removal",s)}return this.detachItem(t),this.pendingHazards.delete(t.id),this.pendingDefenseIds&&this.pendingDefenseIds.delete(t.id),n}processBombs(){}armBomb(t,e,r={}){!t||t.type!==Ie||(t.active=e,t.armed=e,r.notifyServer!==!1&&this.game.socketListener&&t.id&&this.game.socketListener.updateHazard({id:t.id,armed:!!e}))}detonateBomb(t,e={}){const r=e.notifyServer!==void 0?!!e.notifyServer:!0,n=Math.floor((t.x+24)/48),s=Math.floor((t.y+24)/48);console.log(`Bomb detonated at tile ${n}, ${s}`);let o=this.deleteItem(t,{notifyServer:r}),a=this.getHead();for(;a;){const u=a.next,c=Math.floor((a.x+24)/48),h=Math.floor((a.y+24)/48);Math.abs(c-n)<=Lf&&Math.abs(h-s)<=Lf&&this.deleteItem(a,{notifyServer:r}),a=u}let l=this.game.buildingFactory.getHead();for(;l;){const u=Math.floor(l.x)-n,c=Math.floor(l.y)-s;if(Math.abs(u)<=Rf&&Math.abs(c)<=Rf){if(l.type===Ot){l=l.next;continue}l=this.game.buildingFactory.deleteBuilding(l,r);continue}l=l.next}return this.damagePlayersInRadius(n,s),this.game.forceDraw=!0,o}damagePlayersInRadius(){}queueOrbDrop(t,e={}){if(!t||!this.game||!this.game.socketListener)return;const r=this.game.player?.id??null,n=e.ownerId??t.ownerId??r;if(!r||n!==r)return;Array.isArray(this.pendingOrbItems)||(this.pendingOrbItems=[]),this.pendingOrbItems.push(t),t.pendingOrbCheck=!0;const s={id:t.id,x:t.x,y:t.y,ownerId:n,city:e.teamId??t.teamId??this.game.player?.city??null,type:gi};this.game.socketListener.sendOrbDrop(s)}triggerMine(t){!t||t.type!==et||(t.active=!1,t.armed=!1,t.hidden=!0,this.game.forceDraw=!0)}onHazardSpawn(t){if(!t||!t.id)return;let e=this.itemsById.get(t.id);if(!e){const r=this.resolveItemType(t.type);if(e=this.newItem(null,t.x,t.y,r,{id:t.id,notifyServer:!1,detonateTick:t.detonateAt?t.detonateAt:null}),!e)return}this.applyHazardState(e,t),e.synced=!0,this.pendingHazards.delete(t.id)}onHazardUpdate(t){if(!t||!t.id)return;const e=this.itemsById.get(t.id);if(!e){this.onHazardSpawn(t);return}this.applyHazardState(e,t)}onHazardRemove(t){if(!t||!t.id)return;const e=this.itemsById.get(t.id);if(e){if(t.reason==="bomb_detonated"&&this.spawnExplosion(t.x??e.x,t.y??e.y),t.reason==="dfg_triggered"&&t.triggeredBy){const r=this.game.player?.id;t.triggeredBy===r&&this.freezeCurrentPlayer()}this.deleteItem(e,{notifyServer:!1}),this.game.forceDraw=!0}}onOrbResult(t){if(!Array.isArray(this.pendingOrbItems)||!this.pendingOrbItems.length)return;const e=this.pendingOrbItems.shift();!e||(e.pendingOrbCheck=!1,(t||{}).status!=="detonated")||(this.spawnExplosion(e.x,e.y),this.deleteItem(e,{notifyServer:!1}),this.game.forceDraw=!0)}applyHazardState(t,e){if(t.x=this.toFiniteNumber(e.x,t.x),t.y=this.toFiniteNumber(e.y,t.y),qI(t,e,(r,n)=>this.toFiniteNumber(r,n)),e.active!==void 0&&(t.active=!!e.active),e.armed!==void 0&&(t.armed=!!e.armed),e.detonateAt&&(t.detonateTick=e.detonateAt),e.life!==void 0){const r=this.toFiniteNumber(e.life,t.life);Number.isFinite(r)&&(t.life=r)}if(e.revealedAt!==void 0){const r=this.toFiniteNumber(e.revealedAt,t.revealedAt??null);t.revealedAt=Number.isFinite(r)?r:null}e.triggeredBy!==void 0&&(t.triggeredBy=e.triggeredBy??null),e.triggeredTeam!==void 0&&(t.triggeredTeam=e.triggeredTeam??null),this.ensureItemDurability(t)}resolveItemType(t){return t==="mine"||t===et||t===4?et:t==="bomb"||t===Ie||t===3?Ie:t==="dfg"||t===dt||t===7?dt:et}spawnExplosion(t,e){!this.game||!Array.isArray(this.game.explosions)||(this.game.explosions.push({x:t,y:e,frame:0,nextFrameTick:null,variant:"small"}),ls(this.game,he.EXPLOSION,{x:t,y:e}))}toFiniteNumber(t,e){if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t=="string"){const r=Number(t);if(Number.isFinite(r))return r}return e}getHead(){return this.itemListHead}getItemById(t){return t&&this.itemsById.get(t)||null}removeItemById(t,e={}){const r=this.getItemById(t);return r?(this.deleteItem(r,e),!0):!1}}const pe=48,Oe=pe/2,us=8,e1=2,t1=2,Od=18,r1=32,i1=5e3,n1=1300,s1=2200,o1=.55,a1=2800,cs=pe*10,Fd=6,Md=9e3,l1=4500,u1=2600,c1=1200,Rd=pe*7,h1=24e4,f1=pe*7,oi=pe*11,Ld=pe*13,d1=pe*7,p1=20,y1=6e4,m1=6e4,Nd=Object.freeze([Math.PI/4,-Math.PI/4,Math.PI/2,-Math.PI/2]),tu=pe*2.5,nr=(i,t=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const e=Number(i);if(Number.isFinite(e))return e}return t},hs=(i,t,e,r)=>{const n=i-e,s=t-r;return n*n+s*s},v1=i=>{const t=-i/16*Math.PI;return{dx:Math.sin(t),dy:Math.cos(t)}},Va=(i,t,e=0)=>{if(!Number.isFinite(i)||!Number.isFinite(t)||Math.abs(i)<1e-4&&Math.abs(t)<1e-4)return e;const r=Math.sqrt(i*i+t*t);if(r<1e-4)return e;const n=i/r,s=t/r,o=Math.atan2(-n,-s);let a=Math.round(-o/Math.PI*16);return a%=32,a<0&&(a+=32),a},ru=(i,t)=>{const e=Math.sqrt(i*i+t*t);return e<1e-4?{dx:0,dy:0}:{dx:i/e,dy:t/e}},g1=(i,t)=>{if(!i)return{dx:0,dy:0};const e=Math.cos(t),r=Math.sin(t),n=i.dx*e-i.dy*r,s=i.dx*r+i.dy*e;return ru(n,s)},b1=(i,t,e,r,n=tu)=>{const s=e-i,o=r-t;let a="",l="";return Math.abs(s)>n&&(a=s>0?"east":"west"),Math.abs(o)>n&&(l=o>0?"south":"north"),a&&l?`${l}-${a}`:l||a||""};class _1{constructor(t){this.game=t,this.tanks=[],this.nextId=1,this.nextSpawnCheck=0,this.instancePrefix=`local_${Math.random().toString(16).slice(-6)}`,this.nextAllowedSpawnTime=0,this.cityRadiusCache=new Map}getCallsignRegistry(){return this.game?.callsignRegistry||null}assignCallsign(t){const e=this.getCallsignRegistry();if(!e)return null;try{return e.assign(t)}catch{return null}}releaseCallsign(t){const e=this.getCallsignRegistry();if(e)try{e.release(t)}catch{}}sanitizeIdComponent(t){return!t||typeof t!="string"?null:t.replace(/[^a-zA-Z0-9_-]/g,"")}getClientInstanceId(){const t=this.game?.socketListener?.io?.id,e=this.sanitizeIdComponent(t);return e&&e.length?e:this.instancePrefix}createTankId(){const e=`rogue_${this.getClientInstanceId()}_${this.nextId}`;return this.nextId+=1,e}emitTankShot(t,e,r,n){const s=this.game?.socketListener;if(!s||typeof s.sendBulletShot!="function")return;const o=this.game.player?.id??null;o&&s.sendBulletShot({shooter:o,x:e,y:r,type:0,angle:-n,team:null,sourceId:t?.id??null,sourceType:"rogue_tank",targetId:typeof t?.target=="object"?t.target.id??null:null})}update(){if(!this.game||!this.game.buildingFactory)return;const t=this.game.tick||Date.now();t>=this.nextSpawnCheck&&(this.nextSpawnCheck=t+i1,this.evaluateSpawns(t)),this.updateTanks(t)}evaluateSpawns(t){const e=Number.isFinite(t)?t:this.game.tick||Date.now(),r=this.game.cities||[];if(!r.length)return;let n=Math.max(0,e1-this.tanks.length);n!==0&&(this.tanks.length===0&&this.nextAllowedSpawnTime>0&&e<this.nextAllowedSpawnTime||r.forEach((s,o)=>{if(!s||n<=0)return;const a=this.game.buildingFactory.countBuildingsForCity(o);if(a<Od)return;const l=this.tanks.filter(f=>f.targetCityId===o),u=a>=r1?2:1,c=Math.min(u,t1),h=Math.min(n,c-l.length);for(let f=0;f<h;f+=1)if(this.spawnTankNearCity(s,o,e)&&(n-=1,n<=0))return}))}updateTanks(t){for(let e=this.tanks.length-1;e>=0;e-=1){const r=this.tanks[e];if(!r){this.tanks.splice(e,1);continue}if(t-r.spawnedAt>h1||!this.cityStillValid(r.targetCityId)){this.removeTankAtIndex(e);continue}this.refreshTarget(r,t),this.updateMovement(r,t),this.tryShoot(r,t),this.tryDropBomb(r,t),this.updateBombs(r,t)}}cityStillValid(t){return this.game.cities?.[t]?this.game.buildingFactory.countBuildingsForCity(t)>=Od-3:!1}spawnTankNearCity(t,e,r){const n=nr(t?.x,0),s=nr(t?.y,0),o=n+pe*1.5,a=s+pe*1.5,l=Ld,u=Ld+d1;for(let c=0;c<p1;c+=1){const h=Math.random()*Math.PI*2,f=l+Math.random()*(u-l);let d=o+Math.cos(h)*f,p=a+Math.sin(h)*f;if(d=Math.max(Oe,Math.min(512*pe-Oe,d)),p=Math.max(Oe,Math.min(512*pe-Oe,p)),this.isBlocked(d,p))continue;const v=this.createTankId(),y=Number.isFinite(r)?r:this.game.tick||Date.now(),g=this.getCityEngageRadius(e,y),E={id:v,offset:{x:d,y:p},lastSafeOffset:{x:d,y:p},direction:Math.floor(Math.random()*32),isMoving:0,targetCityId:e,target:null,nextDecisionAt:y+250+Math.random()*250,nextTargetRefresh:y+Math.random()*500,fireCooldown:y+1400+Math.random()*900,bombCooldown:y+3800+Math.random()*2200,activeBombs:[],spawnedAt:y,city:-1,health:20,cachedVector:null,notifiedAttack:!1,engageRadius:g,nextRadiusRefresh:y+5e3};return E.callsign=this.assignCallsign(v)||`Rogue ${this.nextId}`,this.tanks.push(E),this.game.forceDraw=!0,!0}return!1}getCityCenter(t){const e=this.game.cities?.[t];if(!e)return null;const r=nr(e.x,0)+pe*1.5,n=nr(e.y,0)+pe*1.5;return{x:r,y:n}}refreshTarget(t,e){if(e<t.nextTargetRefresh)return;t.nextTargetRefresh=e+s1+Math.random()*1200;const r=this.getCityCenter(t.targetCityId);if(r){(!Number.isFinite(t.engageRadius)||e>=(t.nextRadiusRefresh||0))&&(t.engageRadius=this.getCityEngageRadius(t.targetCityId,e),t.nextRadiusRefresh=e+5e3);const o=Number.isFinite(t.engageRadius)?t.engageRadius:oi;if(hs(t.offset.x+Oe,t.offset.y+Oe,r.x,r.y)>o*o){t.target={kind:"point",x:r.x,y:r.y};return}this.notifyCityUnderAttack(t,t.targetCityId,r,o)}const n=this.pickNearestTurret(t);if(n){t.target=n;return}const s=this.pickWanderPoint(t.targetCityId);t.target=s}pickNearestTurret(t){const e=this.game.itemFactory;if(!e)return null;let r=e.getHead(),n=null;const s=cs*cs*1.3;for(;r;){if(r.type===tt||r.type===pt){const o=hs(r.x+Oe,r.y+Oe,t.offset.x+Oe,t.offset.y+Oe);o<s&&(!n||o<n.distanceSq)&&(n={kind:"item",id:r.id,x:r.x+Oe,y:r.y+Oe,distanceSq:o})}r=r.next}return n}pickWanderPoint(t){const e=this.game.cities?.[t],r=nr(e?.x,0)+pe*1.5,n=nr(e?.y,0)+pe*1.5,s=Math.random()*Math.PI*2,o=pe*2+Math.random()*f1;return{kind:"point",x:r+Math.cos(s)*o,y:n+Math.sin(s)*o}}updateMovement(t,e){if(e<t.nextDecisionAt){this.applyMovement(t,e,t.cachedVector)||(t.nextDecisionAt=e);return}t.nextDecisionAt=e+n1+Math.random()*900;const r=this.resolveTargetPosition(t.target);if(!r){t.cachedVector=null,t.isMoving=0;return}const n=r.x-(t.offset.x+Oe),s=r.y-(t.offset.y+Oe);if(n*n+s*s<pe*pe*2.5){t.cachedVector=null,t.isMoving=0;return}const a=ru(n,s),l=(Math.random()-.5)*.4,u=ru(a.dx+l,a.dy+l);t.cachedVector=u,t.direction=Va(u.dx,u.dy,t.direction),this.applyMovement(t,e,u)||(t.nextDecisionAt=e+400+Math.random()*300)}applyMovement(t,e,r){if(!r||!Number.isFinite(r.dx)||!Number.isFinite(r.dy)||Math.abs(r.dx)<1e-4&&Math.abs(r.dy)<1e-4)return t.isMoving=0,!1;const s=Math.min(this.game.timePassed||0,60)*im*o1;if(s<=0)return!1;if(this.tryStep(t,r,s))return t.isMoving=1,!0;const o=this.findAlternateVector(t,r,s);return o&&this.tryStep(t,o,s)?(t.cachedVector=o,t.direction=Va(o.dx,o.dy,t.direction),t.isMoving=1,!0):(t.isMoving=0,t.cachedVector=null,t.nextDecisionAt=Math.min(t.nextDecisionAt||e+400,e+450+Math.random()*250),!1)}tryStep(t,e,r){if(!e)return!1;const n=t.offset.x+e.dx*r,s=t.offset.y+e.dy*r;return this.isBlocked(n,s)?!1:(t.offset.x=n,t.offset.y=s,t.lastSafeOffset={x:n,y:s},!0)}findAlternateVector(t,e,r){if(!e)return null;for(let n=0;n<Nd.length;n+=1){const s=g1(e,Nd[n]);if(!s||Math.abs(s.dx)<1e-4&&Math.abs(s.dy)<1e-4)continue;const o=t.offset.x+s.dx*r,a=t.offset.y+s.dy*r;if(!this.isBlocked(o,a))return s}return null}resolveTargetPosition(t){if(!t)return null;if(t.kind==="item"&&t.id){const e=this.game.itemFactory?.itemsById?.get(t.id);return e?(t.x=e.x+Oe,t.y=e.y+Oe,t):null}return t}tryShoot(t,e){if(e<t.fireCooldown)return;const r=this.resolveTargetPosition(t.target);if(!r||hs(t.offset.x+Oe,t.offset.y+Oe,r.x,r.y)>cs*cs)return;const s=Math.floor(Math.random()*Fd-Fd/2),o=r.x-(t.offset.x+Oe),a=r.y-(t.offset.y+Oe);let l=Va(o,a,t.direction);l=(l+s)%32,l<0&&(l+=32);const u=v1(l),c=t.offset.x+Oe+u.dx*30,h=t.offset.y+Oe+u.dy*30;this.game.bulletFactory.newBullet(t.id,c,h,0,-l,null),this.emitTankShot(t,c,h,l),t.fireCooldown=e+a1+Math.random()*800}tryDropBomb(t,e){if(e<t.bombCooldown)return;const r=this.game.cities?.[t.targetCityId];if(!r)return;const n=nr(r.x,0)+pe*1.5,s=nr(r.y,0)+pe*1.5;if(hs(t.offset.x+Oe,t.offset.y+Oe,n,s)>Rd*Rd)return;const a=this.game.itemFactory?.newItem({id:t.id,city:null,armed:!0},t.offset.x,t.offset.y,Ie,{notifyServer:!1});if(!a){t.bombCooldown=e+Md;return}a.active=!0,a.armed=!0;const l={item:a,detonateAt:e+u1+Math.random()*c1};t.activeBombs.push(l),t.bombCooldown=e+Md+Math.random()*l1,this.game.forceDraw=!0}updateBombs(t,e){if(!Array.isArray(t.activeBombs)||!t.activeBombs.length)return;const r=[];for(let n=0;n<t.activeBombs.length;n+=1){const s=t.activeBombs[n];if(!(!s||!s.item)){if(e>=s.detonateAt){this.game.itemFactory.spawnExplosion(s.item.x,s.item.y),this.game.itemFactory.detonateBomb(s.item,{notifyServer:!1});continue}r.push(s)}}t.activeBombs=r}isBlocked(t,e){const r={x:t+us,y:e+us,w:pe-us*2,h:pe-us*2};return!!(this.hitsEdges(r)||this.hitsBlockingTile(r)||this.hitsBuilding(r)||this.hitsItem(r))}hitsEdges(t){return t.x<0||t.y<0||t.x+t.w>512*pe||t.y+t.h>512*pe}hitsBlockingTile(t){const e=this.game.map;if(!Array.isArray(e)||!e.length)return!1;const r=Math.floor(t.x/pe),n=Math.floor((t.x+t.w)/pe),s=Math.floor(t.y/pe),o=Math.floor((t.y+t.h)/pe),a=(l,u)=>{try{return e[l][u]!==0&&e[l][u]!==3}catch{return!0}};return a(r,s)||a(r,o)||a(n,s)||a(n,o)}hitsBuilding(t){let e=this.game.buildingFactory.getHead();for(;e;){const r={x:e.x*pe,y:e.y*pe,w:pe*3,h:pe*3};if(Kt(t,r))return!0;e=e.next}return!1}hitsItem(t){let e=this.game.itemFactory.getHead();for(;e;){const r={x:e.x,y:e.y,w:pe,h:pe};if(Kt(t,r))return!0;e=e.next}return!1}resolveBulletKillDetails(t){const e={killerId:null,killerCallsign:null,sourceType:t&&t.sourceType?String(t.sourceType).toLowerCase():null,hazardType:null};if(!t)return e;const r=[t.sourceId,t.shooter];for(let n=0;n<r.length;n+=1){const s=r[n];if(s==null)continue;const o=`${s}`;e.killerId=o;const a=typeof this.game?.resolveCallsign=="function"?this.game.resolveCallsign(o):null;if(a){e.killerCallsign=a;break}}return typeof this.game?.describeKillSource=="function"?e.killerLabel=this.game.describeKillSource(e):e.killerCallsign?e.killerLabel=e.killerCallsign:e.killerLabel="Unknown Forces",e}announceRogueDeath(t,e){if(!t||typeof this.game?.notify!="function")return;const r=t.callsign||(typeof this.game?.resolveCallsign=="function"?this.game.resolveCallsign(t.id):null)||"Rogue Tank";let n=e?.killerLabel;e&&e.killerId&&`${e.killerId}`==`${t.id}`&&(n="Self-Inflicted"),(!n||!n.trim().length)&&typeof this.game?.describeKillSource=="function"&&(n=this.game.describeKillSource(e||{})),(!n||!n.trim().length)&&(n="Unknown Forces"),this.game.notify({title:"Elimination",message:`${r} killed by ${n}.`,variant:"warn",timeout:5200})}handleBulletCollision(t,e){if(!e||t.shooter&&t.shooter===e.id)return;const r=Number.isFinite(t.damage)?t.damage:5;if(e.health-=r,e.health<=0){const n=this.resolveBulletKillDetails(t);this.spawnTankExplosion(e),this.announceRogueDeath(e,n),this.removeTank(e)}}spawnTankExplosion(t){Array.isArray(this.game.explosions)&&this.game.explosions.push({x:t.offset.x,y:t.offset.y,frame:0,nextFrameTick:(this.game.tick||Date.now())+75,variant:"small"})}removeTank(t){const e=this.tanks.indexOf(t);e!==-1&&this.removeTankAtIndex(e)}removeTankAtIndex(t){const[e]=this.tanks.splice(t,1);e&&Array.isArray(e.activeBombs)&&e.activeBombs.forEach(r=>{!r||!r.item||this.game.itemFactory.deleteItem(r.item)}),this.tanks.length===0&&this.scheduleNextSpawn(),e&&this.releaseCallsign(e.id),this.game.forceDraw=!0}scheduleNextSpawn(){const t=this.game.tick||Date.now(),e=y1+Math.random()*m1;this.nextAllowedSpawnTime=t+e}notifyCityUnderAttack(t,e,r,n){if(!t||t.notifiedAttack)return;const s=this.game?.notify;if(typeof s!="function")return;const o=Ae(e),a=b1(r?.x??0,r?.y??0,t.offset?.x??0,t.offset?.y??0,Math.max(tu,(n||tu)*.25)),l=a?`Rogue tank assaulting ${o} from the ${a}.`:`Rogue tank assaulting ${o}.`;s({title:"Rogue Assault",message:l,variant:"warn",timeout:6500}),t.notifiedAttack=!0}getCityEngageRadius(t,e){const r=Number.isFinite(t)?t:parseInt(t,10);if(!Number.isFinite(r))return oi;const n=Number.isFinite(e)?e:this.game.tick||Date.now(),s=this.cityRadiusCache.get(r);if(s&&n-s.timestamp<4e3)return s.radius;const o=this.computeCityEngageRadius(r);return this.cityRadiusCache.set(r,{radius:o,timestamp:n}),o}computeCityEngageRadius(t){if(!this.game?.buildingFactory||typeof this.game.buildingFactory.measureCityLayout!="function")return oi;const e=this.game.buildingFactory.measureCityLayout(t);if(!e)return oi;const r=Number.isFinite(e.maxRadiusSq)&&e.maxRadiusSq>0?Math.sqrt(e.maxRadiusSq):0;return!Number.isFinite(r)||r<=0?oi:Math.max(oi,r+pe*4)}}const Dt=Object.create(null);Dt.open="0";Dt.close="1";Dt.ping="2";Dt.pong="3";Dt.message="4";Dt.upgrade="5";Dt.noop="6";const Ts=Object.create(null);Object.keys(Dt).forEach(i=>{Ts[Dt[i]]=i});const iu={type:"error",data:"parser error"},gv=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",bv=typeof ArrayBuffer=="function",_v=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,cc=({type:i,data:t},e,r)=>gv&&t instanceof Blob?e?r(t):Bd(t,r):bv&&(t instanceof ArrayBuffer||_v(t))?e?r(t):Bd(new Blob([t]),r):r(Dt[i]+(t||"")),Bd=(i,t)=>{const e=new FileReader;return e.onload=function(){const r=e.result.split(",")[1];t("b"+(r||""))},e.readAsDataURL(i)};function Dd(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let qa;function x1(i,t){if(gv&&i.data instanceof Blob)return i.data.arrayBuffer().then(Dd).then(t);if(bv&&(i.data instanceof ArrayBuffer||_v(i.data)))return t(Dd(i.data));cc(i,!1,e=>{qa||(qa=new TextEncoder),t(qa.encode(e))})}const kd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",sn=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<kd.length;i++)sn[kd.charCodeAt(i)]=i;const w1=i=>{let t=i.length*.75,e=i.length,r,n=0,s,o,a,l;i[i.length-1]==="="&&(t--,i[i.length-2]==="="&&t--);const u=new ArrayBuffer(t),c=new Uint8Array(u);for(r=0;r<e;r+=4)s=sn[i.charCodeAt(r)],o=sn[i.charCodeAt(r+1)],a=sn[i.charCodeAt(r+2)],l=sn[i.charCodeAt(r+3)],c[n++]=s<<2|o>>4,c[n++]=(o&15)<<4|a>>2,c[n++]=(a&3)<<6|l&63;return u},T1=typeof ArrayBuffer=="function",hc=(i,t)=>{if(typeof i!="string")return{type:"message",data:xv(i,t)};const e=i.charAt(0);return e==="b"?{type:"message",data:I1(i.substring(1),t)}:Ts[e]?i.length>1?{type:Ts[e],data:i.substring(1)}:{type:Ts[e]}:iu},I1=(i,t)=>{if(T1){const e=w1(i);return xv(e,t)}else return{base64:!0,data:i}},xv=(i,t)=>{switch(t){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},wv="",E1=(i,t)=>{const e=i.length,r=new Array(e);let n=0;i.forEach((s,o)=>{cc(s,!1,a=>{r[o]=a,++n===e&&t(r.join(wv))})})},S1=(i,t)=>{const e=i.split(wv),r=[];for(let n=0;n<e.length;n++){const s=hc(e[n],t);if(r.push(s),s.type==="error")break}return r};function C1(){return new TransformStream({transform(i,t){x1(i,e=>{const r=e.length;let n;if(r<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,r);else if(r<65536){n=new Uint8Array(3);const s=new DataView(n.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{n=new Uint8Array(9);const s=new DataView(n.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}i.data&&typeof i.data!="string"&&(n[0]|=128),t.enqueue(n),t.enqueue(e)})}})}let ja;function fs(i){return i.reduce((t,e)=>t+e.length,0)}function ds(i,t){if(i[0].length===t)return i.shift();const e=new Uint8Array(t);let r=0;for(let n=0;n<t;n++)e[n]=i[0][r++],r===i[0].length&&(i.shift(),r=0);return i.length&&r<i[0].length&&(i[0]=i[0].slice(r)),e}function A1(i,t){ja||(ja=new TextDecoder);const e=[];let r=0,n=-1,s=!1;return new TransformStream({transform(o,a){for(e.push(o);;){if(r===0){if(fs(e)<1)break;const l=ds(e,1);s=(l[0]&128)===128,n=l[0]&127,n<126?r=3:n===126?r=1:r=2}else if(r===1){if(fs(e)<2)break;const l=ds(e,2);n=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if(fs(e)<8)break;const l=ds(e,8),u=new DataView(l.buffer,l.byteOffset,l.length),c=u.getUint32(0);if(c>Math.pow(2,21)-1){a.enqueue(iu);break}n=c*Math.pow(2,32)+u.getUint32(4),r=3}else{if(fs(e)<n)break;const l=ds(e,n);a.enqueue(hc(s?l:ja.decode(l),t)),r=0}if(n===0||n>i){a.enqueue(iu);break}}}})}const Tv=4;function ke(i){if(i)return P1(i)}function P1(i){for(var t in ke.prototype)i[t]=ke.prototype[t];return i}ke.prototype.on=ke.prototype.addEventListener=function(i,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(t),this};ke.prototype.once=function(i,t){function e(){this.off(i,e),t.apply(this,arguments)}return e.fn=t,this.on(i,e),this};ke.prototype.off=ke.prototype.removeListener=ke.prototype.removeAllListeners=ke.prototype.removeEventListener=function(i,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var e=this._callbacks["$"+i];if(!e)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var r,n=0;n<e.length;n++)if(r=e[n],r===t||r.fn===t){e.splice(n,1);break}return e.length===0&&delete this._callbacks["$"+i],this};ke.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),e=this._callbacks["$"+i],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(e){e=e.slice(0);for(var r=0,n=e.length;r<n;++r)e[r].apply(this,t)}return this};ke.prototype.emitReserved=ke.prototype.emit;ke.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};ke.prototype.hasListeners=function(i){return!!this.listeners(i).length};const no=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,e)=>e(t,0),bt=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),O1="arraybuffer";function Iv(i,...t){return t.reduce((e,r)=>(i.hasOwnProperty(r)&&(e[r]=i[r]),e),{})}const F1=bt.setTimeout,M1=bt.clearTimeout;function so(i,t){t.useNativeTimers?(i.setTimeoutFn=F1.bind(bt),i.clearTimeoutFn=M1.bind(bt)):(i.setTimeoutFn=bt.setTimeout.bind(bt),i.clearTimeoutFn=bt.clearTimeout.bind(bt))}const R1=1.33;function L1(i){return typeof i=="string"?N1(i):Math.ceil((i.byteLength||i.size)*R1)}function N1(i){let t=0,e=0;for(let r=0,n=i.length;r<n;r++)t=i.charCodeAt(r),t<128?e+=1:t<2048?e+=2:t<55296||t>=57344?e+=3:(r++,e+=4);return e}function Ev(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function B1(i){let t="";for(let e in i)i.hasOwnProperty(e)&&(t.length&&(t+="&"),t+=encodeURIComponent(e)+"="+encodeURIComponent(i[e]));return t}function D1(i){let t={},e=i.split("&");for(let r=0,n=e.length;r<n;r++){let s=e[r].split("=");t[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return t}class k1 extends Error{constructor(t,e,r){super(t),this.description=e,this.context=r,this.type="TransportError"}}class fc extends ke{constructor(t){super(),this.writable=!1,so(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,e,r){return super.emitReserved("error",new k1(t,e,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=hc(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,e={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(e)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const e=B1(t);return e.length?"?"+e:""}}class U1 extends fc{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||e()})),this.writable||(r++,this.once("drain",function(){--r||e()}))}else e()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const e=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};S1(t,this.socket.binaryType).forEach(e),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,E1(t,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",e=this.query||{};return this.opts.timestampRequests!==!1&&(e[this.opts.timestampParam]=Ev()),!this.supportsBinary&&!e.sid&&(e.b64=1),this.createUri(t,e)}}let Sv=!1;try{Sv=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const X1=Sv;function H1(){}class G1 extends U1{constructor(t){if(super(t),typeof location<"u"){const e=location.protocol==="https:";let r=location.port;r||(r=e?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||r!==t.port}}doWrite(t,e){const r=this.request({method:"POST",data:t});r.on("success",e),r.on("error",(n,s)=>{this.onError("xhr post error",n,s)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(e,r)=>{this.onError("xhr poll error",e,r)}),this.pollXhr=t}}class Lt extends ke{constructor(t,e,r){super(),this.createRequest=t,so(this,r),this._opts=r,this._method=r.method||"GET",this._uri=e,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var t;const e=Iv(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(e);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&r.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var n;r.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=Lt.requestsCount++,Lt.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=H1,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Lt.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Lt.requestsCount=0;Lt.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",Ud);else if(typeof addEventListener=="function"){const i="onpagehide"in bt?"pagehide":"unload";addEventListener(i,Ud,!1)}}function Ud(){for(let i in Lt.requests)Lt.requests.hasOwnProperty(i)&&Lt.requests[i].abort()}const Y1=(function(){const i=Cv({xdomain:!1});return i&&i.responseType!==null})();class z1 extends G1{constructor(t){super(t);const e=t&&t.forceBase64;this.supportsBinary=Y1&&!e}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Lt(Cv,this.uri(),t)}}function Cv(i){const t=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||X1))return new XMLHttpRequest}catch{}if(!t)try{return new bt[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Av=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class $1 extends fc{get name(){return"websocket"}doOpen(){const t=this.uri(),e=this.opts.protocols,r=Av?{}:Iv(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,e,r)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const r=t[e],n=e===t.length-1;cc(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}n&&no(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",e=this.query||{};return this.opts.timestampRequests&&(e[this.opts.timestampParam]=Ev()),this.supportsBinary||(e.b64=1),this.createUri(t,e)}}const Wa=bt.WebSocket||bt.MozWebSocket;class V1 extends $1{createSocket(t,e,r){return Av?new Wa(t,e,r):e?new Wa(t,e):new Wa(t)}doWrite(t,e){this.ws.send(e)}}class q1 extends fc{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const e=A1(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=t.readable.pipeThrough(e).getReader(),n=C1();n.readable.pipeTo(t.writable),this._writer=n.writable.getWriter();const s=()=>{r.read().then(({done:a,value:l})=>{a||(this.onPacket(l),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const r=t[e],n=e===t.length-1;this._writer.write(r).then(()=>{n&&no(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const j1={websocket:V1,webtransport:q1,polling:z1},W1=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,K1=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function nu(i){if(i.length>8e3)throw"URI too long";const t=i,e=i.indexOf("["),r=i.indexOf("]");e!=-1&&r!=-1&&(i=i.substring(0,e)+i.substring(e,r).replace(/:/g,";")+i.substring(r,i.length));let n=W1.exec(i||""),s={},o=14;for(;o--;)s[K1[o]]=n[o]||"";return e!=-1&&r!=-1&&(s.source=t,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=Z1(s,s.path),s.queryKey=J1(s,s.query),s}function Z1(i,t){const e=/\/{2,9}/g,r=t.replace(e,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&r.splice(0,1),t.slice(-1)=="/"&&r.splice(r.length-1,1),r}function J1(i,t){const e={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,s){n&&(e[n]=s)}),e}const su=typeof addEventListener=="function"&&typeof removeEventListener=="function",Is=[];su&&addEventListener("offline",()=>{Is.forEach(i=>i())},!1);class dr extends ke{constructor(t,e){if(super(),this.binaryType=O1,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(e=t,t=null),t){const r=nu(t);e.hostname=r.host,e.secure=r.protocol==="https"||r.protocol==="wss",e.port=r.port,r.query&&(e.query=r.query)}else e.host&&(e.hostname=nu(e.host).host);so(this,e),this.secure=e.secure!=null?e.secure:typeof location<"u"&&location.protocol==="https:",e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=e.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},e.transports.forEach(r=>{const n=r.prototype.name;this.transports.push(n),this._transportsByName[n]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},e),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=D1(this.opts.query)),su&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Is.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=Tv,e.transport=t,this.id&&(e.sid=this.id);const r=Object.assign({},this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&dr.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const e=this.createTransport(t);e.open(),this.setTransport(e)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",e=>this._onClose("transport close",e))}onOpen(){this.readyState="open",dr.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const e=new Error("server error");e.code=t.data,this._onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(e+=L1(n)),r>0&&e>this._maxPayload)return this.writeBuffer.slice(0,r);e+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,no(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,e,r){return this._sendPacket("message",t,e,r),this}send(t,e,r){return this._sendPacket("message",t,e,r),this}_sendPacket(t,e,r,n){if(typeof e=="function"&&(n=e,e=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:t,data:e,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},r=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():t()}):this.upgrading?r():t()),this}_onError(t){if(dr.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),su&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=Is.indexOf(this._offlineEventListener);r!==-1&&Is.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this._prevBufferLen=0}}}dr.protocol=Tv;class Q1 extends dr{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let e=this.createTransport(t),r=!1;dr.priorWebsocketSuccess=!1;const n=()=>{r||(e.send([{type:"ping",data:"probe"}]),e.once("packet",h=>{if(!r)if(h.type==="pong"&&h.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;dr.priorWebsocketSuccess=e.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(c(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=e.name,this.emitReserved("upgradeError",f)}}))};function s(){r||(r=!0,c(),e.close(),e=null)}const o=h=>{const f=new Error("probe error: "+h);f.transport=e.name,s(),this.emitReserved("upgradeError",f)};function a(){o("transport closed")}function l(){o("socket closed")}function u(h){e&&h.name!==e.name&&s()}const c=()=>{e.removeListener("open",n),e.removeListener("error",o),e.removeListener("close",a),this.off("close",l),this.off("upgrading",u)};e.once("open",n),e.once("error",o),e.once("close",a),this.once("close",l),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{r||e.open()},200):e.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const e=[];for(let r=0;r<t.length;r++)~this.transports.indexOf(t[r])&&e.push(t[r]);return e}}let eE=class extends Q1{constructor(t,e={}){const r=typeof t=="object"?t:e;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(n=>j1[n]).filter(n=>!!n)),super(t,r)}};function tE(i,t="",e){let r=i;e=e||typeof location<"u"&&location,i==null&&(i=e.protocol+"//"+e.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=e.protocol+i:i=e.host+i),/^(https?|wss?):\/\//.test(i)||(typeof e<"u"?i=e.protocol+"//"+i:i="https://"+i),r=nu(i)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+t,r.href=r.protocol+"://"+s+(e&&e.port===r.port?"":":"+r.port),r}const rE=typeof ArrayBuffer=="function",iE=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,Pv=Object.prototype.toString,nE=typeof Blob=="function"||typeof Blob<"u"&&Pv.call(Blob)==="[object BlobConstructor]",sE=typeof File=="function"||typeof File<"u"&&Pv.call(File)==="[object FileConstructor]";function dc(i){return rE&&(i instanceof ArrayBuffer||iE(i))||nE&&i instanceof Blob||sE&&i instanceof File}function Es(i,t){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let e=0,r=i.length;e<r;e++)if(Es(i[e]))return!0;return!1}if(dc(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return Es(i.toJSON(),!0);for(const e in i)if(Object.prototype.hasOwnProperty.call(i,e)&&Es(i[e]))return!0;return!1}function oE(i){const t=[],e=i.data,r=i;return r.data=ou(e,t),r.attachments=t.length,{packet:r,buffers:t}}function ou(i,t){if(!i)return i;if(dc(i)){const e={_placeholder:!0,num:t.length};return t.push(i),e}else if(Array.isArray(i)){const e=new Array(i.length);for(let r=0;r<i.length;r++)e[r]=ou(i[r],t);return e}else if(typeof i=="object"&&!(i instanceof Date)){const e={};for(const r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=ou(i[r],t));return e}return i}function aE(i,t){return i.data=au(i.data,t),delete i.attachments,i}function au(i,t){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<t.length)return t[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let e=0;e<i.length;e++)i[e]=au(i[e],t);else if(typeof i=="object")for(const e in i)Object.prototype.hasOwnProperty.call(i,e)&&(i[e]=au(i[e],t));return i}const lE=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],uE=5;var ye;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(ye||(ye={}));class cE{constructor(t){this.replacer=t}encode(t){return(t.type===ye.EVENT||t.type===ye.ACK)&&Es(t)?this.encodeAsBinary({type:t.type===ye.EVENT?ye.BINARY_EVENT:ye.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let e=""+t.type;return(t.type===ye.BINARY_EVENT||t.type===ye.BINARY_ACK)&&(e+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(e+=t.nsp+","),t.id!=null&&(e+=t.id),t.data!=null&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=oE(t),r=this.encodeAsString(e.packet),n=e.buffers;return n.unshift(r),n}}function Xd(i){return Object.prototype.toString.call(i)==="[object Object]"}class pc extends ke{constructor(t){super(),this.reviver=t}add(t){let e;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t);const r=e.type===ye.BINARY_EVENT;r||e.type===ye.BINARY_ACK?(e.type=r?ye.EVENT:ye.ACK,this.reconstructor=new hE(e),e.attachments===0&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else if(dc(t)||t.base64)if(this.reconstructor)e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let e=0;const r={type:Number(t.charAt(0))};if(ye[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===ye.BINARY_EVENT||r.type===ye.BINARY_ACK){const s=e+1;for(;t.charAt(++e)!=="-"&&e!=t.length;);const o=t.substring(s,e);if(o!=Number(o)||t.charAt(e)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(t.charAt(e+1)==="/"){const s=e+1;for(;++e&&!(t.charAt(e)===","||e===t.length););r.nsp=t.substring(s,e)}else r.nsp="/";const n=t.charAt(e+1);if(n!==""&&Number(n)==n){const s=e+1;for(;++e;){const o=t.charAt(e);if(o==null||Number(o)!=o){--e;break}if(e===t.length)break}r.id=Number(t.substring(s,e+1))}if(t.charAt(++e)){const s=this.tryParse(t.substr(e));if(pc.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,e){switch(t){case ye.CONNECT:return Xd(e);case ye.DISCONNECT:return e===void 0;case ye.CONNECT_ERROR:return typeof e=="string"||Xd(e);case ye.EVENT:case ye.BINARY_EVENT:return Array.isArray(e)&&(typeof e[0]=="number"||typeof e[0]=="string"&&lE.indexOf(e[0])===-1);case ye.ACK:case ye.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class hE{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const e=aE(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const fE=Object.freeze(Object.defineProperty({__proto__:null,Decoder:pc,Encoder:cE,get PacketType(){return ye},protocol:uE},Symbol.toStringTag,{value:"Module"}));function St(i,t,e){return i.on(t,e),function(){i.off(t,e)}}const dE=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Ov extends ke{constructor(t,e,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[St(t,"open",this.onopen.bind(this)),St(t,"packet",this.onpacket.bind(this)),St(t,"error",this.onerror.bind(this)),St(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){var r,n,s;if(dE.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(e.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(e),this;const o={type:ye.EVENT,data:e};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof e[e.length-1]=="function"){const c=this.ids++,h=e.pop();this._registerAckCallback(c,h),o.id=c}const a=(n=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||n===void 0?void 0:n.writable,l=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(t,e){var r;const n=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(n===void 0){this.acks[t]=e;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===t&&this.sendBuffer.splice(a,1);e.call(this,new Error("operation has timed out"))},n),o=(...a)=>{this.io.clearTimeoutFn(s),e.apply(this,a)};o.withError=!0,this.acks[t]=o}emitWithAck(t,...e){return new Promise((r,n)=>{const s=(o,a)=>o?n(o):r(a);s.withError=!0,e.push(s),this.emit(t,...e)})}_addToQueue(t){let e;typeof t[t.length-1]=="function"&&(e=t.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((n,...s)=>r!==this._queue[0]?void 0:(n!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),e&&e(n)):(this._queue.shift(),e&&e(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const e=this._queue[0];e.pending&&!t||(e.pending=!0,e.tryCount++,this.flags=e.flags,this.emit.apply(this,e.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ye.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(r=>String(r.id)===t)){const r=this.acks[t];delete this.acks[t],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ye.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ye.EVENT:case ye.BINARY_EVENT:this.onevent(t);break;case ye.ACK:case ye.BINARY_ACK:this.onack(t);break;case ye.DISCONNECT:this.ondisconnect();break;case ye.CONNECT_ERROR:this.destroy();const r=new Error(t.data.message);r.data=t.data.data,this.emitReserved("connect_error",r);break}}onevent(t){const e=t.data||[];t.id!=null&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const r of e)r.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const e=this;let r=!1;return function(...n){r||(r=!0,e.packet({type:ye.ACK,id:t,data:n}))}}onack(t){const e=this.acks[t.id];typeof e=="function"&&(delete this.acks[t.id],e.withError&&t.data.unshift(null),e.apply(this,t.data))}onconnect(t,e){this.id=t,this.recovered=e&&this._pid===e,this._pid=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ye.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let r=0;r<e.length;r++)if(t===e[r])return e.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let r=0;r<e.length;r++)if(t===e[r])return e.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const r of e)r.apply(this,t.data)}}}function Hi(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}Hi.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),e=Math.floor(t*this.jitter*i);i=(Math.floor(t*10)&1)==0?i-e:i+e}return Math.min(i,this.max)|0};Hi.prototype.reset=function(){this.attempts=0};Hi.prototype.setMin=function(i){this.ms=i};Hi.prototype.setMax=function(i){this.max=i};Hi.prototype.setJitter=function(i){this.jitter=i};class lu extends ke{constructor(t,e){var r;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,so(this,e),this.reconnection(e.reconnection!==!1),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor((r=e.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Hi({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(e.timeout==null?2e4:e.timeout),this._readyState="closed",this.uri=t;const n=e.parser||fE;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=e.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(e=this.backoff)===null||e===void 0||e.setMin(t),this)}randomizationFactor(t){var e;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(e=this.backoff)===null||e===void 0||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(e=this.backoff)===null||e===void 0||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new eE(this.uri,this.opts);const e=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=St(e,"open",function(){r.onopen(),t&&t()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),t?t(a):this.maybeReconnectOnOpen()},o=St(e,"error",s);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{n(),s(new Error("timeout")),e.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(n),this.subs.push(o),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(St(t,"ping",this.onping.bind(this)),St(t,"data",this.ondata.bind(this)),St(t,"error",this.onerror.bind(this)),St(t,"close",this.onclose.bind(this)),St(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){no(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let r=this.nsps[t];return r?this._autoConnect&&!r.active&&r.connect():(r=new Ov(this,t,e),this.nsps[t]=r),r}_destroy(t){const e=Object.keys(this.nsps);for(const r of e)if(this.nsps[r].active)return;this._close()}_packet(t){const e=this.encoder.encode(t);for(let r=0;r<e.length;r++)this.engine.write(e[r],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,e){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(n=>{n?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",n)):t.onreconnect()}))},e);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Zi={};function Ss(i,t){typeof i=="object"&&(t=i,i=void 0),t=t||{};const e=tE(i,t.path||"/socket.io"),r=e.source,n=e.id,s=e.path,o=Zi[n]&&s in Zi[n].nsps,a=t.forceNew||t["force new connection"]||t.multiplex===!1||o;let l;return a?l=new lu(r,t):(Zi[n]||(Zi[n]=new lu(r,t)),l=Zi[n]),e.query&&!t.query&&(t.query=e.queryKey),l.socket(e.path,t)}Object.assign(Ss,{Manager:lu,Socket:Ov,io:Ss,connect:Ss});var Ka={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */var Hd;function pE(){return Hd||(Hd=1,(function(i,t){(function(e){var r=Object.hasOwnProperty,n=Array.isArray?Array.isArray:function(x){return Object.prototype.toString.call(x)==="[object Array]"},s=10,o=typeof process=="object"&&typeof process.nextTick=="function",a=typeof Symbol=="function",l=typeof Reflect=="object",u=typeof setImmediate=="function",c=u?setImmediate:setTimeout,h=a?l&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(m){var x=Object.getOwnPropertyNames(m);return x.push.apply(x,Object.getOwnPropertySymbols(m)),x}:Object.keys;function f(){this._events={},this._conf&&d.call(this,this._conf)}function d(m){m&&(this._conf=m,m.delimiter&&(this.delimiter=m.delimiter),m.maxListeners!==e&&(this._maxListeners=m.maxListeners),m.wildcard&&(this.wildcard=m.wildcard),m.newListener&&(this._newListener=m.newListener),m.removeListener&&(this._removeListener=m.removeListener),m.verboseMemoryLeak&&(this.verboseMemoryLeak=m.verboseMemoryLeak),m.ignoreErrors&&(this.ignoreErrors=m.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function p(m,x){var w="(node) warning: possible EventEmitter memory leak detected. "+m+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(w+=" Event name: "+x+"."),typeof process<"u"&&process.emitWarning){var I=new Error(w);I.name="MaxListenersExceededWarning",I.emitter=this,I.count=m,process.emitWarning(I)}else console.error(w),console.trace&&console.trace()}var v=function(m,x,w){var I=arguments.length;switch(I){case 0:return[];case 1:return[m];case 2:return[m,x];case 3:return[m,x,w];default:for(var S=new Array(I);I--;)S[I]=arguments[I];return S}};function y(m,x){for(var w={},I,S=m.length,A=0,L=0;L<S;L++)I=m[L],w[I]=L<A?x[L]:e;return w}function g(m,x,w){this._emitter=m,this._target=x,this._listeners={},this._listenersCount=0;var I,S;if((w.on||w.off)&&(I=w.on,S=w.off),x.addEventListener?(I=x.addEventListener,S=x.removeEventListener):x.addListener?(I=x.addListener,S=x.removeListener):x.on&&(I=x.on,S=x.off),!I&&!S)throw Error("target does not implement any known event API");if(typeof I!="function")throw TypeError("on method must be a function");if(typeof S!="function")throw TypeError("off method must be a function");this._on=I,this._off=S;var A=m._observers;A?A.push(this):m._observers=[this]}Object.assign(g.prototype,{subscribe:function(m,x,w){var I=this,S=this._target,A=this._emitter,L=this._listeners,B=function(){var k=v.apply(null,arguments),U={data:k,name:x,original:m};if(w){var V=w.call(S,U);V!==!1&&A.emit.apply(A,[U.name].concat(k));return}A.emit.apply(A,[x].concat(k))};if(L[m])throw Error("Event '"+m+"' is already listening");this._listenersCount++,A._newListener&&A._removeListener&&!I._onNewListener?(this._onNewListener=function(k){k===x&&L[m]===null&&(L[m]=B,I._on.call(S,m,B))},A.on("newListener",this._onNewListener),this._onRemoveListener=function(k){k===x&&!A.hasListeners(k)&&L[m]&&(L[m]=null,I._off.call(S,m,B))},L[m]=null,A.on("removeListener",this._onRemoveListener)):(L[m]=B,I._on.call(S,m,B))},unsubscribe:function(m){var x=this,w=this._listeners,I=this._emitter,S,A,L=this._off,B=this._target,k;if(m&&typeof m!="string")throw TypeError("event must be a string");function U(){x._onNewListener&&(I.off("newListener",x._onNewListener),I.off("removeListener",x._onRemoveListener),x._onNewListener=null,x._onRemoveListener=null);var V=H.call(I,x);I._observers.splice(V,1)}if(m){if(S=w[m],!S)return;L.call(B,m,S),delete w[m],--this._listenersCount||U()}else{for(A=h(w),k=A.length;k-- >0;)m=A[k],L.call(B,m,w[m]);this._listeners={},this._listenersCount=0,U()}}});function E(m,x,w,I){var S=Object.assign({},x);if(!m)return S;if(typeof m!="object")throw TypeError("options must be an object");var A=Object.keys(m),L=A.length,B,k,U;function V(z){throw Error('Invalid "'+B+'" option value'+(z?". Reason: "+z:""))}for(var j=0;j<L;j++){if(B=A[j],!r.call(x,B))throw Error('Unknown "'+B+'" option');k=m[B],k!==e&&(U=w[B],S[B]=U?U(k,V):k)}return S}function T(m,x){return(typeof m!="function"||!m.hasOwnProperty("prototype"))&&x("value must be a constructor"),m}function R(m){var x="value must be type of "+m.join("|"),w=m.length,I=m[0],S=m[1];return w===1?function(A,L){if(typeof A===I)return A;L(x)}:w===2?function(A,L){var B=typeof A;if(B===I||B===S)return A;L(x)}:function(A,L){for(var B=typeof A,k=w;k-- >0;)if(B===m[k])return A;L(x)}}var _=R(["function"]),F=R(["object","function"]);function P(m,x,w){var I,S,A=0,L,B=new m(function(k,U,V){w=E(w,{timeout:0,overload:!1},{timeout:function(q,ie){return q*=1,(typeof q!="number"||q<0||!Number.isFinite(q))&&ie("timeout must be a positive number"),q}}),I=!w.overload&&typeof m.prototype.cancel=="function"&&typeof V=="function";function j(){S&&(S=null),A&&(clearTimeout(A),A=0)}var z=function(q){j(),k(q)},K=function(q){j(),U(q)};I?x(z,K,V):(S=[function(q){K(q||Error("canceled"))}],x(z,K,function(q){if(L)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof q!="function")throw TypeError("onCancel callback must be a function");S.push(q)}),L=!0),w.timeout>0&&(A=setTimeout(function(){var q=Error("timeout");q.code="ETIMEDOUT",A=0,B.cancel(q),U(q)},w.timeout))});return I||(B.cancel=function(k){if(S){for(var U=S.length,V=1;V<U;V++)S[V](k);S[0](k),S=null}}),B}function H(m){var x=this._observers;if(!x)return-1;for(var w=x.length,I=0;I<w;I++)if(x[I]._target===m)return I;return-1}function M(m,x,w,I,S){if(!w)return null;if(I===0){var A=typeof x;if(A==="string"){var L,B,k=0,U=0,V=this.delimiter,j=V.length;if((B=x.indexOf(V))!==-1){L=new Array(5);do L[k++]=x.slice(U,B),U=B+j;while((B=x.indexOf(V,U))!==-1);L[k++]=x.slice(U),x=L,S=k}else x=[x],S=1}else A==="object"?S=x.length:(x=[x],S=1)}var z=null,K,q,ie,ae,te,re=x[I],we=x[I+1],xe,Pe;if(I===S)w._listeners&&(typeof w._listeners=="function"?(m&&m.push(w._listeners),z=[w]):(m&&m.push.apply(m,w._listeners),z=[w]));else if(re==="*"){for(xe=h(w),B=xe.length;B-- >0;)K=xe[B],K!=="_listeners"&&(Pe=M(m,x,w[K],I+1,S),Pe&&(z?z.push.apply(z,Pe):z=Pe));return z}else if(re==="**"){for(te=I+1===S||I+2===S&&we==="*",te&&w._listeners&&(z=M(m,x,w,S,S)),xe=h(w),B=xe.length;B-- >0;)K=xe[B],K!=="_listeners"&&(K==="*"||K==="**"?(w[K]._listeners&&!te&&(Pe=M(m,x,w[K],S,S),Pe&&(z?z.push.apply(z,Pe):z=Pe)),Pe=M(m,x,w[K],I,S)):K===we?Pe=M(m,x,w[K],I+2,S):Pe=M(m,x,w[K],I,S),Pe&&(z?z.push.apply(z,Pe):z=Pe));return z}else w[re]&&(z=M(m,x,w[re],I+1,S));if(q=w["*"],q&&M(m,x,q,I+1,S),ie=w["**"],ie)if(I<S)for(ie._listeners&&M(m,x,ie,S,S),xe=h(ie),B=xe.length;B-- >0;)K=xe[B],K!=="_listeners"&&(K===we?M(m,x,ie[K],I+2,S):K===re?M(m,x,ie[K],I+1,S):(ae={},ae[K]=ie[K],M(m,x,{"**":ae},I+1,S)));else ie._listeners?M(m,x,ie,S,S):ie["*"]&&ie["*"]._listeners&&M(m,x,ie["*"],S,S);return z}function N(m,x,w){var I=0,S=0,A,L=this.delimiter,B=L.length,k;if(typeof m=="string")if((A=m.indexOf(L))!==-1){k=new Array(5);do k[I++]=m.slice(S,A),S=A+B;while((A=m.indexOf(L,S))!==-1);k[I++]=m.slice(S)}else k=[m],I=1;else k=m,I=m.length;if(I>1){for(A=0;A+1<I;A++)if(k[A]==="**"&&k[A+1]==="**")return}var U=this.listenerTree,V;for(A=0;A<I;A++)if(V=k[A],U=U[V]||(U[V]={}),A===I-1)return U._listeners?(typeof U._listeners=="function"&&(U._listeners=[U._listeners]),w?U._listeners.unshift(x):U._listeners.push(x),!U._listeners.warned&&this._maxListeners>0&&U._listeners.length>this._maxListeners&&(U._listeners.warned=!0,p.call(this,U._listeners.length,V))):U._listeners=x,!0;return!0}function Y(m,x,w,I){for(var S=h(m),A=S.length,L,B,k,U=m._listeners,V;A-- >0;)B=S[A],L=m[B],B==="_listeners"?k=w:k=w?w.concat(B):[B],V=I||typeof B=="symbol",U&&x.push(V?k:k.join(this.delimiter)),typeof L=="object"&&Y.call(this,L,x,k,V);return x}function D(m){for(var x=h(m),w=x.length,I,S,A;w-- >0;)S=x[w],I=m[S],I&&(A=!0,S!=="_listeners"&&!D(I)&&delete m[S]);return A}function Z(m,x,w){this.emitter=m,this.event=x,this.listener=w}Z.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function Q(m,x,w){if(w===!0)S=!0;else if(w===!1)I=!0;else{if(!w||typeof w!="object")throw TypeError("options should be an object or true");var I=w.async,S=w.promisify,A=w.nextTick,L=w.objectify}if(I||A||S){var B=x,k=x._origin||x;if(A&&!o)throw Error("process.nextTick is not supported");S===e&&(S=x.constructor.name==="AsyncFunction"),x=function(){var U=arguments,V=this,j=this.event;return S?A?Promise.resolve():new Promise(function(z){c(z)}).then(function(){return V.event=j,B.apply(V,U)}):(A?process.nextTick:c)(function(){V.event=j,B.apply(V,U)})},x._async=!0,x._origin=k}return[x,L?new Z(this,m,x):this]}function $(m){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,d.call(this,m)}$.EventEmitter2=$,$.prototype.listenTo=function(m,x,w){if(typeof m!="object")throw TypeError("target musts be an object");var I=this;w=E(w,{on:e,off:e,reducers:e},{on:_,off:_,reducers:F});function S(A){if(typeof A!="object")throw TypeError("events must be an object");var L=w.reducers,B=H.call(I,m),k;B===-1?k=new g(I,m,w):k=I._observers[B];for(var U=h(A),V=U.length,j,z=typeof L=="function",K=0;K<V;K++)j=U[K],k.subscribe(j,A[j]||j,z?L:L&&L[j])}return n(x)?S(y(x)):S(typeof x=="string"?y(x.split(/\s+/)):x),this},$.prototype.stopListeningTo=function(m,x){var w=this._observers;if(!w)return!1;var I=w.length,S,A=!1;if(m&&typeof m!="object")throw TypeError("target should be an object");for(;I-- >0;)S=w[I],(!m||S._target===m)&&(S.unsubscribe(x),A=!0);return A},$.prototype.delimiter=".",$.prototype.setMaxListeners=function(m){m!==e&&(this._maxListeners=m,this._conf||(this._conf={}),this._conf.maxListeners=m)},$.prototype.getMaxListeners=function(){return this._maxListeners},$.prototype.event="",$.prototype.once=function(m,x,w){return this._once(m,x,!1,w)},$.prototype.prependOnceListener=function(m,x,w){return this._once(m,x,!0,w)},$.prototype._once=function(m,x,w,I){return this._many(m,1,x,w,I)},$.prototype.many=function(m,x,w,I){return this._many(m,x,w,!1,I)},$.prototype.prependMany=function(m,x,w,I){return this._many(m,x,w,!0,I)},$.prototype._many=function(m,x,w,I,S){var A=this;if(typeof w!="function")throw new Error("many only accepts instances of Function");function L(){return--x===0&&A.off(m,L),w.apply(this,arguments)}return L._origin=w,this._on(m,L,I,S)},$.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||f.call(this);var m=arguments[0],x,w=this.wildcard,I,S,A,L,B;if(m==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(w&&(x=m,m!=="newListener"&&m!=="removeListener"&&typeof m=="object")){if(S=m.length,a){for(A=0;A<S;A++)if(typeof m[A]=="symbol"){B=!0;break}}B||(m=m.join(this.delimiter))}var k=arguments.length,U;if(this._all&&this._all.length)for(U=this._all.slice(),A=0,S=U.length;A<S;A++)switch(this.event=m,k){case 1:U[A].call(this,m);break;case 2:U[A].call(this,m,arguments[1]);break;case 3:U[A].call(this,m,arguments[1],arguments[2]);break;default:U[A].apply(this,arguments)}if(w)U=[],M.call(this,U,x,this.listenerTree,0,S);else if(U=this._events[m],typeof U=="function"){switch(this.event=m,k){case 1:U.call(this);break;case 2:U.call(this,arguments[1]);break;case 3:U.call(this,arguments[1],arguments[2]);break;default:for(I=new Array(k-1),L=1;L<k;L++)I[L-1]=arguments[L];U.apply(this,I)}return!0}else U&&(U=U.slice());if(U&&U.length){if(k>3)for(I=new Array(k-1),L=1;L<k;L++)I[L-1]=arguments[L];for(A=0,S=U.length;A<S;A++)switch(this.event=m,k){case 1:U[A].call(this);break;case 2:U[A].call(this,arguments[1]);break;case 3:U[A].call(this,arguments[1],arguments[2]);break;default:U[A].apply(this,I)}return!0}else if(!this.ignoreErrors&&!this._all&&m==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},$.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||f.call(this);var m=arguments[0],x=this.wildcard,w,I,S,A,L,B;if(m==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(x&&(w=m,m!=="newListener"&&m!=="removeListener"&&typeof m=="object")){if(A=m.length,a){for(L=0;L<A;L++)if(typeof m[L]=="symbol"){I=!0;break}}I||(m=m.join(this.delimiter))}var k=[],U=arguments.length,V;if(this._all)for(L=0,A=this._all.length;L<A;L++)switch(this.event=m,U){case 1:k.push(this._all[L].call(this,m));break;case 2:k.push(this._all[L].call(this,m,arguments[1]));break;case 3:k.push(this._all[L].call(this,m,arguments[1],arguments[2]));break;default:k.push(this._all[L].apply(this,arguments))}if(x?(V=[],M.call(this,V,w,this.listenerTree,0)):V=this._events[m],typeof V=="function")switch(this.event=m,U){case 1:k.push(V.call(this));break;case 2:k.push(V.call(this,arguments[1]));break;case 3:k.push(V.call(this,arguments[1],arguments[2]));break;default:for(S=new Array(U-1),B=1;B<U;B++)S[B-1]=arguments[B];k.push(V.apply(this,S))}else if(V&&V.length){if(V=V.slice(),U>3)for(S=new Array(U-1),B=1;B<U;B++)S[B-1]=arguments[B];for(L=0,A=V.length;L<A;L++)switch(this.event=m,U){case 1:k.push(V[L].call(this));break;case 2:k.push(V[L].call(this,arguments[1]));break;case 3:k.push(V[L].call(this,arguments[1],arguments[2]));break;default:k.push(V[L].apply(this,S))}}else if(!this.ignoreErrors&&!this._all&&m==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(k)},$.prototype.on=function(m,x,w){return this._on(m,x,!1,w)},$.prototype.prependListener=function(m,x,w){return this._on(m,x,!0,w)},$.prototype.onAny=function(m){return this._onAny(m,!1)},$.prototype.prependAny=function(m){return this._onAny(m,!0)},$.prototype.addListener=$.prototype.on,$.prototype._onAny=function(m,x){if(typeof m!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),x?this._all.unshift(m):this._all.push(m),this},$.prototype._on=function(m,x,w,I){if(typeof m=="function")return this._onAny(m,x),this;if(typeof x!="function")throw new Error("on only accepts instances of Function");this._events||f.call(this);var S=this,A;return I!==e&&(A=Q.call(this,m,x,I),x=A[0],S=A[1]),this._newListener&&this.emit("newListener",m,x),this.wildcard?(N.call(this,m,x,w),S):(this._events[m]?(typeof this._events[m]=="function"&&(this._events[m]=[this._events[m]]),w?this._events[m].unshift(x):this._events[m].push(x),!this._events[m].warned&&this._maxListeners>0&&this._events[m].length>this._maxListeners&&(this._events[m].warned=!0,p.call(this,this._events[m].length,m))):this._events[m]=x,S)},$.prototype.off=function(m,x){if(typeof x!="function")throw new Error("removeListener only takes instances of Function");var w,I=[];if(this.wildcard){var S=typeof m=="string"?m.split(this.delimiter):m.slice();if(I=M.call(this,null,S,this.listenerTree,0),!I)return this}else{if(!this._events[m])return this;w=this._events[m],I.push({_listeners:w})}for(var A=0;A<I.length;A++){var L=I[A];if(w=L._listeners,n(w)){for(var B=-1,k=0,U=w.length;k<U;k++)if(w[k]===x||w[k].listener&&w[k].listener===x||w[k]._origin&&w[k]._origin===x){B=k;break}if(B<0)continue;return this.wildcard?L._listeners.splice(B,1):this._events[m].splice(B,1),w.length===0&&(this.wildcard?delete L._listeners:delete this._events[m]),this._removeListener&&this.emit("removeListener",m,x),this}else(w===x||w.listener&&w.listener===x||w._origin&&w._origin===x)&&(this.wildcard?delete L._listeners:delete this._events[m],this._removeListener&&this.emit("removeListener",m,x))}return this.listenerTree&&D(this.listenerTree),this},$.prototype.offAny=function(m){var x=0,w=0,I;if(m&&this._all&&this._all.length>0){for(I=this._all,x=0,w=I.length;x<w;x++)if(m===I[x])return I.splice(x,1),this._removeListener&&this.emit("removeListenerAny",m),this}else{if(I=this._all,this._removeListener)for(x=0,w=I.length;x<w;x++)this.emit("removeListenerAny",I[x]);this._all=[]}return this},$.prototype.removeListener=$.prototype.off,$.prototype.removeAllListeners=function(m){if(m===e)return!this._events||f.call(this),this;if(this.wildcard){var x=M.call(this,null,m,this.listenerTree,0),w,I;if(!x)return this;for(I=0;I<x.length;I++)w=x[I],w._listeners=null;this.listenerTree&&D(this.listenerTree)}else this._events&&(this._events[m]=null);return this},$.prototype.listeners=function(m){var x=this._events,w,I,S,A,L;if(m===e){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!x)return[];for(w=h(x),A=w.length,S=[];A-- >0;)I=x[w[A]],typeof I=="function"?S.push(I):S.push.apply(S,I);return S}else{if(this.wildcard){if(L=this.listenerTree,!L)return[];var B=[],k=typeof m=="string"?m.split(this.delimiter):m.slice();return M.call(this,B,k,L,0),B}return x?(I=x[m],I?typeof I=="function"?[I]:I:[]):[]}},$.prototype.eventNames=function(m){var x=this._events;return this.wildcard?Y.call(this,this.listenerTree,[],null,m):x?h(x):[]},$.prototype.listenerCount=function(m){return this.listeners(m).length},$.prototype.hasListeners=function(m){if(this.wildcard){var x=[],w=typeof m=="string"?m.split(this.delimiter):m.slice();return M.call(this,x,w,this.listenerTree,0),x.length>0}var I=this._events,S=this._all;return!!(S&&S.length||I&&(m===e?h(I).length:I[m]))},$.prototype.listenersAny=function(){return this._all?this._all:[]},$.prototype.waitFor=function(m,x){var w=this,I=typeof x;return I==="number"?x={timeout:x}:I==="function"&&(x={filter:x}),x=E(x,{timeout:0,filter:e,handleError:!1,Promise,overload:!1},{filter:_,Promise:T}),P(x.Promise,function(S,A,L){function B(){var k=x.filter;if(!(k&&!k.apply(w,arguments)))if(w.off(m,B),x.handleError){var U=arguments[0];U?A(U):S(v.apply(null,arguments).slice(1))}else S(v.apply(null,arguments))}L(function(){w.off(m,B)}),w._on(m,B,!1)},{timeout:x.timeout,overload:x.overload})};function C(m,x,w){w=E(w,{Promise,timeout:0,overload:!1},{Promise:T});var I=w.Promise;return P(I,function(S,A,L){var B;if(typeof m.addEventListener=="function"){B=function(){S(v.apply(null,arguments))},L(function(){m.removeEventListener(x,B)}),m.addEventListener(x,B,{once:!0});return}var k=function(){U&&m.removeListener("error",U),S(v.apply(null,arguments))},U;x!=="error"&&(U=function(V){m.removeListener(x,k),A(V)},m.once("error",U)),L(function(){U&&m.removeListener("error",U),m.removeListener(x,k)}),m.once(x,k)},{timeout:w.timeout,overload:w.overload})}var O=$.prototype;Object.defineProperties($,{defaultMaxListeners:{get:function(){return O._maxListeners},set:function(m){if(typeof m!="number"||m<0||Number.isNaN(m))throw TypeError("n must be a non-negative number");O._maxListeners=m},enumerable:!0},once:{value:C,writable:!0,configurable:!0}}),Object.defineProperties(O,{_maxListeners:{value:s,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),i.exports=$})()})(Ka)),Ka.exports}var yE=pE();const Gd={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_CLIENT_ID:"837293047887-uvnpu1ib8ono4b87alpoc0sk1cfovs4k.apps.googleusercontent.com"},Yd=240,mE=/[\u0000-\u001F\u007F]/g,vE="team",Za=700,zd=8021,gE=()=>{let i=null;try{if(typeof import.meta<"u"&&Gd){const t=Gd;i=t.VITE_SOCKET_URL||t.VITE_SERVER_URL||null,i&&(i=String(i).trim())}}catch{}if(i)return i.replace(/\/$/,"");if(typeof window<"u"&&window.location){const{protocol:t,hostname:e}=window.location,n=t==="https:"?"https:":"http:",s=(e||"").toLowerCase();if(["localhost","127.0.0.1","::1"].includes(s))return`${n}//${e}:${zd}`;if(window.location.origin)return window.location.origin;const a=window.location.port?`:${window.location.port}`:"";return`${n}//${e}${a}`}return`http://localhost:${zd}`};class bE extends yE.EventEmitter2{constructor(t){super(),this.game=t,this.sequenceCounter=0,this.lastServerSequence=0,this.localShotCache=new Map,this.on("bot:debug",e=>{qw(e)})}listen(){const t=gE();this.io=Ss(t,{transports:["websocket"]}),this.io.on("connect",()=>{console.log("connected"),this.sequenceCounter=0,this.lastServerSequence=0,this.emit("connected"),this.requestLobbySnapshot(),this.game&&this.game.identityManager&&typeof this.game.identityManager.handleSocketConnected=="function"&&this.game.identityManager.handleSocketConnected()}),this.io.on("connect_error",e=>{console.error("socket connect_error",e?.message??e)}),this.io.on("disconnect",e=>{console.warn("socket disconnected",e),this.lastServerSequence=0,this.emit("disconnected",e)}),this.io.on("chat:message",e=>{const r=this.safeParse(e);this.emit("chat:message",r)}),this.io.on("chat:history",e=>{const r=this.safeParse(e);this.emit("chat:history",r)}),this.io.on("chat:rate_limit",e=>{const r=this.safeParse(e);this.emit("chat:rate_limit",r)}),this.io.on("lobby:snapshot",e=>{const r=this.safeParse(e);this.emit("lobby:snapshot",r)}),this.io.on("lobby:update",e=>{const r=this.safeParse(e);this.emit("lobby:update",r)}),this.io.on("identity:ack",e=>{const r=this.safeParse(e);this.emit("identity:ack",r)}),this.io.on("lobby:assignment",e=>{const r=this.safeParse(e);r&&this.game&&this.game.player&&(r.city!==void 0&&r.city!==null&&(this.game.player.city=this.toFiniteNumber(r.city,this.game.player.city??0)),r.role&&(this.game.player.isMayor=r.role==="mayor")),this.emit("lobby:assignment",r)}),this.io.on("lobby:denied",e=>{const r=this.safeParse(e);this.emit("lobby:denied",r)}),this.io.on("enter_game",e=>{const r=this.normalisePlayerPayload(e);r&&this.applyPlayerUpdate(r,{source:"enter_game"})}),this.io.on("player",e=>{const r=this.normalisePlayerPayload(e);r&&this.applyPlayerUpdate(r,{source:"player"})}),this.io.on("players:snapshot",e=>{const r=this.safeParse(e);Array.isArray(r)&&r.forEach(n=>{const s=this.normalisePlayerPayload(n);s&&this.applyPlayerUpdate(s,{source:"snapshot"})})}),this.io.on("player:removed",e=>{const r=this.safeParse(e);!r||!r.id||this.io?.id&&r.id===this.io.id||delete this.game.otherPlayers[r.id]}),this.io.on("player:rejected",e=>{const r=this.safeParse(e);if(r&&(Array.isArray(r.reasons)&&r.reasons.length&&console.warn("Authoritative server rejected player update",r.reasons),r.player)){const n=this.normalisePlayerPayload(r.player);if(!n)return;this.applyPlayerUpdate(n,{source:"rejected"})}}),this.io.on("bullet_shot",e=>{const r=this.safeParse(e);if(!r)return;const n={sourceId:r.sourceId??null,sourceType:r.sourceType??null,targetId:r.targetId??null};if(r.damage!==void 0){const o=Number(r.damage);Number.isFinite(o)&&(n.damage=o)}this.game.bulletFactory.newBullet(r.shooter,r.x,r.y,r.type,r.angle,r.team??null,n);const s=this.shouldSuppressShotSound(r);s||Ls(this.game,r.x,r.y),s||this.playBulletShotSound(r)}),this.io.on("new_icon",e=>{const r=typeof e=="string"?JSON.parse(e):e;if(!r||!this.game||!this.game.iconFactory)return;const n=r.ownerId??r.owner??null;if(r.id&&typeof this.game.iconFactory.getIconById=="function"){const s=this.game.iconFactory.getIconById(r.id);if(s){s.x=r.x,s.y=r.y,r.quantity!==void 0&&(s.quantity=Math.max(1,parseInt(r.quantity,10)||1)),s.city=r.cityId??s.city,s.teamId=r.teamId??r.cityId??s.teamId,s.isSharedDrop=!!r.sharedDrop,s.synced=!0;return}}this.game.iconFactory.newIcon(n,r.x,r.y,r.type,{sourceBuildingId:r.buildingId??r.sourceBuildingId??null,city:r.cityId??null,teamId:r.teamId??r.cityId??null,quantity:r.quantity??1,armed:!!r.armed,id:r.id??null,isSharedDrop:!!r.sharedDrop,skipProductionUpdate:!!r.skipProductionUpdate,synced:!0})}),this.io.on("icon:remove",e=>{const r=this.safeParse(e);!r||!this.game||!this.game.iconFactory||r.id&&typeof this.game.iconFactory.removeIconById=="function"&&this.game.iconFactory.removeIconById(r.id,{onlyUnowned:!0})||typeof r.x=="number"&&typeof r.y=="number"&&r.type!==void 0&&typeof this.game.iconFactory.removeUnownedIconsNear=="function"&&this.game.iconFactory.removeUnownedIconsNear(r.x,r.y,r.type,1,32,r.teamId??r.cityId??null)}),this.io.on("factory:purge",e=>{const r=this.safeParse(e);if(!r||!this.game||!this.game.iconFactory)return;const n=this.toFiniteNumber(r.itemType,null),s=this.toFiniteNumber(r.cityId,null);this.game.iconFactory.purgeCityItems(s,n)}),this.io.on("new_building",e=>{try{const r=typeof e=="string"?JSON.parse(e):e;r&&(r.type=Number(r.type),r.population=r.population||0,r.ownerId=r.ownerId||r.owner||null,r.attachedHouseId=r.attachedHouseId??null,r.city=r.city??0,r.itemsLeft=r.itemsLeft||0,r.smokeActive=!!r.smokeActive,r.smokeFrame=r.smokeFrame||0),this.emit("building:new",r)}catch(r){console.warn("Failed to parse new_building payload",r)}}),this.io.on("population:update",e=>{try{const r=typeof e=="string"?JSON.parse(e):e;r&&(r.type=Number(r.type),r.population=r.population||0,r.attachedHouseId=r.attachedHouseId??null,r.city=r.city??0,r.smokeActive=!!r.smokeActive,r.smokeFrame=r.smokeFrame||0,r.itemsLeft=r.itemsLeft||0),this.emit("population:update",r)}catch(r){console.warn("Failed to parse population update",r)}}),this.io.on("city:finance",e=>{try{const r=typeof e=="string"?JSON.parse(e):e;r&&this.emit("city:finance",r)}catch(r){console.warn("Failed to parse finance update",r)}}),this.io.on("city:info",e=>{const r=this.safeParse(e);!r||typeof r!="object"||(r.cityId===void 0&&r.city!==void 0?r.cityId=this.toFiniteNumber(r.city,r.city):r.cityId!==void 0&&(r.cityId=this.toFiniteNumber(r.cityId,r.cityId)),this.emit("city:info",r))}),this.io.on("city:defenses",e=>{const r=this.safeParse(e);if(!r||r.cityId===void 0)return;const n=this.toFiniteNumber(r.cityId,r.cityId);if(n==null)return;const s=Array.isArray(r.items)?r.items:[];this.game&&typeof this.game.applyDefenseSnapshot=="function"&&this.game.applyDefenseSnapshot(n,s)}),this.io.on("city:defenses:clear",e=>{const r=this.safeParse(e);if(!r||r.cityId===void 0)return;const n=this.toFiniteNumber(r.cityId,r.cityId);n!=null&&this.game&&typeof this.game.clearDefenseItems=="function"&&this.game.clearDefenseItems(n)}),this.io.on("build:denied",e=>{try{const r=typeof e=="string"?JSON.parse(e):e;r&&this.emit("build:denied",r)}catch(r){console.warn("Failed to parse build denied payload",r)}}),this.io.on("demolish_building",e=>{try{const r=typeof e=="string"?JSON.parse(e):e;r&&r.id&&this.game.buildingFactory?.removeBuildingById&&this.game.buildingFactory.removeBuildingById(r.id)}catch(r){console.warn("Failed to handle demolish payload",r)}}),this.io.on("demolish:denied",e=>{const r=this.safeParse(e);this.game.buildingFactory?.handleDemolishDenied&&this.game.buildingFactory.handleDemolishDenied(r)}),this.io.on("player:health",e=>{const r=this.safeParse(e);!r||!r.id||this.applyHealthUpdate(r)}),this.io.on("player:dead",e=>{const r=this.safeParse(e);!r||!r.id||(this.emit("player:dead",r),this.applyHealthUpdate({id:r.id,health:0,source:r.reason}))}),this.io.on("player:status",e=>{const r=this.safeParse(e);!r||!r.id||this.applyStatusUpdate(r)}),this.io.on("hazard:spawn",e=>{const r=this.normaliseHazardPayload(e);r&&this.emit("hazard:spawn",r)}),this.io.on("hazard:update",e=>{const r=this.normaliseHazardPayload(e);r&&this.emit("hazard:update",r)}),this.io.on("hazard:remove",e=>{const r=this.normaliseHazardPayload(e);r&&this.emit("hazard:remove",r)}),this.io.on("orb:result",e=>{const r=this.safeParse(e);this.emit("orb:result",r)}),this.io.on("city:orbed",e=>{const r=this.safeParse(e);r&&this.handleCityOrbedAudio(r),this.emit("city:orbed",r)}),this.io.on("lobby:evicted",e=>{const r=this.safeParse(e);this.emit("lobby:evicted",r)})}sendNewBuilding(t){this.io&&!this.io.disconnected&&this.io.emit("new_building",JSON.stringify(t))}sendDemolishBuilding(t){!this.io||this.io.disconnected||!t||this.io.emit("demolish_building",JSON.stringify({id:t}))}requestCityInfo(t){if(!this.io||this.io.disconnected)return;const e=this.toFiniteNumber(t,null);if(!Number.isFinite(e))return;const r=Math.max(0,Math.floor(e));this.io.emit("city:inspect",JSON.stringify({city:r}))}sendBulletShot(t){t&&this.markLocalShot(t),this.io&&!this.io.disconnected&&this.io.emit("bullet_shot",JSON.stringify(t))}enterGame(t={}){if(console.log("Telling server we've entered the game"),this.io&&!this.io.disconnected){this.sequenceCounter=0,this.game.player.sequence=0;const e=this.createPlayerPayload(),r=this.buildEntryAssignment(t);return Object.assign(e,r),this.io.emit("enter_game",JSON.stringify(e)),this.io.id}return null}requestLobbySnapshot(){this.io&&!this.io.disconnected&&this.io.emit("lobby:refresh")}buildEntryAssignment(t){if(!t||typeof t!="object")return{};const e={},r={};let n=!1;if(t.city!==void 0&&t.city!==null){const s=this.toFiniteNumber(t.city,null);if(Number.isFinite(s)){const o=Math.max(0,Math.floor(s));e.requestedCity=o,r.city=o,r.cityId=o,n=!0}}if(t.role){const s=`${t.role}`.trim().toLowerCase();(s==="mayor"||s==="recruit"||s==="auto")&&(e.requestedRole=s,r.role=s,n=!0)}return t.auto===!0?e.autoAssign=!0:t.auto===!1&&(e.autoAssign=!1),n&&(e.assignment=r),e}cycle(){if(this.io&&!this.io.disconnected){this.sequenceCounter+=1,this.game.player.sequence=this.sequenceCounter;const t=this.createPlayerPayload();this.io.emit("player",JSON.stringify(t))}}spawnHazard(t){!this.io||this.io.disconnected||this.io.emit("hazard:spawn",JSON.stringify(t))}useItem(t,e={}){if(!this.io||this.io.disconnected||!t)return;const r=Object.assign({},e,{type:t});this.io.emit("item:use",JSON.stringify(r))}updateHazard(t){!this.io||this.io.disconnected||this.io.emit("hazard:arm",JSON.stringify(t))}removeHazard(t){!this.io||this.io.disconnected||!t||this.io.emit("hazard:remove",JSON.stringify({id:t}))}spawnDefense(t){if(!this.io||this.io.disconnected||!t)return;const e=typeof t=="string"?t:JSON.stringify(t);this.io.emit("defense:spawn",e)}removeDefense(t){if(!this.io||this.io.disconnected||!t)return;const e=typeof t=="object"?t.id??null:t;e&&this.io.emit("defense:remove",JSON.stringify({id:e}))}collectFactoryItem(t){if(!this.io||this.io.disconnected||!t)return;const e=typeof t=="string"?t:JSON.stringify(t);this.io.emit("factory:collect",e)}dropIcon(t){if(!this.io||this.io.disconnected||!t)return;const e=typeof t=="string"?t:JSON.stringify(t);this.io.emit("icon:drop",e)}collectDroppedIcon(t){if(!this.io||this.io.disconnected||!t)return;const e=typeof t=="string"?t:JSON.stringify(t);this.io.emit("icon:pickup",e)}sendOrbDrop(t){if(!this.io||this.io.disconnected||t===null||t===void 0)return;const e=typeof t=="string"?t:JSON.stringify(t);this.io.emit("orb:drop",e)}sendIdentityUpdate(t){if(!this.io||this.io.disconnected)return;const e={};t&&t.id?(e.identity={id:t.id},t.name&&(e.identity.name=t.name)):e.identity=null,this.io.emit("identity:update",JSON.stringify(e))}createPlayerPayload(){const t=this.game.player,e=Number.isFinite(t.isMoving)?t.isMoving:Number(t.isMoving),r=Number.isFinite(e)?Math.max(-1,Math.min(1,e)):0,n=Number.isFinite(t.isTurning)?t.isTurning:Number(t.isTurning),s=Number.isFinite(n)?Math.max(-1,Math.min(1,Math.round(n))):0,o={id:t.id,city:t.city,isMayor:t.isMayor,health:t.health,direction:(Math.round(t.direction)%32+32)%32,isTurning:s,isMoving:r,bombsArmed:!!t.bombsArmed,isCloaked:!!t.isCloaked,cloakExpiresAt:t.cloakExpiresAt??0,isFrozen:!!t.isFrozen,frozenUntil:t.frozenUntil??0,sequence:t.sequence,offset:{x:t.offset?.x??0,y:t.offset?.y??0}};return this.game&&this.game.identity&&this.game.identity.id&&(o.identity={id:this.game.identity.id}),this.game&&this.game.identity&&this.game.identity.name&&(o.callsign=this.game.identity.name),o}applyPlayerUpdate(t,e={}){if(!t||!t.id)return;const r=this.io?.id;if(r&&t.id===r){this.syncLocalPlayer(t,e);return}const n=this.game.otherPlayers[t.id];if(n&&n.sequence!==void 0&&t.sequence!==void 0&&t.sequence<=n.sequence)return;const s=n?Object.assign({},n,t):Object.assign({},t);!s.callsign&&n&&n.callsign&&(s.callsign=n.callsign),!s.userId&&n&&n.userId&&(s.userId=n.userId),this.game.otherPlayers[t.id]=s;const o=e&&e.source==="snapshot",a=e&&e.source==="enter_game";!n&&!o&&a&&this.notifyPlayerJoined(s)}syncLocalPlayer(t,e={}){if(!t||!this.game||!this.game.player)return;const r=this.game.player;if(t.sequence!==void 0&&t.sequence<this.lastServerSequence&&this.lastServerSequence!==0){const l=Math.abs(t.offset.x-r.offset.x),u=Math.abs(t.offset.y-r.offset.y),c=96;if(l<c&&u<c)return}t.sequence!==void 0&&(this.lastServerSequence=Math.max(this.lastServerSequence,t.sequence)),r.id=t.id??r.id,typeof t.callsign=="string"&&t.callsign.trim().length&&(r.callsign=t.callsign.trim()),typeof t.userId=="string"&&t.userId.trim().length&&(r.userId=t.userId.trim());const n=Number.isFinite(r.city)?r.city:null,s=this.toFiniteNumber(t.city,r.city),o=n!==s;if(t.offset&&typeof t.offset=="object"){const l=this.toFiniteNumber(t.offset.x,r.offset.x),u=this.toFiniteNumber(t.offset.y,r.offset.y),c=l-r.offset.x,h=u-r.offset.y,f=c*c+h*h,d=9216,p=.1;f>d?(r.offset.x=l,r.offset.y=u):(r.offset.x+=c*p,r.offset.y+=h*p),r.lastSafeOffset&&(r.lastSafeOffset.x=r.offset.x,r.lastSafeOffset.y=r.offset.y)}if(r.city=s,o){const l=eo(s);if(l)r.offset.x=l.x,r.offset.y=l.y;else{const u=this.game.cities?.[s];u&&(r.offset.x=u.x+48,r.offset.y=u.y+100)}r.lastSafeOffset&&(r.lastSafeOffset.x=r.offset.x,r.lastSafeOffset.y=r.offset.y)}if(r.isMayor=!!t.isMayor,r.health=this.toFiniteNumber(t.health,r.health),t.isCloaked!==void 0&&(r.isCloaked=!!t.isCloaked),t.cloakExpiresAt!==void 0){const l=this.toFiniteNumber(t.cloakExpiresAt,r.cloakExpiresAt??0);r.cloakExpiresAt=Number.isFinite(l)?Math.max(0,l):0}if(t.isFrozen!==void 0&&(r.isFrozen=!!t.isFrozen),t.frozenUntil!==void 0){const l=this.toFiniteNumber(t.frozenUntil,r.frozenUntil??0);r.frozenUntil=Number.isFinite(l)?Math.max(0,l):0,(!r.isFrozen||r.frozenUntil===0)&&(r.frozenBy=null)}const a=Math.round(this.toFiniteNumber(t.direction,r.direction));if(Number.isFinite(a)){const l=(a%32+32)%32,u=Number.isFinite(r.direction)?(Math.round(r.direction)%32+32)%32:l;Math.min(Math.abs(l-u),32-Math.abs(l-u))>4&&(r.direction=l)}if(t.sequence!==void 0&&(r.sequence=t.sequence),this.game&&typeof this.game.updateOrbHint=="function"){const l=e&&e.source==="enter_game";this.game.updateOrbHint({force:l})}}notifyPlayerJoined(t){if(!t||!this.game||typeof this.game.notify!="function")return;const e=this.buildPlayerLabel(t);if(!e)return;const r=this.buildPlayerCityLabel(t),n=r?` in ${r}`:"";this.game.notify({title:"Player joined",message:`${e} joined${n}.`,variant:"info",timeout:4200})}buildPlayerLabel(t){if(!t)return null;if(typeof t.callsign=="string"&&t.callsign.trim().length)return t.callsign.trim();if(this.game&&typeof this.game.resolveCallsign=="function"){const e=this.game.resolveCallsign(t.id);if(e)return e}return t.id!==void 0&&t.id!==null?`Player ${t.id}`:"Player"}buildPlayerCityLabel(t){if(!t)return null;const e=Number(t.city);return Number.isFinite(e)?Ae(e):null}normalisePlayerPayload(t){const e=this.safeParse(t);if(!e||typeof e!="object")return null;const r=Object.assign({},e);if(!r.id)if(t&&t.id)r.id=t.id;else return null;const n=r.offset&&typeof r.offset=="object"?r.offset:{};r.offset={x:this.toFiniteNumber(n.x,0),y:this.toFiniteNumber(n.y,0)},r.city=this.toFiniteNumber(r.city,0),r.isMayor=!!r.isMayor;const s=this.toFiniteNumber(r.health,this.game?.player?.health??0);r.health=Number.isFinite(s)?Math.max(0,s):0;const o=this.toFiniteNumber(r.direction,0);Number.isFinite(o)?r.direction=(Math.round(o)%32+32)%32:r.direction=0;const a=this.toFiniteNumber(r.isTurning,0);r.isTurning=Math.max(-1,Math.min(1,Math.round(Number.isFinite(a)?a:0)));const l=this.toFiniteNumber(r.isMoving,0);Number.isFinite(l)?l>1?r.isMoving=1:l<-1?r.isMoving=-1:r.isMoving=l:r.isMoving=0,r.sequence=Math.max(0,Math.round(this.toFiniteNumber(r.sequence,0))),r.isCloaked=!!r.isCloaked;const u=this.toFiniteNumber(r.cloakExpiresAt,r.isCloaked?r.cloakExpiresAt??0:0);r.cloakExpiresAt=Number.isFinite(u)?Math.max(0,u):0,r.isFrozen=!!r.isFrozen;const c=this.toFiniteNumber(r.frozenUntil,r.isFrozen?r.frozenUntil??0:0);if(r.frozenUntil=Number.isFinite(c)?Math.max(0,c):0,r.isFrozen?r.frozenBy=r.frozenBy??null:r.frozenBy=null,typeof r.callsign=="string"){const h=r.callsign.trim();h.length?r.callsign=h:delete r.callsign}if(r.userId!==void 0&&r.userId!==null){const h=String(r.userId).trim();h.length?r.userId=h:delete r.userId}return r}normaliseHazardPayload(t){const e=this.safeParse(t);return!e||typeof e!="object"||!e.id?null:{id:e.id,type:e.type,x:this.toFiniteNumber(e.x,0),y:this.toFiniteNumber(e.y,0),ownerId:e.ownerId??null,teamId:e.teamId??null,active:!!e.active,armed:!!e.armed,detonateAt:e.detonateAt??null,reason:e.reason??null,revealedAt:e.revealedAt??null,triggeredBy:e.triggeredBy??null,triggeredTeam:e.triggeredTeam??null}}applyHealthUpdate(t){const e=this.toFiniteNumber(t.health,null);if(!t.id||e===null)return;const r=this.io?.id;if(r&&t.id===r){const n=Number.isFinite(this.game.player?.health)?this.game.player.health:e,s=Math.max(0,e);this.game.player&&(this.game.player.health=s,s<=0&&(this.game.player.engineLoopActive=!1)),this.game.audio&&(s<=0&&n>0?(this.game.audio.playEffect(he.DIE,{volume:.8}),this.game.audio.setLoopState(he.ENGINE,!1)):s<n&&this.game.audio.playEffect(he.HIT,{volume:.7}));return}this.game.otherPlayers[t.id]||(this.game.otherPlayers[t.id]={id:t.id}),this.game.otherPlayers[t.id].health=Math.max(0,e)}applyStatusUpdate(t){const e=this.io?.id,r=e&&t.id===e?this.game.player:this.game.otherPlayers[t.id]??(this.game.otherPlayers[t.id]={id:t.id});if(r){if(t.isCloaked!==void 0&&(r.isCloaked=!!t.isCloaked),t.cloakExpiresAt!==void 0){const n=this.toFiniteNumber(t.cloakExpiresAt,r.cloakExpiresAt??0);r.cloakExpiresAt=Number.isFinite(n)?Math.max(0,n):0}if(t.isFrozen!==void 0&&(r.isFrozen=!!t.isFrozen,r.isFrozen||(r.frozenBy=null)),t.frozenUntil!==void 0){const n=this.toFiniteNumber(t.frozenUntil,r.frozenUntil??0);r.frozenUntil=Number.isFinite(n)?Math.max(0,n):0}t.frozenBy!==void 0&&t.frozenBy!==null&&(r.frozenBy=t.frozenBy),e&&t.id===e&&(this.game.forceDraw=!0)}}playBulletShotSound(t){if(!this.game||!this.game.audio)return;const e=this.resolveShotSoundId(t);if(!e)return;const r=this.toFiniteNumber(t?.x,null),n=this.toFiniteNumber(t?.y,null);Number.isFinite(r)&&Number.isFinite(n)?this.game.audio.playEffect(e,{position:{x:r,y:n}}):this.game.audio.playEffect(e)}resolveShotSoundId(t){const e=this.toFiniteNumber(t?.type,0);if(e===1)return he.ROCKET;if(e===3)return he.FLARE;const r=typeof t?.sourceType=="string"?t.sourceType.toLowerCase():null;return r&&(r==="turret"||r==="plasma"||r==="sleeper")?he.TURRET:he.LASER}markLocalShot(t){if(!t)return;this.localShotCache||(this.localShotCache=new Map);const e=Date.now();t.shooter&&this.localShotCache.set(`shooter:${t.shooter}`,e),t.sourceId&&this.localShotCache.set(`source:${t.sourceId}`,e),this.pruneLocalShots(e)}pruneLocalShots(t=Date.now()){if(!this.localShotCache)return;const e=t-Za;this.localShotCache.forEach((r,n)=>{r<e&&this.localShotCache.delete(n)})}shouldSuppressShotSound(t){if(!t||!this.localShotCache)return!1;const e=Date.now();if(this.pruneLocalShots(e),t.shooter){const r=`shooter:${t.shooter}`,n=this.localShotCache.get(r);if(n&&e-n<Za)return!0}if(t.sourceId){const r=`source:${t.sourceId}`,n=this.localShotCache.get(r);if(n&&e-n<Za)return!0}return!1}handleCityOrbedAudio(t){if(!t||!this.game||!this.game.audio)return;const e=this.toFiniteNumber(this.game.player?.city,null);if(e===null)return;const r=this.toFiniteNumber(t.targetCity,null),n=this.toFiniteNumber(t.attackerCity,null);if(Number.isFinite(r)&&e===r){this.game.audio.playEffect(he.DIE),this.game.audio.setLoopState(he.ENGINE,!1),this.game.player&&(this.game.player.engineLoopActive=!1);return}Number.isFinite(n)&&e===n&&this.game.audio.playEffect(he.SCREECH)}sendChatMessage(t={}){if(!this.io||!this.io.connected)return!1;const e=this.normaliseOutgoingChatPayload(t);return e?(this.io.emit("chat:message",JSON.stringify(e)),!0):!1}normaliseOutgoingChatPayload(t){if(!t||typeof t!="object")return null;const e=this.normaliseChatScope(t.scope),r=this.sanitiseChatText(t.message??t.text??"");return r?{scope:e,message:r}:null}normaliseChatScope(t){if(typeof t=="string"){const e=t.trim().toLowerCase();if(e==="global"||e==="all")return"global";if(e==="team"||e==="city")return"team"}return vE}sanitiseChatText(t){if(t==null)return"";let e=String(t);return e=e.replace(mE,""),e=e.replace(/\s+/g," ").trim(),e.length?(e.length>Yd&&(e=e.slice(0,Yd)),e):""}safeParse(t){if(t==null)return null;if(typeof t!="string")return t;try{return JSON.parse(t)}catch(e){return console.warn("Failed to parse payload from server",e),null}}toFiniteNumber(t,e){if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t=="string"){const r=Number(t);if(Number.isFinite(r))return r}return e!==void 0?e:0}}var Ge=new J.Container;let un=null,cn=null;function _E(i){var t=s=>{s.stopPropagation(),console.log("Setting is demolishing to true"),i.isDemolishing=!0,i.stage.cursor="demolish",i.interactionLayer&&(i.interactionLayer.cursor="demolish")},e=new J.Texture(i.textures.buildingIcons.baseTexture,new J.Rectangle(208,0,16,16)),r=new J.Sprite(e);r.x=i.buildMenuOffset.x-16,r.y=i.buildMenuOffset.y,r.interactive=!0,r.iconType=13,r.on("mousedown",t);var n=new J.Text("Demolish building",{fontSize:12,fill:16777215});n.x=i.buildMenuOffset.x,n.y=i.buildMenuOffset.y,n.interactive=!0,n.on("mousedown",t),Ge.addChild(r),Ge.addChild(n)}const Cs=i=>{cn&&i.interactionLayer&&(i.interactionLayer.off("pointermove",cn),cn=null),un&&(to(un,{minDelay:0,maxDelay:120,destroyTexture:!0,destroyBaseTexture:!1}),un=null),i.isBuilding=!1,i.isDragging=!1,i.showBuildMenu=!1,Ge.visible=!1,i.interactionLayer&&(i.interactionLayer.cursor="cursor")},uu=(i,t,e)=>{Cs(i),i.isBuilding=t,i.isDragging=!0,i.showBuildMenu=!1,Ge.visible=!1;const r=new J.Texture(i.textures.buildings.baseTexture,new J.Rectangle(0,parseInt(i.isBuilding/100)*144,144,144)),n=new J.Sprite(r);n.alpha=.5,n.interactive=!1,n.buttonMode=!1,n.anchor.set(.5,.5),i.stage.addChild(n),un=n;const s=o=>{let a;if(o&&o.global)a=o.global;else if(i.app&&i.app.renderer&&i.app.renderer.plugins&&i.app.renderer.plugins.interaction){const _=i.app.renderer.plugins.interaction,F=_.pointer||_.mouse;F&&F.global&&(a=F.global)}if(!a)return;const l=144/2,u=a.x-l,c=a.y-l,h=Math.floor(i.player.offset.x%48),f=Math.floor(i.player.offset.y%48),d=Math.floor((i.player.offset.x-i.player.defaultOffset.x+h+u)/48),p=Math.floor((i.player.offset.y-i.player.defaultOffset.y+f+c)/48),v=d*48,y=p*48,g=v+l,E=y+l,T=g-i.player.offset.x+i.player.defaultOffset.x,R=E-i.player.offset.y+i.player.defaultOffset.y;n.position.set(T,R)};i.interactionLayer&&(cn=o=>s(o.data),i.interactionLayer.on("pointermove",cn),i.interactionLayer.cursor="pointer"),s(e)},Fv=i=>{if(!i||!i.stage)return;if(!!!(i&&i.player&&i.player.isMayor)){Cs(i),Ge.visible=!1,Ge.parent||i.stage.addChild(Ge);return}const e=Number.isFinite(i?.player?.city)?i.player.city:null,n=(e!==null&&Array.isArray(i?.cities)?i.cities[e]:null)?.canBuild;if(!n){Cs(i),Ge.visible=!1,Ge.parent||i.stage.addChild(Ge);return}if(i.forceDraw){Ge.removeChildren();var s=Object.keys(n),o=1;s.forEach(l=>{n[l]==ur&&o++});var a=new J.Graphics;a.lineStyle(2,0,0),a.beginFill(0,1),a.drawRect(i.buildMenuOffset.x,i.buildMenuOffset.y,180,o*16),a.endFill(),Ge.addChild(a),_E(i),o=1,s.forEach(l=>{if(n[l]==ur){var u=cr[l].TYPE,c=p=>{p.stopPropagation(),uu(i,u,p.data)},h=new J.Texture(i.textures.buildingIcons.baseTexture,new J.Rectangle(cr[l].ICON*16,0,16,16)),f=new J.Sprite(h);f.x=i.buildMenuOffset.x-16,f.y=i.buildMenuOffset.y+o*16,f.interactive=!0,f.iconType=cr[l].IMAGE,f.on("mousedown",c);var d=new J.Text(cr[l].LABEL,{fontSize:12,fill:16777215});d.x=i.buildMenuOffset.x,d.y=i.buildMenuOffset.y+o*16,d.interactive=!0,d.on("mousedown",c),Ge.addChild(f),Ge.addChild(d),o++}}),Ge.visible=!1}Ge.parent||i.stage.addChild(Ge),i.clearGhostBuilding=()=>Cs(i),i.startGhostBuilding=(l,u)=>uu(i,l,u)};function xE(i){i.isBuilding&&!un&&uu(i,i.isBuilding,null)}const wE=i=>{!i.isDragging&&!i.isDemolishing&&(Ge.visible=i.showBuildMenu),xE(i)};var $d=0;const Vd=new Map,Yr=(i,t,e,r,n,s)=>{if(!i)return null;const a=`${i.uid||i.cacheId||"base"}:${t}:${e}:${r}:${n}:${s}`;let l=Vd.get(a);return l||(l=new J.Texture(i,new J.Rectangle(e,r,n,s)),Vd.set(a,l)),l};var TE=function(i,t){for(var e=i.getHead(),r=1920,n=[];e;)e.x>t.offset.x-r&&e.x<t.offset.x+r&&e.y>t.offset.y-r&&e.y<t.offset.y+r&&n.push(e),e=e.next;return n},cu=(i,t,e,r,n)=>{const s=i.textures.imageTurretBase?.baseTexture;if(!s)return;const o=Math.max(0,Math.min(2,(e.type??tt)-tt)),a=Number.isFinite(e?.maxLife)?e.maxLife:null,l=Number.isFinite(e?.life)?e.life:null,u=Number.isFinite(e?.burnThreshold)?e.burnThreshold:null;let c=0;if(a&&l!==null&&l<a){const p=l/a;p<=0||u!==null&&l<=u?c=2:p<=.66&&(c=1)}else e?.isBurning&&(c=2);c=Math.max(0,Math.min(2,c));const h=Yr(s,`turret-base:${o}:${c}`,c*48,o*48,48,48);if(!h)return;t.addFrame(h,e.x-i.player.offset.x+r,e.y-i.player.offset.y+n);let f=0;Number.isFinite(e.angle)&&(f=parseInt(e.angle/22.5+1,10)),(f>=16||f<0)&&(f=0);const d=Yr(i.textures.imageTurretHead?.baseTexture,`turret-head:${e.type}:${f}`,f*48,(e.type-9)*48,48,48);d&&t.addFrame(d,e.x-i.player.offset.x+r,e.y-i.player.offset.y+n)},IE=(i,t,e,r,n)=>{const s=e.city??e.teamId??null,o=i.player?.city??null;if(e.active&&s!==null&&s!==o)return;const a=Yr(i.textures.imageItems?.baseTexture,`mine:${et}`,et*32,0,32,32);if(a){var l=e.x-i.player.offset.x+r+8,u=e.y-i.player.offset.y+n+8;t.addFrame(a,l,u)}},EE=(i,t,e,r,n)=>{const s=e.city??e.teamId??null,o=i.player?.city??null;if(e.active&&s!==null&&s!==o)return;const a=i.textures.imageItems?.baseTexture;if(!a)return;const l=Yr(a,`dfg:${dt}`,dt*48,42,48,48);if(!l)return;const u=e.x-i.player.offset.x+r,c=e.y-i.player.offset.y+n;t.addFrame(l,u,c)},SE=(i,t,e,r,n)=>{const s=i.textures.imageItems?.baseTexture;if(!s)return;const o=!!e.active,a=o?new J.Rectangle(144,91,48,48):new J.Rectangle(Ie*48,42,48,48),l=Yr(s,`bomb:${o?"armed":"idle"}`,a.x,a.y,a.width,a.height);if(!l)return;const u=e.x-i.player.offset.x+r,c=e.y-i.player.offset.y+n;t.addFrame(l,u,c)};const CE=(i,t,e,r,n)=>{const s=i.textures.imageItems?.baseTexture;if(!s)return;const o=Yr(s,`wall:${Ft}`,Ft*48,42,48,48);if(!o)return;const a=e.x-i.player.offset.x+r,l=e.y-i.player.offset.y+n;t.addFrame(o,a,l)},AE=(i,t,e,r,n)=>{const s=e.city??e.teamId??null,o=i.player?.city??null;!(s===null||o===null||s===o)&&!e.target||cu(i,t,e,r,n)},PE=(i,t,e,r,n)=>{const s=i.textures.imageItems?.baseTexture;if(!s)return;const o=e.type*48,a=Yr(s,`item:${e.type}`,o,42,48,48);if(!a)return;const l=e.x-i.player.offset.x+r,u=e.y-i.player.offset.y+n;t.addFrame(a,l,u)},OE={[tt]:cu,[pt]:cu,[xt]:AE,[Ft]:CE,[et]:IE,[dt]:EE,[Ie]:SE},Mv=(i,t)=>{var e=Math.floor(i.player.offset.x%48),r=Math.floor(i.player.offset.y%48);if(i.tick>$d){$d=i.tick+200,t.clear();var n=TE(i.itemFactory,i.player);n.forEach(s=>{switch(s.type){default:{const o=OE[s.type];o?o(i,t,s,e,r):PE(i,t,s,e,r);break}}}),t.position.set(i.player.defaultOffset.x+i.player.offset.x-e,i.player.defaultOffset.y+i.player.offset.y-r)}t.pivot.set(i.player.offset.x,i.player.offset.y)};var FE=function(i,t){for(var e=i.getHead(),r=1920,n=[];e;)e.owner==null&&e.x>t.offset.x-r&&e.x<t.offset.x+r&&e.y>t.offset.y-r&&e.y<t.offset.y+r&&n.push(e),e=e.next;return console.log(n),n};const Rv=(i,t)=>{var e=Math.floor(i.player.offset.x%32),r=Math.floor(i.player.offset.y%32);if(i.forceDraw){t.clear();var n=FE(i.iconFactory,i.player);n.forEach(s=>{console.log(i.player.offset.x-s.x);var o=new J.Texture(i.textures.imageItems.baseTexture,new J.Rectangle(s.type*32,0,32,32));t.addFrame(o,s.x-i.player.offset.x+e,s.y-i.player.offset.y+r)}),t.position.set(i.player.defaultOffset.x+i.player.offset.x-e,i.player.defaultOffset.y+i.player.offset.y-r)}t.pivot.set(i.player.offset.x,i.player.offset.y)},Lv=48,qd=Lv/2,jd=Lv*1.5,Ja="__panelMessageState",Qa="__panelHealthState",Wd=38,Kd=87,ME=Object.freeze({fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:16044095,stroke:0,strokeThickness:2}),RE=Object.freeze({fontFamily:"Arial",fontSize:12,fill:16645886,stroke:0,strokeThickness:2}),LE={[zu]:{x:7,y:267},[Zs]:{x:42,y:267},[vi]:{x:77,y:267},[Ie]:{x:7,y:302},[et]:{x:42,y:302},[gi]:{x:77,y:302},[Js]:{x:7,y:337},[dt]:{x:42,y:337},[Ft]:{x:77,y:337},[tt]:{x:7,y:372},[xt]:{x:42,y:372},[pt]:{x:77,y:372},[vn]:{x:112,y:267}},NE=(i,t,e)=>LE[i]??{x:t,y:e},BE=[{key:"staff",offsetX:145,y:268,width:45,height:20,handler:i=>i?.showStaffSummary&&i.showStaffSummary()},{key:"map",offsetX:145,y:290,width:45,height:20,handler:i=>i?.toggleMapOverlay&&i.toggleMapOverlay()},{key:"info",offsetX:145,y:312,width:45,height:20,handler:i=>i?.showPlayerCityInfo&&i.showPlayerCityInfo()},{key:"points",offsetX:145,y:334,width:45,height:20,handler:i=>i?.showPointsSummary&&i.showPointsSummary()},{key:"options",offsetX:145,y:356,width:45,height:20,handler:i=>i?.openOptionsPanel&&i.openOptionsPanel()},{key:"help",offsetX:145,y:378,width:45,height:20,handler:i=>i?.showHelpMessage&&i.showHelpMessage()},{key:"build",offsetX:126,y:400,width:64,height:22,handler:i=>i?.toggleBuildMenuFromPanel&&i.toggleBuildMenuFromPanel()},{key:"exit",offsetX:150,y:576,width:42,height:18,handler:i=>i?.requestExitToLobby&&i.requestExitToLobby()}],DE=(i,t)=>{if(!i||!t)return;const e=i.maxMapX||0;BE.forEach(r=>{const n=new J.Graphics;n.beginFill(16777215,.001),n.drawRect(e+r.offsetX,r.y,r.width,r.height),n.endFill(),n.interactive=!0,n.buttonMode=!0,n.cursor="pointer",n.on("pointertap",s=>{s.stopPropagation(),typeof r.handler=="function"&&r.handler(i)}),t.addChild(n)})},kE=i=>{const t=Number.isFinite(i)?i:parseInt(i,10)||0;try{return t.toLocaleString("en-US")}catch{return`${t}`}},UE=i=>{if(!i)return 0;if(typeof i.grossIncome=="number"&&Number.isFinite(i.grossIncome))return i.grossIncome;const t=Number(i.income||0),e=Number(i.itemProduction||0)+Number(i.research||0)+Number(i.hospital||0)+Number(i.construction||0);return t-e},Zd="__radarState",XE=2,bi=2,Jd="__homeArrowState",el=40,Nv=5,Bv=160,We=(i,t=null)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const e=Number(i);if(Number.isFinite(e))return e}return t},ps=(i,t)=>!i||!i.baseTexture?null:new J.Texture(i.baseTexture,new J.Rectangle(t*bi,0,bi,bi)),HE=i=>{if(!i||!i.textures)return null;const t=i.textures.imgRadarColors;if(!t)return null;const e={neutral:ps(t,0),admin:ps(t,1),enemy:ps(t,2),ally:ps(t,3)},r=i.textures.imgMiniMapColors;return r&&r.baseTexture&&(e.dead=new J.Texture(r.baseTexture,new J.Rectangle(15*bi,0,bi,bi))),e},GE=i=>i?(i[Ja]||(i[Ja]={heading:null,lines:[]}),i[Ja]):null,YE=i=>{if(!i)return null;if(!i[Qa]){const t=i.textures?.health?.baseTexture;if(!t)return null;const e=new J.Texture(t),r=new J.Sprite(e);r.anchor.set(1,1),i[Qa]={sprite:r,texture:e}}return i[Qa]},Qd=i=>{const t=i?.textures?.imgArrows;if(!t||!t.baseTexture)return[];const e=[];for(let r=0;r<8;r+=1){const n=new J.Rectangle(r*el,0,el,el);e.push(new J.Texture(t.baseTexture,n))}return e},zE=(i,t)=>{if(!i||!t||!i.textures?.imgArrows)return null;let e=t[Jd];if(!e){const r=Qd(i);if(!r.length)return null;const n=new J.Container;n.name="home-arrow",n.position.set((i.maxMapX||0)+Nv,Bv);const s=new J.Sprite(r[0]);return n.addChild(s),t.addChild(n),e={container:n,sprite:s,textures:r,lastIndex:-1},t[Jd]=e,e}return(!e.container.parent||e.container.parent!==t)&&t.addChild(e.container),(!Array.isArray(e.textures)||e.textures.length!==8)&&(e.textures=Qd(i),e.sprite&&e.textures.length&&(e.sprite.texture=e.textures[0],e.lastIndex=-1)),e},$E=(i,t)=>{const e=zE(i,t);if(!e||!e.sprite)return;const r=e.container;r.position.set((i.maxMapX||0)+Nv,Bv);const n=i?.player,s=n?.offset,o=We(n?.city,null);if(!s||o===null){r.visible=!1;return}const a=i.cities?.[o];if(!a){r.visible=!1;return}const l=We(a.x,null),u=We(a.y,null),c=We(s.x,null),h=We(s.y,null);if(!Number.isFinite(l)||!Number.isFinite(u)||!Number.isFinite(c)||!Number.isFinite(h)){r.visible=!1;return}const f=l+jd,d=u+jd,p=c+qd,v=h+qd,y=f-p,g=d-v;if(Math.abs(y)<1&&Math.abs(g)<1){r.visible=!1;return}const E=Math.atan2(-g,y);let T=Math.round(E/(Math.PI/4));T=(T%8+8)%8;const R=e.textures;if(!R||!R[T]){r.visible=!1;return}e.lastIndex!==T&&(e.sprite.texture=R[T],e.lastIndex=T),r.visible=!0},VE=(i,t)=>{if(!i||!t||!i.textures||!i.textures.imgRadarColors)return null;let e=t[Zd];if(!e){const c=new J.Container;c.name="radar-container";const h=new J.Container;h.name="radar-points",c.addChild(h),e={container:c,pointsLayer:h,pool:[],spriteScale:XE,textures:null,bounds:null},t[Zd]=e}if(e.textures||(e.textures=HE(i)),!e.textures)return null;const r=i.maxMapX||0,{offsetX:n,offsetY:s,width:o,height:a}=Y_,l=r+n,u=s;return e.bounds={left:l,top:u,right:l+o,bottom:u+a,width:o,height:a},e.container.position.set(l,u),(!e.container.parent||e.container.parent!==t)&&t.addChild(e.container),e},qE=(i,t)=>{if(!i||!t||!t.pointsLayer||!t.textures)return;const e=i.player;if(!e||!e.offset){t.pointsLayer.visible=!1;return}const r=We(e.offset.x,null),n=We(e.offset.y,null);if(!Number.isFinite(r)||!Number.isFinite(n)){t.pointsLayer.visible=!1;return}const s=t.bounds;if(!s){t.pointsLayer.visible=!1;return}const o=t.pool,a=t.textures,l=(i.maxMapX||0)+H_,u=G_,c=X_,h=We(e.city,null),f=Number.isFinite(h);let d=0;const p=(E,T,R)=>{let _=o[d];_||(_=new J.Sprite(E),_.anchor.set(.5),_.scale.set(t.spriteScale,t.spriteScale),t.pointsLayer.addChild(_),o[d]=_),_.texture!==E&&(_.texture=E),_.visible=!0,_.position.set(T-s.left,R-s.top),d+=1},v=(E,T,R,_,F,P,H)=>{const M=E-r,N=T-n;if(Math.abs(M)>c||Math.abs(N)>c)return;const Y=l+(M-z_)/Ff,D=u+(N-$_)/Ff;if(Y<s.left||Y>s.right||D<s.top||D>s.bottom)return;let Z=a.enemy;if(H!=="rogue"){const Q=Number.isFinite(R)?R:null;F||f&&Q!==null&&Q===h?Z=a.ally||a.neutral||Z:P&&a.admin?Z=a.admin:Q===null&&a.neutral&&(Z=a.neutral)}Number.isFinite(_)&&_<=0&&a.dead&&(Z=a.dead),Z&&p(Z,Y,D)};e.isCloaked||v(r,n,h,We(e.health,null),!0,!1,"player");const y=i.otherPlayers;if(y)for(const E in y){if(!Object.prototype.hasOwnProperty.call(y,E))continue;const T=y[E];if(!T||!T.offset||T.isCloaked)continue;const R=We(T.offset.x,null),_=We(T.offset.y,null);!Number.isFinite(R)||!Number.isFinite(_)||v(R,_,We(T.city,null),We(T.health,null),!1,!!T.isAdmin,"player")}const g=i.rogueTankManager;if(g&&Array.isArray(g.tanks)){const E=g.tanks;for(let T=0;T<E.length;T+=1){const R=E[T];if(!R||!R.offset)continue;const _=We(R.offset.x,null),F=We(R.offset.y,null);!Number.isFinite(_)||!Number.isFinite(F)||v(_,F,null,We(R.health,null),!1,!1,"rogue")}}for(let E=d;E<o.length;E+=1){const T=o[E];T&&(T.visible=!1)}t.pointsLayer.visible=d>0};var jE=(i,t)=>{var e=new J.Sprite(i.textures.interfaceTop);e.x=i.maxMapX,e.y=0,t.addChild(e);var r=new J.Sprite(i.textures.interfaceBottom);r.x=i.maxMapX,r.y=430,t.addChild(r)},WE=(i,t)=>{if(!i.player.isMayor)return;const e=i.player.city??0,r=i.cities?.[e];if(!r)return;const n=i.textures.imgMoneyBox;if(n){const u=new J.Sprite(n);u.x=i.maxMapX+2,u.y=224,t.addChild(u)}const s=UE(r),o=s<0?"imgMoneyDown":"imgMoneyUp",a=i.textures[o];if(a){const u=new J.Sprite(a);u.x=i.maxMapX+8,u.y=225,t.addChild(u)}const l=new J.Text(kE(r.cash??0),{fontFamily:"Arial",fontSize:13,fontWeight:"bold",fill:s<0?15158332:3066993,stroke:0,strokeThickness:1});l.x=i.maxMapX+24,l.y=226,t.addChild(l)},KE=(i,t)=>{for(var e=i.iconFactory.getHead(),r=0,n=0;e;){if(e.owner==i.player.id){let l=e.type*32,u=0;e.type===Ie&&e.armed&&(l=152,u=89);var s=new J.Texture(i.textures.imageItems.baseTexture,new J.Rectangle(l,u,32,32)),o=new J.Sprite(s);const c=NE(e.type,7,267);if(r=i.maxMapX+c.x,n=c.y,e.selected){var a=new J.Sprite(i.textures.imageInventorySelection);a.x=r,a.y=n,t.addChild(a)}o.x=r,o.y=n,o.interactive=!0,o.buttonMode=!0;const h=e;o.on("mousedown",d=>{console.log("selecting item"),d.stopPropagation(),console.log("selecting item"),i.iconFactory.toggleSelected(h),i.forceDraw=!0}),t.addChild(o);const f=e.quantity??1;if(f>1){const d=new J.Text(`${f}`,{fontFamily:"Arial",fontSize:12,fill:16777215,fontWeight:"bold",stroke:0,strokeThickness:3});d.x=r+22,d.y=n+12,t.addChild(d)}}e=e.next}};const ZE=(i,t)=>{if(!i||!t)return;const e=i.panelState||{},r=e.heading||"",n=Array.isArray(e.lines)?e.lines:[];if(!r&&!n.length)return;const s=i.maxMapX+12;let o=465;const a=GE(i),l=a?(a.heading||(a.heading=new J.Text("",ME)),a.heading):null;l&&(r?(l.visible=!0,l.text=r,l.x=s,l.y=o,t.addChild(l),o+=15):l.visible=!1);const u=a?a.lines:[];let c=0;if(n.forEach(h=>{if(h==null||h===""){o+=15,u[c]&&(u[c].visible=!1),c+=1;return}let f=u[c];f||(f=new J.Text("",RE),u[c]=f),f.visible=!0,f.text=`${h}`,f.x=s,f.y=o,t.addChild(f),o+=15,c+=1}),u)for(let h=c;h<u.length;h+=1)u[h]&&(u[h].visible=!1)};var JE=(i,t)=>{const e=Math.max(0,Math.min(1,i.player.health/Pi)),r=Math.floor(e*Kd),n=YE(i);if(!n)return;const{sprite:s,texture:o}=n;if(!s||!o)return;o.frame.height!==r&&(o.frame=new J.Rectangle(0,0,Wd,r),o.updateUvs()),s.visible=r>0,s.x=i.maxMapX+(137+Wd),s.y=160+Kd,s.parent?s.parent!==t&&(s.parent.removeChild(s),t.addChild(s)):t.addChild(s)};const Dv=(i,t)=>{i.forceDraw&&(t.removeChildren(),jE(i,t),WE(i,t),JE(i,t),KE(i,t),ZE(i,t),DE(i,t));const e=VE(i,t);qE(i,e),$E(i,t)};class QE{constructor(t,e={}){this.game=t,this.socketListener=null,this.lastSnapshot=null,this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.visible=!1,this.inGame=!1,this.identityManager=null,this.identityBusy=!1,this.identityFormVisible=!1,this.identityInput=null,this.identityForm=null,this.identitySummary=null,this.identityToggle=null,this.identityFeedback=null,this.identitySave=null,this.identityCancel=null,this.identitySignOut=null,this.googleContainer=null,this.googleButtonTarget=null,this.googleFeedback=null,this.googleScriptPromise=null,this.googleInitialized=!1,this.googleBusy=!1,this.activeTab="cities",this.lastHighScores=[],this.isActivated=e.autoShow!==!1,this.onLobbySnapshot=r=>this.updateSnapshot(r),this.onLobbyUpdate=r=>this.updateSnapshot(r),this.onLobbyAssignment=()=>this.handleAssignment(),this.onLobbyDenied=r=>this.handleDenial(r),this.onSocketConnected=()=>this.handleConnected(),this.onSocketDisconnected=r=>this.handleDisconnected(r),this.onLobbyEvicted=r=>this.handleEviction(r),this.injectStyles(),this.createOverlay(),this.isActivated?this.show():this.hide(),this.setStatus("Connecting to lobby...")}injectStyles(){if(document.getElementById("lobby-overlay-styles"))return;const t=document.createElement("style");t.id="lobby-overlay-styles",t.textContent=`
            .lobby-overlay {
                position: fixed;
                inset: 0;
                display: none;
                align-items: center;
                justify-content: center;
                background: rgba(8, 10, 16, 0.85);
                z-index: 9999;
                pointer-events: auto;
            }
            .lobby-overlay.visible {
                display: flex;
            }
            .lobby-panel {
                background: #131722;
                border: 1px solid #2a3140;
                border-radius: 8px;
                width: min(620px, 92vw);
                max-height: 86vh;
                padding: 24px 28px;
                color: #f5f7ff;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                box-shadow: 0 12px 32px rgba(0, 0, 0, 0.55);
                display: flex;
                flex-direction: column;
                gap: 20px;
            }
            .lobby-header {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }
            .lobby-title {
                font-size: 24px;
                font-weight: 600;
                margin: 0;
            }
            .lobby-subtitle {
                font-size: 14px;
                color: #b3b9c9;
                margin: 0;
            }
            .lobby-tabs {
                display: flex;
                gap: 8px;
                border-bottom: 1px solid rgba(53, 63, 83, 0.8);
                padding-bottom: 8px;
            }
            .lobby-tab {
                background: transparent;
                border: none;
                color: #b3b9c9;
                font-size: 14px;
                padding: 6px 12px;
                border-radius: 6px 6px 0 0;
                cursor: pointer;
                transition: background 0.2s, color 0.2s;
            }
            .lobby-tab:hover {
                color: #f5f7ff;
            }
            .lobby-tab:focus {
                outline: none;
                box-shadow: 0 0 0 2px rgba(123, 225, 125, 0.35);
            }
            .lobby-tab.active {
                background: rgba(53, 63, 83, 0.6);
                color: #f5f7ff;
                font-weight: 600;
            }
            .lobby-tab-panels {
                flex: 1;
                display: flex;
                position: relative;
                min-height: 0;
            }
            .lobby-tab-panel {
                flex: 1;
                display: none;
                flex-direction: column;
                min-height: 0;
            }
            .lobby-tab-panel.active {
                display: flex;
            }
            .lobby-city-list {
                flex: 1;
                overflow-y: auto;
                padding-right: 6px;
                display: flex;
                flex-direction: column;
                gap: 12px;
                min-height: 0;
            }
            .lobby-city-empty {
                color: #b3b9c9;
                font-size: 14px;
                text-align: center;
                padding: 24px 0;
            }
            .lobby-city-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: rgba(22, 27, 38, 0.85);
                border: 1px solid rgba(53, 63, 83, 0.8);
                border-radius: 6px;
                padding: 12px 16px;
                gap: 16px;
            }
            .lobby-city-row.waiting {
                border-color: #5c9eff;
                box-shadow: 0 0 0 1px rgba(92, 158, 255, 0.35);
            }
            .lobby-highscore-list {
                flex: 1;
                overflow-y: auto;
                padding-right: 6px;
                display: flex;
                flex-direction: column;
                gap: 8px;
                min-height: 0;
            }
            .lobby-highscore-empty {
                color: #b3b9c9;
                font-size: 14px;
                text-align: center;
                padding: 24px 0;
            }
            .lobby-highscore-row {
                display: grid;
                grid-template-columns: 44px 1fr 120px;
                align-items: center;
                background: rgba(22, 27, 38, 0.85);
                border: 1px solid rgba(53, 63, 83, 0.8);
                border-radius: 6px;
                padding: 10px 14px;
                gap: 12px;
                font-size: 14px;
            }
            .lobby-highscore-info {
                display: flex;
                flex-direction: column;
                gap: 4px;
                min-width: 0;
            }
            .lobby-highscore-rank {
                font-weight: 600;
                color: #7be17d;
                text-align: center;
            }
            .lobby-highscore-name {
                overflow: hidden;
                white-space: nowrap;
                text-overflow: ellipsis;
            }
            .lobby-highscore-score {
                text-align: right;
                color: #ffc977;
                font-weight: 600;
            }
            .lobby-highscore-meta {
                font-size: 12px;
                color: #8d94a7;
            }
            .lobby-city-info {
                display: flex;
                flex-direction: column;
                gap: 6px;
                min-width: 0;
            }
            .lobby-city-name {
                font-size: 16px;
                font-weight: 600;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .lobby-city-meta {
                font-size: 13px;
                color: #9aa3b8;
            }
            .lobby-city-actions {
                display: flex;
                gap: 8px;
            }
            .lobby-btn {
                background: #1f2534;
                color: #e1e6f6;
                border: 1px solid #384156;
                border-radius: 4px;
                padding: 8px 14px;
                font-size: 13px;
                cursor: pointer;
                transition: background 0.15s, border-color 0.15s, transform 0.15s;
            }
            .lobby-btn--secondary {
                background: #181d2a;
                border-color: #2f374a;
                color: #d4daec;
            }
            .lobby-btn:hover:not(:disabled) {
                background: #2a3245;
                border-color: #4f5d7c;
            }
            .lobby-btn--secondary:hover:not(:disabled) {
                background: #232b3d;
                border-color: #42506d;
            }
            .lobby-btn:active:not(:disabled) {
                transform: translateY(1px);
            }
            .lobby-btn:disabled {
                opacity: 0.45;
                cursor: default;
            }
            .lobby-actions {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
            }
            .lobby-action-group {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }
            .lobby-identity {
                display: flex;
                flex-direction: column;
                gap: 6px;
                align-items: flex-end;
                min-width: 220px;
            }
            .lobby-identity-summary {
                font-size: 13px;
                color: #9aa3b8;
                text-align: right;
            }
            .lobby-identity-form {
                display: none;
                flex-direction: column;
                gap: 8px;
                width: 100%;
            }
            .lobby-identity-form.visible {
                display: flex;
            }
            .lobby-identity-controls {
                display: flex;
                gap: 8px;
                justify-content: flex-end;
                flex-wrap: wrap;
            }
            .lobby-identity-signout {
                color: #f6b6b6;
            }
            .lobby-identity-signout:hover:not(:disabled) {
                background: #2c1b1b;
                border-color: #6b2a2a;
                color: #ffd6d6;
            }
            .lobby-google {
                display: none;
                flex-direction: column;
                gap: 6px;
                align-items: flex-end;
                width: 100%;
            }
            .lobby-google.visible {
                display: flex;
            }
            .lobby-google.busy {
                opacity: 0.6;
                pointer-events: none;
            }
            .lobby-google-button > div {
                display: inline-flex;
            }
            .lobby-google-feedback {
                font-size: 12px;
                color: #9aa3b8;
                text-align: right;
                min-height: 16px;
            }
            .lobby-google-feedback[data-type="error"] {
                color: #ff8484;
            }
            .lobby-google-feedback[data-type="success"] {
                color: #7fe3a0;
            }
            .lobby-identity-input {
                width: 100%;
                padding: 8px 10px;
                border: 1px solid #384156;
                border-radius: 4px;
                background: #0f131d;
                color: #e1e6f6;
                font-size: 13px;
            }
            .lobby-identity-input:focus {
                outline: none;
                border-color: #5c9eff;
                box-shadow: 0 0 0 1px rgba(92, 158, 255, 0.25);
            }
            .lobby-identity-actions {
                display: flex;
                gap: 8px;
                justify-content: flex-end;
            }
            .lobby-identity-feedback {
                font-size: 12px;
                min-height: 16px;
                color: #9aa3b8;
                text-align: right;
            }
            .lobby-identity-feedback[data-type="error"] {
                color: #ff8080;
            }
            .lobby-identity-feedback[data-type="success"] {
                color: #7be17d;
            }
            .lobby-status {
                font-size: 13px;
                color: #b3b9c9;
                min-height: 18px;
            }
            .lobby-status[data-type="error"] {
                color: #ff8080;
            }
            .lobby-status[data-type="warn"] {
                color: #ffc977;
            }
            .lobby-status[data-type="success"] {
                color: #7be17d;
            }
        `,document.head.appendChild(t)}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="lobby-overlay";const t=document.createElement("div");t.className="lobby-panel";const e=document.createElement("div");e.className="lobby-header";const r=document.createElement("h1");r.className="lobby-title",r.textContent="City Lobby";const n=document.createElement("p");n.className="lobby-subtitle",n.textContent="Choose a city to join as mayor or recruit.",e.appendChild(r),e.appendChild(n),this.tabContainer=document.createElement("div"),this.tabContainer.className="lobby-tabs",this.lobbyTabButton=document.createElement("button"),this.lobbyTabButton.type="button",this.lobbyTabButton.className="lobby-tab",this.lobbyTabButton.textContent="Lobby",this.lobbyTabButton.addEventListener("click",()=>this.setActiveTab("cities")),this.highScoreTabButton=document.createElement("button"),this.highScoreTabButton.type="button",this.highScoreTabButton.className="lobby-tab",this.highScoreTabButton.textContent="High Scores",this.highScoreTabButton.addEventListener("click",()=>this.setActiveTab("scores")),this.tabContainer.appendChild(this.lobbyTabButton),this.tabContainer.appendChild(this.highScoreTabButton),this.tabPanels=document.createElement("div"),this.tabPanels.className="lobby-tab-panels",this.cityPanel=document.createElement("div"),this.cityPanel.className="lobby-tab-panel",this.cityPanel.dataset.tab="cities",this.cityListContainer=document.createElement("div"),this.cityListContainer.className="lobby-city-list",this.cityPanel.appendChild(this.cityListContainer),this.highScorePanel=document.createElement("div"),this.highScorePanel.className="lobby-tab-panel",this.highScorePanel.dataset.tab="scores",this.highScoreContainer=document.createElement("div"),this.highScoreContainer.className="lobby-highscore-list",this.highScorePanel.appendChild(this.highScoreContainer),this.tabPanels.appendChild(this.cityPanel),this.tabPanels.appendChild(this.highScorePanel);const s=document.createElement("div");s.className="lobby-actions";const o=document.createElement("div");o.className="lobby-action-group",this.autoButton=document.createElement("button"),this.autoButton.type="button",this.autoButton.className="lobby-btn",this.autoButton.textContent="Auto Assign",this.autoButton.addEventListener("click",()=>this.handleAutoJoin()),this.refreshButton=document.createElement("button"),this.refreshButton.type="button",this.refreshButton.className="lobby-btn",this.refreshButton.textContent="Refresh",this.refreshButton.addEventListener("click",()=>this.requestSnapshot()),o.appendChild(this.autoButton),o.appendChild(this.refreshButton),s.appendChild(o);const a=document.createElement("div");a.className="lobby-identity",this.identitySummary=document.createElement("div"),this.identitySummary.className="lobby-identity-summary",this.identitySummary.textContent="Playing as Guest";const l=document.createElement("div");l.className="lobby-identity-controls",this.identityToggle=document.createElement("button"),this.identityToggle.type="button",this.identityToggle.className="lobby-btn lobby-btn--secondary",this.identityToggle.textContent="Set display name",this.identityToggle.addEventListener("click",()=>this.toggleIdentityForm(!0)),this.identitySignOut=document.createElement("button"),this.identitySignOut.type="button",this.identitySignOut.className="lobby-btn lobby-btn--secondary lobby-identity-signout",this.identitySignOut.textContent="Sign out",this.identitySignOut.style.display="none",this.identitySignOut.addEventListener("click",()=>this.handleIdentitySignOut()),l.appendChild(this.identityToggle),l.appendChild(this.identitySignOut),this.googleContainer=document.createElement("div"),this.googleContainer.className="lobby-google",this.googleButtonTarget=document.createElement("div"),this.googleButtonTarget.className="lobby-google-button",this.googleFeedback=document.createElement("div"),this.googleFeedback.className="lobby-google-feedback",this.googleFeedback.dataset.type="info",this.googleFeedback.textContent="",this.googleContainer.appendChild(this.googleButtonTarget),this.googleContainer.appendChild(this.googleFeedback),this.identityForm=document.createElement("form"),this.identityForm.className="lobby-identity-form",this.identityForm.addEventListener("submit",h=>{h.preventDefault(),this.handleIdentitySubmit()}),this.identityInput=document.createElement("input"),this.identityInput.type="text",this.identityInput.maxLength=32,this.identityInput.autocomplete="off",this.identityInput.placeholder="Enter display name",this.identityInput.className="lobby-identity-input";const u=document.createElement("div");u.className="lobby-identity-actions",this.identitySave=document.createElement("button"),this.identitySave.type="submit",this.identitySave.className="lobby-btn",this.identitySave.textContent="Save",this.identityCancel=document.createElement("button"),this.identityCancel.type="button",this.identityCancel.className="lobby-btn lobby-btn--secondary",this.identityCancel.textContent="Cancel",this.identityCancel.addEventListener("click",()=>this.toggleIdentityForm(!1)),u.appendChild(this.identitySave),u.appendChild(this.identityCancel),this.identityFeedback=document.createElement("div"),this.identityFeedback.className="lobby-identity-feedback",this.identityFeedback.dataset.type="info",this.identityForm.appendChild(this.identityInput),this.identityForm.appendChild(u),this.identityForm.appendChild(this.identityFeedback),a.appendChild(this.identitySummary),a.appendChild(l),a.appendChild(this.googleContainer),a.appendChild(this.identityForm),s.appendChild(a),this.statusNode=document.createElement("div"),this.statusNode.className="lobby-status",this.statusNode.dataset.type="info",t.appendChild(e),t.appendChild(this.tabContainer),t.appendChild(this.tabPanels),t.appendChild(s),t.appendChild(this.statusNode),this.overlay.appendChild(t);const c=document.getElementById("game");c?c.appendChild(this.overlay):document.body.appendChild(this.overlay),this.setActiveTab(this.activeTab||"cities"),this.renderHighScores()}attachSocket(t){t&&this.socketListener!==t&&(this.socketListener&&(this.socketListener.off("lobby:snapshot",this.onLobbySnapshot),this.socketListener.off("lobby:update",this.onLobbyUpdate),this.socketListener.off("lobby:assignment",this.onLobbyAssignment),this.socketListener.off("lobby:denied",this.onLobbyDenied),this.socketListener.off("connected",this.onSocketConnected),this.socketListener.off("disconnected",this.onSocketDisconnected),this.socketListener.off("lobby:evicted",this.onLobbyEvicted)),this.socketListener=t,t.on("lobby:snapshot",this.onLobbySnapshot),t.on("lobby:update",this.onLobbyUpdate),t.on("lobby:assignment",this.onLobbyAssignment),t.on("lobby:denied",this.onLobbyDenied),t.on("connected",this.onSocketConnected),t.on("disconnected",this.onSocketDisconnected),t.on("lobby:evicted",this.onLobbyEvicted))}attachIdentityManager(t){if(this.identityManager=t||null,this.configureGoogleIdentity(),this.identityManager&&typeof this.identityManager.getIdentity=="function"){const e=this.identityManager.getIdentity();this.updateIdentityDisplay(e)}else this.updateIdentityDisplay(null)}updateIdentityDisplay(t){const e=t&&typeof t.name=="string"?t.name.trim():"",r=this.identityManager,n=!!(r&&typeof r.isGoogleAuthEnabled=="function"&&r.isGoogleAuthEnabled()),o=(t&&typeof t.provider=="string"?t.provider.trim().toLowerCase():null)==="google";if(this.identitySummary&&(o&&e.length?this.identitySummary.textContent=`Signed in as ${e}`:e.length?this.identitySummary.textContent=`Playing as ${e}`:n?this.identitySummary.textContent="Register with Google or set a display name to continue.":this.identitySummary.textContent="Set a display name to appear to other players."),this.identityToggle){let l="Set display name";e.length&&(l="Update name"),this.identityToggle.textContent=l,this.identityToggle.disabled=this.identityFormVisible||this.identityBusy}const a=!!(t&&t.id);this.identitySignOut&&(this.identitySignOut.style.display=a?"inline-flex":"none",this.identitySignOut.disabled=this.identityBusy||!a),this.identityInput&&!this.identityFormVisible&&(this.identityInput.value=e),this.updateGoogleDisplay(t)}configureGoogleIdentity(){if(!this.googleContainer)return;const t=this.identityManager;if(!!!(t&&typeof t.isGoogleAuthEnabled=="function"&&t.isGoogleAuthEnabled())){this.googleContainer.classList.remove("visible"),this.setGoogleFeedback("","info"),this.refreshGoogleInteractivity();return}this.googleContainer.classList.add("visible"),this.ensureGoogleClient(),this.refreshGoogleInteractivity()}ensureGoogleClient(){if(typeof window>"u")return;if(window.google&&window.google.accounts&&window.google.accounts.id?window.google.accounts.id:null){this.initializeGoogleButton();return}if(this.googleScriptPromise){this.googleScriptPromise.then(()=>this.initializeGoogleButton()).catch(e=>{this.setGoogleFeedback(e?.message||"Google sign-in unavailable.","error")});return}this.googleScriptPromise=new Promise((e,r)=>{const n=document.querySelector("script[data-google-identity]");if(n){const o=()=>e(window.google),a=()=>r(new Error("Failed to load Google identity script."));n.addEventListener("load",o,{once:!0}),n.addEventListener("error",a,{once:!0});return}const s=document.createElement("script");s.src="https://accounts.google.com/gsi/client",s.async=!0,s.defer=!0,s.dataset.googleIdentity="true",s.onload=()=>e(window.google),s.onerror=()=>r(new Error("Failed to load Google identity script.")),document.head.appendChild(s)}),this.googleScriptPromise.then(()=>this.initializeGoogleButton()).catch(e=>{this.setGoogleFeedback(e?.message||"Google sign-in unavailable.","error")})}initializeGoogleButton(){if(!this.googleContainer)return;const t=this.identityManager;if(!t||typeof t.getGoogleClientId!="function"){this.setGoogleFeedback("Google sign-in unavailable.","error");return}const e=t.getGoogleClientId();if(!e){this.setGoogleFeedback("Google sign-in is not configured.","error");return}if(typeof window>"u"||!window.google||!window.google.accounts||!window.google.accounts.id){this.setGoogleFeedback("Google sign-in unavailable.","error");return}this.googleInitialized||(window.google.accounts.id.initialize({client_id:e,callback:s=>this.handleGoogleCredential(s)}),this.googleInitialized=!0),this.renderGoogleButton();const r=t&&typeof t.getIdentity=="function"?t.getIdentity():null,n=r&&typeof r.provider=="string"?r.provider.trim().toLowerCase():null;this.googleButtonTarget&&(n==="google"?this.googleButtonTarget.style.display="none":this.googleButtonTarget.style.display=""),n==="google"?this.setGoogleFeedback("Registered with Google.","success"):!this.googleBusy&&!this.identityBusy&&!this.identityFormVisible&&this.setGoogleFeedback("Register with Google to save your progress.","info")}renderGoogleButton(){this.googleButtonTarget&&(typeof window>"u"||!window.google||!window.google.accounts||!window.google.accounts.id||(this.googleButtonTarget.innerHTML="",window.google.accounts.id.renderButton(this.googleButtonTarget,{theme:"outline",size:"medium",text:"signup_with",width:240})))}async handleGoogleCredential(t){if(!t||typeof t.credential!="string"){this.setGoogleFeedback("Unable to read Google response.","error");return}if(!this.identityManager||typeof this.identityManager.authenticateWithGoogle!="function"){this.setGoogleFeedback("Google sign-in unavailable.","error");return}this.setGoogleBusy(!0),this.setGoogleFeedback("Registering with Google...","info");try{const e=await this.identityManager.authenticateWithGoogle(t.credential);this.updateIdentityDisplay(e),this.setStatus(`Signed in as ${e.name} via Google.`,{type:"success"}),this.setGoogleFeedback("Registered with Google.","success")}catch(e){const r=e&&e.message?e.message:"Google sign-in failed.";this.setGoogleFeedback(r,"error")}finally{this.setGoogleBusy(!1)}}handleIdentitySignOut(){!this.identityManager||typeof this.identityManager.clearIdentity!="function"||(this.identityManager.clearIdentity(),this.updateIdentityDisplay(null),this.showIdentityFeedback("You are playing as a guest.","info"),this.setStatus("Playing as guest.",{type:"info"}))}setGoogleFeedback(t,e="info"){this.googleFeedback&&(this.googleFeedback.textContent=t||"",this.googleFeedback.dataset.type=e||"info")}setGoogleBusy(t){this.googleBusy=!!t,this.refreshGoogleInteractivity()}refreshGoogleInteractivity(){if(!this.googleContainer)return;this.googleBusy||this.identityBusy||this.identityFormVisible?this.googleContainer.classList.add("busy"):this.googleContainer.classList.remove("busy")}updateGoogleDisplay(t){if(!this.googleContainer)return;const e=this.identityManager,r=!!(e&&typeof e.isGoogleAuthEnabled=="function"&&e.isGoogleAuthEnabled()),s=(t&&typeof t.provider=="string"?t.provider.trim().toLowerCase():null)==="google";if(!r){this.googleContainer.classList.remove("visible"),this.setGoogleFeedback("","info"),this.refreshGoogleInteractivity();return}if(this.googleContainer.classList.add("visible"),!this.googleInitialized){this.ensureGoogleClient();return}this.googleButtonTarget&&(s?this.googleButtonTarget.style.display="none":(this.googleButtonTarget.style.display="",this.googleButtonTarget.firstChild||this.renderGoogleButton())),s?this.setGoogleFeedback("Registered with Google.","success"):!this.googleBusy&&!this.identityBusy&&!this.identityFormVisible&&this.setGoogleFeedback("Register with Google to save your progress.","info")}toggleIdentityForm(t){if(!this.identityForm)return;const e=typeof t=="boolean"?t:!this.identityFormVisible;if(this.identityFormVisible=e,e){if(this.identityForm.classList.add("visible"),this.identityToggle&&(this.identityToggle.disabled=!0),this.identityInput){const r=this.identityManager&&typeof this.identityManager.getIdentity=="function"?this.identityManager.getIdentity():null,n=r&&r.name?r.name:this.identityInput.value;this.identityInput.value=n||"",this.identityInput.disabled=!1,setTimeout(()=>{this.identityInput&&(this.identityInput.focus(),this.identityInput.select())},0)}this.showIdentityFeedback("","info")}else this.identityForm.classList.remove("visible"),this.identityInput&&(this.identityInput.disabled=!1),this.identityToggle&&(this.identityToggle.disabled=this.identityBusy),this.identityBusy||this.showIdentityFeedback("","info");this.refreshGoogleInteractivity()}setIdentityBusy(t){if(this.identityBusy=!!t,this.identityInput&&(this.identityInput.disabled=this.identityBusy),this.identitySave&&(this.identitySave.disabled=this.identityBusy),this.identityCancel&&(this.identityCancel.disabled=this.identityBusy),this.identityToggle&&(this.identityToggle.disabled=this.identityBusy||this.identityFormVisible),this.identitySignOut){const e=this.identityManager&&typeof this.identityManager.getIdentity=="function"?this.identityManager.getIdentity():null,r=!!(e&&e.id);this.identitySignOut.disabled=this.identityBusy||!r}this.refreshGoogleInteractivity()}showIdentityFeedback(t,e="info"){this.identityFeedback&&(this.identityFeedback.textContent=t||"",this.identityFeedback.dataset.type=e||"info")}async handleIdentitySubmit(){if(this.identityBusy)return;const t=this.identityInput?this.identityInput.value:"",e=typeof t=="string"?t.trim():"";if(!e.length){this.showIdentityFeedback("Please enter a name.","error"),this.identityInput&&this.identityInput.focus();return}if(!this.identityManager||typeof this.identityManager.saveName!="function"){this.showIdentityFeedback("Registration is currently unavailable.","error");return}this.setIdentityBusy(!0),this.showIdentityFeedback("Saving...","info");try{const r=await this.identityManager.saveName(e);this.showIdentityFeedback("Name saved.","success"),this.updateIdentityDisplay(r),this.toggleIdentityForm(!1),this.setStatus(`Registered as ${r.name}.`,{type:"success"})}catch(r){const n=r&&r.message?r.message:"Unable to save name.";this.showIdentityFeedback(n,"error")}finally{this.setIdentityBusy(!1),this.identityFormVisible||this.showIdentityFeedback("","info")}}show(){this.isActivated=!0,this.overlay&&this.overlay.classList.add("visible"),this.visible=!0,this.identityManager&&typeof this.identityManager.getIdentity=="function"&&this.updateIdentityDisplay(this.identityManager.getIdentity()),this.game?.music&&typeof this.game.music.playLobby=="function"&&!this.inGame&&this.game.music.playLobby()}hide(){this.overlay&&this.overlay.classList.remove("visible"),this.visible=!1,this.identityFormVisible&&this.toggleIdentityForm(!1),this.game?.music&&typeof this.game.music.stop=="function"&&this.game.music.stop()}isInGame(){return this.inGame}activate(){this.isActivated||(this.isActivated=!0,this.show())}setStatus(t,e={}){if(!this.statusNode)return;const r=e.type||"info";this.statusNode.dataset.type=r,this.statusNode.textContent=t||""}updateSnapshot(t){let e=t;if(e){if(typeof e=="string")try{e=JSON.parse(e)}catch(r){console.warn("Failed to parse lobby snapshot",r);return}!e||!Array.isArray(e.cities)||(this.lastSnapshot=e,this.lastHighScores=Array.isArray(e.highScores)?e.highScores:[],this.renderCityList(),this.renderHighScores(),this.waiting||!e.cities.some(n=>n.openMayor||n.openRecruits>0)&&this.visible&&this.setStatus("All cities are currently full. Please wait for an opening.",{type:"warn"}))}}setActiveTab(t){const e=t==="scores"?"scores":"cities";this.activeTab=e,this.lobbyTabButton&&(this.lobbyTabButton.classList.toggle("active",e==="cities"),this.lobbyTabButton.setAttribute("aria-selected",e==="cities"?"true":"false")),this.highScoreTabButton&&(this.highScoreTabButton.classList.toggle("active",e==="scores"),this.highScoreTabButton.setAttribute("aria-selected",e==="scores"?"true":"false")),this.cityPanel&&this.cityPanel.classList.toggle("active",e==="cities"),this.highScorePanel&&this.highScorePanel.classList.toggle("active",e==="scores")}renderHighScores(){if(!this.highScoreContainer)return;const t=Array.isArray(this.lastHighScores)?this.lastHighScores:[];if(this.highScoreContainer.innerHTML="",!t.length){const e=document.createElement("div");e.className="lobby-highscore-empty",e.textContent="No player scores yet.",this.highScoreContainer.appendChild(e);return}t.forEach((e,r)=>{const n=document.createElement("div");n.className="lobby-highscore-row",n.dataset.rank=String(r+1);const s=document.createElement("div");s.className="lobby-highscore-rank",s.textContent=`#${r+1}`;const o=document.createElement("div");o.className="lobby-highscore-info";const a=document.createElement("div");a.className="lobby-highscore-name",a.textContent=e&&typeof e.name=="string"&&e.name.trim().length?e.name:"Unknown Pilot";const l=document.createElement("div");l.className="lobby-highscore-meta";const c=[`Rank: ${e&&e.rankTitle?e.rankTitle:"Private"}`];e&&Number.isFinite(e.orbs)&&e.orbs>0&&c.push(`Orbs: ${e.orbs}`),e&&Number.isFinite(e.assists)&&e.assists>0&&c.push(`Assists: ${e.assists}`),l.textContent=c.join("  "),o.appendChild(a),o.appendChild(l);const h=document.createElement("div");h.className="lobby-highscore-score";const f=e&&Number.isFinite(e.points)?e.points:Number(e?.points)||0;h.textContent=`${Math.max(0,Math.floor(f)).toLocaleString()} pts`,n.appendChild(s),n.appendChild(o),n.appendChild(h),this.highScoreContainer.appendChild(n)})}renderCityList(){if(!this.cityListContainer)return;if(this.cityListContainer.innerHTML="",!this.lastSnapshot||!Array.isArray(this.lastSnapshot.cities)||!this.lastSnapshot.cities.length){const e=document.createElement("div");e.className="lobby-city-empty",e.textContent="Waiting for available cities...",this.cityListContainer.appendChild(e);return}[...this.lastSnapshot.cities].sort((e,r)=>{const n=Number.isFinite(e?.id)?e.id:0,s=Number.isFinite(r?.id)?r.id:0;return n-s}).forEach(e=>{const r=document.createElement("div");r.className="lobby-city-row",r.dataset.cityId=e.id,this.waiting&&this.waitingCity===e.id&&r.classList.add("waiting");const n=document.createElement("div");n.className="lobby-city-info";const s=document.createElement("div");s.className="lobby-city-name",s.textContent=e.name||`City ${e.id}`;const o=e.mayorName||e.mayorLabel||"(unknown)",a=e.openMayor?"(open)":o,l=Number.isFinite(e.capacity)?e.capacity:1+(e.maxRecruits??3),u=Number.isFinite(e.playerCount)?e.playerCount:0,c=document.createElement("div");c.className="lobby-city-meta";const h=[`Mayor: ${a}`,`Players: ${u}/${l}`],f=Number.isFinite(e.score)?e.score:Number(e.score);Number.isFinite(f)&&h.push(`Score: ${f}`);const d=Number.isFinite(e.orbs)?e.orbs:Number(e.orbs);Number.isFinite(d)&&h.push(`Orbs: ${d}`),c.textContent=h.join("  "),n.appendChild(s),n.appendChild(c);const p=document.createElement("div");p.className="lobby-city-actions";const v=document.createElement("button");v.type="button",v.className="lobby-btn",v.textContent="Mayor",v.disabled=!e.openMayor||this.waiting,v.addEventListener("click",()=>this.handleJoin(e.id,"mayor"));const y=document.createElement("button");y.type="button",y.className="lobby-btn",y.textContent="Recruit";const g=Number.isFinite(e.openRecruits)?e.openRecruits>0:!!e.hasRecruitVacancy;y.disabled=!g||this.waiting,y.addEventListener("click",()=>this.handleJoin(e.id,"recruit")),p.appendChild(v),p.appendChild(y),r.appendChild(n),r.appendChild(p),this.cityListContainer.appendChild(r)}),this.autoButton&&(this.autoButton.disabled=this.waiting),this.refreshButton&&(this.refreshButton.disabled=this.waiting)}handleJoin(t,e){if(this.waiting)return;if(!this.socketListener||this.socketListener.io&&this.socketListener.io.disconnected){this.setStatus("Cannot join right now. Connection unavailable.",{type:"error"});return}this.waiting=!0,this.waitingCity=t,this.waitingRole=e,this.setStatus(`Requesting ${e==="mayor"?"mayor":"recruit"} slot in city ${t}...`),this.renderCityList();const r=this.socketListener.enterGame({city:t,role:e});r&&(this.game.player.id=r)}handleAutoJoin(){if(this.waiting)return;if(!this.socketListener||this.socketListener.io&&this.socketListener.io.disconnected){this.setStatus("Cannot join right now. Connection unavailable.",{type:"error"});return}this.waiting=!0,this.waitingCity=null,this.waitingRole=null,this.setStatus("Requesting automatic assignment..."),this.renderCityList();const t=this.socketListener.enterGame({auto:!0});t&&(this.game.player.id=t)}handleAssignment(){this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.inGame=!0,this.setStatus("Assignment confirmed. Entering city...",{type:"success"}),this.renderCityList(),this.hide()}handleEviction(t){this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.inGame=!1;const e=typeof t?.reason=="string"?t.reason:"orb",r=Number.isFinite(t?.city)?Number(t.city):null,n=Number.isFinite(t?.attackerCity)?Number(t.attackerCity):null,s=Number.isFinite(t?.points)?Number(t.points):null,o=r!==null?Ae(r):"your city",a=n!==null?Ae(n):null,l=[];e==="death"?a?l.push(`${a} eliminated you.`):l.push("You were eliminated in combat."):a?l.push(`${a} destroyed ${o}.`):l.push(`An enemy orb destroyed ${o}.`),e!=="death"&&s!==null&&s>0&&l.push(`They earned ${s} points.`),this.isActivated&&this.show(),this.setStatus(l.join(" "),{type:"error"}),this.renderCityList(),this.requestSnapshot()}handleDenial(t){this.waiting=!1,this.inGame=!1;const e=t?.requestedCity,r=t?.reason==="cities_full"?"All cities are currently full. Please try again in a moment.":"Selected slot was unavailable. Please choose a different option.",n=t?.reason==="cities_full"?"warn":"error";e!=null?this.waitingCity=e:this.waitingCity=null,this.waitingRole=null,this.setStatus(r,{type:n}),this.renderCityList(),this.requestSnapshot()}handleConnected(){this.inGame=!1,this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.isActivated&&this.show(),this.setStatus("Connected. Choose a city to enter.",{type:"info"}),this.requestSnapshot()}handleDisconnected(t){this.inGame=!1,this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.isActivated&&this.show();const e=t?`Connection lost (${t}). Reconnecting...`:"Connection lost. Reconnecting...";this.setStatus(e,{type:"error"})}requestSnapshot(){this.socketListener&&typeof this.socketListener.requestLobbySnapshot=="function"&&this.socketListener.requestLobbySnapshot()}}class eS{constructor(t={}){this.maxVisible=Number.isFinite(t.maxVisible)?Math.max(1,t.maxVisible):5,this.defaultTimeout=Number.isFinite(t.timeout)?t.timeout:5e3,this.notifications=new Set,this.injectStyles(),this.container=this.createContainer()}injectStyles(){if(typeof document>"u"||document.getElementById("battlecity-toast-styles"))return;const t=document.createElement("style");t.id="battlecity-toast-styles",t.textContent=`
            #battlecity-toast-container {
                position: fixed;
                inset: auto 24px 24px auto;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
                gap: 12px;
                width: min(340px, 92vw);
                z-index: 1200;
                pointer-events: none;
            }
            .battlecity-toast {
                background: rgba(16, 20, 32, 0.92);
                border-radius: 12px;
                border: 1px solid rgba(82, 104, 176, 0.35);
                box-shadow: 0 18px 40px rgba(5, 9, 20, 0.55);
                padding: 12px 16px 12px 18px;
                display: flex;
                flex-direction: column;
                gap: 6px;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                color: #ecf2ff;
                pointer-events: auto;
                cursor: pointer;
                opacity: 0;
                transform: translateY(8px);
                transition: opacity 160ms ease, transform 160ms ease;
            }
            .battlecity-toast[data-visible="true"] {
                opacity: 1;
                transform: translateY(0);
            }
            .battlecity-toast__title {
                font-weight: 600;
                letter-spacing: 0.3px;
                font-size: 14px;
            }
            .battlecity-toast__body {
                font-size: 13px;
                line-height: 1.45;
                opacity: 0.9;
            }
            .battlecity-toast[data-variant="success"] {
                border-color: rgba(82, 176, 125, 0.5);
            }
            .battlecity-toast[data-variant="warn"] {
                border-color: rgba(220, 156, 72, 0.5);
            }
            .battlecity-toast[data-variant="error"] {
                border-color: rgba(220, 92, 92, 0.5);
            }
        `,document.head.appendChild(t)}createContainer(){if(typeof document>"u")return null;let t=document.getElementById("battlecity-toast-container");if(!t){t=document.createElement("div"),t.id="battlecity-toast-container";const e=document.getElementById("game");e?e.appendChild(t):document.body.appendChild(t)}return t}normaliseMessage(t){return t==null?"":Array.isArray(t)?t.filter(e=>e!=null).map(e=>`${e}`).join(" "):`${t}`}notify(t={}){if(!this.container)return null;const e=t.title?`${t.title}`:"",r=this.normaliseMessage(t.message),n=t.variant||t.level||"info",s=Number.isFinite(t.timeout)?t.timeout:this.defaultTimeout;for(;this.notifications.size>=this.maxVisible;){const l=this.notifications.values().next().value;if(!l)break;this.dismiss(l)}const o=document.createElement("div");if(o.className="battlecity-toast",o.dataset.variant=n,e){const l=document.createElement("div");l.className="battlecity-toast__title",l.textContent=e,o.appendChild(l)}if(r){const l=document.createElement("div");l.className="battlecity-toast__body",l.textContent=r,o.appendChild(l)}const a=()=>this.dismiss(o);return o.addEventListener("click",a),this.container.appendChild(o),this.notifications.add(o),requestAnimationFrame(()=>{o.dataset.visible="true"}),s>0&&(o.__battlecityTimeout=window.setTimeout(()=>this.dismiss(o),s)),o}dismiss(t){!t||!this.notifications.has(t)||(this.notifications.delete(t),t.dataset.visible="false",t.__battlecityTimeout&&window.clearTimeout(t.__battlecityTimeout),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},180))}clear(){Array.from(this.notifications).forEach(t=>this.dismiss(t))}}const ep=["Iron Vanguard","Steel Warden","Brass Rampart","Cobalt Siege","Obsidian Bastion","Chrome Juggernaut","Granite Lancer","Carbon Phalanx","Titan Howl","Copper Barrage","Lead Avalanche","Onyx Hammer","Nickel Sentry","Tungsten Brawler","Graphite Sabre","Mercury Raptor","Plasma Maul","Ironclad Echo","Steel Tempest","Rivet Spectre","Bunker Wolf","Siege Lynx","Mortar Hydra","Shrapnel Ghost","Grit Titan","Arc Bastion","Vulcan Aegis","Ferro Talon","Razor Rampart","Blast Cyclops","Warden Basilisk","Forge Kraken","Piston Revenant","Tread Harbinger","Serrated Bulwark","Verdant Mauler","Sable Vanguard","Chrome Gorgon","Thunder Pillar","Siege Rancor","Smokestack Viper","Recoil Behemoth","Ashen Paladin","Slate Raider","Oxide Marauder","Coldfire Titan","Tremor Wraith","Steel Cyclone"],tS=Array.isArray(ep)?ep.filter(i=>typeof i=="string"&&i.trim().length):[],rS=i=>Number.isFinite(i)?i<10?`0${i}`:`${i}`:"";class iS{constructor(t={}){const e=Array.isArray(t.names)&&t.names.length?t.names:tS;this.names=e.map(r=>`${r}`.trim()),this.cursor=0,this.assigned=new Map,this.usage=new Map}nextBaseName(){if(!this.names.length)return"Rampart";const t=this.names[this.cursor%this.names.length];return this.cursor=(this.cursor+1)%(this.names.length*1e3),t}buildName(t){const e=(this.usage.get(t)||0)+1;return this.usage.set(t,e),e===1?t:`${t}-${rS(e)}`}assign(t,e={}){if(t==null)return this.buildName(this.nextBaseName());const r=`${t}`;if(this.assigned.has(r))return this.assigned.get(r).name;const n=e.baseName||this.nextBaseName(),s=this.buildName(n);return this.assigned.set(r,{name:s,base:n}),s}get(t){if(t==null)return null;const e=this.assigned.get(`${t}`);return e?e.name:null}release(t){if(t==null)return;const e=`${t}`,r=this.assigned.get(e);if(!r)return;const{base:n}=r;if(this.assigned.delete(e),!n)return;const s=this.usage.get(n)||1,o=Math.max(0,s-1);o===0?this.usage.delete(n):this.usage.set(n,o)}}const He="battlecity-chat-container",nS=100,ai={team:"Team",global:"Global"},sS=3500,hu=(i,t=null)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const e=Number(i);if(Number.isFinite(e))return e}return t},oS=(i,t=null)=>{const e=hu(i,t);return Number.isFinite(e)?Math.max(0,Math.floor(e)):t},aS=i=>Number.isFinite(i)?new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";class lS{constructor(t={}){this.game=t.game??null,this.defaultScope=t.defaultScope==="global"?"global":"team",this.maxMessages=Number.isFinite(t.maxMessages)?Math.max(1,t.maxMessages):nS,this.messages=[],this.socket=null,this.scope=this.defaultScope,this.statusTimeout=null,this.handleIncomingMessage=e=>this.receiveMessage(e),this.handleHistory=e=>this.applyHistory(e),this.handleRateLimit=e=>this.receiveRateLimit(e),this.handleConnected=()=>this.setConnectionState(!0),this.handleDisconnected=()=>this.setConnectionState(!1),this.injectStyles(),this.container=this.ensureContainer(),this.logElement=this.container?this.container.querySelector(".battlecity-chat__log"):null,this.formElement=this.container?this.container.querySelector(".battlecity-chat__form"):null,this.inputElement=this.container?this.container.querySelector(".battlecity-chat__input"):null,this.scopeElement=this.container?this.container.querySelector(".battlecity-chat__scope"):null,this.statusElement=this.container?this.container.querySelector(".battlecity-chat__status"):null,this.registerDomEvents(),this.setConnectionState(!1),this.hideControls()}injectStyles(){if(typeof document>"u"||document.getElementById("battlecity-chat-styles"))return;const t=document.createElement("style");t.id="battlecity-chat-styles",t.textContent=`
            #${He} {
                position: fixed;
                left: 18px;
                bottom: 84px;
                width: min(360px, 32vw);
                display: flex;
                flex-direction: column;
                gap: 8px;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                color: #f5f7ff;
                z-index: 1150;
                pointer-events: none;
            }
            #${He}[data-connected="false"] .battlecity-chat__input,
            #${He}[data-connected="false"] .battlecity-chat__scope {
                opacity: 0.55;
            }
            #${He} .battlecity-chat__log {
                background: rgba(10, 16, 34, 0.72);
                border: 1px solid rgba(70, 94, 180, 0.45);
                border-radius: 12px;
                padding: 12px 14px;
                display: flex;
                flex-direction: column;
                gap: 6px;
                max-height: 240px;
                overflow-y: auto;
                pointer-events: auto;
            }
            #${He} .battlecity-chat__message {
                display: flex;
                flex-direction: column;
                gap: 2px;
                font-size: 13px;
                line-height: 1.45;
                word-break: break-word;
            }
            #${He} .battlecity-chat__messageHeader {
                display: flex;
                gap: 6px;
                align-items: baseline;
                font-size: 12px;
                letter-spacing: 0.2px;
                opacity: 0.8;
            }
            #${He} .battlecity-chat__scopeBadge {
                text-transform: uppercase;
                font-weight: 600;
                color: #8fb5ff;
            }
            #${He} .battlecity-chat__scopeBadge[data-scope="global"] {
                color: #ffba6b;
            }
            #${He} .battlecity-chat__sender {
                font-weight: 600;
                color: #f0f4ff;
            }
            #${He} .battlecity-chat__body {
                font-size: 13px;
                letter-spacing: 0.2px;
            }
            #${He} .battlecity-chat__form {
                display: flex;
                gap: 6px;
                pointer-events: auto;
            }
            #${He} .battlecity-chat__scope {
                appearance: none;
                border: 1px solid rgba(90, 114, 196, 0.6);
                background: rgba(13, 20, 44, 0.9);
                color: #e8eeff;
                border-radius: 10px;
                padding: 6px 10px;
                font-size: 13px;
                font-family: inherit;
                cursor: pointer;
                pointer-events: auto;
            }
            #${He} .battlecity-chat__input {
                flex: 1;
                border: 1px solid rgba(90, 114, 196, 0.6);
                background: rgba(18, 26, 52, 0.92);
                color: #f0f6ff;
                border-radius: 10px;
                padding: 8px 12px;
                font-size: 13px;
                font-family: inherit;
                outline: none;
                pointer-events: auto;
            }
            #${He} .battlecity-chat__input::placeholder {
                color: rgba(205, 214, 255, 0.65);
            }
            #${He} .battlecity-chat__status {
                min-height: 16px;
                font-size: 12px;
                color: #ffd27d;
                letter-spacing: 0.2px;
                opacity: 0;
                transition: opacity 180ms ease;
                pointer-events: none;
            }
            #${He} .battlecity-chat__status[data-visible="true"] {
                opacity: 0.85;
            }
        `,document.head.appendChild(t)}ensureContainer(){if(typeof document>"u")return null;let t=document.getElementById(He);if(!t){t=document.createElement("div"),t.id=He,t.innerHTML=`
                <div class="battlecity-chat__log" aria-live="polite"></div>
                <form class="battlecity-chat__form" autocomplete="off">
                    <select class="battlecity-chat__scope" aria-label="Chat scope">
                        <option value="team">Team</option>
                        <option value="global">Global</option>
                    </select>
                    <input class="battlecity-chat__input" type="text" maxlength="240" placeholder="Team chat" />
                </form>
                <div class="battlecity-chat__status" role="status"></div>
            `;const e=document.getElementById("game");e?e.appendChild(t):document.body.appendChild(t)}return t}registerDomEvents(){!this.formElement||!this.inputElement||!this.scopeElement||(this.scopeElement.value=this.scope,this.scopeElement.addEventListener("change",()=>{this.scope=this.scopeElement.value==="global"?"global":"team",this.updatePlaceholder(),this.focusInput()}),this.formElement.addEventListener("submit",t=>{t.preventDefault(),this.submitMessage()}))}bindSocket(t){this.socket&&(this.socket.off("chat:message",this.handleIncomingMessage),this.socket.off("chat:history",this.handleHistory),this.socket.off("chat:rate_limit",this.handleRateLimit),this.socket.off("connected",this.handleConnected),this.socket.off("disconnected",this.handleDisconnected)),this.socket=t,t&&(t.on("chat:message",this.handleIncomingMessage),t.on("chat:history",this.handleHistory),t.on("chat:rate_limit",this.handleRateLimit),t.on("connected",this.handleConnected),t.on("disconnected",this.handleDisconnected))}setConnectionState(t){this.container&&(this.container.dataset.connected=t?"true":"false",this.inputElement&&(this.inputElement.disabled=!t,this.scopeElement&&(this.scopeElement.disabled=!t),this.updatePlaceholder()))}updatePlaceholder(){if(!this.inputElement)return;const t=ai[this.scope]||ai.team,e=this.container?.dataset.connected==="true"?`${t} chat`:"Chat offline";this.inputElement.placeholder=e}submitMessage(){if(!this.socket||!this.inputElement)return;const t=this.inputElement.value;if(!t||!t.trim()){this.inputElement.value="";return}this.socket.sendChatMessage({scope:this.scope,message:t})&&(this.inputElement.value="")}focusInput(){!this.inputElement||typeof window>"u"||window.requestAnimationFrame(()=>{this.inputElement&&this.inputElement.focus()})}receiveMessage(t){const e=this.normaliseIncomingMessage(t);e&&(this.messages.push(e),this.messages.length>this.maxMessages&&this.messages.splice(0,this.messages.length-this.maxMessages),this.appendMessage(e))}applyHistory(t){Array.isArray(t)&&(this.messages=t.map(e=>this.normaliseIncomingMessage(e)).filter(Boolean),this.logElement&&(this.logElement.innerHTML="",this.messages.forEach(e=>{this.logElement.appendChild(this.renderMessage(e))}),this.scrollToBottom()))}normaliseIncomingMessage(t){if(!t)return null;const e=typeof t.scope=="string"&&t.scope.toLowerCase()==="global"?"global":"team",r=typeof t.text=="string"?t.text.trim():"";if(!r)return null;const n=hu(t.createdAt,Date.now()),s=t.senderId??null,o=oS(t.senderCity,null),a=this.resolveSenderLabel(t,o);return{id:t.id?String(t.id):`${n}-${Math.random().toString(36).slice(2,6)}`,scope:e,text:r,createdAt:n,senderId:s,senderCity:o,senderLabel:a}}resolveSenderLabel(t,e){if(t&&typeof t.senderDisplay=="string"&&t.senderDisplay.trim().length)return t.senderDisplay.trim();if(t&&typeof t.senderCallsign=="string"&&t.senderCallsign.trim().length)return t.senderCallsign.trim();if(this.game&&typeof this.game.resolveCallsign=="function"&&t?.senderId){const n=this.game.resolveCallsign(t.senderId);if(n)return n}const r=this.resolveCityName(e);if(t?.senderId){const n=String(t.senderId);return n.length<=8?n:`${n.slice(0,4)}${n.slice(-2)}`}return r||"Player"}resolveCityName(t){if(t==null)return null;if(this.game&&Array.isArray(this.game.cities)){const e=this.game.cities[t];if(e){if(typeof e.nameOverride=="string"&&e.nameOverride.trim().length)return e.nameOverride.trim();if(typeof e.name=="string"&&e.name.trim().length)return e.name.trim()}}return Ae(t)}appendMessage(t){if(!this.logElement)return;const e=this.renderMessage(t);e.dataset.timestamp=Date.now(),this.logElement.appendChild(e),this.scrollToBottom(),this.startMessageCleanup()}renderMessage(t){const e=document.createElement("div");e.className="battlecity-chat__message",e.dataset.scope=t.scope;const r=document.createElement("div");r.className="battlecity-chat__messageHeader";const n=document.createElement("span");if(n.className="battlecity-chat__scopeBadge",n.dataset.scope=t.scope,n.textContent=ai[t.scope]||ai.team,r.appendChild(n),t.senderCity!==null&&t.senderCity!==void 0){const l=document.createElement("span");l.className="battlecity-chat__city",l.textContent=this.resolveCityName(t.senderCity),r.appendChild(l)}const s=document.createElement("span");s.className="battlecity-chat__sender",s.textContent=t.senderLabel,r.appendChild(s);const o=aS(t.createdAt);if(o){const l=document.createElement("span");l.className="battlecity-chat__time",l.textContent=o,r.appendChild(l)}const a=document.createElement("div");return a.className="battlecity-chat__body",a.textContent=t.text,e.appendChild(r),e.appendChild(a),e}scrollToBottom(){this.logElement&&(this.logElement.scrollTop=this.logElement.scrollHeight)}receiveRateLimit(t){if(!t)return;const e=t.scope==="global"?"global":"team",r=ai[e]||ai.team,n=hu(t.retryAt,Date.now()),s=Math.max(1,Math.ceil((n-Date.now())/1e3)),o=`${r} chat cooling down (${s}s)`;this.showStatus(o),this.game&&typeof this.game.notify=="function"&&this.game.notify({title:"Chat Rate Limit",message:o,variant:"warn",timeout:2400})}showStatus(t){this.statusElement&&(this.statusElement.textContent=t||"",t?(this.statusElement.dataset.visible="true",typeof window<"u"&&(this.statusTimeout&&window.clearTimeout(this.statusTimeout),this.statusTimeout=window.setTimeout(()=>{this.statusElement&&(this.statusElement.dataset.visible="false",this.statusElement.textContent="")},sS))):this.statusElement.dataset.visible="false")}showControls(){this.formElement&&(this.formElement.style.display="flex"),this.statusElement&&(this.statusElement.style.display="block"),this.logElement&&(this.logElement.style.display="flex"),this.showAllMessages()}hideControls(){this.formElement&&(this.formElement.style.display="none"),this.statusElement&&(this.statusElement.style.display="none"),this.hideOldMessages()}showAllMessages(){if(!this.logElement)return;this.logElement.querySelectorAll(".battlecity-chat__message").forEach(e=>{e.style.display="flex"})}hideOldMessages(){if(!this.logElement)return;const t=Date.now(),e=this.logElement.querySelectorAll(".battlecity-chat__message");let r=!1;e.forEach(n=>{const s=parseInt(n.dataset.timestamp,10);s&&t-s>1e4?n.style.display="none":(n.style.display="flex",r=!0)}),r?this.logElement.style.display="flex":this.logElement.style.display="none"}startMessageCleanup(){this.cleanupInterval||(this.cleanupInterval=setInterval(()=>{this.formElement&&this.formElement.style.display==="none"&&this.hideOldMessages()},1e3))}stopMessageCleanup(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)}}const ks={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_GOOGLE_CLIENT_ID:"837293047887-uvnpu1ib8ono4b87alpoc0sk1cfovs4k.apps.googleusercontent.com"},uS="battlecity.identity",tp=2,cS=32,hS=()=>{try{if(typeof import.meta<"u"&&ks){const i=ks,t=i.VITE_SOCKET_URL||i.VITE_SERVER_URL||null;if(t)return String(t)}}catch{}return null},tl=()=>{if(typeof window<"u"&&window.location){const{protocol:i,hostname:t}=window.location,e=i==="https:"?"https:":"http:",r=(t||"").toLowerCase();if(["localhost","127.0.0.1","::1"].includes(r))return`${e}//${t}:8021`;if(window.location.origin)return window.location.origin;const s=window.location.port?`:${window.location.port}`:"";return`${e}//${t}${s}`}return"http://localhost:8021"},fS=()=>{try{if(typeof import.meta<"u"&&ks){const i=ks,t=i.VITE_GOOGLE_CLIENT_IDS||i.VITE_GOOGLE_CLIENT_ID||null;if(t)return String(t)}}catch{}return null},dS=i=>{if(!i||typeof i!="string")return null;const t=i.replace(/\s+/g," ").trim();if(!t.length||t.length<tp)return null;const e=t.replace(/[\u0000-\u001F\u007F]/g,"").slice(0,cS).trim();return e.length<tp?null:e};class pS{constructor(t,e={}){this.game=t,this.identity=null;const r=hS(),n=e.apiBase||r||tl();this.apiBase=this._normaliseBase(n),this.storageKey=e.storageKey||uS,this.socketListener=null;const s=fS(),o=Array.isArray(e.googleClientIds)?e.googleClientIds:e.googleClientId||null;this.googleClientIds=this._normaliseClientIds(o)||[],this.googleClientIds.length===0&&(this.googleClientIds=this._normaliseClientIds(s)),this.googleClientId=this.googleClientIds.length?this.googleClientIds[0]:null,this._initialisePromise=null,this.handleSocketConnected=this.handleSocketConnected.bind(this),this.handleIdentityAck=this.handleIdentityAck.bind(this)}_normaliseProvider(t){if(!t||typeof t!="string")return null;const e=t.trim();return e.length?e.toLowerCase():null}_normaliseBase(t){if(!t||typeof t!="string")return tl();const e=t.trim().replace(/\/$/,"");return e.length?e:tl()}loadFromStorage(){if(typeof window>"u"||!window.localStorage)return null;try{const t=window.localStorage.getItem(this.storageKey);if(!t)return null;const e=JSON.parse(t);if(!e||typeof e!="object")return null;if(typeof e.id=="string"&&typeof e.name=="string"){const r={id:e.id,name:e.name,provider:typeof e.provider=="string"?this._normaliseProvider(e.provider):null,email:typeof e.email=="string"?e.email:null,createdAt:e.createdAt??null,updatedAt:e.updatedAt??null};return this.identity=r,this.applyIdentity(r),r}}catch{window?.localStorage&&window.localStorage.removeItem(this.storageKey)}return null}getIdentity(){return this.identity?Object.assign({},this.identity):null}isGoogleAuthEnabled(){return Array.isArray(this.googleClientIds)&&this.googleClientIds.length>0}getGoogleClientId(){return this.googleClientId}initialise(){return this._initialisePromise?this._initialisePromise:(this._initialisePromise=this._loadRemoteConfig().catch(t=>{throw this._initialisePromise=null,t}),this._initialisePromise)}async saveName(t){const e=dS(t);if(!e)throw new Error("Name must be between 2 and 32 characters.");const r=this._normaliseProvider(this.identity?.provider)||null;let n;return this.identity&&this.identity.id?n=await this._request("PUT",`/api/users/${encodeURIComponent(this.identity.id)}`,{name:e},{fallbackMessage:"Unable to save name."}):n=await this._request("POST","/api/users/register",{name:e},{fallbackMessage:"Unable to save name."}),this.identity={id:n.id,name:n.name,provider:this._normaliseProvider(n.provider)||r||"local",email:n.email??this.identity?.email??null,createdAt:n.createdAt??null,updatedAt:n.updatedAt??null},this._persistIdentity(),this.applyIdentity(this.identity),this.notifySocket(),Object.assign({},this.identity)}async authenticateWithGoogle(t){if(!t||typeof t!="string")throw new Error("Missing Google credential.");const e=await this._request("POST","/api/auth/google",{credential:t},{fallbackMessage:"Google sign-in failed."}),r=this._normaliseProvider(e.provider)||"google";return this.identity={id:e.id,name:e.name,provider:r,email:e.email??null,createdAt:e.createdAt??null,updatedAt:e.updatedAt??null},this._persistIdentity(),this.applyIdentity(this.identity),this.notifySocket(),await this.refresh()||Object.assign({},this.identity)}async refresh(){if(!this.identity||!this.identity.id)return null;try{const t=await this._request("GET",`/api/users/${encodeURIComponent(this.identity.id)}`,void 0,{fallbackMessage:"Unable to refresh identity."});return this.identity={id:t.id,name:t.name,provider:this._normaliseProvider(t.provider)??this._normaliseProvider(this.identity.provider)??null,email:t.email??this.identity.email??null,createdAt:t.createdAt??this.identity.createdAt??null,updatedAt:t.updatedAt??Date.now()},this._persistIdentity(),this.applyIdentity(this.identity),Object.assign({},this.identity)}catch{return null}}bindSocket(t){this.socketListener=t,!(!t||typeof t.on!="function")&&(t.on("connected",this.handleSocketConnected),t.on("identity:ack",this.handleIdentityAck))}handleSocketConnected(){this.notifySocket(),this.identity&&this.identity.id&&this.refresh()}handleIdentityAck(t){if(!(!t||t.status!=="ok")&&t.id&&t.name){const e=this._normaliseProvider(this.identity?.provider)??null;this.identity={id:t.id,name:t.name,provider:e,createdAt:this.identity?.createdAt??null,updatedAt:Date.now()},this._persistIdentity(),this.applyIdentity(this.identity)}}notifySocket(t=!1){!this.socketListener||typeof this.socketListener.sendIdentityUpdate!="function"||!t&&(!this.identity||!this.identity.id)||this.socketListener.sendIdentityUpdate(this.identity||null)}applyIdentity(t){this.game&&(t?(this.game.identity={id:t.id,name:t.name,provider:this._normaliseProvider(t.provider)??null,email:t.email??null},this.game.player&&(this.game.player.userId=t.id,this.game.player.callsign=t.name)):(this.game.identity=null,this.game.player&&(this.game.player.userId=null)),this.game.lobby&&typeof this.game.lobby.updateIdentityDisplay=="function"&&this.game.lobby.updateIdentityDisplay(this.game.identity))}clearIdentity(){this.identity=null,this._persistIdentity(),this.applyIdentity(null),this.notifySocket(!0)}async _request(t,e,r,n={}){const s=`${this.apiBase}${e}`,a={method:t,headers:{"Content-Type":"application/json"}};t!=="GET"&&t!=="HEAD"&&r!==void 0&&(a.body=JSON.stringify(r));const l=n&&typeof n.fallbackMessage=="string"?n.fallbackMessage:"Request failed.";let u;try{u=await fetch(s,a)}catch{throw new Error(l)}if(!u.ok){let h=l;try{const f=await u.json();f&&typeof f=="object"&&f.error&&(f.error==="invalid_name"?h="Name must be between 2 and 32 characters.":f.error==="name_taken"?h="That name is already taken.":f.error==="not_found"?h="Registration record not found.":f.error==="invalid_id"?h="Registration identifier was invalid.":f.error==="invalid_credential"?h="Google sign-in could not be verified.":f.error==="audience_mismatch"?h="Google sign-in is not configured for this server.":f.error==="registration_failed"?h="We were unable to save your Google profile.":f.error==="save_failed"?h="Unable to save your identity. Please try again.":f.error==="upstream_unavailable"?h="Google services are currently unavailable. Please try again later.":f.error==="missing_credential"&&(h="Google response was missing required data."))}catch{}throw new Error(h)}return u.status===204?null:await u.json()}async _loadRemoteConfig(){const t=await this._request("GET","/api/identity/config",void 0,{fallbackMessage:"Unable to load identity configuration."});if(!t||typeof t!="object")return null;const e=t.google||{},r=this._normaliseClientIds(Array.isArray(e.clientIds)&&e.clientIds.length?e.clientIds:e.clientId||[]);return this._areClientIdListsEqual(r,this.googleClientIds)||(this.googleClientIds=r,this.googleClientId=this.googleClientIds.length>0?this.googleClientIds[0]:null,this._notifyGoogleConfigChanged()),t}_notifyGoogleConfigChanged(){if(!this.game||!this.game.lobby)return;const t=this.game.lobby;typeof t.configureGoogleIdentity=="function"&&t.configureGoogleIdentity(),typeof t.updateIdentityDisplay=="function"?t.updateIdentityDisplay(this.getIdentity()):typeof t.updateGoogleDisplay=="function"&&t.updateGoogleDisplay(this.getIdentity())}_persistIdentity(){if(typeof window>"u"||!window.localStorage)return;if(!this.identity){window.localStorage.removeItem(this.storageKey);return}const t={id:this.identity.id,name:this.identity.name,provider:this._normaliseProvider(this.identity.provider)??null,email:this.identity.email??null,createdAt:this.identity.createdAt??Date.now(),updatedAt:this.identity.updatedAt??Date.now()};window.localStorage.setItem(this.storageKey,JSON.stringify(t))}_normaliseClientIds(t){return t?Array.isArray(t)?t.map(e=>typeof e=="string"?e.trim():"").filter(e=>e.length>0):typeof t=="string"?t.split(/[;,]/).map(e=>e.trim()).filter(e=>e.length>0):[]:[]}_areClientIdListsEqual(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r+=1)if(t[r]!==e[r])return!1;return!0}}const rp=[new URL("/music/bc1.ogg",import.meta.url).href,new URL("/music/bc2.ogg",import.meta.url).href,new URL("/music/bc3.ogg",import.meta.url).href,new URL("/music/bc5.ogg",import.meta.url).href,new URL("/music/bc6.ogg",import.meta.url).href,new URL("/music/bc8.ogg",import.meta.url).href,new URL("/music/bc9.ogg",import.meta.url).href],yS=i=>!Number.isFinite(i)||i<=0?0:Math.floor(Math.random()*i);class mS{constructor(t){this.audioManager=t,this.mediaElement=null,this.mediaSourceNode=null,this.gainNode=null,this.trackList=null,this.currentIndex=0,this.isPlayingLobby=!1,this.onTrackEnded=()=>this.handleTrackEnded()}resolveTrackList(){if(this.trackList)return this.trackList;if(typeof window>"u")return this.trackList=[],this.trackList;const t=Array.isArray(rp)?rp.filter(Boolean):[];return t.length||console.warn("No lobby music tracks configured; music manager idle."),this.trackList=t,this.trackList}ensureMediaElement(){if(this.mediaElement||typeof window>"u")return;const t=new Audio;t.preload="auto",t.loop=!1,t.crossOrigin="anonymous",t.addEventListener("ended",this.onTrackEnded),this.mediaElement=t;const e=this.audioManager?.getContext?.();if(e)try{this.mediaSourceNode=e.createMediaElementSource(t),this.gainNode=e.createGain(),this.gainNode.gain.value=.45,this.mediaSourceNode.connect(this.gainNode),this.gainNode.connect(e.destination)}catch(r){console.debug("Failed to connect lobby music to AudioContext",r),this.gainNode=null,this.mediaSourceNode=null,this.mediaElement.volume=.45}else this.mediaElement.volume=.45}async playLobby(){const t=this.resolveTrackList();t.length&&(this.ensureMediaElement(),this.mediaElement&&(this.isPlayingLobby||(this.currentIndex=yS(t.length)),this.isPlayingLobby=!0,await this.startCurrentTrack()))}async startCurrentTrack(){const t=this.resolveTrackList();if(!this.mediaElement||!t.length)return;const e=(this.currentIndex%t.length+t.length)%t.length,r=t[e];if(r){if(this.audioManager&&typeof this.audioManager.resumeContext=="function")try{await this.audioManager.resumeContext()}catch(n){console.debug("Unable to resume AudioContext for lobby music",n)}this.mediaElement.src!==r&&(this.mediaElement.src=r);try{await this.mediaElement.play()}catch(n){console.debug("Lobby music playback blocked",n)}}}handleTrackEnded(){if(!this.isPlayingLobby)return;const t=this.resolveTrackList();t.length&&(this.currentIndex=(this.currentIndex+1)%t.length,this.startCurrentTrack())}stop(){if(this.isPlayingLobby=!1,this.mediaElement){this.mediaElement.pause();try{this.mediaElement.currentTime=0}catch{}}}}class vS{constructor(t={}){this.onStart=typeof t.onStart=="function"?t.onStart:null,this.heading=t.heading||"Battle City Remastered",this.blurb=t.blurb||"Roll into the war for control of the city. Team up, build, and rain steel.",this.buttonLabel=t.buttonLabel||"Play Now",this.root=null,this.button=null,this.ensureStyles(),this.createOverlay()}ensureStyles(){if(document.getElementById("intro-modal-styles"))return;const t=document.createElement("style");t.id="intro-modal-styles",t.textContent=`
            .intro-modal-overlay {
                position: fixed;
                inset: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                background: radial-gradient(circle at top, rgba(12, 18, 36, 0.92), rgba(4, 6, 10, 0.94));
                z-index: 10000;
                pointer-events: auto;
            }
            .intro-modal-panel {
                max-width: 520px;
                width: calc(100vw - 64px);
                background: rgba(18, 22, 34, 0.9);
                border: 1px solid rgba(75, 95, 140, 0.6);
                border-radius: 16px;
                padding: 48px 40px;
                color: #f5f8ff;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                text-align: center;
                box-shadow: 0 32px 56px rgba(0, 0, 0, 0.55);
                display: grid;
                gap: 28px;
            }
            .intro-modal-heading {
                font-size: clamp(28px, 5vw, 40px);
                font-weight: 700;
                margin: 0;
                letter-spacing: 0.6px;
                text-transform: uppercase;
            }
            .intro-modal-copy {
                margin: 0;
                font-size: 16px;
                line-height: 1.6;
                color: rgba(218, 227, 255, 0.85);
            }
            .intro-modal-hint {
                margin: 0;
                font-size: 13px;
                line-height: 1.5;
                color: rgba(255, 218, 93, 0.9);
                font-weight: 500;
                letter-spacing: 0.3px;
            }
            .intro-modal-button {
                align-self: center;
                border: none;
                border-radius: 999px;
                padding: 16px 44px;
                font-size: 18px;
                font-weight: 600;
                letter-spacing: 0.8px;
                text-transform: uppercase;
                color: #0b1022;
                background: linear-gradient(135deg, #ffda5d, #ff8a3d);
                cursor: pointer;
                transition: transform 0.18s ease, box-shadow 0.18s ease;
                box-shadow: 0 12px 24px rgba(255, 136, 61, 0.35);
            }
            .intro-modal-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 16px 28px rgba(255, 136, 61, 0.45);
            }
            .intro-modal-button:active {
                transform: translateY(1px);
                box-shadow: 0 10px 18px rgba(255, 136, 61, 0.4);
            }
        `,document.head.appendChild(t)}createOverlay(){const t=document.createElement("div");t.className="intro-modal-overlay";const e=document.createElement("div");e.className="intro-modal-panel";const r=document.createElement("h1");r.className="intro-modal-heading",r.textContent=this.heading;const n=document.createElement("p");n.className="intro-modal-copy",n.textContent=this.blurb;const s=document.createElement("p");s.className="intro-modal-hint",s.textContent="Press F to play in fullscreen!";const o=document.createElement("button");o.className="intro-modal-button",o.type="button",o.textContent=this.buttonLabel,o.addEventListener("click",()=>this.handleStart(),{once:!0}),e.appendChild(r),e.appendChild(n),e.appendChild(s),e.appendChild(o),t.appendChild(e),document.body.appendChild(t),this.root=t,this.button=o}async handleStart(){this.button&&(this.button.disabled=!0);try{this.onStart&&await this.onStart()}catch(t){console.warn("[intro] Failed to handle start action",t?.message||t)}finally{this.destroy()}}destroy(){this.root&&this.root.parentNode&&this.root.parentNode.removeChild(this.root),this.root=null,this.button=null}}class gS{constructor(t,e={}){this.game=t,this.onClose=typeof e.onClose=="function"?e.onClose:null,this.overlay=null,this.panel=null,this.ensureStyles(),this.createOverlay()}ensureStyles(){if(typeof document>"u"||document.getElementById("battlecity-help-styles"))return;const t=document.createElement("style");t.id="battlecity-help-styles",t.textContent=`
            .battlecity-help-overlay {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.7);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 15000;
                padding: 20px;
                pointer-events: auto;
            }
            .battlecity-help-panel {
                width: min(520px, 100%);
                max-height: calc(100vh - 40px);
                overflow-y: auto;
                background: rgba(10, 12, 20, 0.95);
                border: 1px solid rgba(145, 196, 255, 0.4);
                box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
                border-radius: 18px;
                padding: 28px 32px;
                color: #f5f7ff;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                display: flex;
                flex-direction: column;
                gap: 18px;
                position: relative;
            }
            .battlecity-help-close {
                position: absolute;
                top: 12px;
                right: 12px;
                border: none;
                background: rgba(255, 255, 255, 0.05);
                color: #f5f7ff;
                font-size: 14px;
                padding: 6px 12px;
                border-radius: 999px;
                cursor: pointer;
                transition: background 0.2s ease;
            }
            .battlecity-help-close:hover {
                background: rgba(255, 255, 255, 0.15);
            }
            .battlecity-help-heading {
                font-size: 22px;
                font-weight: 600;
                margin: 0;
                letter-spacing: 0.3px;
                text-transform: uppercase;
            }
            .battlecity-help-list {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            .battlecity-help-section {
                display: flex;
                flex-direction: column;
                gap: 6px;
            }
            .battlecity-help-section h3 {
                margin: 0;
                font-size: 16px;
                font-weight: 600;
                letter-spacing: 0.2px;
            }
            .battlecity-help-section p {
                margin: 0;
                font-size: 14px;
                line-height: 1.5;
                color: rgba(229, 234, 255, 0.93);
            }
            .battlecity-help-key-row {
                display: flex;
                gap: 8px;
                align-items: baseline;
            }
            .battlecity-help-key {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                min-width: 70px;
                padding: 4px 10px;
                border-radius: 6px;
                font-size: 12px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                border: 1px solid rgba(255, 255, 255, 0.5);
            }
            .battlecity-help-key-desc {
                flex: 1;
                font-size: 13px;
                color: rgba(230, 234, 255, 0.9);
            }
            .battlecity-help-section-footer {
                font-size: 12px;
                color: rgba(255, 255, 255, 0.6);
            }
        `,document.head.appendChild(t)}createOverlay(){if(typeof document>"u")return;const t=document.createElement("div");t.className="battlecity-help-overlay",t.addEventListener("click",s=>{s.target===t&&this.close()});const e=document.createElement("div");e.className="battlecity-help-panel";const r=document.createElement("h1");r.className="battlecity-help-heading",r.textContent="Help & Controls";const n=document.createElement("button");n.className="battlecity-help-close",n.type="button",n.textContent="Close",n.addEventListener("click",()=>this.close()),e.appendChild(n),e.appendChild(r),e.appendChild(this.createMovementSection()),e.appendChild(this.createShortcutSection()),e.appendChild(this.createBuildingSection()),e.appendChild(this.createScoringSection()),t.appendChild(e),document.body.appendChild(t),this.overlay=t,this.panel=e}createMovementSection(){const t=document.createElement("div");t.className="battlecity-help-section";const e=document.createElement("h3");e.textContent="Movement",t.appendChild(e);const r=document.createElement("p");r.textContent="Use the arrow keys for every movement input: Up/Down for forward and reverse, Left/Right to spin the turret. WASD support is still under development, so stick with the arrows.",t.appendChild(r);const n=document.createElement("p");return n.textContent="Keep moving to stay ahead of rogues, and remember that immobilizing hazards (freeze/time) will lock you until the effect expires.",t.appendChild(n),t}createShortcutSection(){const t=document.createElement("div");t.className="battlecity-help-section";const e=document.createElement("h3");e.textContent="Keyboard shortcuts",t.appendChild(e);const r=document.createElement("div");r.className="battlecity-help-list",[{key:"Shift",desc:"Fire equipped weapon (laser or Cougar rockets; rockets need you to be stationary)."},{key:"Ctrl",desc:"Fire the Flare Gun spread behind you when you own an Orb icon."},{key:"D",desc:"Drop the currently selected icon/item at your marker; press again to adjust the placement."},{key:"B",desc:"Arm/disarm your bombs whenever the selected icon is a bomb stack."},{key:"H",desc:"Use a MedKit to instantly restore your health when you have one in inventory."},{key:"C",desc:"Activate a 5-second cloak as long as you own the Cloak icon."},{key:"F",desc:"Toggle fullscreen on supported browsers."}].forEach(o=>{const a=document.createElement("div");a.className="battlecity-help-key-row";const l=document.createElement("span");l.className="battlecity-help-key",l.textContent=o.key;const u=document.createElement("span");u.className="battlecity-help-key-desc",u.textContent=o.desc,a.appendChild(l),a.appendChild(u),r.appendChild(a)}),t.appendChild(r);const s=document.createElement("div");return s.className="battlecity-help-section-footer",s.textContent="Weapon availability depends on your inventory; pick up icons to unlock more gear.",t.appendChild(s),t}createBuildingSection(){const t=document.createElement("div");t.className="battlecity-help-section";const e=document.createElement("h3");e.textContent="Building overview",t.appendChild(e);const r=document.createElement("p");this.game?.player?.isMayor?r.textContent="Open the Build button on the panel to reveal the available blueprints. Click a blueprint to preview the ghost building and then click the map to place ityour city must have enough resources and population slots. Use the Demolish button to remove unwanted buildings and recover the tile.":r.textContent="Only mayors can access the build menu. Ask your mayor to open the Build button, select a blueprint, and click the map to place structures, or to demolish old ones if needed.",t.appendChild(r);const n=document.createElement("p");return n.textContent="Cities can only build when their finance ticks cover the blueprint cost, so keep your income healthy before expanding.",t.appendChild(n),t}createScoringSection(){const t=document.createElement("div");t.className="battlecity-help-section";const e=document.createElement("h3");e.textContent="Scoring & progress",t.appendChild(e);const r=document.createElement("p");r.textContent="Each city tracks a score and orb count that appear in the finance panel, lobby, and right-click inspector. Destroying a rival city with an orb resets their economy, awards your city points based on their growth, and raises the orb bounty you see on other cities.",t.appendChild(r);const n=document.createElement("p");return n.className="battlecity-help-section-footer",n.textContent="Stay alive, protect your buildings, and time your orb drops to maximize your bounty.",t.appendChild(n),t}close(){if(this.overlay&&this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=null,this.panel=null,typeof this.onClose=="function")try{this.onClose()}catch(t){console.warn("[help] onClose error",t?.message||t)}}}const bS=2,_S=4,kv="#4da3ff",xS="rgba(4, 12, 24, 0.85)",Uv="#fdfefe",wS="rgba(255, 255, 255, 0.9)",fu=48,ip=fu/2,Xv=[{id:"ground",label:"Grassland & Plains",color:"#27421f"},{id:"rock",label:"Mountain Ridge",color:"#8d99a6"},{id:"lava",label:"Lava Field",color:"#d35400"},{id:"building",label:"Constructed Buildings",color:"#f6d743"}],Hv=[{id:"research",label:"Research Centers",color:"#f7b538",marker:"structure",defaultFootprint:3},{id:"factory",label:"Factories",color:"#ff6b6b",marker:"structure",defaultFootprint:3},{id:"hospital",label:"Hospitals",color:"#9b6ef3",marker:"structure",defaultFootprint:3},{id:"housing",label:"Housing",color:"#6fcf97",marker:"structure",defaultFootprint:1},{id:"support",label:"Support & Other",color:"#5ad1ff",marker:"structure",defaultFootprint:3},{id:"command",label:"City Command Center",color:kv,marker:"structure",defaultFootprint:3}],TS=[...Xv,{id:"player",label:"Current Position",color:Uv,marker:"player"}],IS=i=>{const t=Number(i);return!Number.isFinite(t)||t<1?bS:Math.min(_S,Math.max(1,Math.round(t)))},ES=(i,t=255)=>{if(typeof i!="string")return[0,0,0,t];let e=i.trim();if(e.startsWith("#")&&(e=e.slice(1)),e.length===3&&(e=e.split("").map(a=>`${a}${a}`).join("")),e.length!==6)return[0,0,0,t];const r=parseInt(e,16),n=r>>16&255,s=r>>8&255,o=r&255;return[n,s,o,t]},ys=Xv.reduce((i,t)=>(i[t.id]=ES(t.color),i),{}),rl=Hv.reduce((i,t)=>(i[t.id]=t,i),{}),np=Hv.reduce((i,t,e)=>(i[t.id]=e,i),{}),sp=Qs.reduce((i,t)=>{const e=Number(t.type);return Number.isFinite(e)&&t.label&&(i[e]=t.label),i},{}),SS="rgba(4, 12, 24, 0.82)";class CS{constructor(t,e={}){this.game=t,this.scale=IS(e.scale),this.onClose=typeof e.onClose=="function"?e.onClose:null,this.overlay=null,this.panel=null,this.canvas=null,this.legendContainer=null,this.playerIndicator=null,this.playerIndicator=null,this.handleKeyDown=this.handleKeyDown.bind(this),this.palette={ground:ys.ground,rock:ys.rock,lava:ys.lava,building:ys.building},this.ensureStyles(),this.buildOverlay(),this.open()}ensureStyles(){if(typeof document>"u"||document.getElementById("battlecity-map-styles"))return;const t=document.createElement("style");t.id="battlecity-map-styles",t.textContent=`
            .battlecity-map-overlay {
                position: fixed;
                inset: 0;
                background: rgba(2, 6, 12, 0.82);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 18000;
                padding: 24px;
                pointer-events: auto;
            }
            .battlecity-map-panel {
                width: min(96vw, 1040px);
                max-height: min(96vh, 1080px);
                overflow: hidden;
                background: rgba(8, 10, 18, 0.96);
                border: 1px solid rgba(145, 196, 255, 0.35);
                box-shadow: 0 28px 56px rgba(0, 0, 0, 0.6);
                border-radius: 20px;
                padding: 20px 24px 24px;
                color: #f1f5ff;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                display: flex;
                flex-direction: column;
                gap: 18px;
                position: relative;
                align-items: stretch;
            }
            .battlecity-map-close {
                position: absolute;
                top: 14px;
                right: 14px;
                border: none;
                background: rgba(255, 255, 255, 0.08);
                color: #f1f5ff;
                font-size: 14px;
                padding: 6px 14px;
                border-radius: 999px;
                cursor: pointer;
                transition: background 0.2s ease;
                z-index: 20;
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
            }
            .battlecity-map-close:hover {
                background: rgba(255, 255, 255, 0.18);
            }
            .battlecity-map-content {
                width: 100%;
                display: flex;
                flex: 1;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 18px;
            }
            .battlecity-map-canvas-wrapper {
                width: 100%;
                max-width: min(92vw, 980px);
                display: flex;
                flex-direction: column;
                gap: 14px;
                align-items: center;
                position: relative;
                justify-content: center;
            }
            .battlecity-map-canvas {
                width: min(100%, 980px);
                max-height: calc(90vh - 160px);
                height: auto;
                border-radius: 14px;
                border: 1px solid rgba(255, 255, 255, 0.16);
                background: rgba(15, 19, 30, 0.85);
                image-rendering: pixelated;
                box-shadow: 0 14px 32px rgba(0, 0, 0, 0.45);
                display: block;
            }
            .battlecity-map-player-indicator {
                position: absolute;
                width: 24px;
                height: 24px;
                clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
                background: linear-gradient(145deg, #ffffff 0%, #f6f9ff 50%, #cfe0ff 100%);
                border: 1px solid rgba(255, 255, 255, 0.95);
                box-shadow:
                    0 0 12px rgba(255, 255, 255, 0.7),
                    0 0 24px rgba(64, 164, 255, 0.65),
                    0 0 40px rgba(64, 164, 255, 0.35);
                animation: battlecity-player-pulse 1200ms ease-in-out infinite;
                z-index: 20;
                pointer-events: none;
                transform-origin: center;
                will-change: transform, opacity, box-shadow;
                mix-blend-mode: screen;
                display: none;
            }
            .battlecity-map-legend {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 10px;
                padding: 10px 14px;
                background: rgba(8, 11, 20, 0.92);
                border-radius: 14px;
                border: 1px solid rgba(145, 196, 255, 0.18);
                box-shadow: 0 12px 28px rgba(0, 0, 0, 0.32);
                width: min(92vw, 980px);
                margin: 0 auto;
                align-self: center;
            }
            .battlecity-map-legend-entry {
                display: flex;
                align-items: center;
                gap: 8px;
                background: rgba(8, 11, 20, 0.88);
                border-radius: 8px;
                padding: 6px 10px;
                border: 1px solid rgba(145, 196, 255, 0.16);
                font-size: 12px;
            }
            .battlecity-map-legend-swatch {
                width: 14px;
                height: 14px;
                border-radius: 4px;
                border: 1px solid rgba(255, 255, 255, 0.35);
                box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.4) inset;
                transition: box-shadow 0.2s ease, transform 0.2s ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
            .battlecity-map-legend-entry[data-marker='player'] .battlecity-map-legend-swatch {
                width: 18px;
                height: 18px;
                border-radius: 0;
                border: none;
                clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
                box-shadow:
                    0 0 0 1px rgba(255, 255, 255, 0.55),
                    0 0 14px rgba(245, 247, 255, 0.65);
                transform: translateY(1px);
            }
            .battlecity-map-legend-label {
                font-size: 12px;
                letter-spacing: 0.2px;
                color: rgba(226, 233, 255, 0.88);
            }
            @keyframes battlecity-player-pulse {
                0% {
                    transform: scale(0.9);
                    opacity: 0.35;
                    box-shadow:
                        0 0 8px rgba(255, 255, 255, 0.35),
                        0 0 18px rgba(64, 164, 255, 0.25),
                        0 0 22px rgba(64, 164, 255, 0.15);
                }
                50% {
                    transform: scale(1.35);
                    opacity: 1;
                    box-shadow:
                        0 0 14px rgba(255, 255, 255, 0.85),
                        0 0 34px rgba(64, 164, 255, 0.7),
                        0 0 46px rgba(64, 164, 255, 0.45);
                }
                100% {
                    transform: scale(0.9);
                    opacity: 0.35;
                    box-shadow:
                        0 0 8px rgba(255, 255, 255, 0.35),
                        0 0 18px rgba(64, 164, 255, 0.25),
                        0 0 22px rgba(64, 164, 255, 0.15);
                }
            }
        `,document.head.appendChild(t)}buildOverlay(){if(typeof document>"u")return;const t=document.createElement("div");t.className="battlecity-map-overlay",t.addEventListener("click",u=>{u.target===t&&this.close()});const e=document.createElement("div");e.className="battlecity-map-panel";const r=document.createElement("button");r.type="button",r.className="battlecity-map-close",r.textContent="Close",r.addEventListener("click",()=>this.close());const n=document.createElement("div");n.className="battlecity-map-canvas-wrapper";const s=document.createElement("canvas");s.className="battlecity-map-canvas";const o=document.createElement("div");o.className="battlecity-map-legend";const a=document.createElement("div");a.className="battlecity-map-player-indicator",n.appendChild(s),n.appendChild(a);const l=document.createElement("div");l.className="battlecity-map-content",l.appendChild(n),l.appendChild(o),e.appendChild(r),e.appendChild(l),t.appendChild(e),this.overlay=t,this.panel=e,this.canvas=s,this.legendContainer=o,this.playerIndicator=a}open(){typeof document>"u"||this.overlay&&(this.overlay.isConnected||document.body.appendChild(this.overlay),this.render(),document.addEventListener("keydown",this.handleKeyDown),this.isOpen=!0)}close(){if(!this.overlay){typeof this.onClose=="function"&&this.onClose();return}document.removeEventListener("keydown",this.handleKeyDown),this.overlay.parentNode&&this.overlay.parentNode.removeChild(this.overlay),this.overlay=null,this.panel=null,this.canvas=null,this.legendContainer=null,this.isOpen=!1,typeof this.onClose=="function"&&this.onClose()}handleKeyDown(t){t&&(t.key==="Escape"||t.key==="Esc")&&(t.preventDefault(),this.close())}render(){this.renderLegend();const t=this.collectCities(),e=this.collectStructures(),r=this.getPlayerCenter();this.renderMap(t,e,r)}renderLegend(){this.legendContainer&&(this.legendContainer.replaceChildren(),TS.forEach(t=>{const e=document.createElement("div");e.className="battlecity-map-legend-entry",t.marker&&(e.dataset.marker=t.marker);const r=document.createElement("span");r.className="battlecity-map-legend-swatch",r.style.background=t.color;const n=document.createElement("span");n.className="battlecity-map-legend-label",n.textContent=t.label,e.appendChild(r),e.appendChild(n),this.legendContainer.appendChild(e)}))}collectStructures(){const t=[],r=this.game?.buildingFactory?.buildingsById;if(!r||typeof r!="object")return t;const n=o=>{if(Number.isFinite(o))return Math.floor(o);const a=Number(o);return Number.isFinite(a)?Math.floor(a):null},s=(o,a)=>{const l=typeof o.cityName=="string"&&o.cityName.length>0,u=typeof a.cityName=="string"&&a.cityName.length>0;if(l&&u){const h=o.cityName.localeCompare(a.cityName);if(h!==0)return h}else{if(l)return-1;if(u)return 1}const c=(o.label||"").localeCompare(a.label||"");return c!==0?c:o.tileY!==a.tileY?o.tileY-a.tileY:o.tileX-a.tileX};return Object.values(r).forEach(o=>{if(!o||typeof o!="object")return;const a=Number(o.type);if(!Number.isFinite(a))return;const l=this.determineStructureCategory(a);if(l==="command"||!rl[l])return;const u=n(o.x),c=n(o.y);if(u===null||c===null)return;const h=this.resolveStructureFootprint(o,l),f=u+h.width/2,d=c+h.height/2,p=o.city??o.cityId??null,v=Number(p),y=Number.isFinite(v)?v:null;let g=null;if(y!==null){const T=Array.isArray(this.game?.cities)?this.game.cities[y]:null;g=this.resolveCityName(T,y)}const E={id:o.id??`${u}_${c}_${a}`,type:a,category:l,label:this.resolveStructureLabel(a,l),tileX:u,tileY:c,centerTileX:f,centerTileY:d,cityId:y,cityName:g,widthTiles:h.width,heightTiles:h.height};t.push(E)}),t.sort((o,a)=>{const l=np[o.category]??Number.MAX_SAFE_INTEGER,u=np[a.category]??Number.MAX_SAFE_INTEGER;return l!==u?l-u:s(o,a)}),t}resolveStructureFootprint(t,e){if(t&&typeof t=="object"){const s=Number(t.width),o=Number(t.height);if(Number.isFinite(s)&&Number.isFinite(o))return{width:Math.max(1,Math.round(s)),height:Math.max(1,Math.round(o))}}const r=rl[e],n=Number.isFinite(r?.defaultFootprint)?Math.max(1,Math.round(r.defaultFootprint)):1;return{width:n,height:n}}resolveStructureLabel(t,e){if(Number.isFinite(t)&&sp[t])return sp[t];const r=rl[e];return r?`${r.label} (${t})`:`Structure ${t}`}determineStructureCategory(t){return Number.isFinite(t)?t===Ot?"command":t>=400&&t<500?"research":t>=100&&t<200?"factory":t>=300&&t<400?"housing":t>=200&&t<300?"hospital":"support":"support"}renderMap(t,e,r){if(!this.canvas)return;const n=Array.isArray(this.game?.map)?this.game.map:null,s=Array.isArray(n)?n.length:0,o=s>0&&Array.isArray(n[0])?n[0].length:0,a=this.canvas.getContext("2d");if(!a)return;const l=this.scale;if(!s||!o){a.clearRect(0,0,this.canvas.width,this.canvas.height),this.updatePlayerIndicator(null,l);return}const u=s*l,c=o*l;(this.canvas.width!==u||this.canvas.height!==c)&&(this.canvas.width=u,this.canvas.height=c);const h=a.createImageData(u,c),f=h.data;for(let d=0;d<o;d++)for(let p=0;p<s;p++){const v=n[p]?.[d]??0,y=this.getColorForTile(v),g=y[0],E=y[1],T=y[2],R=y[3];for(let _=0;_<l;_++){const P=(d*l+_)*u;for(let H=0;H<l;H++){const M=p*l+H,N=(P+M)*4;f[N]=g,f[N+1]=E,f[N+2]=T,f[N+3]=R}}}a.putImageData(h,0,0),a.imageSmoothingEnabled=!1,this.drawStructureMarkers(a,e,l),this.drawCityMarkers(a,t,l),this.drawPlayerMarker(a,r,l),this.updatePlayerIndicator(r,l)}drawStructureMarkers(t,e,r){if(!Array.isArray(e)||e.length===0)return;const n=Math.max(3,Math.round(r*1.6));e.forEach(s=>{const o="#f6d743",a=SS,l=Number.isFinite(s.centerTileX)?s.centerTileX:(s.tileX??0)+.5,u=Number.isFinite(s.centerTileY)?s.centerTileY:(s.tileY??0)+.5,c=l*r,h=u*r;!Number.isFinite(c)||!Number.isFinite(h)||(t.save(),t.translate(c,h),t.rotate(Math.PI/4),t.fillStyle=o,t.strokeStyle=a,t.lineWidth=Math.max(1,Math.round(r/2)),t.fillRect(-n,-n,n*2,n*2),t.strokeRect(-n,-n,n*2,n*2),t.restore())})}drawCityMarkers(t,e,r){if(!Array.isArray(e)||!e.length)return;const n=Math.max(4,Math.round(r*2.5)),s=Math.max(12,Math.round(r*4.5));e.forEach(o=>{const a=((o.tileX??0)+.5)*r,l=((o.tileY??0)+.5)*r;if(t.beginPath(),t.fillStyle=kv,t.strokeStyle=xS,t.lineWidth=Math.max(1,Math.round(r/1.5)),t.arc(a,l,n,0,Math.PI*2),t.fill(),t.stroke(),!o.name)return;const u=l+n+Math.max(4,Math.round(r));t.font=`600 ${s}px "Segoe UI", sans-serif`,t.textAlign="center",t.textBaseline="top";const c=t.measureText(o.name),h=c.width,f=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent,d=Math.max(4,Math.round(r*1.5)),p=Math.max(2,Math.round(r));t.fillStyle="rgba(6, 10, 18, 0.82)",t.fillRect(a-h/2-d,u-p,h+d*2,f+p*2),t.fillStyle="#f6f9ff",t.fillText(o.name,a,u)})}drawPlayerMarker(t,e,r){if(!e||!this.canvas)return;const n=Number(e.centerTileX),s=Number(e.centerTileY);if(!Number.isFinite(n)||!Number.isFinite(s))return;const o=n*r,a=s*r;if(!Number.isFinite(o)||!Number.isFinite(a))return;const l=this.canvas.width,u=this.canvas.height;if(o<0||a<0||o>l||a>u)return;const c=Math.max(5,Math.round(r*2.8)),h=Math.max(c*1.8,c+6),f=(p,v)=>{p.beginPath(),p.moveTo(0,-v),p.lineTo(v*.85,v*.9),p.lineTo(0,v*.55),p.lineTo(-v*.85,v*.9),p.closePath()};t.save(),t.translate(o,a);const d=t.createRadialGradient(0,0,c*.6,0,0,h*1.4);d.addColorStop(0,"rgba(255, 255, 255, 0.75)"),d.addColorStop(1,"rgba(255, 255, 255, 0)"),t.fillStyle=d,t.beginPath(),t.arc(0,0,h*1.3,0,Math.PI*2),t.fill(),t.restore(),t.save(),t.translate(o,a),t.shadowColor="rgba(255, 255, 255, 0.6)",t.shadowBlur=h,f(t,h),t.fillStyle="rgba(255, 255, 255, 0.35)",t.fill(),t.restore(),t.save(),t.translate(o,a),f(t,c),t.fillStyle=Uv,t.strokeStyle=wS,t.lineWidth=Math.max(2,Math.round(r/1.2)),t.fill(),t.stroke(),t.restore()}updatePlayerIndicator(t,e){const r=this.playerIndicator;if(!r||!this.canvas)return;if(!t){r.style.display="none";return}const n=Number(t.centerTileX),s=Number(t.centerTileY);if(!Number.isFinite(n)||!Number.isFinite(s)){r.style.display="none";return}const o=n*e,a=s*e;if(!Number.isFinite(o)||!Number.isFinite(a)){r.style.display="none";return}const l=this.canvas.width,u=this.canvas.height;if(o<0||a<0||o>l||a>u){r.style.display="none";return}const c=Math.max(18,Math.round(e*2.4));r.style.width=`${c}px`,r.style.height=`${c}px`,r.style.left=`${o-c/2}px`,r.style.top=`${a-c/2}px`,r.style.display="block"}getPlayerCenter(){const t=this.game?.player?.offset;if(!t||typeof t!="object")return null;const e=Number(t.x),r=Number(t.y);if(!Number.isFinite(e)||!Number.isFinite(r))return null;const n=(e+ip)/fu,s=(r+ip)/fu;if(!Number.isFinite(n)||!Number.isFinite(s))return null;const o=Math.max(0,Math.floor(n)),a=Math.max(0,Math.floor(s));return{centerTileX:n,centerTileY:s,tileX:o,tileY:a}}collectCities(){const t=[];return(Array.isArray(this.game?.cities)?this.game.cities:[]).forEach((r,n)=>{if(!r||typeof r!="object")return;const s=Number.isFinite(r.tileX)?r.tileX:Number.isFinite(r.x)?Math.round(r.x/48):n,o=Number.isFinite(r.tileY)?r.tileY:Number.isFinite(r.y)?Math.round(r.y/48):n,a=this.resolveCityName(r,n);t.push({id:Number.isFinite(r.id)?r.id:n,name:a,tileX:s,tileY:o})}),t.sort((r,n)=>!r.name&&!n.name?r.id-n.id:r.name?n.name?r.name.localeCompare(n.name):-1:1),t}resolveCityName(t,e){if(!t||typeof t!="object")return Ae(e);if(typeof t.nameOverride=="string"&&t.nameOverride.trim().length)return t.nameOverride.trim();if(typeof t.name=="string"&&t.name.trim().length)return t.name.trim();const r=Number.isFinite(t.id)?t.id:e;return Ae(r)}getColorForTile(t){return t===Yu?this.palette.lava:t===Ws?this.palette.rock:t>=ki?this.palette.building:this.palette.ground}isOpen(){return!!this.overlay}}const ve=i=>`/${i}`,Us=J.LoaderResource||J.loaders&&J.loaders.Resource,ms=Us?Us.LOAD_TYPE:{},op=Us?Us.XHR_RESPONSE_TYPE:{},AS={r:255,g:0,b:255},yi=48,yr={heading:"Intel",lines:["Right-click a city building to inspect."]},PS=(i,t=AS)=>{if(!i||!i.data||!i.texture)return;const e=i.data,r=e.width,n=e.height,s=document.createElement("canvas");s.width=r,s.height=n;const o=s.getContext("2d");if(!o)return;o.drawImage(e,0,0);const a=o.getImageData(0,0,r,n),l=a.data;for(let c=0;c<l.length;c+=4)l[c]===t.r&&l[c+1]===t.g&&l[c+2]===t.b&&(l[c+3]=0);o.putImageData(a,0,0),i.texture&&i.texture.destroy(!0);const u=J.BaseTexture.from(s);u.alphaMode=J.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,u.scaleMode=J.SCALE_MODES.NEAREST,i.data=s,i.texture=new J.Texture(u),i.baseTexture=u},ce=(i,t=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const e=parseInt(i,10);if(!Number.isNaN(e))return e}return t},je=(i,t=null)=>{const e=ce(i,t);return Number.isFinite(e)?Math.max(0,Math.floor(e)):t},Gv=i=>!i||typeof i!="string"?null:i.length<=8?i:`${i.slice(0,4)}...${i.slice(-2)}`;var Qe=new J.Application({width:window.innerWidth,height:window.innerHeight,antialias:!1,useContextAlpha:!1,powerPreference:"high-performance",backgroundAlpha:1});Qe.renderer.plugins.interaction.cursorStyles={demolish:`url(${ve("imgDemolish.png")}), auto`,cursor:`url(${ve("imgCursor.png")}), auto`};document.getElementById("game").appendChild(Qe.view);var Xs=new L_;Xs.showPanel(0);document.getElementById("game").appendChild(Xs.dom);const yc=document.getElementById("game");var oo=new J.Container;oo.interactive=!1;oo.interactiveChildren=!1;var wn=new J.Container;wn.interactive=!1;wn.interactiveChildren=!1;var du=new J.Container,ui=null,ci=null,hi=null,fi=null;const ao=J.Loader.shared,b={map:[],tiles:[],tick:0,lastTick:0,timePassed:0,staticTick:0,textures:[],maxMapX:window.innerWidth-200,maxMapY:window.innerHeight,maxCities:0,otherPlayers:{},audio:null,showBuildMenu:!1,buildMenuOffset:{x:(window.innerWidth-200)/2,y:window.innerHeight/2},buildings:{},cities:[],player:{id:-1,city:0,isMayor:!1,health:Pi,isTurning:0,timeTurn:0,direction:0,defaultOffset:{x:(window.innerWidth-200)/2,y:window.innerHeight/2},offset:{x:0,y:0,vx:0,vy:0},bombsArmed:!1,lastSafeOffset:{x:0,y:0},sequence:0,isCloaked:!1,cloakExpiresAt:0,isFrozen:!1,frozenUntil:0,frozenBy:null,callsign:null,userId:null,engineLoopActive:!1},explosions:[],panelState:{heading:yr.heading,lines:[...yr.lines]},defenseItems:new Map,identity:null,lobby:null,app:Qe,stage:Qe.stage,objectContainer:oo,commandCenterLabelLayer:wn,orbHintElement:null,lastOrbHintMessage:"",nextOrbHintUpdate:0,cameraShake:{remaining:0,duration:0,intensity:0,offsetX:0,offsetY:0},gBotDebug:null};b.audio=new zx;b.audio.bindGestureUnlock();b.audio.preloadAll().catch(i=>{console.warn("Audio assets failed to preload",i)});b.music=new mS(b.audio);const lo=document.createElement("div");lo.id="orb-hint";const Ze=lo.style;Ze.position="fixed";Ze.top="24px";Ze.right="24px";Ze.padding="10px 14px";Ze.borderRadius="12px";Ze.background="rgba(10, 18, 52, 0.82)";Ze.border="1px solid rgba(123, 152, 255, 0.35)";Ze.boxShadow="0 18px 36px rgba(0, 0, 0, 0.45)";Ze.fontFamily='"Segoe UI", Tahoma, Geneva, Verdana, sans-serif';Ze.fontSize="14px";Ze.color="#f0f6ff";Ze.letterSpacing="0.3px";Ze.maxWidth="320px";Ze.zIndex="1000";Ze.pointerEvents="none";Ze.display="none";b.orbHintElement=lo;const yt=document.createElement("button");yt.id="menu-toggle-button";yt.innerHTML="&#9776;";yt.title="Toggle Menu";const Ne=yt.style;Ne.position="fixed";Ne.bottom="24px";Ne.left="24px";Ne.width="48px";Ne.height="48px";Ne.borderRadius="12px";Ne.background="rgba(10, 18, 52, 0.82)";Ne.border="1px solid rgba(123, 152, 255, 0.35)";Ne.boxShadow="0 8px 16px rgba(0, 0, 0, 0.45)";Ne.fontSize="24px";Ne.color="#f0f6ff";Ne.cursor="pointer";Ne.zIndex="1200";Ne.transition="all 0.2s ease";Ne.display="flex";Ne.alignItems="center";Ne.justifyContent="center";Ne.fontFamily="Arial, sans-serif";const Qt=document.createElement("button");Qt.id="fullscreen-button";Qt.textContent="";Qt.title="Toggle Fullscreen (F)";const Ve=Qt.style;Ve.width="48px";Ve.height="48px";Ve.borderRadius="12px";Ve.background="rgba(10, 18, 52, 0.82)";Ve.border="1px solid rgba(123, 152, 255, 0.35)";Ve.boxShadow="0 8px 16px rgba(0, 0, 0, 0.45)";Ve.fontSize="24px";Ve.color="#f0f6ff";Ve.cursor="pointer";Ve.transition="all 0.2s ease";Ve.display="flex";Ve.alignItems="center";Ve.justifyContent="center";Ve.fontFamily="Arial, sans-serif";Qt.addEventListener("mouseenter",()=>{Ve.background="rgba(15, 28, 72, 0.92)",Ve.transform="scale(1.05)"});Qt.addEventListener("mouseleave",()=>{Ve.background="rgba(10, 18, 52, 0.82)",Ve.transform="scale(1)"});Qt.addEventListener("click",()=>{typeof b.toggleFullscreen=="function"&&b.toggleFullscreen()});const Mn=document.createElement("div");Mn.id="game-menu-container";const Pt=Mn.style;Pt.position="fixed";Pt.left="18px";Pt.bottom="84px";Pt.display="none";Pt.flexDirection="column";Pt.gap="12px";Pt.zIndex="1150";Pt.pointerEvents="auto";Mn.appendChild(Qt);b.menuOpen=!1;b.menuToggleButton=yt;b.fullscreenButton=Qt;b.menuContainer=Mn;b.toggleMenu=()=>{b.menuOpen=!b.menuOpen,b.menuOpen?(yt.innerHTML="&#10005;",yt.title="Close Menu",b.chatManager&&typeof b.chatManager.showControls=="function"&&b.chatManager.showControls(),setTimeout(()=>{const i=document.getElementById("battlecity-chat-container");if(i){const t=i.offsetHeight;Pt.bottom=`${84+t+12}px`}Pt.display="flex"},10)):(Pt.display="none",yt.innerHTML="&#9776;",yt.title="Toggle Menu",b.chatManager&&typeof b.chatManager.hideControls=="function"&&b.chatManager.hideControls())};yt.addEventListener("mouseenter",()=>{Ne.background="rgba(15, 28, 72, 0.92)",Ne.transform="scale(1.05)"});yt.addEventListener("mouseleave",()=>{Ne.background="rgba(10, 18, 52, 0.82)",Ne.transform="scale(1)"});yt.addEventListener("click",()=>{b.toggleMenu()});yc.appendChild(lo);yc.appendChild(Mn);yc.appendChild(yt);D_(b);b.lastOrbHintMessage="";b.callsignRegistry=new iS;b.notificationManager=new eS;b.notify=i=>b.notificationManager?b.notificationManager.notify(i):null;b.chatManager=new lS({game:b});b.identityManager=new pS(b);b.identityManager.loadFromStorage();b.resolveCallsign=i=>{if(i==null)return null;const t=`${i}`,e=b.player&&b.player.id!==void 0?`${b.player.id}`:null;if(e&&t===e)return b.player?.callsign||null;const r=b.otherPlayers?b.otherPlayers[t]:null;if(r&&typeof r.callsign=="string"&&r.callsign.trim().length)return r.callsign;if(b.callsignRegistry&&typeof b.callsignRegistry.get=="function"){const n=b.callsignRegistry.get(t);if(n)return n}return null};b.describeKillSource=(i={})=>{if(!i)return"System Hazard";if(i.killerCallsign)return i.killerCallsign;const t=Number.isFinite(i.killerCity)?Math.max(0,Math.floor(i.killerCity)):null,r=(()=>{if(t===null)return null;const o=Array.isArray(b.cities)?b.cities[t]:null;if(o&&typeof o=="object"){if(typeof o.nameOverride=="string"&&o.nameOverride.trim().length)return o.nameOverride.trim();if(typeof o.name=="string"&&o.name.trim().length)return o.name.trim()}return Ae(t)})(),n=i.sourceType?String(i.sourceType).toLowerCase():null;if(n)switch(n){case"turret":return`${r||"City"} Turret`;case"plasma":case"plasma_cannon":return`${r||"City"} Plasma Cannon`;case"sleeper":return`${r||"City"} Sleeper Turret`;case"rogue_tank":return"Rogue Tank";case"fake_recruit":case"city_recruit":return`${r||"City"} Recruit`}const s=i.hazardType?String(i.hazardType).toLowerCase():null;if(s)switch(s){case"mine":return`${r||"City"} Mine`;case"bomb":return`${r||"City"} Bomb`;case"dfg":case"dfg_field":return`${r||"City"} DFG Field`}return"System Hazard"};b.cityFinanceFlags=new Map;b.mapOverlayActive=!1;let Mr=null;const OS=(i,t,e=yi)=>{let r="",n="";return Math.abs(i)>e&&(r=i>0?"east":"west"),Math.abs(t)>e&&(n=t>0?"south":"north"),r&&n?`${n}-${r}`:n||r||"nearby"},FS=i=>!i||typeof i!="string"?"":i.split("-").map(t=>t&&t.charAt(0).toUpperCase()+t.slice(1)).join("-"),MS=i=>{if(!i)return null;const t=Number.isFinite(i.x)?i.x:yi*ce(i.tileX,0),e=Number.isFinite(i.y)?i.y:yi*ce(i.tileY,0);return{x:t+1.5*yi,y:e+1*yi}},RS=(i,t)=>i&&typeof i.name=="string"&&i.name.trim().length?i.name:Ae(t),LS=Object.values(cr||{}).reduce((i,t)=>(!t||t.TYPE===void 0||(i[t.TYPE]=t.LABEL),i),{}),NS=(i,t)=>{const e={totalPopulation:0,totalBuildings:0,staffedBuildings:0,houses:0,labels:new Map};if(!i||!i.buildingFactory||typeof i.buildingFactory.getHead!="function")return e;let r=i.buildingFactory.getHead();for(;r;){if(je(r.city,null)===t){e.totalBuildings+=1;const s=ce(r.population,0),o=Number.isFinite(s)?Math.max(0,s):0;e.totalPopulation+=o,o>0&&(e.staffedBuildings+=1);const a=LS[r.type]||"Structure";e.labels.has(a)||e.labels.set(a,{count:0,population:0});const l=e.labels.get(a);l.count+=1,l.population+=o,a.toLowerCase().includes("house")&&(e.houses+=1)}r=r.next}return e};b.updateOrbHint=(i={})=>{const{force:t=!1}=i,e=b.orbHintElement;if(!e)return;const r=b.lobby;if(!(r&&typeof r.isInGame=="function"?r.isInGame():!1)){e.style.display!=="none"&&(e.style.display="none",b.lastOrbHintMessage="");return}const s=b.player,o=s?.offset,a=ce(o?.x,NaN),l=ce(o?.y,NaN);if(!Number.isFinite(a)||!Number.isFinite(l)){e.style.display!=="none"&&(e.style.display="none",b.lastOrbHintMessage="");return}const u=je(s?.city,null);let c=null;(Array.isArray(b.cities)?b.cities:[]).forEach((d,p)=>{if(!d||p===u||!d.isOrbable)return;const v=MS(d);if(!v)return;const y=v.x-a,g=v.y-l,E=y*y+g*g;Number.isFinite(E)&&(!c||E<c.distanceSq)&&(c={city:d,index:p,dx:y,dy:g,distanceSq:E})});let f;if(!c)f="No orbable cities detected yet.";else{const d=RS(c.city,c.index),p=FS(OS(c.dx,c.dy)),v=Math.sqrt(c.distanceSq),y=Math.round(v/yi),g=y>1?` (~${y} tiles)`:"";f=`Nearest orbable city: ${d}  ${p}${g}`}!t&&f===b.lastOrbHintMessage||(e.textContent=f||"",e.style.display=f?"block":"none",b.lastOrbHintMessage=f||"")};b.updateOrbHint({force:!0});b.clearDefenseItems=i=>{const t=je(i,null);if(t===null)return;const e=b.defenseItems.get(t);Array.isArray(e)&&b.itemFactory&&typeof b.itemFactory.removeItemById=="function"&&e.forEach(r=>{b.itemFactory.removeItemById(r,{notifyServer:!1})}),b.defenseItems.delete(t),b.forceDraw=!0};b.applyDefenseSnapshot=(i,t)=>{const e=je(i,null);if(e===null||!b.itemFactory||typeof b.itemFactory.newItem!="function"||(b.clearDefenseItems(e),!Array.isArray(t)||!t.length))return;const r=[];t.forEach((n,s)=>{const o=ce(n?.type,null),a=ce(n?.x,null),l=ce(n?.y,null);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(l))return;const u=ce(n?.teamId,e),c=typeof n?.id=="string"&&n.id.length>0?n.id:`defense_${e}_${s}`;typeof b.itemFactory.removeItemById=="function"&&b.itemFactory.removeItemById(c,{notifyServer:!1});const f={id:typeof n?.ownerId=="string"&&n.ownerId.length>0?n.ownerId:`fake_city_${e}`,city:e},d=b.itemFactory.newItem(f,a,l,o,{id:c,notifyServer:!1,teamId:u,city:u});if(d){if(d.isDefense=!0,n?.angle!==void 0){const p=ce(n.angle,null);Number.isFinite(p)&&(d.angle=p)}r.push(d.id)}}),r.length&&(b.defenseItems.set(e,r),b.forceDraw=!0)};const Tn=i=>{const t=i&&typeof i.heading=="string"?i.heading:"",e=i&&Array.isArray(i.lines)?i.lines:[],r=[];e.forEach(n=>{if(n==null)return;const s=`${n}`;r.push(s)}),b.panelState={heading:t,lines:r},b.forceDraw=!0},BS=i=>{const t=je(i,null);if(t===null)return null;let e=0,r=null;je(b.player&&b.player.city,null)===t&&(e+=1,b.player&&b.player.isMayor&&(r=b.player.id||r)),Object.keys(b.otherPlayers||{}).forEach(a=>{const l=b.otherPlayers[a];l&&je(l.city,null)===t&&(e+=1,!r&&l.isMayor&&(r=l.id||null))});const s=b.buildingFactory,o=s&&typeof s.countBuildingsForCity=="function"?s.countBuildingsForCity(t):0;return{cityId:t,playerCount:e,buildingCount:o,mayorId:r,mayorLabel:r?Gv(r):null}},DS=(i,t={})=>{const e=je(i,null);if(e===null)return{heading:yr.heading,lines:[...yr.lines]};const r=BS(e)||{playerCount:0,buildingCount:0,mayorId:null,mayorLabel:null},n=b.cities?.[e],s=t.cityName||n?.name||Ae(e),o=t.mayorLabel||r.mayorLabel,a=t.mayorId!==void 0?t.mayorId:r.mayorId,l=o||Gv(a)||"(unknown)",u=Number.isFinite(t.playerCount)?t.playerCount:r.playerCount,c=Number.isFinite(t.buildingCount)?t.buildingCount:r.buildingCount,h=[`Mayor:   ${l}`,`Players: ${u}`,`Size:    ${c} building${c===1?"":"s"}`];if(t.score!==void 0){const f=Number.isFinite(t.score)?t.score:ce(t.score,0);h.push(`Score:   ${f} pts`)}if(t.isOrbable&&t.orbPoints!==void 0){const f=Number.isFinite(t.orbPoints)?t.orbPoints:ce(t.orbPoints,0);h.push(`Bounty:  ${f} points`)}if(t.isOrbable&&t.orbs!==void 0){const f=Number.isFinite(t.orbs)?t.orbs:ce(t.orbs,0);h.push(`Orbs:    ${f}`)}if(t.uptimeInMinutes!==void 0&&t.uptimeInMinutes!==null){const f=Number.isFinite(t.uptimeInMinutes)?t.uptimeInMinutes:ce(t.uptimeInMinutes,0);if(Number.isFinite(f)&&f>0){const d=Math.floor(f/60),p=f%60;h.push(`Uptime:  ${d}h ${p}m`)}}return{heading:s,lines:h}};b.setPanelMessage=i=>{if(!i){Tn(yr);return}Tn(i)};b.clearPanelMessage=()=>{if(Mr){Mr.close();return}b.mapOverlayActive=!1,Tn(yr)};b.showCityInfo=(i,t={})=>{let e=t||{},r=i;i&&typeof i=="object"&&!Array.isArray(i)&&(e=i,i.cityId!==void 0?r=i.cityId:i.city!==void 0&&(r=i.city));const n=je(r,null);if(n===null){Tn(yr);return}const s=DS(n,e||{});Tn(s)};b.showStaffSummary=()=>{const i=je(b.player&&b.player.city,null);if(i===null){b.notify&&b.notify({title:"Staff Overview",message:"Join a city to view staffing information.",variant:"warn"});return}const t=NS(b,i),e=Ae(i),r=[`Population: ${t.totalPopulation}`,`Buildings: ${t.totalBuildings}`,`Staffed:   ${t.staffedBuildings}`];t.houses>0&&r.push(`Housing:  ${t.houses}`);const n=Array.from(t.labels.entries()).filter(([,s])=>s.population>0).sort((s,o)=>o[1].population-s[1].population).slice(0,3);n.length?n.forEach(([s,o])=>{r.push(`${s}: ${o.population}`)}):r.push("Factories need staff before production begins."),b.setPanelMessage({heading:`${e} Staff`,lines:r}),b.notify&&b.notify({title:"Staff Overview",message:`${e}: ${t.totalPopulation} population across ${t.totalBuildings} structures.`,variant:"info",timeout:4600}),b.forceDraw=!0};b.toggleMapOverlay=()=>{if(Mr){Mr.close(),b.forceDraw=!0;return}const i=new CS(b,{onClose:()=>{Mr===i&&(Mr=null),b.mapOverlayActive=!1,b.setPanelMessage(yr),b.forceDraw=!0}});Mr=i,b.mapOverlayActive=!0,b.setPanelMessage({heading:"Strategic Map",lines:["Strategic overlay open.","Press Esc or Close to return to command."]}),b.notify&&b.notify({title:"Strategic Map",message:"Displaying the full theatre. Press Esc or Close when finished.",variant:"info",timeout:4800}),b.forceDraw=!0};b.showPlayerCityInfo=()=>{const i=je(b.player&&b.player.city,null);if(i===null){b.notify&&b.notify({title:"City Intel",message:"Join a city to view local intel.",variant:"warn"});return}b.showCityInfo(i),b.notify&&b.notify({title:"City Intel",message:`Showing intel for ${Ae(i)} in the panel.`,variant:"info",timeout:3600})};b.showPointsSummary=()=>{const i=je(b.player&&b.player.city,null);if(i===null){b.notify&&b.notify({title:"Points Overview",message:"Join a city to review point totals.",variant:"warn"});return}const t=b.cities?.[i]||{},e=ce(t.score,0),r=ce(t.orbs,0),n=ce(t.orbPoints,0),s=[`City score: ${e}`,`Orbs fired: ${r}`,`Orb bounty: ${n}`,"Monthly leaderboards will surface in a future patch."];b.setPanelMessage({heading:`${Ae(i)} Points`,lines:s}),b.notify&&b.notify({title:"Points Overview",message:`${Ae(i)} currently holds ${e} points.`,variant:"info",timeout:4e3}),b.forceDraw=!0};b.openOptionsPanel=()=>{b.setPanelMessage({heading:"Options (Preview)",lines:["In-game configuration UI is still on the roadmap.","Use the lobby overlay to change cities or roles.","See AGENTS.md for developer setup and tweaks."]}),b.notify&&b.notify({title:"Options",message:"Configuration controls are coming soon. The panel lists available workarounds.",variant:"warn"}),b.forceDraw=!0};let il=null;b.showHelpMessage=()=>{il||(il=new gS(b,{onClose:()=>{il=null}}))};b.toggleBuildMenuFromPanel=()=>{if(!b?.player?.isMayor){b.notify?b.notify({title:"Construction Restricted",message:"Only the mayor can access the build menu.",variant:"warn",timeout:3600}):console.warn("Build menu unavailable: only mayors can construct buildings."),b.showBuildMenu=!1,b.forceDraw=!0;return}b.showBuildMenu=!b.showBuildMenu,b.notify&&b.notify({title:"Build Menu",message:b.showBuildMenu?"Select a blueprint to place or choose Demolish.":"Build menu hidden.",variant:"info",timeout:3600}),b.forceDraw=!0};b.requestExitToLobby=()=>{b.lobby&&typeof b.lobby.show=="function"&&(b.lobby.show(),b.lobby.setStatus("Lobby opened. Choose a city slot or wait for the next match.",{type:"info"})),b.notify&&b.notify({title:"Exit to Lobby",message:"The lobby overlay is open. Session hand-off will improve in a future build.",variant:"warn"})};b.clearPanelMessage();b.isFullscreen=!1;b.resizeToFullscreen=()=>{const i=window.innerWidth,t=window.innerHeight;Qe.renderer.resize(i,t),b.maxMapX=i-200,b.maxMapY=t,b.buildMenuOffset.x=(i-200)/2,b.buildMenuOffset.y=t/2,b.player.defaultOffset.x=(i-200)/2,b.player.defaultOffset.y=t/2,b.forceDraw=!0};b.resizeToOriginal=()=>{b.resizeToWindow()};b.toggleFullscreen=()=>{const i=document.getElementById("game");i&&(document.fullscreenElement?document.exitFullscreen().catch(t=>{console.warn("Failed to exit fullscreen:",t?.message||t)}):i.requestFullscreen().catch(t=>{console.warn("Failed to enter fullscreen:",t?.message||t),b.notify&&b.notify({title:"Fullscreen Error",message:"Unable to enter fullscreen mode.",variant:"warn",timeout:3e3})}))};b.resizeToWindow=()=>{if(b.isFullscreen)return;const i=window.innerWidth,t=window.innerHeight;Qe.renderer.resize(i,t),b.maxMapX=i-200,b.maxMapY=t,b.buildMenuOffset.x=(i-200)/2,b.buildMenuOffset.y=t/2,b.player.defaultOffset.x=(i-200)/2,b.player.defaultOffset.y=t/2,b.forceDraw=!0};document.addEventListener("fullscreenchange",()=>{document.fullscreenElement?(b.isFullscreen=!0,b.resizeToFullscreen()):(b.isFullscreen=!1,b.resizeToWindow())});window.addEventListener("resize",()=>{b.isFullscreen||b.resizeToWindow()});b.resizeToWindow();b.bulletFactory=new zI(b);b.buildingFactory=new MI(b);b.socketListener=new bE(b);b.chatManager&&b.chatManager.bindSocket(b.socketListener);b.identityManager&&b.identityManager.bindSocket(b.socketListener);b.lobby=new QE(b,{autoShow:!1});b.lobby.attachSocket(b.socketListener);b.identityManager&&(b.lobby.attachIdentityManager(b.identityManager),b.lobby.updateIdentityDisplay(b.identityManager.getIdentity()),typeof b.identityManager.initialise=="function"&&b.identityManager.initialise().catch(i=>{console.warn("[identity] Failed to initialise identity manager:",i?.message||i)}));b.iconFactory=new $I(b);b.itemFactory=new QI(b);b.rogueTankManager=new _1(b);b.introModal=new vS({heading:"Battle City Remastered",blurb:"Roll in, build your city, and hold the line against rival mayors.",buttonLabel:"Play Now",onStart:async()=>{if(b.audio&&typeof b.audio.resumeContext=="function")try{await b.audio.resumeContext()}catch(i){console.debug("[audio] resume context failed",i?.message||i)}b.lobby&&typeof b.lobby.activate=="function"&&b.lobby.activate()}});const kS=[{name:"imgTanks",url:ve("imgTanks.png")},{name:"imgGround",url:ve("skins/BattleCityDX/imgGround.png")},{name:"imgLava",url:ve("skins/BattleCityDX/imgLava.png")},{name:"imgRocks",url:ve("skins/BattleCityDX/imgRocks.png")},{name:"imgBullets",url:ve("skins/BattleCityDX/imgBullets.png")},{name:"imgInterfaceTop",url:ve("skins/BattleCityDX/imgInterface.png")},{name:"imgInterfaceBottom",url:ve("skins/BattleCityDX/imgInterfaceBottom.png")},{name:"imgHealth",url:ve("skins/BattleCityDX/imgHealth.png")},{name:"imgBuildings",url:ve("skins/BattleCityDX/imgBuildings.png")},{name:"imgBuildIcons",url:ve("imgBuildIcons.png")},{name:"imgItems",url:ve("imgItems.png")},{name:"imgInventorySelection",url:ve("imgInventorySelection.png")},{name:"imgArrows",url:ve("imgArrows.png")},{name:"imgArrowsRed",url:ve("imgArrowsRed.png")},{name:"imgRadarColors",url:ve("imgRadarColors.png")},{name:"imgMiniMapColors",url:ve("imgMiniMapColors.png")},{name:"imgPopulation",url:ve("imgPopulation.png")},{name:"imgBlackNumbers",url:ve("imgBlackNumbers.png")},{name:"imgMoneyBox",url:ve("skins/BattleCity3.1/imgMoneyBox.png")},{name:"imgMoneyUp",url:ve("skins/BattleCity3.1/imgMoneyUp.png")},{name:"imgMoneyDown",url:ve("skins/BattleCity3.1/imgMoneyDown.png")},{name:"imgTurretBase",url:ve("skins/BattleCityDX/imgTurretBase.png")},{name:"imgTurretHead",url:ve("skins/BattleCityDX/imgTurretHead.png")},{name:"imgSmoke",url:ve("imgSmoke.png")},{name:"imgLEExplosion",url:ve("imgLExplosion.png")},{name:"imgSExplosion",url:ve("imgSExplosion.png")},{name:"imgMuzzleFlash",url:ve("imgMuzzleFlash.png")},{name:"mapData",url:ve("map.dat"),loadType:ms.XHR!==void 0?ms.XHR:1,xhrType:op.BUFFER||"arraybuffer"},{name:"cityDemo",url:ve("cities/Balkh/demo.city"),loadType:ms.XHR!==void 0?ms.XHR:1,xhrType:op.TEXT||"text"}];ao.add(kS);ao.onProgress.add(US);ao.load(XS);function US(i,t){t&&console.log("loading: "+t.url),console.log("progress: "+i.progress+"%")}function XS(){console.log("loaded");const i=ao.resources;var t=i.mapData.data;Ox(b,t),Bx(b);const e=eo(b.player.city);e?(b.player.offset.x=e.x,b.player.offset.y=e.y):b.cities[b.player.city]?(b.player.offset.x=b.cities[b.player.city].x+48,b.player.offset.y=b.cities[b.player.city].y+100):(b.player.offset.x=0,b.player.offset.y=0),b.player.lastSafeOffset={x:b.player.offset.x,y:b.player.offset.y},[i.imgGround,i.imgLava,i.imgRocks,i.imgBuildings,i.imgBuildIcons,i.imgItems,i.imgInventorySelection,i.imgArrows,i.imgArrowsRed,i.imgInterfaceTop,i.imgInterfaceBottom,i.imgRadarColors,i.imgMiniMapColors,i.imgTurretBase,i.imgTurretHead,i.imgPopulation,i.imgBlackNumbers,i.imgMoneyBox,i.imgMoneyUp,i.imgMoneyDown,i.imgSmoke,i.imgLEExplosion,i.imgSExplosion,i.imgMuzzleFlash].forEach(n=>PS(n)),b.textures.groundTexture=i.imgGround.texture,b.textures.tankTexture=i.imgTanks.texture,b.textures.rockTexture=i.imgRocks.texture,b.textures.lavaTexture=i.imgLava.texture,b.textures.bulletTexture=i.imgBullets.texture,b.textures.interfaceTop=i.imgInterfaceTop.texture,b.textures.interfaceBottom=i.imgInterfaceBottom.texture,b.textures.imgRadarColors=i.imgRadarColors.texture,b.textures.imgMiniMapColors=i.imgMiniMapColors.texture,b.textures.health=i.imgHealth.texture,b.textures.buildings=i.imgBuildings.texture,b.textures.buildingIcons=i.imgBuildIcons.texture,b.textures.imageIcons=i.imgItems.texture,b.textures.imageItems=i.imgItems.texture,b.textures.imageInventorySelection=i.imgInventorySelection.texture,b.textures.imgArrows=i.imgArrows.texture,b.textures.imgArrowsRed=i.imgArrowsRed.texture,b.textures.imageTurretBase=i.imgTurretBase.texture,b.textures.imageTurretHead=i.imgTurretHead.texture,b.textures.population=i.imgPopulation.texture,b.textures.blackNumbers=i.imgBlackNumbers.texture,b.textures.imgMoneyBox=i.imgMoneyBox.texture,b.textures.imgMoneyUp=i.imgMoneyUp.texture,b.textures.imgMoneyDown=i.imgMoneyDown.texture,b.textures.smoke=i.imgSmoke.texture,b.textures.imageLEExplosion=i.imgLEExplosion.texture,b.textures.imgLEExplosion=i.imgLEExplosion.texture,b.textures.imageSExplosion=i.imgSExplosion.texture,b.textures.imageMuzzleFlash=i.imgMuzzleFlash.texture,pw(b),yw(b),b.socketListener.listen(),b.itemFactory.bindSocketEvents(b.socketListener),b.socketListener.on("connected",()=>{console.log("Connected to server")}),b.socketListener.on("population:update",n=>{b.buildingFactory.applyPopulationUpdate(n)}),b.socketListener.on("building:new",n=>{n&&(b.buildingFactory.newBuilding(n.ownerId||null,n.x,n.y,n.type,{notifyServer:!1,id:n.id,population:n.population||0,attachedHouseId:n.attachedHouseId||null,city:n.city??0,itemsLeft:n.itemsLeft||0,updateCity:!1}),b.forceDraw=!0)}),b.socketListener.on("city:finance",n=>{let s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch(f){console.warn("Failed to parse finance payload",f);return}if(!s)return;const o=s.id??s.city;if(o==null)return;const a=ce(o,0);b.cities[a]||(b.cities[a]={id:a,canBuild:{},cash:0,income:0,itemProduction:0,research:0,hospital:0,construction:0,grossIncome:0});const l=b.cities[a],u=b.cityFinanceFlags.get(a)||{};l.cash=ce(s.cash,l.cash??0),l.income=ce(s.income,0),l.itemProduction=ce(s.itemProduction,0),l.research=ce(s.research,0),l.hospital=ce(s.hospital,0),l.construction=ce(s.construction,0),s.grossIncome!==void 0?l.grossIncome=ce(s.grossIncome,l.grossIncome??0):l.grossIncome=l.income-(l.itemProduction+l.research+l.hospital+l.construction),s.orbPoints!==void 0&&(l.orbPoints=ce(s.orbPoints,l.orbPoints??0)),s.score!==void 0&&(l.score=ce(s.score,l.score??0)),s.orbs!==void 0&&(l.orbs=ce(s.orbs,l.orbs??0)),s.isOrbable!==void 0&&(l.isOrbable=!!s.isOrbable),s.currentBuildings!==void 0&&(l.currentBuildings=ce(s.currentBuildings,l.currentBuildings??0)),s.maxBuildings!==void 0&&(l.maxBuildings=ce(s.maxBuildings,l.maxBuildings??0)),l.updatedAt=s.updatedAt?ce(s.updatedAt,Date.now()):Date.now();const c=je(b.player&&b.player.city,null),h={orbable:!!l.isOrbable,negativeIncome:l.grossIncome<0,cashZero:l.cash<=0,cashLow:l.cash>0&&l.cash<tn};if(b.cityFinanceFlags.set(a,h),c===a&&b.notify){const f=Ae(a);h.cashZero&&!u.cashZero?b.notify({title:"City Treasury Empty",message:`${f} has run out of cash. Income ticks are needed before building again.`,variant:"error"}):h.negativeIncome&&!u.negativeIncome&&b.notify({title:"Income Shortfall",message:`${f} is spending more than it earns. Consider staffing houses or pausing construction.`,variant:"warn",timeout:5200}),h.orbable&&!u.orbable&&b.notify({title:"City Orbable",message:`${f} can now be destroyed by an enemy orb. Strengthen defenses.`,variant:"warn",timeout:5200})}typeof b.updateOrbHint=="function"&&b.updateOrbHint({force:!0}),b.forceDraw=!0}),b.socketListener.on("city:info",n=>{n&&b.showCityInfo(n)}),b.socketListener.on("orb:result",n=>{if(n){if(n.status==="detonated"){const s=n.targetCity!==void 0&&n.targetCity!==null?Ae(n.targetCity):"Enemy city",o=ce(n.points,0),a=[`Destroyed ${s}.`,o>0?`Awarded ${o} points.`:null].filter(Boolean);if(b.setPanelMessage({heading:"Orb Successful",lines:a}),b.notify){const l=[`${s} destroyed.`];o>0&&l.push(`+${o} points.`),b.notify({title:"Orb Detonated",message:l.join(" "),variant:"success",timeout:5400})}b.forceDraw=!0;return}if(n.status==="idle"||n.status==="rejected"){let s="The orb failed to trigger.";n.reason==="not_orbable"?s="Target city is not orbable yet.":n.reason==="no_target"&&(s="An orb must land on an enemy command center."),b.setPanelMessage({heading:"Orb Inert",lines:[s]}),b.notify&&b.notify({title:"Orb Failed",message:s,variant:"warn",timeout:4200}),b.forceDraw=!0}}}),b.socketListener.on("city:orbed",n=>{if(!n)return;k_(b,{duration:900,intensity:7});const s=Ae(n.attackerCity),o=Ae(n.targetCity),a=ce(n.points,0),l=[`${s} destroyed ${o}.`,a>0?`They earned ${a} points.`:null].filter(Boolean);if(b.setPanelMessage({heading:"City Destroyed",lines:l}),b.notify){const u=[`${s} eliminated ${o}.`];a>0&&u.push(`+${a} points.`),b.notify({title:"City Destroyed",message:u.join(" "),variant:n.targetCity===je(b.player&&b.player.city,null)?"error":"warn",timeout:5600})}if(Number.isFinite(n.targetCity)&&b.cities?.[n.targetCity]){const u=b.cities[n.targetCity];u.orbPoints=0,u.isOrbable=!1,u.currentBuildings=ce(u.currentBuildings,1),u.maxBuildings=Math.max(1,ce(u.maxBuildings,1)),u.updatedAt=Date.now()}b.forceDraw=!0}),b.socketListener.on("lobby:evicted",n=>{b.player&&(b.player.city=null,b.player.isMayor=!1);let s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch{s={}}if(b.notify&&s){const o=typeof s.reason=="string"?s.reason:"orb",a=je(s.city,null),l=je(s.attackerCity,null),u=a!==null?Ae(a):"your city",c=l!==null?Ae(l):null,h={death:"error",orb:"error"},f=[];o==="death"?f.push(c?`${c} eliminated you.`:"You were destroyed in combat."):c?f.push(`${c} destroyed ${u}.`):f.push(`${u} was destroyed.`),Number.isFinite(s.points)&&s.points>0&&f.push(`They earned ${s.points} points.`),b.notify({title:"Evicted",message:f.join(" "),variant:h[o]||"warn",timeout:5600})}b.lobby&&typeof b.lobby.handleEviction=="function"&&b.lobby.handleEviction(n),b.forceDraw=!0}),b.socketListener.on("player:dead",n=>{if(!n||!b.notify)return;let s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch(Y){console.warn("Failed to parse player:dead payload",Y);return}if(!s||!s.id)return;const o=s.reason&&typeof s.reason=="object"?s.reason:{},l=`${s.id}`,u=b.socketListener?.io?.id?`${b.socketListener.io.id}`:null,c=u&&l===u,h=s.sourceType??o.sourceType??null,f=s.hazardType??o.type??null,d=ce(s.killerCity,null),p=ce(o.teamId,null),v=ce(s.teamId,null),y=Number.isFinite(d)?Math.max(0,Math.floor(d)):Number.isFinite(p)?Math.max(0,Math.floor(p)):null,g=Number.isFinite(p)?Math.max(0,Math.floor(p)):Number.isFinite(v)?Math.max(0,Math.floor(v)):y,E=s.killerId??o.sourceId??o.shooterId??o.emitterId??o.ownerId??null,T=E!=null?`${E}`:null,R=c?b.player:b.otherPlayers?.[l]||null,_=je(R?.city??o.cityId??o.teamId??null,null);let F=s.callsign||b.resolveCallsign(l)||(c?"Your Tank":null);F||(F=_!==null?`${Ae(_)} Tank`:"Unknown Tank");const P=s.killerCallsign||b.resolveCallsign(T);let H=s.killerLabel&&typeof s.killerLabel=="string"?s.killerLabel:null;H||(H=b.describeKillSource({killerCallsign:P,killerCity:y,teamId:g,sourceType:h,hazardType:f})),T&&l===T&&(H="Self-Inflicted"),(!H||!H.trim().length)&&(H="Unknown Forces");const M=c?"error":"warn",N=`${F} killed by ${H}.`;b.notify({title:"Elimination",message:N,variant:M,timeout:5200})}),b.socketListener.on("build:denied",n=>{let s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch(o){console.warn("Failed to parse build denied payload",o);return}s&&b.buildingFactory.handleBuildDenied(s)}),ui=new J.tilemap.CompositeRectTileLayer(0,b.textures.groundTexture,!0),ui.interactive=!1,ui.interactiveChildren=!1,ci=new J.Container,ci.interactive=!1,ci.interactiveChildren=!1,hi=new J.tilemap.CompositeRectTileLayer(0,b.textures.imageItems,!0),hi.interactive=!1,hi.interactiveChildren=!1,fi=new J.tilemap.CompositeRectTileLayer(0,null,!0),fi.interactive=!1,fi.interactiveChildren=!1,wn.removeChildren(),b.commandCenterLabelCache&&typeof b.commandCenterLabelCache.clear=="function"&&b.commandCenterLabelCache.clear(),Qe.stage.addChild(ui),Qe.stage.addChild(ci),Qe.stage.addChild(fi),Qe.stage.addChild(hi),Qe.stage.addChild(wn),Qe.stage.addChild(oo),Qe.stage.addChild(du),b.gBotDebug=new J.Graphics,Qe.stage.addChild(b.gBotDebug),Fv(b),b.forceDraw=!0,pm(b,ui),bm(b,ci),Rv(b,hi),Mv(b,fi),Dv(b,du),b.forceDraw=!1,Yv()}var Ji=0,ap=0;function Yv(){Xs.begin(),b.lastTick=b.tick,b.tick=new Date().getTime(),b.timePassed=b.tick-b.lastTick;const i=U_(b,b.timePassed);if(b.stage){const t=Number.isFinite(i.x)?i.x:0,e=Number.isFinite(i.y)?i.y:0;(b.stage.position.x!==t||b.stage.position.y!==e)&&b.stage.position.set(t,e)}if(b.bulletFactory.cycle(),(!b.lobby||b.lobby.isInGame())&&b.socketListener.cycle(),b.itemFactory.cycle(),b.rogueTankManager&&b.rogueTankManager.update(),Fv(b),pm(b,ui),bm(b,ci),Mv(b,fi),Vw(b),wE(b),Rv(b,hi),Dv(b,du),b.gBotDebug.clear(),jw(b,b.gBotDebug),fw(b),typeof b.updateOrbHint=="function"){const t=Number.isFinite(b.nextOrbHintUpdate)?b.nextOrbHintUpdate:0;(!t||b.tick>=t)&&(b.updateOrbHint(),b.nextOrbHintUpdate=b.tick+500)}Qe.renderer.plugins.tilemap.tileAnim[0]=Ji*144,b.forceDraw=!1,Xs.end(),requestAnimationFrame(Yv),b.tick>ap&&(ap=b.tick+300,Ji=Ji+1,Ji>=3&&(Ji=0))}
