(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function t(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=t(n);fetch(n.href,s)}})();var ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bi(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function ov(i){if(Object.prototype.hasOwnProperty.call(i,"__esModule"))return i;var e=i.default;if(typeof e=="function"){var t=function r(){var n=!1;try{n=this instanceof r}catch{}return n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var n=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return i[r]}})}),t}var bn={},th;function av(){return th||(th=1,(function(i){(function(e){var t=e.Promise,r=t&&"resolve"in t&&"reject"in t&&"all"in t&&"race"in t&&(function(){var R;return new t(function(N){R=N}),typeof R=="function"})();i?(i.Promise=r?t:H,i.Polyfill=H):r||(e.Promise=H);var n="pending",s="sealed",o="fulfilled",a="rejected",l=function(){};function u(R){return Object.prototype.toString.call(R)==="[object Array]"}var h=typeof setImmediate<"u"?setImmediate:setTimeout,c=[],f;function d(){for(var R=0;R<c.length;R++)c[R][0](c[R][1]);c=[],f=!1}function p(R,N){c.push([R,N]),f||(f=!0,h(d,0))}function v(R,N){function Y(J){E(N,J)}function D(J){M(N,J)}try{R(Y,D)}catch(J){D(J)}}function m(R){var N=R.owner,Y=N.state_,D=N.data_,J=R[Y],Q=R.then;if(typeof J=="function"){Y=o;try{D=J(D)}catch(V){M(Q,V)}}g(Q,D)||(Y===o&&E(Q,D),Y===a&&M(Q,D))}function g(R,N){var Y;try{if(R===N)throw new TypeError("A promises callback cannot return that same promise.");if(N&&(typeof N=="function"||typeof N=="object")){var D=N.then;if(typeof D=="function")return D.call(N,function(J){Y||(Y=!0,N!==J?E(R,J):I(R,J))},function(J){Y||(Y=!0,M(R,J))}),!0}}catch(J){return Y||M(R,J),!0}return!1}function E(R,N){(R===N||!g(R,N))&&I(R,N)}function I(R,N){R.state_===n&&(R.state_=s,R.data_=N,p(F,R))}function M(R,N){R.state_===n&&(R.state_=s,R.data_=N,p(C,R))}function _(R){var N=R.then_;R.then_=void 0;for(var Y=0;Y<N.length;Y++)m(N[Y])}function F(R){R.state_=o,_(R)}function C(R){R.state_=a,_(R)}function H(R){if(typeof R!="function")throw new TypeError("Promise constructor takes a function argument");if(!(this instanceof H))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],v(R,this)}H.prototype={constructor:H,state_:n,then_:null,data_:void 0,then:function(R,N){var Y={owner:this,then:new this.constructor(l),fulfilled:R,rejected:N};return this.state_===o||this.state_===a?p(m,Y):this.then_.push(Y),Y.then},catch:function(R){return this.then(null,R)}},H.all=function(R){var N=this;if(!u(R))throw new TypeError("You must pass an array to Promise.all().");return new N(function(Y,D){var J=[],Q=0;function V(y){return Q++,function(b){J[y]=b,--Q||Y(J)}}for(var A=0,O;A<R.length;A++)O=R[A],O&&typeof O.then=="function"?O.then(V(A),D):J[A]=O;Q||Y(J)})},H.race=function(R){var N=this;if(!u(R))throw new TypeError("You must pass an array to Promise.race().");return new N(function(Y,D){for(var J=0,Q;J<R.length;J++)Q=R[J],Q&&typeof Q.then=="function"?Q.then(Y,D):Y(Q)})},H.resolve=function(R){var N=this;return R&&typeof R=="object"&&R.constructor===N?R:new N(function(Y){Y(R)})},H.reject=function(R){var N=this;return new N(function(Y,D){D(R)})}})(typeof window<"u"?window:typeof ai<"u"?ai:typeof self<"u"?self:bn)})(bn)),bn}var lv=av();/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var Zs,eh;function uv(){if(eh)return Zs;eh=1;var i=Object.getOwnPropertySymbols,e=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable;function r(s){if(s==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(s)}function n(){try{if(!Object.assign)return!1;var s=new String("abc");if(s[5]="de",Object.getOwnPropertyNames(s)[0]==="5")return!1;for(var o={},a=0;a<10;a++)o["_"+String.fromCharCode(a)]=a;var l=Object.getOwnPropertyNames(o).map(function(h){return o[h]});if(l.join("")!=="0123456789")return!1;var u={};return"abcdefghijklmnopqrst".split("").forEach(function(h){u[h]=h}),Object.keys(Object.assign({},u)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}return Zs=n()?Object.assign:function(s,o){for(var a,l=r(s),u,h=1;h<arguments.length;h++){a=Object(arguments[h]);for(var c in a)e.call(a,c)&&(l[c]=a[c]);if(i){u=i(a);for(var f=0;f<u.length;f++)t.call(a,u[f])&&(l[u[f]]=a[u[f]])}}return l},Zs}var hv=uv();const cv=bi(hv);/*!
 * @pixi/polyfill - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/polyfill is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */window.Promise||(window.Promise=lv.Polyfill);Object.assign||(Object.assign=cv);var fv=16;Date.now&&Date.prototype.getTime||(Date.now=function(){return new Date().getTime()});if(!(window.performance&&window.performance.now)){var dv=Date.now();window.performance||(window.performance={}),window.performance.now=function(){return Date.now()-dv}}var Js=Date.now(),rh=["ms","moz","webkit","o"];for(var Qs=0;Qs<rh.length&&!window.requestAnimationFrame;++Qs){var to=rh[Qs];window.requestAnimationFrame=window[to+"RequestAnimationFrame"],window.cancelAnimationFrame=window[to+"CancelAnimationFrame"]||window[to+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(i){if(typeof i!="function")throw new TypeError(i+"is not a function");var e=Date.now(),t=fv+Js-e;return t<0&&(t=0),Js=e,window.setTimeout(function(){Js=Date.now(),i(performance.now())},t)});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(i){return clearTimeout(i)});Math.sign||(Math.sign=function(e){return e=Number(e),e===0||isNaN(e)?e:e>0?1:-1});Number.isInteger||(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e});window.ArrayBuffer||(window.ArrayBuffer=Array);window.Float32Array||(window.Float32Array=Array);window.Uint32Array||(window.Uint32Array=Array);window.Uint16Array||(window.Uint16Array=Array);window.Uint8Array||(window.Uint8Array=Array);window.Int32Array||(window.Int32Array=Array);var eo=/iPhone/i,ih=/iPod/i,nh=/iPad/i,sh=/\biOS-universal(?:.+)Mac\b/i,ro=/\bAndroid(?:.+)Mobile\b/i,oh=/Android/i,Vr=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,_n=/Silk/i,Ne=/Windows Phone/i,ah=/\bWindows(?:.+)ARM\b/i,lh=/BlackBerry/i,uh=/BB10/i,hh=/Opera Mini/i,ch=/\b(CriOS|Chrome)(?:.+)Mobile/i,fh=/Mobile(?:.+)Firefox\b/i,dh=function(i){return typeof i<"u"&&i.platform==="MacIntel"&&typeof i.maxTouchPoints=="number"&&i.maxTouchPoints>1&&typeof MSStream>"u"};function pv(i){return function(e){return e.test(i)}}function yv(i){var e={userAgent:"",platform:"",maxTouchPoints:0};!i&&typeof navigator<"u"?e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof i=="string"?e.userAgent=i:i&&i.userAgent&&(e={userAgent:i.userAgent,platform:i.platform,maxTouchPoints:i.maxTouchPoints||0});var t=e.userAgent,r=t.split("[FBAN");typeof r[1]<"u"&&(t=r[0]),r=t.split("Twitter"),typeof r[1]<"u"&&(t=r[0]);var n=pv(t),s={apple:{phone:n(eo)&&!n(Ne),ipod:n(ih),tablet:!n(eo)&&(n(nh)||dh(e))&&!n(Ne),universal:n(sh),device:(n(eo)||n(ih)||n(nh)||n(sh)||dh(e))&&!n(Ne)},amazon:{phone:n(Vr),tablet:!n(Vr)&&n(_n),device:n(Vr)||n(_n)},android:{phone:!n(Ne)&&n(Vr)||!n(Ne)&&n(ro),tablet:!n(Ne)&&!n(Vr)&&!n(ro)&&(n(_n)||n(oh)),device:!n(Ne)&&(n(Vr)||n(_n)||n(ro)||n(oh))||n(/\bokhttp\b/i)},windows:{phone:n(Ne),tablet:n(ah),device:n(Ne)||n(ah)},other:{blackberry:n(lh),blackberry10:n(uh),opera:n(hh),firefox:n(fh),chrome:n(ch),device:n(lh)||n(uh)||n(hh)||n(fh)||n(ch)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}/*!
 * @pixi/settings - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/settings is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ye=yv(window.navigator);function mv(i){var e=!0;if(ye.tablet||ye.phone){if(ye.apple.device){var t=navigator.userAgent.match(/OS (\d+)_(\d+)?/);if(t){var r=parseInt(t[1],10);r<11&&(e=!1)}}if(ye.android.device){var t=navigator.userAgent.match(/Android\s([0-9.]*)/);if(t){var r=parseInt(t[1],10);r<7&&(e=!1)}}}return e?i:4}function vv(){return!ye.apple.device}var nt={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:mv(32),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:ye.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:vv(),CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},io={exports:{}},ph;function gv(){return ph||(ph=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function n(l,u,h){this.fn=l,this.context=u,this.once=h||!1}function s(l,u,h,c,f){if(typeof h!="function")throw new TypeError("The listener must be a function");var d=new n(h,c||l,f),p=t?t+u:u;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],d]:l._events[p].push(d):(l._events[p]=d,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new r:delete l._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],h,c;if(this._eventsCount===0)return u;for(c in h=this._events)e.call(h,c)&&u.push(t?c.slice(1):c);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(h)):u},a.prototype.listeners=function(u){var h=t?t+u:u,c=this._events[h];if(!c)return[];if(c.fn)return[c.fn];for(var f=0,d=c.length,p=new Array(d);f<d;f++)p[f]=c[f].fn;return p},a.prototype.listenerCount=function(u){var h=t?t+u:u,c=this._events[h];return c?c.fn?1:c.length:0},a.prototype.emit=function(u,h,c,f,d,p){var v=t?t+u:u;if(!this._events[v])return!1;var m=this._events[v],g=arguments.length,E,I;if(m.fn){switch(m.once&&this.removeListener(u,m.fn,void 0,!0),g){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,h),!0;case 3:return m.fn.call(m.context,h,c),!0;case 4:return m.fn.call(m.context,h,c,f),!0;case 5:return m.fn.call(m.context,h,c,f,d),!0;case 6:return m.fn.call(m.context,h,c,f,d,p),!0}for(I=1,E=new Array(g-1);I<g;I++)E[I-1]=arguments[I];m.fn.apply(m.context,E)}else{var M=m.length,_;for(I=0;I<M;I++)switch(m[I].once&&this.removeListener(u,m[I].fn,void 0,!0),g){case 1:m[I].fn.call(m[I].context);break;case 2:m[I].fn.call(m[I].context,h);break;case 3:m[I].fn.call(m[I].context,h,c);break;case 4:m[I].fn.call(m[I].context,h,c,f);break;default:if(!E)for(_=1,E=new Array(g-1);_<g;_++)E[_-1]=arguments[_];m[I].fn.apply(m[I].context,E)}}return!0},a.prototype.on=function(u,h,c){return s(this,u,h,c,!1)},a.prototype.once=function(u,h,c){return s(this,u,h,c,!0)},a.prototype.removeListener=function(u,h,c,f){var d=t?t+u:u;if(!this._events[d])return this;if(!h)return o(this,d),this;var p=this._events[d];if(p.fn)p.fn===h&&(!f||p.once)&&(!c||p.context===c)&&o(this,d);else{for(var v=0,m=[],g=p.length;v<g;v++)(p[v].fn!==h||f&&!p[v].once||c&&p[v].context!==c)&&m.push(p[v]);m.length?this._events[d]=m.length===1?m[0]:m:o(this,d)}return this},a.prototype.removeAllListeners=function(u){var h;return u?(h=t?t+u:u,this._events[h]&&o(this,h)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,i.exports=a})(io)),io.exports}var bv=gv();const _i=bi(bv);var xn={exports:{}},yh;function _v(){if(yh)return xn.exports;yh=1,xn.exports=i,xn.exports.default=i;function i(A,O,y){y=y||2;var b=O&&O.length,x=b?O[0]*y:A.length,T=e(A,0,x,y,!0),S=[];if(!T||T.next===T.prev)return S;var P,L,B,k,U,q,W;if(b&&(T=l(A,O,T,y)),A.length>80*y){P=B=A[0],L=k=A[1];for(var z=y;z<x;z+=y)U=A[z],q=A[z+1],U<P&&(P=U),q<L&&(L=q),U>B&&(B=U),q>k&&(k=q);W=Math.max(B-P,k-L),W=W!==0?32767/W:0}return r(T,S,y,P,L,W,0),S}function e(A,O,y,b,x){var T,S;if(x===V(A,O,y,b)>0)for(T=O;T<y;T+=b)S=D(T,A[T],A[T+1],S);else for(T=y-b;T>=O;T-=b)S=D(T,A[T],A[T+1],S);return S&&M(S,S.next)&&(J(S),S=S.next),S}function t(A,O){if(!A)return A;O||(O=A);var y=A,b;do if(b=!1,!y.steiner&&(M(y,y.next)||I(y.prev,y,y.next)===0)){if(J(y),y=O=y.prev,y===y.next)break;b=!0}else y=y.next;while(b||y!==O);return O}function r(A,O,y,b,x,T,S){if(A){!S&&T&&d(A,b,x,T);for(var P=A,L,B;A.prev!==A.next;){if(L=A.prev,B=A.next,T?s(A,b,x,T):n(A)){O.push(L.i/y|0),O.push(A.i/y|0),O.push(B.i/y|0),J(A),A=B.next,P=B.next;continue}if(A=B,A===P){S?S===1?(A=o(t(A),O,y),r(A,O,y,b,x,T,2)):S===2&&a(A,O,y,b,x,T):r(t(A),O,y,b,x,T,1);break}}}}function n(A){var O=A.prev,y=A,b=A.next;if(I(O,y,b)>=0)return!1;for(var x=O.x,T=y.x,S=b.x,P=O.y,L=y.y,B=b.y,k=x<T?x<S?x:S:T<S?T:S,U=P<L?P<B?P:B:L<B?L:B,q=x>T?x>S?x:S:T>S?T:S,W=P>L?P>B?P:B:L>B?L:B,z=b.next;z!==O;){if(z.x>=k&&z.x<=q&&z.y>=U&&z.y<=W&&g(x,P,T,L,S,B,z.x,z.y)&&I(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function s(A,O,y,b){var x=A.prev,T=A,S=A.next;if(I(x,T,S)>=0)return!1;for(var P=x.x,L=T.x,B=S.x,k=x.y,U=T.y,q=S.y,W=P<L?P<B?P:B:L<B?L:B,z=k<U?k<q?k:q:U<q?U:q,Z=P>L?P>B?P:B:L>B?L:B,j=k>U?k>q?k:q:U>q?U:q,it=v(W,z,O,y,b),at=v(Z,j,O,y,b),et=A.prevZ,rt=A.nextZ;et&&et.z>=it&&rt&&rt.z<=at;){if(et.x>=W&&et.x<=Z&&et.y>=z&&et.y<=j&&et!==x&&et!==S&&g(P,k,L,U,B,q,et.x,et.y)&&I(et.prev,et,et.next)>=0||(et=et.prevZ,rt.x>=W&&rt.x<=Z&&rt.y>=z&&rt.y<=j&&rt!==x&&rt!==S&&g(P,k,L,U,B,q,rt.x,rt.y)&&I(rt.prev,rt,rt.next)>=0))return!1;rt=rt.nextZ}for(;et&&et.z>=it;){if(et.x>=W&&et.x<=Z&&et.y>=z&&et.y<=j&&et!==x&&et!==S&&g(P,k,L,U,B,q,et.x,et.y)&&I(et.prev,et,et.next)>=0)return!1;et=et.prevZ}for(;rt&&rt.z<=at;){if(rt.x>=W&&rt.x<=Z&&rt.y>=z&&rt.y<=j&&rt!==x&&rt!==S&&g(P,k,L,U,B,q,rt.x,rt.y)&&I(rt.prev,rt,rt.next)>=0)return!1;rt=rt.nextZ}return!0}function o(A,O,y){var b=A;do{var x=b.prev,T=b.next.next;!M(x,T)&&_(x,b,b.next,T)&&R(x,T)&&R(T,x)&&(O.push(x.i/y|0),O.push(b.i/y|0),O.push(T.i/y|0),J(b),J(b.next),b=A=T),b=b.next}while(b!==A);return t(b)}function a(A,O,y,b,x,T){var S=A;do{for(var P=S.next.next;P!==S.prev;){if(S.i!==P.i&&E(S,P)){var L=Y(S,P);S=t(S,S.next),L=t(L,L.next),r(S,O,y,b,x,T,0),r(L,O,y,b,x,T,0);return}P=P.next}S=S.next}while(S!==A)}function l(A,O,y,b){var x=[],T,S,P,L,B;for(T=0,S=O.length;T<S;T++)P=O[T]*b,L=T<S-1?O[T+1]*b:A.length,B=e(A,P,L,b,!1),B===B.next&&(B.steiner=!0),x.push(m(B));for(x.sort(u),T=0;T<x.length;T++)y=h(x[T],y);return y}function u(A,O){return A.x-O.x}function h(A,O){var y=c(A,O);if(!y)return O;var b=Y(y,A);return t(b,b.next),t(y,y.next)}function c(A,O){var y=O,b=A.x,x=A.y,T=-1/0,S;do{if(x<=y.y&&x>=y.next.y&&y.next.y!==y.y){var P=y.x+(x-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(P<=b&&P>T&&(T=P,S=y.x<y.next.x?y:y.next,P===b))return S}y=y.next}while(y!==O);if(!S)return null;var L=S,B=S.x,k=S.y,U=1/0,q;y=S;do b>=y.x&&y.x>=B&&b!==y.x&&g(x<k?b:T,x,B,k,x<k?T:b,x,y.x,y.y)&&(q=Math.abs(x-y.y)/(b-y.x),R(y,A)&&(q<U||q===U&&(y.x>S.x||y.x===S.x&&f(S,y)))&&(S=y,U=q)),y=y.next;while(y!==L);return S}function f(A,O){return I(A.prev,A,O.prev)<0&&I(O.next,A,A.next)<0}function d(A,O,y,b){var x=A;do x.z===0&&(x.z=v(x.x,x.y,O,y,b)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next;while(x!==A);x.prevZ.nextZ=null,x.prevZ=null,p(x)}function p(A){var O,y,b,x,T,S,P,L,B=1;do{for(y=A,A=null,T=null,S=0;y;){for(S++,b=y,P=0,O=0;O<B&&(P++,b=b.nextZ,!!b);O++);for(L=B;P>0||L>0&&b;)P!==0&&(L===0||!b||y.z<=b.z)?(x=y,y=y.nextZ,P--):(x=b,b=b.nextZ,L--),T?T.nextZ=x:A=x,x.prevZ=T,T=x;y=b}T.nextZ=null,B*=2}while(S>1);return A}function v(A,O,y,b,x){return A=(A-y)*x|0,O=(O-b)*x|0,A=(A|A<<8)&16711935,A=(A|A<<4)&252645135,A=(A|A<<2)&858993459,A=(A|A<<1)&1431655765,O=(O|O<<8)&16711935,O=(O|O<<4)&252645135,O=(O|O<<2)&858993459,O=(O|O<<1)&1431655765,A|O<<1}function m(A){var O=A,y=A;do(O.x<y.x||O.x===y.x&&O.y<y.y)&&(y=O),O=O.next;while(O!==A);return y}function g(A,O,y,b,x,T,S,P){return(x-S)*(O-P)>=(A-S)*(T-P)&&(A-S)*(b-P)>=(y-S)*(O-P)&&(y-S)*(T-P)>=(x-S)*(b-P)}function E(A,O){return A.next.i!==O.i&&A.prev.i!==O.i&&!H(A,O)&&(R(A,O)&&R(O,A)&&N(A,O)&&(I(A.prev,A,O.prev)||I(A,O.prev,O))||M(A,O)&&I(A.prev,A,A.next)>0&&I(O.prev,O,O.next)>0)}function I(A,O,y){return(O.y-A.y)*(y.x-O.x)-(O.x-A.x)*(y.y-O.y)}function M(A,O){return A.x===O.x&&A.y===O.y}function _(A,O,y,b){var x=C(I(A,O,y)),T=C(I(A,O,b)),S=C(I(y,b,A)),P=C(I(y,b,O));return!!(x!==T&&S!==P||x===0&&F(A,y,O)||T===0&&F(A,b,O)||S===0&&F(y,A,b)||P===0&&F(y,O,b))}function F(A,O,y){return O.x<=Math.max(A.x,y.x)&&O.x>=Math.min(A.x,y.x)&&O.y<=Math.max(A.y,y.y)&&O.y>=Math.min(A.y,y.y)}function C(A){return A>0?1:A<0?-1:0}function H(A,O){var y=A;do{if(y.i!==A.i&&y.next.i!==A.i&&y.i!==O.i&&y.next.i!==O.i&&_(y,y.next,A,O))return!0;y=y.next}while(y!==A);return!1}function R(A,O){return I(A.prev,A,A.next)<0?I(A,O,A.next)>=0&&I(A,A.prev,O)>=0:I(A,O,A.prev)<0||I(A,A.next,O)<0}function N(A,O){var y=A,b=!1,x=(A.x+O.x)/2,T=(A.y+O.y)/2;do y.y>T!=y.next.y>T&&y.next.y!==y.y&&x<(y.next.x-y.x)*(T-y.y)/(y.next.y-y.y)+y.x&&(b=!b),y=y.next;while(y!==A);return b}function Y(A,O){var y=new Q(A.i,A.x,A.y),b=new Q(O.i,O.x,O.y),x=A.next,T=O.prev;return A.next=O,O.prev=A,y.next=x,x.prev=y,b.next=y,y.prev=b,T.next=b,b.prev=T,b}function D(A,O,y,b){var x=new Q(A,O,y);return b?(x.next=b.next,x.prev=b,b.next.prev=x,b.next=x):(x.prev=x,x.next=x),x}function J(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function Q(A,O,y){this.i=A,this.x=O,this.y=y,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}i.deviation=function(A,O,y,b){var x=O&&O.length,T=x?O[0]*y:A.length,S=Math.abs(V(A,0,T,y));if(x)for(var P=0,L=O.length;P<L;P++){var B=O[P]*y,k=P<L-1?O[P+1]*y:A.length;S-=Math.abs(V(A,B,k,y))}var U=0;for(P=0;P<b.length;P+=3){var q=b[P]*y,W=b[P+1]*y,z=b[P+2]*y;U+=Math.abs((A[q]-A[z])*(A[W+1]-A[q+1])-(A[q]-A[W])*(A[z+1]-A[q+1]))}return S===0&&U===0?0:Math.abs((U-S)/S)};function V(A,O,y,b){for(var x=0,T=O,S=y-b;T<y;T+=b)x+=(A[S]-A[T])*(A[T+1]+A[S+1]),S=T;return x}return i.flatten=function(A){for(var O=A[0][0].length,y={vertices:[],holes:[],dimensions:O},b=0,x=0;x<A.length;x++){for(var T=0;T<A[x].length;T++)for(var S=0;S<O;S++)y.vertices.push(A[x][T][S]);x>0&&(b+=A[x-1].length,y.holes.push(b))}return y},xn.exports}var xv=_v();const Gl=bi(xv);var pr={},Ui={exports:{}};/*! https://mths.be/punycode v1.4.1 by @mathias */var wv=Ui.exports,mh;function Tv(){return mh||(mh=1,(function(i,e){(function(t){var r=e&&!e.nodeType&&e,n=i&&!i.nodeType&&i,s=typeof ai=="object"&&ai;(s.global===s||s.window===s||s.self===s)&&(t=s);var o,a=2147483647,l=36,u=1,h=26,c=38,f=700,d=72,p=128,v="-",m=/^xn--/,g=/[^\x20-\x7E]/,E=/[\x2E\u3002\uFF0E\uFF61]/g,I={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},M=l-u,_=Math.floor,F=String.fromCharCode,C;function H(x){throw new RangeError(I[x])}function R(x,T){for(var S=x.length,P=[];S--;)P[S]=T(x[S]);return P}function N(x,T){var S=x.split("@"),P="";S.length>1&&(P=S[0]+"@",x=S[1]),x=x.replace(E,".");var L=x.split("."),B=R(L,T).join(".");return P+B}function Y(x){for(var T=[],S=0,P=x.length,L,B;S<P;)L=x.charCodeAt(S++),L>=55296&&L<=56319&&S<P?(B=x.charCodeAt(S++),(B&64512)==56320?T.push(((L&1023)<<10)+(B&1023)+65536):(T.push(L),S--)):T.push(L);return T}function D(x){return R(x,function(T){var S="";return T>65535&&(T-=65536,S+=F(T>>>10&1023|55296),T=56320|T&1023),S+=F(T),S}).join("")}function J(x){return x-48<10?x-22:x-65<26?x-65:x-97<26?x-97:l}function Q(x,T){return x+22+75*(x<26)-((T!=0)<<5)}function V(x,T,S){var P=0;for(x=S?_(x/f):x>>1,x+=_(x/T);x>M*h>>1;P+=l)x=_(x/M);return _(P+(M+1)*x/(x+c))}function A(x){var T=[],S=x.length,P,L=0,B=p,k=d,U,q,W,z,Z,j,it,at,et;for(U=x.lastIndexOf(v),U<0&&(U=0),q=0;q<U;++q)x.charCodeAt(q)>=128&&H("not-basic"),T.push(x.charCodeAt(q));for(W=U>0?U+1:0;W<S;){for(z=L,Z=1,j=l;W>=S&&H("invalid-input"),it=J(x.charCodeAt(W++)),(it>=l||it>_((a-L)/Z))&&H("overflow"),L+=it*Z,at=j<=k?u:j>=k+h?h:j-k,!(it<at);j+=l)et=l-at,Z>_(a/et)&&H("overflow"),Z*=et;P=T.length+1,k=V(L-z,P,z==0),_(L/P)>a-B&&H("overflow"),B+=_(L/P),L%=P,T.splice(L++,0,B)}return D(T)}function O(x){var T,S,P,L,B,k,U,q,W,z,Z,j=[],it,at,et,rt;for(x=Y(x),it=x.length,T=p,S=0,B=d,k=0;k<it;++k)Z=x[k],Z<128&&j.push(F(Z));for(P=L=j.length,L&&j.push(v);P<it;){for(U=a,k=0;k<it;++k)Z=x[k],Z>=T&&Z<U&&(U=Z);for(at=P+1,U-T>_((a-S)/at)&&H("overflow"),S+=(U-T)*at,T=U,k=0;k<it;++k)if(Z=x[k],Z<T&&++S>a&&H("overflow"),Z==T){for(q=S,W=l;z=W<=B?u:W>=B+h?h:W-B,!(q<z);W+=l)rt=q-z,et=l-z,j.push(F(Q(z+rt%et,0))),q=_(rt/et);j.push(F(Q(q,0))),B=V(S,at,P==L),S=0,++P}++S,++T}return j.join("")}function y(x){return N(x,function(T){return m.test(T)?A(T.slice(4).toLowerCase()):T})}function b(x){return N(x,function(T){return g.test(T)?"xn--"+O(T):T})}if(o={version:"1.4.1",ucs2:{decode:Y,encode:D},decode:A,encode:O,toASCII:b,toUnicode:y},r&&n)if(i.exports==r)n.exports=o;else for(C in o)o.hasOwnProperty(C)&&(r[C]=o[C]);else t.punycode=o})(wv)})(Ui,Ui.exports)),Ui.exports}var no,vh;function xi(){return vh||(vh=1,no=TypeError),no}const Iv={},Ev=Object.freeze(Object.defineProperty({__proto__:null,default:Iv},Symbol.toStringTag,{value:"Module"})),Sv=ov(Ev);var so,gh;function Is(){if(gh)return so;gh=1;var i=typeof Map=="function"&&Map.prototype,e=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,t=i&&e&&typeof e.get=="function"?e.get:null,r=i&&Map.prototype.forEach,n=typeof Set=="function"&&Set.prototype,s=Object.getOwnPropertyDescriptor&&n?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,o=n&&s&&typeof s.get=="function"?s.get:null,a=n&&Set.prototype.forEach,l=typeof WeakMap=="function"&&WeakMap.prototype,u=l?WeakMap.prototype.has:null,h=typeof WeakSet=="function"&&WeakSet.prototype,c=h?WeakSet.prototype.has:null,f=typeof WeakRef=="function"&&WeakRef.prototype,d=f?WeakRef.prototype.deref:null,p=Boolean.prototype.valueOf,v=Object.prototype.toString,m=Function.prototype.toString,g=String.prototype.match,E=String.prototype.slice,I=String.prototype.replace,M=String.prototype.toUpperCase,_=String.prototype.toLowerCase,F=RegExp.prototype.test,C=Array.prototype.concat,H=Array.prototype.join,R=Array.prototype.slice,N=Math.floor,Y=typeof BigInt=="function"?BigInt.prototype.valueOf:null,D=Object.getOwnPropertySymbols,J=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Q=typeof Symbol=="function"&&typeof Symbol.iterator=="object",V=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Q||!0)?Symbol.toStringTag:null,A=Object.prototype.propertyIsEnumerable,O=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(X){return X.__proto__}:null);function y(X,G){if(X===1/0||X===-1/0||X!==X||X&&X>-1e3&&X<1e3||F.call(/e/,G))return G;var mt=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof X=="number"){var Tt=X<0?-N(-X):N(X);if(Tt!==X){var Et=String(Tt),ut=E.call(G,Et.length+1);return I.call(Et,mt,"$&_")+"."+I.call(I.call(ut,/([0-9]{3})/g,"$&_"),/_$/,"")}}return I.call(G,mt,"$&_")}var b=Sv,x=b.custom,T=at(x)?x:null,S={__proto__:null,double:'"',single:"'"},P={__proto__:null,double:/(["\\])/g,single:/(['\\])/g};so=function X(G,mt,Tt,Et){var ut=mt||{};if(wt(ut,"quoteStyle")&&!wt(S,ut.quoteStyle))throw new TypeError('option "quoteStyle" must be "single" or "double"');if(wt(ut,"maxStringLength")&&(typeof ut.maxStringLength=="number"?ut.maxStringLength<0&&ut.maxStringLength!==1/0:ut.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var Ze=wt(ut,"customInspect")?ut.customInspect:!0;if(typeof Ze!="boolean"&&Ze!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(wt(ut,"indent")&&ut.indent!==null&&ut.indent!=="	"&&!(parseInt(ut.indent,10)===ut.indent&&ut.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(wt(ut,"numericSeparator")&&typeof ut.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var dr=ut.numericSeparator;if(typeof G>"u")return"undefined";if(G===null)return"null";if(typeof G=="boolean")return G?"true":"false";if(typeof G=="string")return zu(G,ut);if(typeof G=="number"){if(G===0)return 1/0/G>0?"0":"-0";var oe=String(G);return dr?y(G,oe):oe}if(typeof G=="bigint"){var Je=String(G)+"n";return dr?y(G,Je):Je}var zs=typeof ut.depth>"u"?5:ut.depth;if(typeof Tt>"u"&&(Tt=0),Tt>=zs&&zs>0&&typeof G=="object")return U(G)?"[Array]":"[Object]";var Yr=iv(ut,Tt);if(typeof Et>"u")Et=[];else if(Ke(Et,G)>=0)return"[Circular]";function _e(zr,gn,sv){if(gn&&(Et=R.call(Et),Et.push(gn)),sv){var Qu={depth:ut.depth};return wt(ut,"quoteStyle")&&(Qu.quoteStyle=ut.quoteStyle),X(zr,Qu,Tt+1,Et)}return X(zr,ut,Tt+1,Et)}if(typeof G=="function"&&!W(G)){var qu=At(G),$u=mn(G,_e);return"[Function"+(qu?": "+qu:" (anonymous)")+"]"+($u.length>0?" { "+H.call($u,", ")+" }":"")}if(at(G)){var ju=Q?I.call(String(G),/^(Symbol\(.*\))_[^)]*$/,"$1"):J.call(G);return typeof G=="object"&&!Q?Ci(ju):ju}if(tv(G)){for(var Pi="<"+_.call(String(G.nodeName)),Vs=G.attributes||[],vn=0;vn<Vs.length;vn++)Pi+=" "+Vs[vn].name+"="+L(B(Vs[vn].value),"double",ut);return Pi+=">",G.childNodes&&G.childNodes.length&&(Pi+="..."),Pi+="</"+_.call(String(G.nodeName))+">",Pi}if(U(G)){if(G.length===0)return"[]";var qs=mn(G,_e);return Yr&&!rv(qs)?"["+Ys(qs,Yr)+"]":"[ "+H.call(qs,", ")+" ]"}if(z(G)){var $s=mn(G,_e);return!("cause"in Error.prototype)&&"cause"in G&&!A.call(G,"cause")?"{ ["+String(G)+"] "+H.call(C.call("[cause]: "+_e(G.cause),$s),", ")+" }":$s.length===0?"["+String(G)+"]":"{ ["+String(G)+"] "+H.call($s,", ")+" }"}if(typeof G=="object"&&Ze){if(T&&typeof G[T]=="function"&&b)return b(G,{depth:zs-Tt});if(Ze!=="symbol"&&typeof G.inspect=="function")return G.inspect()}if(be(G)){var Wu=[];return r&&r.call(G,function(zr,gn){Wu.push(_e(gn,G,!0)+" => "+_e(zr,G))}),Vu("Map",t.call(G),Wu,Yr)}if(Gr(G)){var Ku=[];return a&&a.call(G,function(zr){Ku.push(_e(zr,G))}),Vu("Set",o.call(G),Ku,Yr)}if(Xr(G))return Gs("WeakMap");if(Qm(G))return Gs("WeakSet");if(Hr(G))return Gs("WeakRef");if(j(G))return Ci(_e(Number(G)));if(et(G))return Ci(_e(Y.call(G)));if(it(G))return Ci(p.call(G));if(Z(G))return Ci(_e(String(G)));if(typeof window<"u"&&G===window)return"{ [object Window] }";if(typeof globalThis<"u"&&G===globalThis||typeof ai<"u"&&G===ai)return"{ [object globalThis] }";if(!q(G)&&!W(G)){var js=mn(G,_e),Zu=O?O(G)===Object.prototype:G instanceof Object||G.constructor===Object,Ws=G instanceof Object?"":"null prototype",Ju=!Zu&&V&&Object(G)===G&&V in G?E.call(xt(G),8,-1):Ws?"Object":"",nv=Zu||typeof G.constructor!="function"?"":G.constructor.name?G.constructor.name+" ":"",Ks=nv+(Ju||Ws?"["+H.call(C.call([],Ju||[],Ws||[]),": ")+"] ":"");return js.length===0?Ks+"{}":Yr?Ks+"{"+Ys(js,Yr)+"}":Ks+"{ "+H.call(js,", ")+" }"}return String(G)};function L(X,G,mt){var Tt=mt.quoteStyle||G,Et=S[Tt];return Et+X+Et}function B(X){return I.call(String(X),/"/g,"&quot;")}function k(X){return!V||!(typeof X=="object"&&(V in X||typeof X[V]<"u"))}function U(X){return xt(X)==="[object Array]"&&k(X)}function q(X){return xt(X)==="[object Date]"&&k(X)}function W(X){return xt(X)==="[object RegExp]"&&k(X)}function z(X){return xt(X)==="[object Error]"&&k(X)}function Z(X){return xt(X)==="[object String]"&&k(X)}function j(X){return xt(X)==="[object Number]"&&k(X)}function it(X){return xt(X)==="[object Boolean]"&&k(X)}function at(X){if(Q)return X&&typeof X=="object"&&X instanceof Symbol;if(typeof X=="symbol")return!0;if(!X||typeof X!="object"||!J)return!1;try{return J.call(X),!0}catch{}return!1}function et(X){if(!X||typeof X!="object"||!Y)return!1;try{return Y.call(X),!0}catch{}return!1}var rt=Object.prototype.hasOwnProperty||function(X){return X in this};function wt(X,G){return rt.call(X,G)}function xt(X){return v.call(X)}function At(X){if(X.name)return X.name;var G=g.call(m.call(X),/^function\s*([\w$]+)/);return G?G[1]:null}function Ke(X,G){if(X.indexOf)return X.indexOf(G);for(var mt=0,Tt=X.length;mt<Tt;mt++)if(X[mt]===G)return mt;return-1}function be(X){if(!t||!X||typeof X!="object")return!1;try{t.call(X);try{o.call(X)}catch{return!0}return X instanceof Map}catch{}return!1}function Xr(X){if(!u||!X||typeof X!="object")return!1;try{u.call(X,u);try{c.call(X,c)}catch{return!0}return X instanceof WeakMap}catch{}return!1}function Hr(X){if(!d||!X||typeof X!="object")return!1;try{return d.call(X),!0}catch{}return!1}function Gr(X){if(!o||!X||typeof X!="object")return!1;try{o.call(X);try{t.call(X)}catch{return!0}return X instanceof Set}catch{}return!1}function Qm(X){if(!c||!X||typeof X!="object")return!1;try{c.call(X,c);try{u.call(X,u)}catch{return!0}return X instanceof WeakSet}catch{}return!1}function tv(X){return!X||typeof X!="object"?!1:typeof HTMLElement<"u"&&X instanceof HTMLElement?!0:typeof X.nodeName=="string"&&typeof X.getAttribute=="function"}function zu(X,G){if(X.length>G.maxStringLength){var mt=X.length-G.maxStringLength,Tt="... "+mt+" more character"+(mt>1?"s":"");return zu(E.call(X,0,G.maxStringLength),G)+Tt}var Et=P[G.quoteStyle||"single"];Et.lastIndex=0;var ut=I.call(I.call(X,Et,"\\$1"),/[\x00-\x1f]/g,ev);return L(ut,"single",G)}function ev(X){var G=X.charCodeAt(0),mt={8:"b",9:"t",10:"n",12:"f",13:"r"}[G];return mt?"\\"+mt:"\\x"+(G<16?"0":"")+M.call(G.toString(16))}function Ci(X){return"Object("+X+")"}function Gs(X){return X+" { ? }"}function Vu(X,G,mt,Tt){var Et=Tt?Ys(mt,Tt):H.call(mt,", ");return X+" ("+G+") {"+Et+"}"}function rv(X){for(var G=0;G<X.length;G++)if(Ke(X[G],`
`)>=0)return!1;return!0}function iv(X,G){var mt;if(X.indent==="	")mt="	";else if(typeof X.indent=="number"&&X.indent>0)mt=H.call(Array(X.indent+1)," ");else return null;return{base:mt,prev:H.call(Array(G+1),mt)}}function Ys(X,G){if(X.length===0)return"";var mt=`
`+G.prev+G.base;return mt+H.call(X,","+mt)+`
`+G.prev}function mn(X,G){var mt=U(X),Tt=[];if(mt){Tt.length=X.length;for(var Et=0;Et<X.length;Et++)Tt[Et]=wt(X,Et)?G(X[Et],X):""}var ut=typeof D=="function"?D(X):[],Ze;if(Q){Ze={};for(var dr=0;dr<ut.length;dr++)Ze["$"+ut[dr]]=ut[dr]}for(var oe in X)wt(X,oe)&&(mt&&String(Number(oe))===oe&&oe<X.length||Q&&Ze["$"+oe]instanceof Symbol||(F.call(/[^\w$]/,oe)?Tt.push(G(oe,X)+": "+G(X[oe],X)):Tt.push(oe+": "+G(X[oe],X))));if(typeof D=="function")for(var Je=0;Je<ut.length;Je++)A.call(X,ut[Je])&&Tt.push("["+G(ut[Je])+"]: "+G(X[ut[Je]],X));return Tt}return so}var oo,bh;function Av(){if(bh)return oo;bh=1;var i=Is(),e=xi(),t=function(a,l,u){for(var h=a,c;(c=h.next)!=null;h=c)if(c.key===l)return h.next=c.next,u||(c.next=a.next,a.next=c),c},r=function(a,l){if(a){var u=t(a,l);return u&&u.value}},n=function(a,l,u){var h=t(a,l);h?h.value=u:a.next={key:l,next:a.next,value:u}},s=function(a,l){return a?!!t(a,l):!1},o=function(a,l){if(a)return t(a,l,!0)};return oo=function(){var l,u={assert:function(h){if(!u.has(h))throw new e("Side channel does not contain "+i(h))},delete:function(h){var c=l&&l.next,f=o(l,h);return f&&c&&c===f&&(l=void 0),!!f},get:function(h){return r(l,h)},has:function(h){return s(l,h)},set:function(h,c){l||(l={next:void 0}),n(l,h,c)}};return u},oo}var ao,_h;function xd(){return _h||(_h=1,ao=Object),ao}var lo,xh;function Cv(){return xh||(xh=1,lo=Error),lo}var uo,wh;function Pv(){return wh||(wh=1,uo=EvalError),uo}var ho,Th;function Ov(){return Th||(Th=1,ho=RangeError),ho}var co,Ih;function Fv(){return Ih||(Ih=1,co=ReferenceError),co}var fo,Eh;function Rv(){return Eh||(Eh=1,fo=SyntaxError),fo}var po,Sh;function Mv(){return Sh||(Sh=1,po=URIError),po}var yo,Ah;function Lv(){return Ah||(Ah=1,yo=Math.abs),yo}var mo,Ch;function Nv(){return Ch||(Ch=1,mo=Math.floor),mo}var vo,Ph;function Bv(){return Ph||(Ph=1,vo=Math.max),vo}var go,Oh;function Dv(){return Oh||(Oh=1,go=Math.min),go}var bo,Fh;function kv(){return Fh||(Fh=1,bo=Math.pow),bo}var _o,Rh;function Uv(){return Rh||(Rh=1,_o=Math.round),_o}var xo,Mh;function Xv(){return Mh||(Mh=1,xo=Number.isNaN||function(e){return e!==e}),xo}var wo,Lh;function Hv(){if(Lh)return wo;Lh=1;var i=Xv();return wo=function(t){return i(t)||t===0?t:t<0?-1:1},wo}var To,Nh;function Gv(){return Nh||(Nh=1,To=Object.getOwnPropertyDescriptor),To}var Io,Bh;function wd(){if(Bh)return Io;Bh=1;var i=Gv();if(i)try{i([],"length")}catch{i=null}return Io=i,Io}var Eo,Dh;function Yv(){if(Dh)return Eo;Dh=1;var i=Object.defineProperty||!1;if(i)try{i({},"a",{value:1})}catch{i=!1}return Eo=i,Eo}var So,kh;function zv(){return kh||(kh=1,So=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var n=42;e[t]=n;for(var s in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var o=Object.getOwnPropertySymbols(e);if(o.length!==1||o[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var a=Object.getOwnPropertyDescriptor(e,t);if(a.value!==n||a.enumerable!==!0)return!1}return!0}),So}var Ao,Uh;function Vv(){if(Uh)return Ao;Uh=1;var i=typeof Symbol<"u"&&Symbol,e=zv();return Ao=function(){return typeof i!="function"||typeof Symbol!="function"||typeof i("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},Ao}var Co,Xh;function Td(){return Xh||(Xh=1,Co=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),Co}var Po,Hh;function Id(){if(Hh)return Po;Hh=1;var i=xd();return Po=i.getPrototypeOf||null,Po}var Oo,Gh;function qv(){if(Gh)return Oo;Gh=1;var i="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",n=function(l,u){for(var h=[],c=0;c<l.length;c+=1)h[c]=l[c];for(var f=0;f<u.length;f+=1)h[f+l.length]=u[f];return h},s=function(l,u){for(var h=[],c=u,f=0;c<l.length;c+=1,f+=1)h[f]=l[c];return h},o=function(a,l){for(var u="",h=0;h<a.length;h+=1)u+=a[h],h+1<a.length&&(u+=l);return u};return Oo=function(l){var u=this;if(typeof u!="function"||e.apply(u)!==r)throw new TypeError(i+u);for(var h=s(arguments,1),c,f=function(){if(this instanceof c){var g=u.apply(this,n(h,arguments));return Object(g)===g?g:this}return u.apply(l,n(h,arguments))},d=t(0,u.length-h.length),p=[],v=0;v<d;v++)p[v]="$"+v;if(c=Function("binder","return function ("+o(p,",")+"){ return binder.apply(this,arguments); }")(f),u.prototype){var m=function(){};m.prototype=u.prototype,c.prototype=new m,m.prototype=null}return c},Oo}var Fo,Yh;function Es(){if(Yh)return Fo;Yh=1;var i=qv();return Fo=Function.prototype.bind||i,Fo}var Ro,zh;function Yl(){return zh||(zh=1,Ro=Function.prototype.call),Ro}var Mo,Vh;function Ed(){return Vh||(Vh=1,Mo=Function.prototype.apply),Mo}var Lo,qh;function $v(){return qh||(qh=1,Lo=typeof Reflect<"u"&&Reflect&&Reflect.apply),Lo}var No,$h;function jv(){if($h)return No;$h=1;var i=Es(),e=Ed(),t=Yl(),r=$v();return No=r||i.call(t,e),No}var Bo,jh;function Sd(){if(jh)return Bo;jh=1;var i=Es(),e=xi(),t=Yl(),r=jv();return Bo=function(s){if(s.length<1||typeof s[0]!="function")throw new e("a function is required");return r(i,t,s)},Bo}var Do,Wh;function Wv(){if(Wh)return Do;Wh=1;var i=Sd(),e=wd(),t;try{t=[].__proto__===Array.prototype}catch(o){if(!o||typeof o!="object"||!("code"in o)||o.code!=="ERR_PROTO_ACCESS")throw o}var r=!!t&&e&&e(Object.prototype,"__proto__"),n=Object,s=n.getPrototypeOf;return Do=r&&typeof r.get=="function"?i([r.get]):typeof s=="function"?function(a){return s(a==null?a:n(a))}:!1,Do}var ko,Kh;function Kv(){if(Kh)return ko;Kh=1;var i=Td(),e=Id(),t=Wv();return ko=i?function(n){return i(n)}:e?function(n){if(!n||typeof n!="object"&&typeof n!="function")throw new TypeError("getProto: not an object");return e(n)}:t?function(n){return t(n)}:null,ko}var Uo,Zh;function Zv(){if(Zh)return Uo;Zh=1;var i=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Es();return Uo=t.call(i,e),Uo}var Xo,Jh;function zl(){if(Jh)return Xo;Jh=1;var i,e=xd(),t=Cv(),r=Pv(),n=Ov(),s=Fv(),o=Rv(),a=xi(),l=Mv(),u=Lv(),h=Nv(),c=Bv(),f=Dv(),d=kv(),p=Uv(),v=Hv(),m=Function,g=function(W){try{return m('"use strict"; return ('+W+").constructor;")()}catch{}},E=wd(),I=Yv(),M=function(){throw new a},_=E?(function(){try{return arguments.callee,M}catch{try{return E(arguments,"callee").get}catch{return M}}})():M,F=Vv()(),C=Kv(),H=Id(),R=Td(),N=Ed(),Y=Yl(),D={},J=typeof Uint8Array>"u"||!C?i:C(Uint8Array),Q={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?i:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?i:ArrayBuffer,"%ArrayIteratorPrototype%":F&&C?C([][Symbol.iterator]()):i,"%AsyncFromSyncIteratorPrototype%":i,"%AsyncFunction%":D,"%AsyncGenerator%":D,"%AsyncGeneratorFunction%":D,"%AsyncIteratorPrototype%":D,"%Atomics%":typeof Atomics>"u"?i:Atomics,"%BigInt%":typeof BigInt>"u"?i:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?i:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?i:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?i:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?i:Float16Array,"%Float32Array%":typeof Float32Array>"u"?i:Float32Array,"%Float64Array%":typeof Float64Array>"u"?i:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?i:FinalizationRegistry,"%Function%":m,"%GeneratorFunction%":D,"%Int8Array%":typeof Int8Array>"u"?i:Int8Array,"%Int16Array%":typeof Int16Array>"u"?i:Int16Array,"%Int32Array%":typeof Int32Array>"u"?i:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":F&&C?C(C([][Symbol.iterator]())):i,"%JSON%":typeof JSON=="object"?JSON:i,"%Map%":typeof Map>"u"?i:Map,"%MapIteratorPrototype%":typeof Map>"u"||!F||!C?i:C(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":E,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?i:Promise,"%Proxy%":typeof Proxy>"u"?i:Proxy,"%RangeError%":n,"%ReferenceError%":s,"%Reflect%":typeof Reflect>"u"?i:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?i:Set,"%SetIteratorPrototype%":typeof Set>"u"||!F||!C?i:C(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?i:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":F&&C?C(""[Symbol.iterator]()):i,"%Symbol%":F?Symbol:i,"%SyntaxError%":o,"%ThrowTypeError%":_,"%TypedArray%":J,"%TypeError%":a,"%Uint8Array%":typeof Uint8Array>"u"?i:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?i:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?i:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?i:Uint32Array,"%URIError%":l,"%WeakMap%":typeof WeakMap>"u"?i:WeakMap,"%WeakRef%":typeof WeakRef>"u"?i:WeakRef,"%WeakSet%":typeof WeakSet>"u"?i:WeakSet,"%Function.prototype.call%":Y,"%Function.prototype.apply%":N,"%Object.defineProperty%":I,"%Object.getPrototypeOf%":H,"%Math.abs%":u,"%Math.floor%":h,"%Math.max%":c,"%Math.min%":f,"%Math.pow%":d,"%Math.round%":p,"%Math.sign%":v,"%Reflect.getPrototypeOf%":R};if(C)try{null.error}catch(W){var V=C(C(W));Q["%Error.prototype%"]=V}var A=function W(z){var Z;if(z==="%AsyncFunction%")Z=g("async function () {}");else if(z==="%GeneratorFunction%")Z=g("function* () {}");else if(z==="%AsyncGeneratorFunction%")Z=g("async function* () {}");else if(z==="%AsyncGenerator%"){var j=W("%AsyncGeneratorFunction%");j&&(Z=j.prototype)}else if(z==="%AsyncIteratorPrototype%"){var it=W("%AsyncGenerator%");it&&C&&(Z=C(it.prototype))}return Q[z]=Z,Z},O={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=Es(),b=Zv(),x=y.call(Y,Array.prototype.concat),T=y.call(N,Array.prototype.splice),S=y.call(Y,String.prototype.replace),P=y.call(Y,String.prototype.slice),L=y.call(Y,RegExp.prototype.exec),B=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,k=/\\(\\)?/g,U=function(z){var Z=P(z,0,1),j=P(z,-1);if(Z==="%"&&j!=="%")throw new o("invalid intrinsic syntax, expected closing `%`");if(j==="%"&&Z!=="%")throw new o("invalid intrinsic syntax, expected opening `%`");var it=[];return S(z,B,function(at,et,rt,wt){it[it.length]=rt?S(wt,k,"$1"):et||at}),it},q=function(z,Z){var j=z,it;if(b(O,j)&&(it=O[j],j="%"+it[0]+"%"),b(Q,j)){var at=Q[j];if(at===D&&(at=A(j)),typeof at>"u"&&!Z)throw new a("intrinsic "+z+" exists, but is not available. Please file an issue!");return{alias:it,name:j,value:at}}throw new o("intrinsic "+z+" does not exist!")};return Xo=function(z,Z){if(typeof z!="string"||z.length===0)throw new a("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof Z!="boolean")throw new a('"allowMissing" argument must be a boolean');if(L(/^%?[^%]*%?$/,z)===null)throw new o("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var j=U(z),it=j.length>0?j[0]:"",at=q("%"+it+"%",Z),et=at.name,rt=at.value,wt=!1,xt=at.alias;xt&&(it=xt[0],T(j,x([0,1],xt)));for(var At=1,Ke=!0;At<j.length;At+=1){var be=j[At],Xr=P(be,0,1),Hr=P(be,-1);if((Xr==='"'||Xr==="'"||Xr==="`"||Hr==='"'||Hr==="'"||Hr==="`")&&Xr!==Hr)throw new o("property names with quotes must have matching quotes");if((be==="constructor"||!Ke)&&(wt=!0),it+="."+be,et="%"+it+"%",b(Q,et))rt=Q[et];else if(rt!=null){if(!(be in rt)){if(!Z)throw new a("base intrinsic for "+z+" exists, but the property is not available.");return}if(E&&At+1>=j.length){var Gr=E(rt,be);Ke=!!Gr,Ke&&"get"in Gr&&!("originalValue"in Gr.get)?rt=Gr.get:rt=rt[be]}else Ke=b(rt,be),rt=rt[be];Ke&&!wt&&(Q[et]=rt)}}return rt},Xo}var Ho,Qh;function Ad(){if(Qh)return Ho;Qh=1;var i=zl(),e=Sd(),t=e([i("%String.prototype.indexOf%")]);return Ho=function(n,s){var o=i(n,!!s);return typeof o=="function"&&t(n,".prototype.")>-1?e([o]):o},Ho}var Go,tc;function Cd(){if(tc)return Go;tc=1;var i=zl(),e=Ad(),t=Is(),r=xi(),n=i("%Map%",!0),s=e("Map.prototype.get",!0),o=e("Map.prototype.set",!0),a=e("Map.prototype.has",!0),l=e("Map.prototype.delete",!0),u=e("Map.prototype.size",!0);return Go=!!n&&function(){var c,f={assert:function(d){if(!f.has(d))throw new r("Side channel does not contain "+t(d))},delete:function(d){if(c){var p=l(c,d);return u(c)===0&&(c=void 0),p}return!1},get:function(d){if(c)return s(c,d)},has:function(d){return c?a(c,d):!1},set:function(d,p){c||(c=new n),o(c,d,p)}};return f},Go}var Yo,ec;function Jv(){if(ec)return Yo;ec=1;var i=zl(),e=Ad(),t=Is(),r=Cd(),n=xi(),s=i("%WeakMap%",!0),o=e("WeakMap.prototype.get",!0),a=e("WeakMap.prototype.set",!0),l=e("WeakMap.prototype.has",!0),u=e("WeakMap.prototype.delete",!0);return Yo=s?function(){var c,f,d={assert:function(p){if(!d.has(p))throw new n("Side channel does not contain "+t(p))},delete:function(p){if(s&&p&&(typeof p=="object"||typeof p=="function")){if(c)return u(c,p)}else if(r&&f)return f.delete(p);return!1},get:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&c?o(c,p):f&&f.get(p)},has:function(p){return s&&p&&(typeof p=="object"||typeof p=="function")&&c?l(c,p):!!f&&f.has(p)},set:function(p,v){s&&p&&(typeof p=="object"||typeof p=="function")?(c||(c=new s),a(c,p,v)):r&&(f||(f=r()),f.set(p,v))}};return d}:r,Yo}var zo,rc;function Qv(){if(rc)return zo;rc=1;var i=xi(),e=Is(),t=Av(),r=Cd(),n=Jv(),s=n||r||t;return zo=function(){var a,l={assert:function(u){if(!l.has(u))throw new i("Side channel does not contain "+e(u))},delete:function(u){return!!a&&a.delete(u)},get:function(u){return a&&a.get(u)},has:function(u){return!!a&&a.has(u)},set:function(u,h){a||(a=s()),a.set(u,h)}};return l},zo}var Vo,ic;function Vl(){if(ic)return Vo;ic=1;var i=String.prototype.replace,e=/%20/g,t={RFC1738:"RFC1738",RFC3986:"RFC3986"};return Vo={default:t.RFC3986,formatters:{RFC1738:function(r){return i.call(r,e,"+")},RFC3986:function(r){return String(r)}},RFC1738:t.RFC1738,RFC3986:t.RFC3986},Vo}var qo,nc;function Pd(){if(nc)return qo;nc=1;var i=Vl(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r=(function(){for(var m=[],g=0;g<256;++g)m.push("%"+((g<16?"0":"")+g.toString(16)).toUpperCase());return m})(),n=function(g){for(;g.length>1;){var E=g.pop(),I=E.obj[E.prop];if(t(I)){for(var M=[],_=0;_<I.length;++_)typeof I[_]<"u"&&M.push(I[_]);E.obj[E.prop]=M}}},s=function(g,E){for(var I=E&&E.plainObjects?{__proto__:null}:{},M=0;M<g.length;++M)typeof g[M]<"u"&&(I[M]=g[M]);return I},o=function m(g,E,I){if(!E)return g;if(typeof E!="object"&&typeof E!="function"){if(t(g))g.push(E);else if(g&&typeof g=="object")(I&&(I.plainObjects||I.allowPrototypes)||!e.call(Object.prototype,E))&&(g[E]=!0);else return[g,E];return g}if(!g||typeof g!="object")return[g].concat(E);var M=g;return t(g)&&!t(E)&&(M=s(g,I)),t(g)&&t(E)?(E.forEach(function(_,F){if(e.call(g,F)){var C=g[F];C&&typeof C=="object"&&_&&typeof _=="object"?g[F]=m(C,_,I):g.push(_)}else g[F]=_}),g):Object.keys(E).reduce(function(_,F){var C=E[F];return e.call(_,F)?_[F]=m(_[F],C,I):_[F]=C,_},M)},a=function(g,E){return Object.keys(E).reduce(function(I,M){return I[M]=E[M],I},g)},l=function(m,g,E){var I=m.replace(/\+/g," ");if(E==="iso-8859-1")return I.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(I)}catch{return I}},u=1024,h=function(g,E,I,M,_){if(g.length===0)return g;var F=g;if(typeof g=="symbol"?F=Symbol.prototype.toString.call(g):typeof g!="string"&&(F=String(g)),I==="iso-8859-1")return escape(F).replace(/%u[0-9a-f]{4}/gi,function(J){return"%26%23"+parseInt(J.slice(2),16)+"%3B"});for(var C="",H=0;H<F.length;H+=u){for(var R=F.length>=u?F.slice(H,H+u):F,N=[],Y=0;Y<R.length;++Y){var D=R.charCodeAt(Y);if(D===45||D===46||D===95||D===126||D>=48&&D<=57||D>=65&&D<=90||D>=97&&D<=122||_===i.RFC1738&&(D===40||D===41)){N[N.length]=R.charAt(Y);continue}if(D<128){N[N.length]=r[D];continue}if(D<2048){N[N.length]=r[192|D>>6]+r[128|D&63];continue}if(D<55296||D>=57344){N[N.length]=r[224|D>>12]+r[128|D>>6&63]+r[128|D&63];continue}Y+=1,D=65536+((D&1023)<<10|R.charCodeAt(Y)&1023),N[N.length]=r[240|D>>18]+r[128|D>>12&63]+r[128|D>>6&63]+r[128|D&63]}C+=N.join("")}return C},c=function(g){for(var E=[{obj:{o:g},prop:"o"}],I=[],M=0;M<E.length;++M)for(var _=E[M],F=_.obj[_.prop],C=Object.keys(F),H=0;H<C.length;++H){var R=C[H],N=F[R];typeof N=="object"&&N!==null&&I.indexOf(N)===-1&&(E.push({obj:F,prop:R}),I.push(N))}return n(E),g},f=function(g){return Object.prototype.toString.call(g)==="[object RegExp]"},d=function(g){return!g||typeof g!="object"?!1:!!(g.constructor&&g.constructor.isBuffer&&g.constructor.isBuffer(g))},p=function(g,E){return[].concat(g,E)},v=function(g,E){if(t(g)){for(var I=[],M=0;M<g.length;M+=1)I.push(E(g[M]));return I}return E(g)};return qo={arrayToObject:s,assign:a,combine:p,compact:c,decode:l,encode:h,isBuffer:d,isRegExp:f,maybeMap:v,merge:o},qo}var $o,sc;function tg(){if(sc)return $o;sc=1;var i=Qv(),e=Pd(),t=Vl(),r=Object.prototype.hasOwnProperty,n={brackets:function(m){return m+"[]"},comma:"comma",indices:function(m,g){return m+"["+g+"]"},repeat:function(m){return m}},s=Array.isArray,o=Array.prototype.push,a=function(v,m){o.apply(v,s(m)?m:[m])},l=Date.prototype.toISOString,u=t.default,h={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,commaRoundTrip:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:e.encode,encodeValuesOnly:!1,filter:void 0,format:u,formatter:t.formatters[u],indices:!1,serializeDate:function(m){return l.call(m)},skipNulls:!1,strictNullHandling:!1},c=function(m){return typeof m=="string"||typeof m=="number"||typeof m=="boolean"||typeof m=="symbol"||typeof m=="bigint"},f={},d=function v(m,g,E,I,M,_,F,C,H,R,N,Y,D,J,Q,V,A,O){for(var y=m,b=O,x=0,T=!1;(b=b.get(f))!==void 0&&!T;){var S=b.get(m);if(x+=1,typeof S<"u"){if(S===x)throw new RangeError("Cyclic object value");T=!0}typeof b.get(f)>"u"&&(x=0)}if(typeof R=="function"?y=R(g,y):y instanceof Date?y=D(y):E==="comma"&&s(y)&&(y=e.maybeMap(y,function(et){return et instanceof Date?D(et):et})),y===null){if(_)return H&&!V?H(g,h.encoder,A,"key",J):g;y=""}if(c(y)||e.isBuffer(y)){if(H){var P=V?g:H(g,h.encoder,A,"key",J);return[Q(P)+"="+Q(H(y,h.encoder,A,"value",J))]}return[Q(g)+"="+Q(String(y))]}var L=[];if(typeof y>"u")return L;var B;if(E==="comma"&&s(y))V&&H&&(y=e.maybeMap(y,H)),B=[{value:y.length>0?y.join(",")||null:void 0}];else if(s(R))B=R;else{var k=Object.keys(y);B=N?k.sort(N):k}var U=C?String(g).replace(/\./g,"%2E"):String(g),q=I&&s(y)&&y.length===1?U+"[]":U;if(M&&s(y)&&y.length===0)return q+"[]";for(var W=0;W<B.length;++W){var z=B[W],Z=typeof z=="object"&&z&&typeof z.value<"u"?z.value:y[z];if(!(F&&Z===null)){var j=Y&&C?String(z).replace(/\./g,"%2E"):String(z),it=s(y)?typeof E=="function"?E(q,j):q:q+(Y?"."+j:"["+j+"]");O.set(m,x);var at=i();at.set(f,O),a(L,v(Z,it,E,I,M,_,F,C,E==="comma"&&V&&s(y)?null:H,R,N,Y,D,J,Q,V,A,at))}}return L},p=function(m){if(!m)return h;if(typeof m.allowEmptyArrays<"u"&&typeof m.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof m.encodeDotInKeys<"u"&&typeof m.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(m.encoder!==null&&typeof m.encoder<"u"&&typeof m.encoder!="function")throw new TypeError("Encoder has to be a function.");var g=m.charset||h.charset;if(typeof m.charset<"u"&&m.charset!=="utf-8"&&m.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var E=t.default;if(typeof m.format<"u"){if(!r.call(t.formatters,m.format))throw new TypeError("Unknown format option provided.");E=m.format}var I=t.formatters[E],M=h.filter;(typeof m.filter=="function"||s(m.filter))&&(M=m.filter);var _;if(m.arrayFormat in n?_=m.arrayFormat:"indices"in m?_=m.indices?"indices":"repeat":_=h.arrayFormat,"commaRoundTrip"in m&&typeof m.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var F=typeof m.allowDots>"u"?m.encodeDotInKeys===!0?!0:h.allowDots:!!m.allowDots;return{addQueryPrefix:typeof m.addQueryPrefix=="boolean"?m.addQueryPrefix:h.addQueryPrefix,allowDots:F,allowEmptyArrays:typeof m.allowEmptyArrays=="boolean"?!!m.allowEmptyArrays:h.allowEmptyArrays,arrayFormat:_,charset:g,charsetSentinel:typeof m.charsetSentinel=="boolean"?m.charsetSentinel:h.charsetSentinel,commaRoundTrip:!!m.commaRoundTrip,delimiter:typeof m.delimiter>"u"?h.delimiter:m.delimiter,encode:typeof m.encode=="boolean"?m.encode:h.encode,encodeDotInKeys:typeof m.encodeDotInKeys=="boolean"?m.encodeDotInKeys:h.encodeDotInKeys,encoder:typeof m.encoder=="function"?m.encoder:h.encoder,encodeValuesOnly:typeof m.encodeValuesOnly=="boolean"?m.encodeValuesOnly:h.encodeValuesOnly,filter:M,format:E,formatter:I,serializeDate:typeof m.serializeDate=="function"?m.serializeDate:h.serializeDate,skipNulls:typeof m.skipNulls=="boolean"?m.skipNulls:h.skipNulls,sort:typeof m.sort=="function"?m.sort:null,strictNullHandling:typeof m.strictNullHandling=="boolean"?m.strictNullHandling:h.strictNullHandling}};return $o=function(v,m){var g=v,E=p(m),I,M;typeof E.filter=="function"?(M=E.filter,g=M("",g)):s(E.filter)&&(M=E.filter,I=M);var _=[];if(typeof g!="object"||g===null)return"";var F=n[E.arrayFormat],C=F==="comma"&&E.commaRoundTrip;I||(I=Object.keys(g)),E.sort&&I.sort(E.sort);for(var H=i(),R=0;R<I.length;++R){var N=I[R],Y=g[N];E.skipNulls&&Y===null||a(_,d(Y,N,F,C,E.allowEmptyArrays,E.strictNullHandling,E.skipNulls,E.encodeDotInKeys,E.encode?E.encoder:null,E.filter,E.sort,E.allowDots,E.serializeDate,E.format,E.formatter,E.encodeValuesOnly,E.charset,H))}var D=_.join(E.delimiter),J=E.addQueryPrefix===!0?"?":"";return E.charsetSentinel&&(E.charset==="iso-8859-1"?J+="utf8=%26%2310003%3B&":J+="utf8=%E2%9C%93&"),D.length>0?J+D:""},$o}var jo,oc;function eg(){if(oc)return jo;oc=1;var i=Pd(),e=Object.prototype.hasOwnProperty,t=Array.isArray,r={allowDots:!1,allowEmptyArrays:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decodeDotInKeys:!1,decoder:i.decode,delimiter:"&",depth:5,duplicates:"combine",ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictDepth:!1,strictNullHandling:!1,throwOnLimitExceeded:!1},n=function(f){return f.replace(/&#(\d+);/g,function(d,p){return String.fromCharCode(parseInt(p,10))})},s=function(f,d,p){if(f&&typeof f=="string"&&d.comma&&f.indexOf(",")>-1)return f.split(",");if(d.throwOnLimitExceeded&&p>=d.arrayLimit)throw new RangeError("Array limit exceeded. Only "+d.arrayLimit+" element"+(d.arrayLimit===1?"":"s")+" allowed in an array.");return f},o="utf8=%26%2310003%3B",a="utf8=%E2%9C%93",l=function(d,p){var v={__proto__:null},m=p.ignoreQueryPrefix?d.replace(/^\?/,""):d;m=m.replace(/%5B/gi,"[").replace(/%5D/gi,"]");var g=p.parameterLimit===1/0?void 0:p.parameterLimit,E=m.split(p.delimiter,p.throwOnLimitExceeded?g+1:g);if(p.throwOnLimitExceeded&&E.length>g)throw new RangeError("Parameter limit exceeded. Only "+g+" parameter"+(g===1?"":"s")+" allowed.");var I=-1,M,_=p.charset;if(p.charsetSentinel)for(M=0;M<E.length;++M)E[M].indexOf("utf8=")===0&&(E[M]===a?_="utf-8":E[M]===o&&(_="iso-8859-1"),I=M,M=E.length);for(M=0;M<E.length;++M)if(M!==I){var F=E[M],C=F.indexOf("]="),H=C===-1?F.indexOf("="):C+1,R,N;H===-1?(R=p.decoder(F,r.decoder,_,"key"),N=p.strictNullHandling?null:""):(R=p.decoder(F.slice(0,H),r.decoder,_,"key"),N=i.maybeMap(s(F.slice(H+1),p,t(v[R])?v[R].length:0),function(D){return p.decoder(D,r.decoder,_,"value")})),N&&p.interpretNumericEntities&&_==="iso-8859-1"&&(N=n(String(N))),F.indexOf("[]=")>-1&&(N=t(N)?[N]:N);var Y=e.call(v,R);Y&&p.duplicates==="combine"?v[R]=i.combine(v[R],N):(!Y||p.duplicates==="last")&&(v[R]=N)}return v},u=function(f,d,p,v){var m=0;if(f.length>0&&f[f.length-1]==="[]"){var g=f.slice(0,-1).join("");m=Array.isArray(d)&&d[g]?d[g].length:0}for(var E=v?d:s(d,p,m),I=f.length-1;I>=0;--I){var M,_=f[I];if(_==="[]"&&p.parseArrays)M=p.allowEmptyArrays&&(E===""||p.strictNullHandling&&E===null)?[]:i.combine([],E);else{M=p.plainObjects?{__proto__:null}:{};var F=_.charAt(0)==="["&&_.charAt(_.length-1)==="]"?_.slice(1,-1):_,C=p.decodeDotInKeys?F.replace(/%2E/g,"."):F,H=parseInt(C,10);!p.parseArrays&&C===""?M={0:E}:!isNaN(H)&&_!==C&&String(H)===C&&H>=0&&p.parseArrays&&H<=p.arrayLimit?(M=[],M[H]=E):C!=="__proto__"&&(M[C]=E)}E=M}return E},h=function(d,p,v,m){if(d){var g=v.allowDots?d.replace(/\.([^.[]+)/g,"[$1]"):d,E=/(\[[^[\]]*])/,I=/(\[[^[\]]*])/g,M=v.depth>0&&E.exec(g),_=M?g.slice(0,M.index):g,F=[];if(_){if(!v.plainObjects&&e.call(Object.prototype,_)&&!v.allowPrototypes)return;F.push(_)}for(var C=0;v.depth>0&&(M=I.exec(g))!==null&&C<v.depth;){if(C+=1,!v.plainObjects&&e.call(Object.prototype,M[1].slice(1,-1))&&!v.allowPrototypes)return;F.push(M[1])}if(M){if(v.strictDepth===!0)throw new RangeError("Input depth exceeded depth option of "+v.depth+" and strictDepth is true");F.push("["+g.slice(M.index)+"]")}return u(F,p,v,m)}},c=function(d){if(!d)return r;if(typeof d.allowEmptyArrays<"u"&&typeof d.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof d.decodeDotInKeys<"u"&&typeof d.decodeDotInKeys!="boolean")throw new TypeError("`decodeDotInKeys` option can only be `true` or `false`, when provided");if(d.decoder!==null&&typeof d.decoder<"u"&&typeof d.decoder!="function")throw new TypeError("Decoder has to be a function.");if(typeof d.charset<"u"&&d.charset!=="utf-8"&&d.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");if(typeof d.throwOnLimitExceeded<"u"&&typeof d.throwOnLimitExceeded!="boolean")throw new TypeError("`throwOnLimitExceeded` option must be a boolean");var p=typeof d.charset>"u"?r.charset:d.charset,v=typeof d.duplicates>"u"?r.duplicates:d.duplicates;if(v!=="combine"&&v!=="first"&&v!=="last")throw new TypeError("The duplicates option must be either combine, first, or last");var m=typeof d.allowDots>"u"?d.decodeDotInKeys===!0?!0:r.allowDots:!!d.allowDots;return{allowDots:m,allowEmptyArrays:typeof d.allowEmptyArrays=="boolean"?!!d.allowEmptyArrays:r.allowEmptyArrays,allowPrototypes:typeof d.allowPrototypes=="boolean"?d.allowPrototypes:r.allowPrototypes,allowSparse:typeof d.allowSparse=="boolean"?d.allowSparse:r.allowSparse,arrayLimit:typeof d.arrayLimit=="number"?d.arrayLimit:r.arrayLimit,charset:p,charsetSentinel:typeof d.charsetSentinel=="boolean"?d.charsetSentinel:r.charsetSentinel,comma:typeof d.comma=="boolean"?d.comma:r.comma,decodeDotInKeys:typeof d.decodeDotInKeys=="boolean"?d.decodeDotInKeys:r.decodeDotInKeys,decoder:typeof d.decoder=="function"?d.decoder:r.decoder,delimiter:typeof d.delimiter=="string"||i.isRegExp(d.delimiter)?d.delimiter:r.delimiter,depth:typeof d.depth=="number"||d.depth===!1?+d.depth:r.depth,duplicates:v,ignoreQueryPrefix:d.ignoreQueryPrefix===!0,interpretNumericEntities:typeof d.interpretNumericEntities=="boolean"?d.interpretNumericEntities:r.interpretNumericEntities,parameterLimit:typeof d.parameterLimit=="number"?d.parameterLimit:r.parameterLimit,parseArrays:d.parseArrays!==!1,plainObjects:typeof d.plainObjects=="boolean"?d.plainObjects:r.plainObjects,strictDepth:typeof d.strictDepth=="boolean"?!!d.strictDepth:r.strictDepth,strictNullHandling:typeof d.strictNullHandling=="boolean"?d.strictNullHandling:r.strictNullHandling,throwOnLimitExceeded:typeof d.throwOnLimitExceeded=="boolean"?d.throwOnLimitExceeded:!1}};return jo=function(f,d){var p=c(d);if(f===""||f===null||typeof f>"u")return p.plainObjects?{__proto__:null}:{};for(var v=typeof f=="string"?l(f,p):f,m=p.plainObjects?{__proto__:null}:{},g=Object.keys(v),E=0;E<g.length;++E){var I=g[E],M=h(I,v[I],p,typeof f=="string");m=i.merge(m,M,p)}return p.allowSparse===!0?m:i.compact(m)},jo}var Wo,ac;function rg(){if(ac)return Wo;ac=1;var i=tg(),e=eg(),t=Vl();return Wo={formats:t,parse:e,stringify:i},Wo}var lc;function ig(){if(lc)return pr;lc=1;var i=Tv();function e(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var t=/^([a-z0-9.+-]+:)/i,r=/:[0-9]*$/,n=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,s=["<",">",'"',"`"," ","\r",`
`,"	"],o=["{","}","|","\\","^","`"].concat(s),a=["'"].concat(o),l=["%","/","?",";","#"].concat(a),u=["/","?","#"],h=255,c=/^[+a-z0-9A-Z_-]{0,63}$/,f=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,d={javascript:!0,"javascript:":!0},p={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},m=rg();function g(_,F,C){if(_&&typeof _=="object"&&_ instanceof e)return _;var H=new e;return H.parse(_,F,C),H}e.prototype.parse=function(_,F,C){if(typeof _!="string")throw new TypeError("Parameter 'url' must be a string, not "+typeof _);var H=_.indexOf("?"),R=H!==-1&&H<_.indexOf("#")?"?":"#",N=_.split(R),Y=/\\/g;N[0]=N[0].replace(Y,"/"),_=N.join(R);var D=_;if(D=D.trim(),!C&&_.split("#").length===1){var J=n.exec(D);if(J)return this.path=D,this.href=D,this.pathname=J[1],J[2]?(this.search=J[2],F?this.query=m.parse(this.search.substr(1)):this.query=this.search.substr(1)):F&&(this.search="",this.query={}),this}var Q=t.exec(D);if(Q){Q=Q[0];var V=Q.toLowerCase();this.protocol=V,D=D.substr(Q.length)}if(C||Q||D.match(/^\/\/[^@/]+@[^@/]+/)){var A=D.substr(0,2)==="//";A&&!(Q&&p[Q])&&(D=D.substr(2),this.slashes=!0)}if(!p[Q]&&(A||Q&&!v[Q])){for(var O=-1,y=0;y<u.length;y++){var b=D.indexOf(u[y]);b!==-1&&(O===-1||b<O)&&(O=b)}var x,T;O===-1?T=D.lastIndexOf("@"):T=D.lastIndexOf("@",O),T!==-1&&(x=D.slice(0,T),D=D.slice(T+1),this.auth=decodeURIComponent(x)),O=-1;for(var y=0;y<l.length;y++){var b=D.indexOf(l[y]);b!==-1&&(O===-1||b<O)&&(O=b)}O===-1&&(O=D.length),this.host=D.slice(0,O),D=D.slice(O),this.parseHost(),this.hostname=this.hostname||"";var S=this.hostname[0]==="["&&this.hostname[this.hostname.length-1]==="]";if(!S)for(var P=this.hostname.split(/\./),y=0,L=P.length;y<L;y++){var B=P[y];if(B&&!B.match(c)){for(var k="",U=0,q=B.length;U<q;U++)B.charCodeAt(U)>127?k+="x":k+=B[U];if(!k.match(c)){var W=P.slice(0,y),z=P.slice(y+1),Z=B.match(f);Z&&(W.push(Z[1]),z.unshift(Z[2])),z.length&&(D="/"+z.join(".")+D),this.hostname=W.join(".");break}}}this.hostname.length>h?this.hostname="":this.hostname=this.hostname.toLowerCase(),S||(this.hostname=i.toASCII(this.hostname));var j=this.port?":"+this.port:"",it=this.hostname||"";this.host=it+j,this.href+=this.host,S&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),D[0]!=="/"&&(D="/"+D))}if(!d[V])for(var y=0,L=a.length;y<L;y++){var at=a[y];if(D.indexOf(at)!==-1){var et=encodeURIComponent(at);et===at&&(et=escape(at)),D=D.split(at).join(et)}}var rt=D.indexOf("#");rt!==-1&&(this.hash=D.substr(rt),D=D.slice(0,rt));var wt=D.indexOf("?");if(wt!==-1?(this.search=D.substr(wt),this.query=D.substr(wt+1),F&&(this.query=m.parse(this.query)),D=D.slice(0,wt)):F&&(this.search="",this.query={}),D&&(this.pathname=D),v[V]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var j=this.pathname||"",xt=this.search||"";this.path=j+xt}return this.href=this.format(),this};function E(_){return typeof _=="string"&&(_=g(_)),_ instanceof e?_.format():e.prototype.format.call(_)}e.prototype.format=function(){var _=this.auth||"";_&&(_=encodeURIComponent(_),_=_.replace(/%3A/i,":"),_+="@");var F=this.protocol||"",C=this.pathname||"",H=this.hash||"",R=!1,N="";this.host?R=_+this.host:this.hostname&&(R=_+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(R+=":"+this.port)),this.query&&typeof this.query=="object"&&Object.keys(this.query).length&&(N=m.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var Y=this.search||N&&"?"+N||"";return F&&F.substr(-1)!==":"&&(F+=":"),this.slashes||(!F||v[F])&&R!==!1?(R="//"+(R||""),C&&C.charAt(0)!=="/"&&(C="/"+C)):R||(R=""),H&&H.charAt(0)!=="#"&&(H="#"+H),Y&&Y.charAt(0)!=="?"&&(Y="?"+Y),C=C.replace(/[?#]/g,function(D){return encodeURIComponent(D)}),Y=Y.replace("#","%23"),F+R+C+Y+H};function I(_,F){return g(_,!1,!0).resolve(F)}e.prototype.resolve=function(_){return this.resolveObject(g(_,!1,!0)).format()};function M(_,F){return _?g(_,!1,!0).resolveObject(F):F}return e.prototype.resolveObject=function(_){if(typeof _=="string"){var F=new e;F.parse(_,!1,!0),_=F}for(var C=new e,H=Object.keys(this),R=0;R<H.length;R++){var N=H[R];C[N]=this[N]}if(C.hash=_.hash,_.href==="")return C.href=C.format(),C;if(_.slashes&&!_.protocol){for(var Y=Object.keys(_),D=0;D<Y.length;D++){var J=Y[D];J!=="protocol"&&(C[J]=_[J])}return v[C.protocol]&&C.hostname&&!C.pathname&&(C.pathname="/",C.path=C.pathname),C.href=C.format(),C}if(_.protocol&&_.protocol!==C.protocol){if(!v[_.protocol]){for(var Q=Object.keys(_),V=0;V<Q.length;V++){var A=Q[V];C[A]=_[A]}return C.href=C.format(),C}if(C.protocol=_.protocol,!_.host&&!p[_.protocol]){for(var L=(_.pathname||"").split("/");L.length&&!(_.host=L.shift()););_.host||(_.host=""),_.hostname||(_.hostname=""),L[0]!==""&&L.unshift(""),L.length<2&&L.unshift(""),C.pathname=L.join("/")}else C.pathname=_.pathname;if(C.search=_.search,C.query=_.query,C.host=_.host||"",C.auth=_.auth,C.hostname=_.hostname||_.host,C.port=_.port,C.pathname||C.search){var O=C.pathname||"",y=C.search||"";C.path=O+y}return C.slashes=C.slashes||_.slashes,C.href=C.format(),C}var b=C.pathname&&C.pathname.charAt(0)==="/",x=_.host||_.pathname&&_.pathname.charAt(0)==="/",T=x||b||C.host&&_.pathname,S=T,P=C.pathname&&C.pathname.split("/")||[],L=_.pathname&&_.pathname.split("/")||[],B=C.protocol&&!v[C.protocol];if(B&&(C.hostname="",C.port=null,C.host&&(P[0]===""?P[0]=C.host:P.unshift(C.host)),C.host="",_.protocol&&(_.hostname=null,_.port=null,_.host&&(L[0]===""?L[0]=_.host:L.unshift(_.host)),_.host=null),T=T&&(L[0]===""||P[0]==="")),x)C.host=_.host||_.host===""?_.host:C.host,C.hostname=_.hostname||_.hostname===""?_.hostname:C.hostname,C.search=_.search,C.query=_.query,P=L;else if(L.length)P||(P=[]),P.pop(),P=P.concat(L),C.search=_.search,C.query=_.query;else if(_.search!=null){if(B){C.host=P.shift(),C.hostname=C.host;var k=C.host&&C.host.indexOf("@")>0?C.host.split("@"):!1;k&&(C.auth=k.shift(),C.hostname=k.shift(),C.host=C.hostname)}return C.search=_.search,C.query=_.query,(C.pathname!==null||C.search!==null)&&(C.path=(C.pathname?C.pathname:"")+(C.search?C.search:"")),C.href=C.format(),C}if(!P.length)return C.pathname=null,C.search?C.path="/"+C.search:C.path=null,C.href=C.format(),C;for(var U=P.slice(-1)[0],q=(C.host||_.host||P.length>1)&&(U==="."||U==="..")||U==="",W=0,z=P.length;z>=0;z--)U=P[z],U==="."?P.splice(z,1):U===".."?(P.splice(z,1),W++):W&&(P.splice(z,1),W--);if(!T&&!S)for(;W--;W)P.unshift("..");T&&P[0]!==""&&(!P[0]||P[0].charAt(0)!=="/")&&P.unshift(""),q&&P.join("/").substr(-1)!=="/"&&P.push("");var Z=P[0]===""||P[0]&&P[0].charAt(0)==="/";if(B){C.hostname=Z?"":P.length?P.shift():"",C.host=C.hostname;var k=C.host&&C.host.indexOf("@")>0?C.host.split("@"):!1;k&&(C.auth=k.shift(),C.hostname=k.shift(),C.host=C.hostname)}return T=T||C.host&&P.length,T&&!Z&&P.unshift(""),P.length>0?C.pathname=P.join("/"):(C.pathname=null,C.path=null),(C.pathname!==null||C.search!==null)&&(C.path=(C.pathname?C.pathname:"")+(C.search?C.search:"")),C.auth=_.auth||C.auth,C.slashes=C.slashes||_.slashes,C.href=C.format(),C},e.prototype.parseHost=function(){var _=this.host,F=r.exec(_);F&&(F=F[0],F!==":"&&(this.port=F.substr(1)),_=_.substr(0,_.length-F.length)),_&&(this.hostname=_)},pr.parse=g,pr.resolve=I,pr.resolveObject=M,pr.format=E,pr.Url=e,pr}var Od=ig();const Fd=bi(Od);/*!
 * @pixi/constants - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/constants is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Pe;(function(i){i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2"})(Pe||(Pe={}));var li;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS"})(li||(li={}));var Wi;(function(i){i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL"})(Wi||(Wi={}));var st;(function(i){i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR"})(st||(st={}));var ue;(function(i){i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(ue||(ue={}));var ui;(function(i){i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(ui||(ui={}));var ar;(function(i){i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(ar||(ar={}));var Nt;(function(i){i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.FLOAT=5126]="FLOAT",i[i.HALF_FLOAT=36193]="HALF_FLOAT"})(Nt||(Nt={}));var Te;(function(i){i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR"})(Te||(Te={}));var Ae;(function(i){i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(Ae||(Ae={}));var hi;(function(i){i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON"})(hi||(hi={}));var ze;(function(i){i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"})(ze||(ze={}));var xe;(function(i){i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT"})(xe||(xe={}));var ds;(function(i){i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL"})(ds||(ds={}));var Ie;(function(i){i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp"})(Ie||(Ie={}));var Jt;(function(i){i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE"})(Jt||(Jt={}));var Ar;(function(i){i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH"})(Ar||(Ar={}));/*!
 * @pixi/utils - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/utils is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */nt.RETINA_PREFIX=/@([0-9\.]+)x/;nt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var Ra=!1,uc="5.3.12";function ng(){Ra=!0}function Rd(i){var e;if(!Ra){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var t=[`
 %c %c %c PixiJS `+uc+" -  "+i+`   %c  %c  http://www.pixijs.com/  %c %c %c%c 

`,"background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];(e=window.console).log.apply(e,t)}else window.console&&window.console.log("PixiJS "+uc+" - "+i+" - http://www.pixijs.com/");Ra=!0}}var Ko;function Md(){return typeof Ko>"u"&&(Ko=(function(){var e={stencil:!0,failIfMajorPerformanceCaveat:nt.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var t=document.createElement("canvas"),r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),n=!!(r&&r.getContextAttributes().stencil);if(r){var s=r.getExtension("WEBGL_lose_context");s&&s.loseContext()}return r=null,n}catch{return!1}})()),Ko}function Cr(i,e){return e===void 0&&(e=[]),e[0]=(i>>16&255)/255,e[1]=(i>>8&255)/255,e[2]=(i&255)/255,e}function ql(i){var e=i.toString(16);return e="000000".substr(0,6-e.length)+e,"#"+e}function $l(i){return typeof i=="string"&&i[0]==="#"&&(i=i.substr(1)),parseInt(i,16)}function sg(i){return(i[0]*255<<16)+(i[1]*255<<8)+(i[2]*255|0)}function og(){for(var i=[],e=[],t=0;t<32;t++)i[t]=t,e[t]=t;i[st.NORMAL_NPM]=st.NORMAL,i[st.ADD_NPM]=st.ADD,i[st.SCREEN_NPM]=st.SCREEN,e[st.NORMAL]=st.NORMAL_NPM,e[st.ADD]=st.ADD_NPM,e[st.SCREEN]=st.SCREEN_NPM;var r=[];return r.push(e),r.push(i),r}var jl=og();function Wl(i,e){return jl[e?1:0][i]}function Ld(i,e,t,r){return t=t||new Float32Array(4),r||r===void 0?(t[0]=i[0]*e,t[1]=i[1]*e,t[2]=i[2]*e):(t[0]=i[0],t[1]=i[1],t[2]=i[2]),t[3]=e,t}function Ss(i,e){if(e===1)return(e*255<<24)+i;if(e===0)return 0;var t=i>>16&255,r=i>>8&255,n=i&255;return t=t*e+.5|0,r=r*e+.5|0,n=n*e+.5|0,(e*255<<24)+(t<<16)+(r<<8)+n}function Kl(i,e,t,r){return t=t||new Float32Array(4),t[0]=(i>>16&255)/255,t[1]=(i>>8&255)/255,t[2]=(i&255)/255,(r||r===void 0)&&(t[0]*=e,t[1]*=e,t[2]*=e),t[3]=e,t}function Zl(i,e){e===void 0&&(e=null);var t=i*6;if(e=e||new Uint16Array(t),e.length!==t)throw new Error("Out buffer length is incorrect, got "+e.length+" and expected "+t);for(var r=0,n=0;r<t;r+=6,n+=4)e[r+0]=n+0,e[r+1]=n+1,e[r+2]=n+2,e[r+3]=n+0,e[r+4]=n+2,e[r+5]=n+3;return e}function Nd(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}var ag={Float32Array,Uint32Array,Int32Array,Uint8Array};function lg(i,e){for(var t=0,r=0,n={},s=0;s<i.length;s++)r+=e[s],t+=i[s].length;for(var o=new ArrayBuffer(t*4),a=null,l=0,s=0;s<i.length;s++){var u=e[s],h=i[s],c=Nd(h);n[c]||(n[c]=new ag[c](o)),a=n[c];for(var f=0;f<h.length;f++){var d=(f/u|0)*r+l,p=f%u;a[d+p]=h[f]}l+=u}return new Float32Array(o)}function Ki(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Ma(i){return!(i&i-1)&&!!i}function La(i){var e=(i>65535?1:0)<<4;i>>>=e;var t=(i>255?1:0)<<3;return i>>>=t,e|=t,t=(i>15?1:0)<<2,i>>>=t,e|=t,t=(i>3?1:0)<<1,i>>>=t,e|=t,e|i>>1}function Sr(i,e,t){var r=i.length,n;if(!(e>=r||t===0)){t=e+t>r?r-e:t;var s=r-t;for(n=e;n<s;++n)i[n]=i[n+t];i.length=s}}function Ir(i){return i===0?0:i<0?-1:1}var ug=0;function Pr(){return++ug}var hc={};function K(i,e,t){if(t===void 0&&(t=3),!hc[e]){var r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+i):(r=r.split(`
`).splice(t).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",e+`
Deprecated since v`+i),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",e+`
Deprecated since v`+i),console.warn(r))),hc[e]=!0}}var Na={},Qt=Object.create(null),de=Object.create(null);function hg(){var i;for(i in Qt)Qt[i].destroy();for(i in de)de[i].destroy()}function cg(){var i;for(i in Qt)delete Qt[i];for(i in de)delete de[i]}var Ba=(function(){function i(e,t,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||nt.RESOLUTION,this.resize(e,t)}return i.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},i.prototype.resize=function(e,t){this.canvas.width=e*this.resolution,this.canvas.height=t*this.resolution},i.prototype.destroy=function(){this.context=null,this.canvas=null},Object.defineProperty(i.prototype,"width",{get:function(){return this.canvas.width},set:function(e){this.canvas.width=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this.canvas.height},set:function(e){this.canvas.height=e},enumerable:!1,configurable:!0}),i})();function Bd(i){var e=i.width,t=i.height,r=i.getContext("2d"),n=r.getImageData(0,0,e,t),s=n.data,o=s.length,a={top:null,left:null,right:null,bottom:null},l=null,u,h,c;for(u=0;u<o;u+=4)s[u+3]!==0&&(h=u/4%e,c=~~(u/4/e),a.top===null&&(a.top=c),(a.left===null||h<a.left)&&(a.left=h),(a.right===null||a.right<h)&&(a.right=h+1),(a.bottom===null||a.bottom<c)&&(a.bottom=c));return a.top!==null&&(e=a.right-a.left,t=a.bottom-a.top+1,l=r.getImageData(a.left,a.top,e,t)),{height:t,width:e,data:l}}var Dd=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function fg(i){var e=Dd.exec(i);if(e)return{mediaType:e[1]?e[1].toLowerCase():void 0,subType:e[2]?e[2].toLowerCase():void 0,charset:e[3]?e[3].toLowerCase():void 0,encoding:e[4]?e[4].toLowerCase():void 0,data:e[5]}}var wn;function kd(i,e){if(e===void 0&&(e=window.location),i.indexOf("data:")===0)return"";e=e||window.location,wn||(wn=document.createElement("a")),wn.href=i;var t=Od.parse(wn.href),r=!t.port&&e.port===""||t.port===e.port;return t.hostname!==e.hostname||!r||t.protocol!==e.protocol?"anonymous":""}function Zi(i,e){var t=nt.RETINA_PREFIX.exec(i);return t?parseFloat(t[1]):e!==void 0?e:1}const dg=Object.freeze(Object.defineProperty({__proto__:null,BaseTextureCache:de,CanvasRenderTarget:Ba,DATA_URI:Dd,EventEmitter:_i,ProgramCache:Na,TextureCache:Qt,clearTextureCache:cg,correctBlendMode:Wl,createIndicesForQuads:Zl,decomposeDataUri:fg,deprecation:K,destroyTextureCache:hg,determineCrossOrigin:kd,earcut:Gl,getBufferType:Nd,getResolutionOfUrl:Zi,hex2rgb:Cr,hex2string:ql,interleaveTypedArrays:lg,isMobile:ye,isPow2:Ma,isWebGLSupported:Md,log2:La,nextPow2:Ki,premultiplyBlendMode:jl,premultiplyRgba:Ld,premultiplyTint:Ss,premultiplyTintToRgba:Kl,removeItems:Sr,rgb2hex:sg,sayHello:Rd,sign:Ir,skipHello:ng,string2hex:$l,trimCanvas:Bd,uid:Pr,url:Fd},Symbol.toStringTag,{value:"Module"}));/*!
 * @pixi/math - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/math is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ci=Math.PI*2,Ud=180/Math.PI,Xd=Math.PI/180,Rt;(function(i){i[i.POLY=0]="POLY",i[i.RECT=1]="RECT",i[i.CIRC=2]="CIRC",i[i.ELIP=3]="ELIP",i[i.RREC=4]="RREC"})(Rt||(Rt={}));var vt=(function(){function i(e,t,r,n){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(n),this.type=Rt.RECT}return Object.defineProperty(i.prototype,"left",{get:function(){return this.x},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"right",{get:function(){return this.x+this.width},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"top",{get:function(){return this.y},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!1,configurable:!0}),Object.defineProperty(i,"EMPTY",{get:function(){return new i(0,0,0,0)},enumerable:!1,configurable:!0}),i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},i.prototype.copyTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},i.prototype.contains=function(e,t){return this.width<=0||this.height<=0?!1:e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height},i.prototype.pad=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),this.x-=e,this.y-=t,this.width+=e*2,this.height+=t*2,this},i.prototype.fit=function(e){var t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),s=Math.min(this.y+this.height,e.y+e.height);return this.x=t,this.width=Math.max(r-t,0),this.y=n,this.height=Math.max(s-n,0),this},i.prototype.ceil=function(e,t){e===void 0&&(e=1),t===void 0&&(t=.001);var r=Math.ceil((this.x+this.width-t)*e)/e,n=Math.ceil((this.y+this.height-t)*e)/e;return this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=n-this.y,this},i.prototype.enlarge=function(e){var t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),s=Math.max(this.y+this.height,e.y+e.height);return this.x=t,this.width=r-t,this.y=n,this.height=s-n,this},i})(),Hd=(function(){function i(e,t,r){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),this.x=e,this.y=t,this.radius=r,this.type=Rt.CIRC}return i.prototype.clone=function(){return new i(this.x,this.y,this.radius)},i.prototype.contains=function(e,t){if(this.radius<=0)return!1;var r=this.radius*this.radius,n=this.x-e,s=this.y-t;return n*=n,s*=s,n+s<=r},i.prototype.getBounds=function(){return new vt(this.x-this.radius,this.y-this.radius,this.radius*2,this.radius*2)},i})(),Gd=(function(){function i(e,t,r,n){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),n===void 0&&(n=0),this.x=e,this.y=t,this.width=r,this.height=n,this.type=Rt.ELIP}return i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height)},i.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var r=(e-this.x)/this.width,n=(t-this.y)/this.height;return r*=r,n*=n,r+n<=1},i.prototype.getBounds=function(){return new vt(this.x-this.width,this.y-this.height,this.width,this.height)},i})(),ii=(function(){function i(){for(var e=arguments,t=[],r=0;r<arguments.length;r++)t[r]=e[r];var n=Array.isArray(t[0])?t[0]:t;if(typeof n[0]!="number"){for(var s=[],o=0,a=n.length;o<a;o++)s.push(n[o].x,n[o].y);n=s}this.points=n,this.type=Rt.POLY,this.closeStroke=!0}return i.prototype.clone=function(){var e=this.points.slice(),t=new i(e);return t.closeStroke=this.closeStroke,t},i.prototype.contains=function(e,t){for(var r=!1,n=this.points.length/2,s=0,o=n-1;s<n;o=s++){var a=this.points[s*2],l=this.points[s*2+1],u=this.points[o*2],h=this.points[o*2+1],c=l>t!=h>t&&e<(u-a)*((t-l)/(h-l))+a;c&&(r=!r)}return r},i})(),Yd=(function(){function i(e,t,r,n,s){e===void 0&&(e=0),t===void 0&&(t=0),r===void 0&&(r=0),n===void 0&&(n=0),s===void 0&&(s=20),this.x=e,this.y=t,this.width=r,this.height=n,this.radius=s,this.type=Rt.RREC}return i.prototype.clone=function(){return new i(this.x,this.y,this.width,this.height,this.radius)},i.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){if(t>=this.y+this.radius&&t<=this.y+this.height-this.radius||e>=this.x+this.radius&&e<=this.x+this.width-this.radius)return!0;var r=e-(this.x+this.radius),n=t-(this.y+this.radius),s=this.radius*this.radius;if(r*r+n*n<=s||(r=e-(this.x+this.width-this.radius),r*r+n*n<=s)||(n=t-(this.y+this.height-this.radius),r*r+n*n<=s)||(r=e-(this.x+this.radius),r*r+n*n<=s))return!0}return!1},i})(),Ht=(function(){function i(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this.x=e,this.y=t}return i.prototype.clone=function(){return new i(this.x,this.y)},i.prototype.copyFrom=function(e){return this.set(e.x,e.y),this},i.prototype.copyTo=function(e){return e.set(this.x,this.y),e},i.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},i.prototype.set=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),this.x=e,this.y=t,this},i})(),Er=(function(){function i(e,t,r,n){r===void 0&&(r=0),n===void 0&&(n=0),this._x=r,this._y=n,this.cb=e,this.scope=t}return i.prototype.clone=function(e,t){return e===void 0&&(e=this.cb),t===void 0&&(t=this.scope),new i(e,t,this._x,this._y)},i.prototype.set=function(e,t){return e===void 0&&(e=0),t===void 0&&(t=e),(this._x!==e||this._y!==t)&&(this._x=e,this._y=t,this.cb.call(this.scope)),this},i.prototype.copyFrom=function(e){return(this._x!==e.x||this._y!==e.y)&&(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this},i.prototype.copyTo=function(e){return e.set(this._x,this._y),e},i.prototype.equals=function(e){return e.x===this._x&&e.y===this._y},Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))},enumerable:!1,configurable:!0}),i})(),Mt=(function(){function i(e,t,r,n,s,o){e===void 0&&(e=1),t===void 0&&(t=0),r===void 0&&(r=0),n===void 0&&(n=1),s===void 0&&(s=0),o===void 0&&(o=0),this.array=null,this.a=e,this.b=t,this.c=r,this.d=n,this.tx=s,this.ty=o}return i.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},i.prototype.set=function(e,t,r,n,s,o){return this.a=e,this.b=t,this.c=r,this.d=n,this.tx=s,this.ty=o,this},i.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));var r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},i.prototype.apply=function(e,t){t=t||new Ht;var r=e.x,n=e.y;return t.x=this.a*r+this.c*n+this.tx,t.y=this.b*r+this.d*n+this.ty,t},i.prototype.applyInverse=function(e,t){t=t||new Ht;var r=1/(this.a*this.d+this.c*-this.b),n=e.x,s=e.y;return t.x=this.d*r*n+-this.c*r*s+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*s+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,t},i.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},i.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},i.prototype.rotate=function(e){var t=Math.cos(e),r=Math.sin(e),n=this.a,s=this.c,o=this.tx;return this.a=n*t-this.b*r,this.b=n*r+this.b*t,this.c=s*t-this.d*r,this.d=s*r+this.d*t,this.tx=o*t-this.ty*r,this.ty=o*r+this.ty*t,this},i.prototype.append=function(e){var t=this.a,r=this.b,n=this.c,s=this.d;return this.a=e.a*t+e.b*n,this.b=e.a*r+e.b*s,this.c=e.c*t+e.d*n,this.d=e.c*r+e.d*s,this.tx=e.tx*t+e.ty*n+this.tx,this.ty=e.tx*r+e.ty*s+this.ty,this},i.prototype.setTransform=function(e,t,r,n,s,o,a,l,u){return this.a=Math.cos(a+u)*s,this.b=Math.sin(a+u)*s,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=e-(r*this.a+n*this.c),this.ty=t-(r*this.b+n*this.d),this},i.prototype.prepend=function(e){var t=this.tx;if(e.a!==1||e.b!==0||e.c!==0||e.d!==1){var r=this.a,n=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},i.prototype.decompose=function(e){var t=this.a,r=this.b,n=this.c,s=this.d,o=-Math.atan2(-n,s),a=Math.atan2(r,t),l=Math.abs(o+a);return l<1e-5||Math.abs(ci-l)<1e-5?(e.rotation=a,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=a),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(n*n+s*s),e.position.x=this.tx,e.position.y=this.ty,e},i.prototype.invert=function(){var e=this.a,t=this.b,r=this.c,n=this.d,s=this.tx,o=e*n-t*r;return this.a=n/o,this.b=-t/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-n*s)/o,this.ty=-(e*this.ty-t*s)/o,this},i.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},i.prototype.clone=function(){var e=new i;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},i.prototype.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},i.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},Object.defineProperty(i,"IDENTITY",{get:function(){return new i},enumerable:!1,configurable:!0}),Object.defineProperty(i,"TEMP_MATRIX",{get:function(){return new i},enumerable:!1,configurable:!0}),i})(),gr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],br=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],_r=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],xr=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Da=[],zd=[],Tn=Math.sign;function pg(){for(var i=0;i<16;i++){var e=[];Da.push(e);for(var t=0;t<16;t++)for(var r=Tn(gr[i]*gr[t]+_r[i]*br[t]),n=Tn(br[i]*gr[t]+xr[i]*br[t]),s=Tn(gr[i]*_r[t]+_r[i]*xr[t]),o=Tn(br[i]*_r[t]+xr[i]*xr[t]),a=0;a<16;a++)if(gr[a]===r&&br[a]===n&&_r[a]===s&&xr[a]===o){e.push(a);break}}for(var i=0;i<16;i++){var l=new Mt;l.set(gr[i],br[i],_r[i],xr[i],0,0),zd.push(l)}}pg();var Pt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(i){return gr[i]},uY:function(i){return br[i]},vX:function(i){return _r[i]},vY:function(i){return xr[i]},inv:function(i){return i&8?i&15:-i&7},add:function(i,e){return Da[i][e]},sub:function(i,e){return Da[i][Pt.inv(e)]},rotate180:function(i){return i^4},isVertical:function(i){return(i&3)===2},byDirection:function(i,e){return Math.abs(i)*2<=Math.abs(e)?e>=0?Pt.S:Pt.N:Math.abs(e)*2<=Math.abs(i)?i>0?Pt.E:Pt.W:e>0?i>0?Pt.SE:Pt.SW:i>0?Pt.NE:Pt.NW},matrixAppendRotationInv:function(i,e,t,r){t===void 0&&(t=0),r===void 0&&(r=0);var n=zd[Pt.inv(e)];n.tx=t,n.ty=r,i.append(n)}},Jl=(function(){function i(){this.worldTransform=new Mt,this.localTransform=new Mt,this.position=new Er(this.onChange,this,0,0),this.scale=new Er(this.onChange,this,1,1),this.pivot=new Er(this.onChange,this,0,0),this.skew=new Er(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}return i.prototype.onChange=function(){this._localID++},i.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++},i.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},i.prototype.updateTransform=function(e){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var r=e.worldTransform,n=this.worldTransform;n.a=t.a*r.a+t.b*r.c,n.b=t.a*r.b+t.b*r.d,n.c=t.c*r.a+t.d*r.c,n.d=t.c*r.b+t.d*r.d,n.tx=t.tx*r.a+t.ty*r.c+r.tx,n.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}},i.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},set:function(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())},enumerable:!1,configurable:!0}),i.IDENTITY=new i,i})();/*!
 * @pixi/display - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/display is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */nt.SORTABLE_CHILDREN=!1;var Ji=(function(){function i(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}return i.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},i.prototype.clear=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},i.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?vt.EMPTY:(e=e||new vt(0,0,1,1),e.x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},i.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},i.prototype.addQuad=function(e){var t=this.minX,r=this.minY,n=this.maxX,s=this.maxY,o=e[0],a=e[1];t=o<t?o:t,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=e[2],a=e[3],t=o<t?o:t,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=e[4],a=e[5],t=o<t?o:t,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,o=e[6],a=e[7],t=o<t?o:t,r=a<r?a:r,n=o>n?o:n,s=a>s?a:s,this.minX=t,this.minY=r,this.maxX=n,this.maxY=s},i.prototype.addFrame=function(e,t,r,n,s){this.addFrameMatrix(e.worldTransform,t,r,n,s)},i.prototype.addFrameMatrix=function(e,t,r,n,s){var o=e.a,a=e.b,l=e.c,u=e.d,h=e.tx,c=e.ty,f=this.minX,d=this.minY,p=this.maxX,v=this.maxY,m=o*t+l*r+h,g=a*t+u*r+c;f=m<f?m:f,d=g<d?g:d,p=m>p?m:p,v=g>v?g:v,m=o*n+l*r+h,g=a*n+u*r+c,f=m<f?m:f,d=g<d?g:d,p=m>p?m:p,v=g>v?g:v,m=o*t+l*s+h,g=a*t+u*s+c,f=m<f?m:f,d=g<d?g:d,p=m>p?m:p,v=g>v?g:v,m=o*n+l*s+h,g=a*n+u*s+c,f=m<f?m:f,d=g<d?g:d,p=m>p?m:p,v=g>v?g:v,this.minX=f,this.minY=d,this.maxX=p,this.maxY=v},i.prototype.addVertexData=function(e,t,r){for(var n=this.minX,s=this.minY,o=this.maxX,a=this.maxY,l=t;l<r;l+=2){var u=e[l],h=e[l+1];n=u<n?u:n,s=h<s?h:s,o=u>o?u:o,a=h>a?h:a}this.minX=n,this.minY=s,this.maxX=o,this.maxY=a},i.prototype.addVertices=function(e,t,r,n){this.addVerticesMatrix(e.worldTransform,t,r,n)},i.prototype.addVerticesMatrix=function(e,t,r,n,s,o){s===void 0&&(s=0),o===void 0&&(o=s);for(var a=e.a,l=e.b,u=e.c,h=e.d,c=e.tx,f=e.ty,d=this.minX,p=this.minY,v=this.maxX,m=this.maxY,g=r;g<n;g+=2){var E=t[g],I=t[g+1],M=a*E+u*I+c,_=h*I+l*E+f;d=Math.min(d,M-s),v=Math.max(v,M+s),p=Math.min(p,_-o),m=Math.max(m,_+o)}this.minX=d,this.minY=p,this.maxX=v,this.maxY=m},i.prototype.addBounds=function(e){var t=this.minX,r=this.minY,n=this.maxX,s=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>s?e.maxY:s},i.prototype.addBoundsMask=function(e,t){var r=e.minX>t.minX?e.minX:t.minX,n=e.minY>t.minY?e.minY:t.minY,s=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=s&&n<=o){var a=this.minX,l=this.minY,u=this.maxX,h=this.maxY;this.minX=r<a?r:a,this.minY=n<l?n:l,this.maxX=s>u?s:u,this.maxY=o>h?o:h}},i.prototype.addBoundsMatrix=function(e,t){this.addFrameMatrix(t,e.minX,e.minY,e.maxX,e.maxY)},i.prototype.addBoundsArea=function(e,t){var r=e.minX>t.x?e.minX:t.x,n=e.minY>t.y?e.minY:t.y,s=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=s&&n<=o){var a=this.minX,l=this.minY,u=this.maxX,h=this.maxY;this.minX=r<a?r:a,this.minY=n<l?n:l,this.maxX=s>u?s:u,this.maxY=o>h?o:h}},i.prototype.pad=function(e,t){e===void 0&&(e=0),t===void 0&&(t=e),this.isEmpty()||(this.minX-=e,this.maxX+=e,this.minY-=t,this.maxY+=t)},i.prototype.addFramePad=function(e,t,r,n,s,o){e-=s,t-=o,r+=s,n+=o,this.minX=this.minX<e?this.minX:e,this.maxX=this.maxX>r?this.maxX:r,this.minY=this.minY<t?this.minY:t,this.maxY=this.maxY>n?this.maxY:n},i})();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ka=function(i,e){return ka=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},ka(i,e)};function Ql(i,e){ka(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Dt=(function(i){Ql(e,i);function e(){var t=i.call(this)||this;return t.tempDisplayObjectParent=null,t.transform=new Jl,t.alpha=1,t.visible=!0,t.renderable=!0,t.parent=null,t.worldAlpha=1,t._lastSortedIndex=0,t._zIndex=0,t.filterArea=null,t.filters=null,t._enabledFilters=null,t._bounds=new Ji,t._localBounds=null,t._boundsID=0,t._boundsRect=null,t._localBoundsRect=null,t._mask=null,t._destroyed=!1,t.isSprite=!1,t.isMask=!1,t}return e.mixin=function(t){for(var r=Object.keys(t),n=0;n<r.length;++n){var s=r[n];Object.defineProperty(e.prototype,s,Object.getOwnPropertyDescriptor(t,s))}},e.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},e.prototype.updateTransform=function(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha},e.prototype.getBounds=function(t,r){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),r||(this._boundsRect||(this._boundsRect=new vt),r=this._boundsRect),this._bounds.getRectangle(r)},e.prototype.getLocalBounds=function(t){t||(this._localBoundsRect||(this._localBoundsRect=new vt),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Ji);var r=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;var s=this._bounds,o=this._boundsID;this._bounds=this._localBounds;var a=this.getBounds(!1,t);return this.parent=n,this.transform=r,this._bounds=s,this._bounds.updateID+=this._boundsID-o,a},e.prototype.toGlobal=function(t,r,n){return n===void 0&&(n=!1),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,r)},e.prototype.toLocal=function(t,r,n,s){return r&&(t=r.toGlobal(t,n,s)),s||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)},e.prototype.setParent=function(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t},e.prototype.setTransform=function(t,r,n,s,o,a,l,u,h){return t===void 0&&(t=0),r===void 0&&(r=0),n===void 0&&(n=1),s===void 0&&(s=1),o===void 0&&(o=0),a===void 0&&(a=0),l===void 0&&(l=0),u===void 0&&(u=0),h===void 0&&(h=0),this.position.x=t,this.position.y=r,this.scale.x=n||1,this.scale.y=s||1,this.rotation=o,this.skew.x=a,this.skew.y=l,this.pivot.x=u,this.pivot.y=h,this},e.prototype.destroy=function(t){this.parent&&this.parent.removeChild(this),this.removeAllListeners(),this.transform=null,this.parent=null,this._bounds=null,this._mask=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},Object.defineProperty(e.prototype,"_tempDisplayObjectParent",{get:function(){return this.tempDisplayObjectParent===null&&(this.tempDisplayObjectParent=new tu),this.tempDisplayObjectParent},enumerable:!1,configurable:!0}),e.prototype.enableTempParent=function(){var t=this.parent;return this.parent=this._tempDisplayObjectParent,t},e.prototype.disableTempParent=function(t){this.parent=t},Object.defineProperty(e.prototype,"x",{get:function(){return this.position.x},set:function(t){this.transform.position.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this.position.y},set:function(t){this.transform.position.y=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldTransform",{get:function(){return this.transform.worldTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localTransform",{get:function(){return this.transform.localTransform},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{get:function(){return this.transform.position},set:function(t){this.transform.position.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.transform.scale},set:function(t){this.transform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pivot",{get:function(){return this.transform.pivot},set:function(t){this.transform.pivot.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.transform.skew},set:function(t){this.transform.skew.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotation",{get:function(){return this.transform.rotation},set:function(t){this.transform.rotation=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.transform.rotation*Ud},set:function(t){this.transform.rotation=t*Xd},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zIndex",{get:function(){return this._zIndex},set:function(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldVisible",{get:function(){var t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mask",{get:function(){return this._mask},set:function(t){if(this._mask){var r=this._mask.maskObject||this._mask;r.renderable=!0,r.isMask=!1}if(this._mask=t,this._mask){var r=this._mask.maskObject||this._mask;r.renderable=!1,r.isMask=!0}},enumerable:!1,configurable:!0}),e})(_i),tu=(function(i){Ql(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t.sortDirty=null,t}return e})(Dt);Dt.prototype.displayObjectUpdateTransform=Dt.prototype.updateTransform;function yg(i,e){return i.zIndex===e.zIndex?i._lastSortedIndex-e._lastSortedIndex:i.zIndex-e.zIndex}var ee=(function(i){Ql(e,i);function e(){var t=i.call(this)||this;return t.children=[],t.sortableChildren=nt.SORTABLE_CHILDREN,t.sortDirty=!1,t}return e.prototype.onChildrenChange=function(t){},e.prototype.addChild=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];if(r.length>1)for(var s=0;s<r.length;s++)this.addChild(r[s]);else{var o=r[0];o.parent&&o.parent.removeChild(o),o.parent=this,this.sortDirty=!0,o.transform._parentID=-1,this.children.push(o),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",o,this,this.children.length-1),o.emit("added",this)}return r[0]},e.prototype.addChildAt=function(t,r){if(r<0||r>this.children.length)throw new Error(t+"addChildAt: The index "+r+" supplied is out of bounds "+this.children.length);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(r,0,t),this._boundsID++,this.onChildrenChange(r),t.emit("added",this),this.emit("childAdded",t,this,r),t},e.prototype.swapChildren=function(t,r){if(t!==r){var n=this.getChildIndex(t),s=this.getChildIndex(r);this.children[n]=r,this.children[s]=t,this.onChildrenChange(n<s?n:s)}},e.prototype.getChildIndex=function(t){var r=this.children.indexOf(t);if(r===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return r},e.prototype.setChildIndex=function(t,r){if(r<0||r>=this.children.length)throw new Error("The index "+r+" supplied is out of bounds "+this.children.length);var n=this.getChildIndex(t);Sr(this.children,n,1),this.children.splice(r,0,t),this.onChildrenChange(r)},e.prototype.getChildAt=function(t){if(t<0||t>=this.children.length)throw new Error("getChildAt: Index ("+t+") does not exist.");return this.children[t]},e.prototype.removeChild=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];if(r.length>1)for(var s=0;s<r.length;s++)this.removeChild(r[s]);else{var o=r[0],a=this.children.indexOf(o);if(a===-1)return null;o.parent=null,o.transform._parentID=-1,Sr(this.children,a,1),this._boundsID++,this.onChildrenChange(a),o.emit("removed",this),this.emit("childRemoved",o,this,a)}return r[0]},e.prototype.removeChildAt=function(t){var r=this.getChildAt(t);return r.parent=null,r.transform._parentID=-1,Sr(this.children,t,1),this._boundsID++,this.onChildrenChange(t),r.emit("removed",this),this.emit("childRemoved",r,this,t),r},e.prototype.removeChildren=function(t,r){t===void 0&&(t=0),r===void 0&&(r=this.children.length);var n=t,s=r,o=s-n,a;if(o>0&&o<=s){a=this.children.splice(n,o);for(var l=0;l<a.length;++l)a[l].parent=null,a[l].transform&&(a[l].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(var l=0;l<a.length;++l)a[l].emit("removed",this),this.emit("childRemoved",a[l],this,l);return a}else if(o===0&&this.children.length===0)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},e.prototype.sortChildren=function(){for(var t=!1,r=0,n=this.children.length;r<n;++r){var s=this.children[r];s._lastSortedIndex=r,!t&&s.zIndex!==0&&(t=!0)}t&&this.children.length>1&&this.children.sort(yg),this.sortDirty=!1},e.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var t=0,r=this.children.length;t<r;++t){var n=this.children[t];n.visible&&n.updateTransform()}},e.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var t=0;t<this.children.length;t++){var r=this.children[t];if(!(!r.visible||!r.renderable))if(r.calculateBounds(),r._mask){var n=r._mask.maskObject||r._mask;n.calculateBounds(),this._bounds.addBoundsMask(r._bounds,n._bounds)}else r.filterArea?this._bounds.addBoundsArea(r._bounds,r.filterArea):this._bounds.addBounds(r._bounds)}this._bounds.updateID=this._boundsID},e.prototype.getLocalBounds=function(t,r){r===void 0&&(r=!1);var n=i.prototype.getLocalBounds.call(this,t);if(!r)for(var s=0,o=this.children.length;s<o;++s){var a=this.children[s];a.visible&&a.updateTransform()}return n},e.prototype._calculateBounds=function(){},e.prototype.render=function(t){if(!(!this.visible||this.worldAlpha<=0||!this.renderable))if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(t);else{this._render(t);for(var r=0,n=this.children.length;r<n;++r)this.children[r].render(t)}},e.prototype.renderAdvanced=function(t){t.batch.flush();var r=this.filters,n=this._mask;if(r){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var s=0;s<r.length;s++)r[s].enabled&&this._enabledFilters.push(r[s]);this._enabledFilters.length&&t.filter.push(this,this._enabledFilters)}n&&t.mask.push(this,this._mask),this._render(t);for(var s=0,o=this.children.length;s<o;s++)this.children[s].render(t);t.batch.flush(),n&&t.mask.pop(this),r&&this._enabledFilters&&this._enabledFilters.length&&t.filter.pop()},e.prototype._render=function(t){},e.prototype.destroy=function(t){i.prototype.destroy.call(this),this.sortDirty=!1;var r=typeof t=="boolean"?t:t&&t.children,n=this.removeChildren(0,this.children.length);if(r)for(var s=0;s<n.length;++s)n[s].destroy(t)},Object.defineProperty(e.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(t){var r=this.getLocalBounds().width;r!==0?this.scale.x=t/r:this.scale.x=1,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(t){var r=this.getLocalBounds().height;r!==0?this.scale.y=t/r:this.scale.y=1,this._height=t},enumerable:!1,configurable:!0}),e})(Dt);ee.prototype.containerUpdateTransform=ee.prototype.updateTransform;/*!
 * @pixi/accessibility - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/accessibility is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Vd={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1};Dt.mixin(Vd);var mg=9,In=100,vg=0,gg=0,cc=2,fc=1,bg=-1e3,_g=-1e3,xg=2,qd=(function(){function i(e){this._hookDiv=null,(ye.tablet||ye.phone)&&this.createTouchHook();var t=document.createElement("div");t.style.width=In+"px",t.style.height=In+"px",t.style.position="absolute",t.style.top=vg+"px",t.style.left=gg+"px",t.style.zIndex=cc.toString(),this.div=t,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=e,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this._isActive=!1,this._isMobileAccessibility=!1,this.androidUpdateCount=0,this.androidUpdateFrequency=500,window.addEventListener("keydown",this._onKeyDown,!1)}return Object.defineProperty(i.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"isMobileAccessibility",{get:function(){return this._isMobileAccessibility},enumerable:!1,configurable:!0}),i.prototype.createTouchHook=function(){var e=this,t=document.createElement("button");t.style.width=fc+"px",t.style.height=fc+"px",t.style.position="absolute",t.style.top=bg+"px",t.style.left=_g+"px",t.style.zIndex=xg.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessability for this content",t.addEventListener("focus",function(){e._isMobileAccessibility=!0,e.activate(),e.destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t},i.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},i.prototype.activate=function(){this._isActive||(this._isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},i.prototype.deactivate=function(){!this._isActive||this._isMobileAccessibility||(this._isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},i.prototype.updateAccessibleObjects=function(e){if(!(!e.visible||!e.accessibleChildren)){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);for(var t=e.children,r=0;r<t.length;r++)this.updateAccessibleObjects(t[r])}},i.prototype.update=function(){var e=performance.now();if(!(ye.android.device&&e<this.androidUpdateCount)&&(this.androidUpdateCount=e+this.androidUpdateFrequency,!!this.renderer.renderingToScreen)){this.renderer._lastObjectRendered&&this.updateAccessibleObjects(this.renderer._lastObjectRendered);var t=this.renderer.view.getBoundingClientRect(),r=this.renderer.resolution,n=t.width/this.renderer.width*r,s=t.height/this.renderer.height*r,o=this.div;o.style.left=t.left+"px",o.style.top=t.top+"px",o.style.width=this.renderer.width+"px",o.style.height=this.renderer.height+"px";for(var a=0;a<this.children.length;a++){var l=this.children[a];if(l.renderId!==this.renderId)l._accessibleActive=!1,Sr(this.children,a,1),this.div.removeChild(l._accessibleDiv),this.pool.push(l._accessibleDiv),l._accessibleDiv=null,a--;else{o=l._accessibleDiv;var u=l.hitArea,h=l.worldTransform;l.hitArea?(o.style.left=(h.tx+u.x*h.a)*n+"px",o.style.top=(h.ty+u.y*h.d)*s+"px",o.style.width=u.width*h.a*n+"px",o.style.height=u.height*h.d*s+"px"):(u=l.getBounds(),this.capHitArea(u),o.style.left=u.x*n+"px",o.style.top=u.y*s+"px",o.style.width=u.width*n+"px",o.style.height=u.height*s+"px",o.title!==l.accessibleTitle&&l.accessibleTitle!==null&&(o.title=l.accessibleTitle),o.getAttribute("aria-label")!==l.accessibleHint&&l.accessibleHint!==null&&o.setAttribute("aria-label",l.accessibleHint)),(l.accessibleTitle!==o.title||l.tabIndex!==o.tabIndex)&&(o.title=l.accessibleTitle,o.tabIndex=l.tabIndex,this.debug&&this.updateDebugHTML(o))}}this.renderId++}},i.prototype.updateDebugHTML=function(e){e.innerHTML="type: "+e.type+"</br> title : "+e.title+"</br> tabIndex: "+e.tabIndex},i.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.renderer.width&&(e.width=this.renderer.width-e.x),e.y+e.height>this.renderer.height&&(e.height=this.renderer.height-e.y)},i.prototype.addChild=function(e){var t=this.pool.pop();t||(t=document.createElement("button"),t.style.width=In+"px",t.style.height=In+"px",t.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=cc.toString(),t.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),t.style.pointerEvents=e.accessiblePointerEvents,t.type=e.accessibleType,e.accessibleTitle&&e.accessibleTitle!==null?t.title=e.accessibleTitle:(!e.accessibleHint||e.accessibleHint===null)&&(t.title="displayObject "+e.tabIndex),e.accessibleHint&&e.accessibleHint!==null&&t.setAttribute("aria-label",e.accessibleHint),this.debug&&this.updateDebugHTML(t),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},i.prototype._onClick=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"click",t.eventData),t.dispatchEvent(e.target.displayObject,"pointertap",t.eventData),t.dispatchEvent(e.target.displayObject,"tap",t.eventData)},i.prototype._onFocus=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","assertive");var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseover",t.eventData)},i.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live")||e.target.setAttribute("aria-live","polite");var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseout",t.eventData)},i.prototype._onKeyDown=function(e){e.keyCode===mg&&this.activate()},i.prototype._onMouseMove=function(e){e.movementX===0&&e.movementY===0||this.deactivate()},i.prototype.destroy=function(){this.destroyTouchHook(),this.div=null,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},i})();/*!
 * @pixi/ticker - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/ticker is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */nt.TARGET_FPMS=.06;var Oe;(function(i){i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY"})(Oe||(Oe={}));var Zo=(function(){function i(e,t,r,n){t===void 0&&(t=null),r===void 0&&(r=0),n===void 0&&(n=!1),this.fn=e,this.context=t,this.priority=r,this.once=n,this.next=null,this.previous=null,this._destroyed=!1}return i.prototype.match=function(e,t){return t===void 0&&(t=null),this.fn===e&&this.context===t},i.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));var t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t},i.prototype.connect=function(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this},i.prototype.destroy=function(e){e===void 0&&(e=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var t=this.next;return this.next=e?null:t,this.previous=null,t},i})(),Xt=(function(){function i(){var e=this;this._head=new Zo(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/nt.TARGET_FPMS,this.elapsedMS=1/nt.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&e._requestId===null&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}}return i.prototype._requestIfNeeded=function(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},i.prototype._cancelIfNeeded=function(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)},i.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},i.prototype.add=function(e,t,r){return r===void 0&&(r=Oe.NORMAL),this._addListener(new Zo(e,t,r))},i.prototype.addOnce=function(e,t,r){return r===void 0&&(r=Oe.NORMAL),this._addListener(new Zo(e,t,r,!0))},i.prototype._addListener=function(e){var t=this._head.next,r=this._head;if(!t)e.connect(r);else{for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}return this._startIfPossible(),this},i.prototype.remove=function(e,t){for(var r=this._head.next;r;)r.match(e,t)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this},Object.defineProperty(i.prototype,"count",{get:function(){if(!this._head)return 0;for(var e=0,t=this._head;t=t.next;)e++;return e},enumerable:!1,configurable:!0}),i.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},i.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},i.prototype.destroy=function(){if(!this._protected){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}},i.prototype.update=function(e){e===void 0&&(e=performance.now());var t;if(e>this.lastTime){if(t=this.elapsedMS=e-this.lastTime,t>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){var r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*nt.TARGET_FPMS;for(var n=this._head,s=n.next;s;)s=s.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e},Object.defineProperty(i.prototype,"FPS",{get:function(){return 1e3/this.elapsedMS},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"minFPS",{get:function(){return 1e3/this._maxElapsedMS},set:function(e){var t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,nt.TARGET_FPMS);this._maxElapsedMS=1/r},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"maxFPS",{get:function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},set:function(e){if(e===0)this._minElapsedMS=0;else{var t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}},enumerable:!1,configurable:!0}),Object.defineProperty(i,"shared",{get:function(){if(!i._shared){var e=i._shared=new i;e.autoStart=!0,e._protected=!0}return i._shared},enumerable:!1,configurable:!0}),Object.defineProperty(i,"system",{get:function(){if(!i._system){var e=i._system=new i;e.autoStart=!0,e._protected=!0}return i._system},enumerable:!1,configurable:!0}),i})(),$d=(function(){function i(){}return i.init=function(e){var t=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(r){this._ticker&&this._ticker.remove(this.render,this),this._ticker=r,r&&r.add(this.render,this,Oe.LOW)},get:function(){return this._ticker}}),this.stop=function(){t._ticker.stop()},this.start=function(){t._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?Xt.shared:new Xt,e.autoStart&&this.start()},i.destroy=function(){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}},i})();/*!
 * @pixi/interaction - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/interaction is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Ua=(function(){function i(){this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0,this.global=new Ht,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0}return Object.defineProperty(i.prototype,"pointerId",{get:function(){return this.identifier},enumerable:!1,configurable:!0}),i.prototype.getLocalPosition=function(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)},i.prototype.copyEvent=function(e){"isPrimary"in e&&e.isPrimary&&(this.isPrimary=!0),this.button="button"in e&&e.button;var t="buttons"in e&&e.buttons;this.buttons=Number.isInteger(t)?t:"which"in e&&e.which,this.width="width"in e&&e.width,this.height="height"in e&&e.height,this.tiltX="tiltX"in e&&e.tiltX,this.tiltY="tiltY"in e&&e.tiltY,this.pointerType="pointerType"in e&&e.pointerType,this.pressure="pressure"in e&&e.pressure,this.rotationAngle="rotationAngle"in e&&e.rotationAngle,this.twist="twist"in e&&e.twist||0,this.tangentialPressure="tangentialPressure"in e&&e.tangentialPressure||0},i.prototype.reset=function(){this.isPrimary=!1},i})();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Xa=function(i,e){return Xa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},Xa(i,e)};function wg(i,e){Xa(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var jd=(function(){function i(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null}return i.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},i.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null},i})(),Zn=(function(){function i(e){this._pointerId=e,this._flags=i.FLAGS.NONE}return i.prototype._doSet=function(e,t){t?this._flags=this._flags|e:this._flags=this._flags&~e},Object.defineProperty(i.prototype,"pointerId",{get:function(){return this._pointerId},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"flags",{get:function(){return this._flags},set:function(e){this._flags=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"none",{get:function(){return this._flags===i.FLAGS.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"over",{get:function(){return(this._flags&i.FLAGS.OVER)!==0},set:function(e){this._doSet(i.FLAGS.OVER,e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rightDown",{get:function(){return(this._flags&i.FLAGS.RIGHT_DOWN)!==0},set:function(e){this._doSet(i.FLAGS.RIGHT_DOWN,e)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leftDown",{get:function(){return(this._flags&i.FLAGS.LEFT_DOWN)!==0},set:function(e){this._doSet(i.FLAGS.LEFT_DOWN,e)},enumerable:!1,configurable:!0}),i.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4}),i})(),Tg=(function(){function i(){this._tempPoint=new Ht}return i.prototype.recursiveFindHit=function(e,t,r,n,s){if(!t||!t.visible)return!1;var o=e.data.global;s=t.interactive||s;var a=!1,l=s,u=!0;if(t.hitArea?(n&&(t.worldTransform.applyInverse(o,this._tempPoint),t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(n=!1,u=!1)),l=!1):t._mask&&n&&(t._mask.containsPoint&&t._mask.containsPoint(o)||(n=!1)),u&&t.interactiveChildren&&t.children)for(var h=t.children,c=h.length-1;c>=0;c--){var f=h[c],d=this.recursiveFindHit(e,f,r,n,l);if(d){if(!f.parent)continue;l=!1,d&&(e.target&&(n=!1),a=!0)}}return s&&(n&&!e.target&&!t.hitArea&&t.containsPoint&&t.containsPoint(o)&&(a=!0),t.interactive&&(a&&!e.target&&(e.target=t),r&&r(e,t,!!a))),a},i.prototype.findHit=function(e,t,r,n){this.recursiveFindHit(e,t,r,n,!1)},i})(),Wd={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return this.cursor==="pointer"},set buttonMode(i){i?this.cursor="pointer":this.cursor==="pointer"&&(this.cursor=null)},cursor:null,get trackedPointers(){return this._trackedPointers===void 0&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};Dt.mixin(Wd);var En=1,Sn={target:null,data:{global:null}},Kd=(function(i){wg(e,i);function e(t,r){var n=i.call(this)||this;return r=r||{},n.renderer=t,n.autoPreventDefault=r.autoPreventDefault!==void 0?r.autoPreventDefault:!0,n.interactionFrequency=r.interactionFrequency||10,n.mouse=new Ua,n.mouse.identifier=En,n.mouse.global.set(-999999),n.activeInteractionData={},n.activeInteractionData[En]=n.mouse,n.interactionDataPool=[],n.eventData=new jd,n.interactionDOMElement=null,n.moveWhenInside=!1,n.eventsAdded=!1,n.tickerAdded=!1,n.mouseOverRenderer=!1,n.supportsTouchEvents="ontouchstart"in window,n.supportsPointerEvents=!!window.PointerEvent,n.onPointerUp=n.onPointerUp.bind(n),n.processPointerUp=n.processPointerUp.bind(n),n.onPointerCancel=n.onPointerCancel.bind(n),n.processPointerCancel=n.processPointerCancel.bind(n),n.onPointerDown=n.onPointerDown.bind(n),n.processPointerDown=n.processPointerDown.bind(n),n.onPointerMove=n.onPointerMove.bind(n),n.processPointerMove=n.processPointerMove.bind(n),n.onPointerOut=n.onPointerOut.bind(n),n.processPointerOverOut=n.processPointerOverOut.bind(n),n.onPointerOver=n.onPointerOver.bind(n),n.cursorStyles={default:"inherit",pointer:"pointer"},n.currentCursorMode=null,n.cursor=null,n.resolution=1,n.delayedEvents=[],n.search=new Tg,n._tempDisplayObject=new tu,n._useSystemTicker=r.useSystemTicker!==void 0?r.useSystemTicker:!0,n.setTargetElement(n.renderer.view,n.renderer.resolution),n}return Object.defineProperty(e.prototype,"useSystemTicker",{get:function(){return this._useSystemTicker},set:function(t){this._useSystemTicker=t,t?this.addTickerListener():this.removeTickerListener()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastObjectRendered",{get:function(){return this.renderer._lastObjectRendered||this._tempDisplayObject},enumerable:!1,configurable:!0}),e.prototype.hitTest=function(t,r){return Sn.target=null,Sn.data.global=t,r||(r=this.lastObjectRendered),this.processInteractive(Sn,r,null,!0),Sn.target},e.prototype.setTargetElement=function(t,r){r===void 0&&(r=1),this.removeTickerListener(),this.removeEvents(),this.interactionDOMElement=t,this.resolution=r,this.addEvents(),this.addTickerListener()},e.prototype.addTickerListener=function(){this.tickerAdded||!this.interactionDOMElement||!this._useSystemTicker||(Xt.system.add(this.tickerUpdate,this,Oe.INTERACTION),this.tickerAdded=!0)},e.prototype.removeTickerListener=function(){this.tickerAdded&&(Xt.system.remove(this.tickerUpdate,this),this.tickerAdded=!1)},e.prototype.addEvents=function(){if(!(this.eventsAdded||!this.interactionDOMElement)){var t=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0}},e.prototype.removeEvents=function(){if(!(!this.eventsAdded||!this.interactionDOMElement)){var t=this.interactionDOMElement.style;window.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1}},e.prototype.tickerUpdate=function(t){this._deltaTime+=t,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.update())},e.prototype.update=function(){if(this.interactionDOMElement){if(this._didMove){this._didMove=!1;return}this.cursor=null;for(var t in this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var r=this.activeInteractionData[t];if(r.originalEvent&&r.pointerType!=="touch"){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},e.prototype.setCursorMode=function(t){if(t=t||"default",this.currentCursorMode!==t){this.currentCursorMode=t;var r=this.cursorStyles[t];if(r)switch(typeof r){case"string":this.interactionDOMElement.style.cursor=r;break;case"function":r(t);break;case"object":Object.assign(this.interactionDOMElement.style,r);break}else typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.interactionDOMElement.style.cursor=t)}},e.prototype.dispatchEvent=function(t,r,n){(!n.stopPropagationHint||t===n.stopsPropagatingAt)&&(n.currentTarget=t,n.type=r,t.emit(r,n),t[r]&&t[r](n))},e.prototype.delayDispatchEvent=function(t,r,n){this.delayedEvents.push({displayObject:t,eventString:r,eventData:n})},e.prototype.mapPositionToPoint=function(t,r,n){var s;this.interactionDOMElement.parentElement?s=this.interactionDOMElement.getBoundingClientRect():s={x:0,y:0,width:0,height:0};var o=1/this.resolution;t.x=(r-s.left)*(this.interactionDOMElement.width/s.width)*o,t.y=(n-s.top)*(this.interactionDOMElement.height/s.height)*o},e.prototype.processInteractive=function(t,r,n,s){var o=this.search.findHit(t,r,n,s),a=this.delayedEvents;if(!a.length)return o;t.stopPropagationHint=!1;var l=a.length;this.delayedEvents=[];for(var u=0;u<l;u++){var h=a[u],c=h.displayObject,f=h.eventString,d=h.eventData;d.stopsPropagatingAt===c&&(d.stopPropagationHint=!0),this.dispatchEvent(c,f,d)}return o},e.prototype.onPointerDown=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t);if(this.autoPreventDefault&&r[0].isNormalized){var n=t.cancelable||!("cancelable"in t);n&&t.preventDefault()}for(var s=r.length,o=0;o<s;o++){var a=r[o],l=this.getInteractionDataForPointerId(a),u=this.configureInteractionEventForDOMEvent(this.eventData,a,l);if(u.data.originalEvent=t,this.processInteractive(u,this.lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",u),a.pointerType==="touch")this.emit("touchstart",u);else if(a.pointerType==="mouse"||a.pointerType==="pen"){var h=a.button===2;this.emit(h?"rightdown":"mousedown",this.eventData)}}}},e.prototype.processPointerDown=function(t,r,n){var s=t.data,o=t.data.identifier;if(n){if(r.trackedPointers[o]||(r.trackedPointers[o]=new Zn(o)),this.dispatchEvent(r,"pointerdown",t),s.pointerType==="touch")this.dispatchEvent(r,"touchstart",t);else if(s.pointerType==="mouse"||s.pointerType==="pen"){var a=s.button===2;a?r.trackedPointers[o].rightDown=!0:r.trackedPointers[o].leftDown=!0,this.dispatchEvent(r,a?"rightdown":"mousedown",t)}}},e.prototype.onPointerComplete=function(t,r,n){for(var s=this.normalizeToPointerData(t),o=s.length,a=t.target!==this.interactionDOMElement?"outside":"",l=0;l<o;l++){var u=s[l],h=this.getInteractionDataForPointerId(u),c=this.configureInteractionEventForDOMEvent(this.eventData,u,h);if(c.data.originalEvent=t,this.processInteractive(c,this.lastObjectRendered,n,r||!a),this.emit(r?"pointercancel":"pointerup"+a,c),u.pointerType==="mouse"||u.pointerType==="pen"){var f=u.button===2;this.emit(f?"rightup"+a:"mouseup"+a,c)}else u.pointerType==="touch"&&(this.emit(r?"touchcancel":"touchend"+a,c),this.releaseInteractionDataForPointerId(u.pointerId))}},e.prototype.onPointerCancel=function(t){this.supportsTouchEvents&&t.pointerType==="touch"||this.onPointerComplete(t,!0,this.processPointerCancel)},e.prototype.processPointerCancel=function(t,r){var n=t.data,s=t.data.identifier;r.trackedPointers[s]!==void 0&&(delete r.trackedPointers[s],this.dispatchEvent(r,"pointercancel",t),n.pointerType==="touch"&&this.dispatchEvent(r,"touchcancel",t))},e.prototype.onPointerUp=function(t){this.supportsTouchEvents&&t.pointerType==="touch"||this.onPointerComplete(t,!1,this.processPointerUp)},e.prototype.processPointerUp=function(t,r,n){var s=t.data,o=t.data.identifier,a=r.trackedPointers[o],l=s.pointerType==="touch",u=s.pointerType==="mouse"||s.pointerType==="pen",h=!1;if(u){var c=s.button===2,f=Zn.FLAGS,d=c?f.RIGHT_DOWN:f.LEFT_DOWN,p=a!==void 0&&a.flags&d;n?(this.dispatchEvent(r,c?"rightup":"mouseup",t),p&&(this.dispatchEvent(r,c?"rightclick":"click",t),h=!0)):p&&this.dispatchEvent(r,c?"rightupoutside":"mouseupoutside",t),a&&(c?a.rightDown=!1:a.leftDown=!1)}n?(this.dispatchEvent(r,"pointerup",t),l&&this.dispatchEvent(r,"touchend",t),a&&((!u||h)&&this.dispatchEvent(r,"pointertap",t),l&&(this.dispatchEvent(r,"tap",t),a.over=!1))):a&&(this.dispatchEvent(r,"pointerupoutside",t),l&&this.dispatchEvent(r,"touchendoutside",t)),a&&a.none&&delete r.trackedPointers[o]},e.prototype.onPointerMove=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t);(r[0].pointerType==="mouse"||r[0].pointerType==="pen")&&(this._didMove=!0,this.cursor=null);for(var n=r.length,s=0;s<n;s++){var o=r[s],a=this.getInteractionDataForPointerId(o),l=this.configureInteractionEventForDOMEvent(this.eventData,o,a);l.data.originalEvent=t,this.processInteractive(l,this.lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",l),o.pointerType==="touch"&&this.emit("touchmove",l),(o.pointerType==="mouse"||o.pointerType==="pen")&&this.emit("mousemove",l)}r[0].pointerType==="mouse"&&this.setCursorMode(this.cursor)}},e.prototype.processPointerMove=function(t,r,n){var s=t.data,o=s.pointerType==="touch",a=s.pointerType==="mouse"||s.pointerType==="pen";a&&this.processPointerOverOut(t,r,n),(!this.moveWhenInside||n)&&(this.dispatchEvent(r,"pointermove",t),o&&this.dispatchEvent(r,"touchmove",t),a&&this.dispatchEvent(r,"mousemove",t))},e.prototype.onPointerOut=function(t){if(!(this.supportsTouchEvents&&t.pointerType==="touch")){var r=this.normalizeToPointerData(t),n=r[0];n.pointerType==="mouse"&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,this.processInteractive(o,this.lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",o),n.pointerType==="mouse"||n.pointerType==="pen"?this.emit("mouseout",o):this.releaseInteractionDataForPointerId(s.identifier)}},e.prototype.processPointerOverOut=function(t,r,n){var s=t.data,o=t.data.identifier,a=s.pointerType==="mouse"||s.pointerType==="pen",l=r.trackedPointers[o];n&&!l&&(l=r.trackedPointers[o]=new Zn(o)),l!==void 0&&(n&&this.mouseOverRenderer?(l.over||(l.over=!0,this.delayDispatchEvent(r,"pointerover",t),a&&this.delayDispatchEvent(r,"mouseover",t)),a&&this.cursor===null&&(this.cursor=r.cursor)):l.over&&(l.over=!1,this.dispatchEvent(r,"pointerout",this.eventData),a&&this.dispatchEvent(r,"mouseout",t),l.none&&delete r.trackedPointers[o]))},e.prototype.onPointerOver=function(t){var r=this.normalizeToPointerData(t),n=r[0],s=this.getInteractionDataForPointerId(n),o=this.configureInteractionEventForDOMEvent(this.eventData,n,s);o.data.originalEvent=n,n.pointerType==="mouse"&&(this.mouseOverRenderer=!0),this.emit("pointerover",o),(n.pointerType==="mouse"||n.pointerType==="pen")&&this.emit("mouseover",o)},e.prototype.getInteractionDataForPointerId=function(t){var r=t.pointerId,n;return r===En||t.pointerType==="mouse"?n=this.mouse:this.activeInteractionData[r]?n=this.activeInteractionData[r]:(n=this.interactionDataPool.pop()||new Ua,n.identifier=r,this.activeInteractionData[r]=n),n.copyEvent(t),n},e.prototype.releaseInteractionDataForPointerId=function(t){var r=this.activeInteractionData[t];r&&(delete this.activeInteractionData[t],r.reset(),this.interactionDataPool.push(r))},e.prototype.configureInteractionEventForDOMEvent=function(t,r,n){return t.data=n,this.mapPositionToPoint(n.global,r.clientX,r.clientY),r.pointerType==="touch"&&(r.globalX=n.global.x,r.globalY=n.global.y),n.originalEvent=r,t.reset(),t},e.prototype.normalizeToPointerData=function(t){var r=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(var n=0,s=t.changedTouches.length;n<s;n++){var o=t.changedTouches[n];typeof o.button>"u"&&(o.button=t.touches.length?1:0),typeof o.buttons>"u"&&(o.buttons=t.touches.length?1:0),typeof o.isPrimary>"u"&&(o.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof o.width>"u"&&(o.width=o.radiusX||1),typeof o.height>"u"&&(o.height=o.radiusY||1),typeof o.tiltX>"u"&&(o.tiltX=0),typeof o.tiltY>"u"&&(o.tiltY=0),typeof o.pointerType>"u"&&(o.pointerType="touch"),typeof o.pointerId>"u"&&(o.pointerId=o.identifier||0),typeof o.pressure>"u"&&(o.pressure=o.force||.5),typeof o.twist>"u"&&(o.twist=0),typeof o.tangentialPressure>"u"&&(o.tangentialPressure=0),typeof o.layerX>"u"&&(o.layerX=o.offsetX=o.clientX),typeof o.layerY>"u"&&(o.layerY=o.offsetY=o.clientY),o.isNormalized=!0,r.push(o)}else if(t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof window.PointerEvent))){var a=t;typeof a.isPrimary>"u"&&(a.isPrimary=!0),typeof a.width>"u"&&(a.width=1),typeof a.height>"u"&&(a.height=1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="mouse"),typeof a.pointerId>"u"&&(a.pointerId=En),typeof a.pressure>"u"&&(a.pressure=.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),a.isNormalized=!0,r.push(a)}else r.push(t);return r},e.prototype.destroy=function(){this.removeEvents(),this.removeTickerListener(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this.search=null},e})(_i);/*!
 * @pixi/runner - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/runner is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Yt=(function(){function i(e){this.items=[],this._name=e,this._aliasCount=0}return i.prototype.emit=function(e,t,r,n,s,o,a,l){if(arguments.length>8)throw new Error("max arguments reached");var u=this,h=u.name,c=u.items;this._aliasCount++;for(var f=0,d=c.length;f<d;f++)c[f][h](e,t,r,n,s,o,a,l);return c===this.items&&this._aliasCount--,this},i.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},i.prototype.add=function(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this},i.prototype.remove=function(e){var t=this.items.indexOf(e);return t!==-1&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this},i.prototype.contains=function(e){return this.items.indexOf(e)!==-1},i.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},i.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Object.defineProperty(i.prototype,"empty",{get:function(){return this.items.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),i})();Object.defineProperties(Yt.prototype,{dispatch:{value:Yt.prototype.emit},run:{value:Yt.prototype.emit}});/*!
 * @pixi/core - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/core is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */nt.PREFER_ENV=ye.any?Pe.WEBGL:Pe.WEBGL2;nt.STRICT_TEXTURE_CACHE=!1;var ps=[];function eu(i,e){if(!i)return null;var t="";if(typeof i=="string"){var r=/\.(\w{3,4})(?:$|\?|#)/i.exec(i);r&&(t=r[1].toLowerCase())}for(var n=ps.length-1;n>=0;--n){var s=ps[n];if(s.test&&s.test(i,t))return new s(i,e)}throw new Error("Unrecognized source type to auto-detect Resource")}/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Ha=function(i,e){return Ha=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},Ha(i,e)};function ft(i,e){Ha(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var fi=(function(){function i(e,t){e===void 0&&(e=0),t===void 0&&(t=0),this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new Yt("setRealSize"),this.onUpdate=new Yt("update"),this.onError=new Yt("onError")}return i.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.emit(this._width,this._height)},i.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},i.prototype.resize=function(e,t){(e!==this._width||t!==this._height)&&(this._width=e,this._height=t,this.onResize.emit(e,t))},Object.defineProperty(i.prototype,"valid",{get:function(){return!!this._width&&!!this._height},enumerable:!1,configurable:!0}),i.prototype.update=function(){this.destroyed||this.onUpdate.emit()},i.prototype.load=function(){return Promise.resolve(this)},Object.defineProperty(i.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),i.prototype.style=function(e,t,r){return!1},i.prototype.dispose=function(){},i.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},i.test=function(e,t){return!1},i})(),As=(function(i){ft(e,i);function e(t,r){var n=this,s=r||{},o=s.width,a=s.height;if(!o||!a)throw new Error("BufferResource width or height invalid");return n=i.call(this,o,a)||this,n.data=t,n}return e.prototype.upload=function(t,r,n){var s=t.gl;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ze.UNPACK),n.width===r.width&&n.height===r.height?s.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(n.width=r.width,n.height=r.height,s.texImage2D(r.target,0,n.internalFormat,r.width,r.height,0,r.format,n.type,this.data)),!0},e.prototype.dispose=function(){this.data=null},e.test=function(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array},e})(fi),Ig={scaleMode:Te.NEAREST,format:ui.RGBA,alphaMode:ze.NPM},It=(function(i){ft(e,i);function e(t,r){t===void 0&&(t=null),r===void 0&&(r=null);var n=i.call(this)||this;r=r||{};var s=r.alphaMode,o=r.mipmap,a=r.anisotropicLevel,l=r.scaleMode,u=r.width,h=r.height,c=r.wrapMode,f=r.format,d=r.type,p=r.target,v=r.resolution,m=r.resourceOptions;return t&&!(t instanceof fi)&&(t=eu(t,m),t.internal=!0),n.width=u||0,n.height=h||0,n.resolution=v||nt.RESOLUTION,n.mipmap=o!==void 0?o:nt.MIPMAP_TEXTURES,n.anisotropicLevel=a!==void 0?a:nt.ANISOTROPIC_LEVEL,n.wrapMode=c||nt.WRAP_MODE,n.scaleMode=l!==void 0?l:nt.SCALE_MODE,n.format=f||ui.RGBA,n.type=d||Nt.UNSIGNED_BYTE,n.target=p||ar.TEXTURE_2D,n.alphaMode=s!==void 0?s:ze.UNPACK,r.premultiplyAlpha!==void 0&&(n.premultiplyAlpha=r.premultiplyAlpha),n.uid=Pr(),n.touched=0,n.isPowerOfTwo=!1,n._refreshPOT(),n._glTextures={},n.dirtyId=0,n.dirtyStyleId=0,n.cacheId=null,n.valid=u>0&&h>0,n.textureCacheIds=[],n.destroyed=!1,n.resource=null,n._batchEnabled=0,n._batchLocation=0,n.parentTextureArray=null,n.setResource(t),n}return Object.defineProperty(e.prototype,"realWidth",{get:function(){return Math.ceil(this.width*this.resolution-1e-4)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"realHeight",{get:function(){return Math.ceil(this.height*this.resolution-1e-4)},enumerable:!1,configurable:!0}),e.prototype.setStyle=function(t,r){var n;return t!==void 0&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),r!==void 0&&r!==this.mipmap&&(this.mipmap=r,n=!0),n&&this.dirtyStyleId++,this},e.prototype.setSize=function(t,r,n){return this.resolution=n||this.resolution,this.width=t,this.height=r,this._refreshPOT(),this.update(),this},e.prototype.setRealSize=function(t,r,n){return this.resolution=n||this.resolution,this.width=t/this.resolution,this.height=r/this.resolution,this._refreshPOT(),this.update(),this},e.prototype._refreshPOT=function(){this.isPowerOfTwo=Ma(this.realWidth)&&Ma(this.realHeight)},e.prototype.setResolution=function(t){var r=this.resolution;return r===t?this:(this.resolution=t,this.valid&&(this.width=this.width*r/t,this.height=this.height*r/t,this.emit("update",this)),this._refreshPOT(),this)},e.prototype.setResource=function(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this},e.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},e.prototype.onError=function(t){this.emit("error",this,t)},e.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete de[this.cacheId],delete Qt[this.cacheId],this.cacheId=null),this.dispose(),e.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},e.prototype.dispose=function(){this.emit("dispose",this)},e.prototype.castToBaseTexture=function(){return this},e.from=function(t,r,n){n===void 0&&(n=nt.STRICT_TEXTURE_CACHE);var s=typeof t=="string",o=null;s?o=t:(t._pixiId||(t._pixiId="pixiid_"+Pr()),o=t._pixiId);var a=de[o];if(s&&n&&!a)throw new Error('The cacheId "'+o+'" does not exist in BaseTextureCache.');return a||(a=new e(t,r),a.cacheId=o,e.addToCache(a,o)),a},e.fromBuffer=function(t,r,n,s){t=t||new Float32Array(r*n*4);var o=new As(t,{width:r,height:n}),a=t instanceof Float32Array?Nt.FLOAT:Nt.UNSIGNED_BYTE;return new e(o,Object.assign(Ig,s||{width:r,height:n,type:a}))},e.addToCache=function(t,r){r&&(t.textureCacheIds.indexOf(r)===-1&&t.textureCacheIds.push(r),de[r]&&console.warn("BaseTexture added to the cache with an id ["+r+"] that already had an entry"),de[r]=t)},e.removeFromCache=function(t){if(typeof t=="string"){var r=de[t];if(r){var n=r.textureCacheIds.indexOf(t);return n>-1&&r.textureCacheIds.splice(n,1),delete de[t],r}}else if(t&&t.textureCacheIds){for(var s=0;s<t.textureCacheIds.length;++s)delete de[t.textureCacheIds[s]];return t.textureCacheIds.length=0,t}return null},e._globalBatch=0,e})(_i),ru=(function(i){ft(e,i);function e(t,r){var n=this,s=r||{},o=s.width,a=s.height;n=i.call(this,o,a)||this,n.items=[],n.itemDirtyIds=[];for(var l=0;l<t;l++){var u=new It;n.items.push(u),n.itemDirtyIds.push(-2)}return n.length=t,n._load=null,n.baseTexture=null,n}return e.prototype.initFromArray=function(t,r){for(var n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof fi?this.addResourceAt(t[n],n):this.addResourceAt(eu(t[n],r),n))},e.prototype.dispose=function(){for(var t=0,r=this.length;t<r;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},e.prototype.addResourceAt=function(t,r){if(!this.items[r])throw new Error("Index "+r+" is out of bounds");return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[r].setResource(t),this},e.prototype.bind=function(t){if(this.baseTexture!==null)throw new Error("Only one base texture per TextureArray is allowed");i.prototype.bind.call(this,t);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=t,this.items[r].on("update",t.update,t)},e.prototype.unbind=function(t){i.prototype.unbind.call(this,t);for(var r=0;r<this.length;r++)this.items[r].parentTextureArray=null,this.items[r].off("update",t.update,t)},e.prototype.load=function(){var t=this;if(this._load)return this._load;var r=this.items.map(function(s){return s.resource}).filter(function(s){return s}),n=r.map(function(s){return s.load()});return this._load=Promise.all(n).then(function(){var s=t.items[0],o=s.realWidth,a=s.realHeight;return t.resize(o,a),Promise.resolve(t)}),this._load},e})(fi),Zd=(function(i){ft(e,i);function e(t,r){var n=this,s=r||{},o=s.width,a=s.height,l,u;return Array.isArray(t)?(l=t,u=t.length):u=t,n=i.call(this,u,{width:o,height:a})||this,l&&n.initFromArray(l,r),n}return e.prototype.addBaseTextureAt=function(t,r){if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("ArrayResource does not support RenderTexture");return this},e.prototype.bind=function(t){i.prototype.bind.call(this,t),t.target=ar.TEXTURE_2D_ARRAY},e.prototype.upload=function(t,r,n){var s=this,o=s.length,a=s.itemDirtyIds,l=s.items,u=t.gl;n.dirtyId<0&&u.texImage3D(u.TEXTURE_2D_ARRAY,0,r.format,this._width,this._height,o,0,r.format,r.type,null);for(var h=0;h<o;h++){var c=l[h];a[h]<c.dirtyId&&(a[h]=c.dirtyId,c.valid&&u.texSubImage3D(u.TEXTURE_2D_ARRAY,0,0,0,h,c.resource.width,c.resource.height,1,r.format,r.type,c.resource.source))}return!0},e})(ru),Ve=(function(i){ft(e,i);function e(t){var r=this,n=t,s=n.naturalWidth||n.videoWidth||n.width,o=n.naturalHeight||n.videoHeight||n.height;return r=i.call(this,s,o)||this,r.source=t,r.noSubImage=!1,r}return e.crossOrigin=function(t,r,n){n===void 0&&r.indexOf("data:")!==0?t.crossOrigin=kd(r):n!==!1&&(t.crossOrigin=typeof n=="string"?n:"anonymous")},e.prototype.upload=function(t,r,n,s){var o=t.gl,a=r.realWidth,l=r.realHeight;return s=s||this.source,o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ze.UNPACK),!this.noSubImage&&r.target===o.TEXTURE_2D&&n.width===a&&n.height===l?o.texSubImage2D(o.TEXTURE_2D,0,0,0,r.format,r.type,s):(n.width=a,n.height=l,o.texImage2D(r.target,0,r.format,r.format,r.type,s)),!0},e.prototype.update=function(){if(!this.destroyed){var t=this.source,r=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(r,n),i.prototype.update.call(this)}},e.prototype.dispose=function(){this.source=null},e})(fi),iu=(function(i){ft(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.test=function(t){var r=window.OffscreenCanvas;return r&&t instanceof r?!0:t instanceof HTMLCanvasElement},e})(Ve),Jd=(function(i){ft(e,i);function e(t,r){var n=this,s=r||{},o=s.width,a=s.height,l=s.autoLoad,u=s.linkBaseTexture;if(t&&t.length!==e.SIDES)throw new Error("Invalid length. Got "+t.length+", expected 6");n=i.call(this,6,{width:o,height:a})||this;for(var h=0;h<e.SIDES;h++)n.items[h].target=ar.TEXTURE_CUBE_MAP_POSITIVE_X+h;return n.linkBaseTexture=u!==!1,t&&n.initFromArray(t,r),l!==!1&&n.load(),n}return e.prototype.bind=function(t){i.prototype.bind.call(this,t),t.target=ar.TEXTURE_CUBE_MAP},e.prototype.addBaseTextureAt=function(t,r,n){if(n===void 0&&(n=this.linkBaseTexture),!this.items[r])throw new Error("Index "+r+" is out of bounds");if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0)if(t.resource)this.addResourceAt(t.resource,r);else throw new Error("CubeResource does not support copying of renderTexture.");else t.target=ar.TEXTURE_CUBE_MAP_POSITIVE_X+r,t.parentTextureArray=this.baseTexture,this.items[r]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[r]=t,this},e.prototype.upload=function(t,r,n){for(var s=this.itemDirtyIds,o=0;o<e.SIDES;o++){var a=this.items[o];s[o]<a.dirtyId&&(a.valid&&a.resource?(a.resource.upload(t,a,n),s[o]=a.dirtyId):s[o]<-1&&(t.gl.texImage2D(a.target,0,n.internalFormat,r.realWidth,r.realHeight,0,r.format,n.type,null),s[o]=-1))}return!0},e.test=function(t){return Array.isArray(t)&&t.length===e.SIDES},e.SIDES=6,e})(ru),nu=(function(i){ft(e,i);function e(t,r){var n=this;if(r=r||{},!(t instanceof HTMLImageElement)){var s=new Image;Ve.crossOrigin(s,t,r.crossorigin),s.src=t,t=s}return n=i.call(this,t)||this,!t.complete&&n._width&&n._height&&(n._width=0,n._height=0),n.url=t.src,n._process=null,n.preserveBitmap=!1,n.createBitmap=(r.createBitmap!==void 0?r.createBitmap:nt.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,n.alphaMode=typeof r.alphaMode=="number"?r.alphaMode:null,r.premultiplyAlpha!==void 0&&(n.premultiplyAlpha=r.premultiplyAlpha),n.bitmap=null,n._load=null,r.autoLoad!==!1&&n.load(),n}return e.prototype.load=function(t){var r=this;return this._load?this._load:(t!==void 0&&(this.createBitmap=t),this._load=new Promise(function(n,s){var o=r.source;r.url=o.src;var a=function(){r.destroyed||(o.onload=null,o.onerror=null,r.resize(o.width,o.height),r._load=null,r.createBitmap?n(r.process()):n(r))};o.complete&&o.src?a():(o.onload=a,o.onerror=function(l){s(l),r.onError.emit(l)})}),this._load)},e.prototype.process=function(){var t=this,r=this.source;return this._process!==null?this._process:this.bitmap!==null||!window.createImageBitmap?Promise.resolve(this):(this._process=window.createImageBitmap(r,0,0,r.width,r.height,{premultiplyAlpha:this.alphaMode===ze.UNPACK?"premultiply":"none"}).then(function(n){return t.destroyed?Promise.reject():(t.bitmap=n,t.update(),t._process=null,Promise.resolve(t))}),this._process)},e.prototype.upload=function(t,r,n){if(typeof this.alphaMode=="number"&&(r.alphaMode=this.alphaMode),!this.createBitmap)return i.prototype.upload.call(this,t,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(i.prototype.upload.call(this,t,r,n,this.bitmap),!this.preserveBitmap){var s=!0,o=r._glTextures;for(var a in o){var l=o[a];if(l!==n&&l.dirtyId!==r.dirtyId){s=!1;break}}s&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},e.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,i.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},e.test=function(t){return typeof t=="string"||t instanceof HTMLImageElement},e})(Ve),Qd=(function(i){ft(e,i);function e(t,r){var n=this;return r=r||{},n=i.call(this,document.createElement("canvas"))||this,n._width=0,n._height=0,n.svg=t,n.scale=r.scale||1,n._overrideWidth=r.width,n._overrideHeight=r.height,n._resolve=null,n._crossorigin=r.crossorigin,n._load=null,r.autoLoad!==!1&&n.load(),n}return e.prototype.load=function(){var t=this;return this._load?this._load:(this._load=new Promise(function(r){if(t._resolve=function(){t.resize(t.source.width,t.source.height),r(t)},/^\<svg/.test(t.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");t.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(t.svg)))}t._loadSvg()}),this._load)},e.prototype._loadSvg=function(){var t=this,r=new Image;Ve.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(n){t._resolve&&(r.onerror=null,t.onError.emit(n))},r.onload=function(){if(t._resolve){var n=r.width,s=r.height;if(!n||!s)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var o=n*t.scale,a=s*t.scale;(t._overrideWidth||t._overrideHeight)&&(o=t._overrideWidth||t._overrideHeight/s*n,a=t._overrideHeight||t._overrideWidth/n*s),o=Math.round(o),a=Math.round(a);var l=t.source;l.width=o,l.height=a,l._pixiId="canvas_"+Pr(),l.getContext("2d").drawImage(r,0,0,n,s,0,0,o,a),t._resolve(),t._resolve=null}}},e.getSize=function(t){var r=e.SVG_SIZE.exec(t),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n},e.prototype.dispose=function(){i.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},e.test=function(t,r){return r==="svg"||typeof t=="string"&&/^data:image\/svg\+xml(;(charset=utf8|utf8))?;base64/.test(t)||typeof t=="string"&&t.indexOf("<svg")===0},e.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i,e})(Ve),tp=(function(i){ft(e,i);function e(t,r){var n=this;if(r=r||{},!(t instanceof HTMLVideoElement)){var s=document.createElement("video");s.setAttribute("preload","auto"),s.setAttribute("webkit-playsinline",""),s.setAttribute("playsinline",""),typeof t=="string"&&(t=[t]);var o=t[0].src||t[0];Ve.crossOrigin(s,o,r.crossorigin);for(var a=0;a<t.length;++a){var l=document.createElement("source"),u=t[a],h=u.src,c=u.mime;h=h||t[a];var f=h.split("?").shift().toLowerCase(),d=f.substr(f.lastIndexOf(".")+1);c=c||e.MIME_TYPES[d]||"video/"+d,l.src=h,l.type=c,s.appendChild(l)}t=s}return n=i.call(this,t)||this,n.noSubImage=!0,n._autoUpdate=!0,n._isConnectedToTicker=!1,n._updateFPS=r.updateFPS||0,n._msToNextUpdate=0,n.autoPlay=r.autoPlay!==!1,n._load=null,n._resolve=null,n._onCanPlay=n._onCanPlay.bind(n),n._onError=n._onError.bind(n),r.autoLoad!==!1&&n.load(),n}return e.prototype.update=function(t){if(!this.destroyed){var r=Xt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(i.prototype.update.call(this),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},e.prototype.load=function(){var t=this;if(this._load)return this._load;var r=this.source;return(r.readyState===r.HAVE_ENOUGH_DATA||r.readyState===r.HAVE_FUTURE_DATA)&&r.width&&r.height&&(r.complete=!0),r.addEventListener("play",this._onPlayStart.bind(this)),r.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(r.addEventListener("canplay",this._onCanPlay),r.addEventListener("canplaythrough",this._onCanPlay),r.addEventListener("error",this._onError,!0)),this._load=new Promise(function(n){t.valid?n(t):(t._resolve=n,r.load())}),this._load},e.prototype._onError=function(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)},e.prototype._isSourcePlaying=function(){var t=this.source;return t.currentTime>0&&t.paused===!1&&t.ended===!1&&t.readyState>2},e.prototype._isSourceReady=function(){var t=this.source;return t.readyState===3||t.readyState===4},e.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(Xt.shared.add(this.update,this),this._isConnectedToTicker=!0)},e.prototype._onPlayStop=function(){this._isConnectedToTicker&&(Xt.shared.remove(this.update,this),this._isConnectedToTicker=!1)},e.prototype._onCanPlay=function(){var t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);var r=this.valid;this.resize(t.videoWidth,t.videoHeight),!r&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()},e.prototype.dispose=function(){this._isConnectedToTicker&&Xt.shared.remove(this.update,this);var t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),i.prototype.dispose.call(this)},Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Xt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(Xt.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"updateFPS",{get:function(){return this._updateFPS},set:function(t){t!==this._updateFPS&&(this._updateFPS=t)},enumerable:!1,configurable:!0}),e.test=function(t,r){return t instanceof HTMLVideoElement||e.TYPES.indexOf(r)>-1},e.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],e.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},e})(Ve),ep=(function(i){ft(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.test=function(t){return!!window.createImageBitmap&&t instanceof ImageBitmap},e})(Ve);ps.push(nu,ep,iu,tp,Qd,As,Jd,Zd);var rp={Resource:fi,BaseImageResource:Ve,INSTALLED:ps,autoDetectResource:eu,AbstractMultiResource:ru,ArrayResource:Zd,BufferResource:As,CanvasResource:iu,CubeResource:Jd,ImageResource:nu,SVGResource:Qd,VideoResource:tp,ImageBitmapResource:ep},ne=(function(){function i(e){this.renderer=e}return i.prototype.destroy=function(){this.renderer=null},i})(),Eg=(function(i){ft(e,i);function e(){return i!==null&&i.apply(this,arguments)||this}return e.prototype.upload=function(t,r,n){var s=t.gl;return s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.alphaMode===ze.UNPACK),n.width===r.width&&n.height===r.height?s.texSubImage2D(r.target,0,0,0,r.width,r.height,r.format,r.type,this.data):(n.width=r.width,n.height=r.height,s.texImage2D(r.target,0,t.context.webGLVersion===1?s.DEPTH_COMPONENT:s.DEPTH_COMPONENT16,r.width,r.height,0,r.format,r.type,this.data)),!0},e})(As),ys=(function(){function i(e,t){this.width=Math.ceil(e||100),this.height=Math.ceil(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new Yt("disposeFramebuffer"),this.multisample=Ar.NONE}return Object.defineProperty(i.prototype,"colorTexture",{get:function(){return this.colorTextures[0]},enumerable:!1,configurable:!0}),i.prototype.addColorTexture=function(e,t){return e===void 0&&(e=0),this.colorTextures[e]=t||new It(null,{scaleMode:Te.NEAREST,resolution:1,mipmap:hi.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},i.prototype.addDepthTexture=function(e){return this.depthTexture=e||new It(new Eg(null,{width:this.width,height:this.height}),{scaleMode:Te.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:hi.OFF,format:ui.DEPTH_COMPONENT,type:Nt.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},i.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},i.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},i.prototype.resize=function(e,t){if(e=Math.ceil(e),t=Math.ceil(t),!(e===this.width&&t===this.height)){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var n=this.colorTextures[r],s=n.resolution;n.setSize(e/s,t/s)}if(this.depthTexture){var s=this.depthTexture.resolution;this.depthTexture.setSize(e/s,t/s)}}},i.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},i.prototype.destroyDepthTexture=function(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)},i})(),zi=(function(i){ft(e,i);function e(t){var r=this;if(typeof t=="number"){var n=arguments[0],s=arguments[1],o=arguments[2],a=arguments[3];t={width:n,height:s,scaleMode:o,resolution:a}}r=i.call(this,null,t)||this;var l=t||{},u=l.width,h=l.height;return r.mipmap=0,r.width=Math.ceil(u)||100,r.height=Math.ceil(h)||100,r.valid=!0,r.clearColor=[0,0,0,0],r.framebuffer=new ys(r.width*r.resolution,r.height*r.resolution).addColorTexture(0,r),r.maskStack=[],r.filterStack=[{}],r}return e.prototype.resize=function(t,r){t=Math.ceil(t),r=Math.ceil(r),this.framebuffer.resize(t*this.resolution,r*this.resolution)},e.prototype.dispose=function(){this.framebuffer.dispose(),i.prototype.dispose.call(this)},e.prototype.destroy=function(){i.prototype.destroy.call(this),this.framebuffer.destroyDepthTexture(),this.framebuffer=null},e})(It),su=(function(){function i(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}return i.prototype.set=function(e,t,r){var n=t.width,s=t.height;if(r){var o=e.width/2/n,a=e.height/2/s,l=e.x/n+o,u=e.y/s+a;r=Pt.add(r,Pt.NW),this.x0=l+o*Pt.uX(r),this.y0=u+a*Pt.uY(r),r=Pt.add(r,2),this.x1=l+o*Pt.uX(r),this.y1=u+a*Pt.uY(r),r=Pt.add(r,2),this.x2=l+o*Pt.uX(r),this.y2=u+a*Pt.uY(r),r=Pt.add(r,2),this.x3=l+o*Pt.uX(r),this.y3=u+a*Pt.uY(r)}else this.x0=e.x/n,this.y0=e.y/s,this.x1=(e.x+e.width)/n,this.y1=e.y/s,this.x2=(e.x+e.width)/n,this.y2=(e.y+e.height)/s,this.x3=e.x/n,this.y3=(e.y+e.height)/s;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3},i})(),dc=new su,lt=(function(i){ft(e,i);function e(t,r,n,s,o,a){var l=i.call(this)||this;if(l.noFrame=!1,r||(l.noFrame=!0,r=new vt(0,0,1,1)),t instanceof e&&(t=t.baseTexture),l.baseTexture=t,l._frame=r,l.trim=s,l.valid=!1,l._uvs=dc,l.uvMatrix=null,l.orig=n||r,l._rotate=Number(o||0),o===!0)l._rotate=2;else if(l._rotate%2!==0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");return l.defaultAnchor=a?new Ht(a.x,a.y):new Ht(0,0),l._updateID=0,l.textureCacheIds=[],t.valid?l.noFrame?t.valid&&l.onBaseTextureUpdated(t):l.frame=r:t.once("loaded",l.onBaseTextureUpdated,l),l.noFrame&&t.on("update",l.onBaseTextureUpdated,l),l}return e.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},e.prototype.onBaseTextureUpdated=function(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},e.prototype.destroy=function(t){if(this.baseTexture){if(t){var r=this.baseTexture;r&&r.url&&Qt[r.url]&&e.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,e.removeFromCache(this),this.textureCacheIds=null},e.prototype.clone=function(){return new e(this.baseTexture,this.frame.clone(),this.orig.clone(),this.trim&&this.trim.clone(),this.rotate,this.defaultAnchor)},e.prototype.updateUvs=function(){this._uvs===dc&&(this._uvs=new su),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},e.from=function(t,r,n){r===void 0&&(r={}),n===void 0&&(n=nt.STRICT_TEXTURE_CACHE);var s=typeof t=="string",o=null;s?o=t:(t._pixiId||(t._pixiId="pixiid_"+Pr()),o=t._pixiId);var a=Qt[o];if(s&&n&&!a)throw new Error('The cacheId "'+o+'" does not exist in TextureCache.');return a||(r.resolution||(r.resolution=Zi(t)),a=new e(new It(t,r)),a.baseTexture.cacheId=o,It.addToCache(a.baseTexture,o),e.addToCache(a,o)),a},e.fromURL=function(t,r){var n=Object.assign({autoLoad:!1},r?.resourceOptions),s=e.from(t,Object.assign({resourceOptions:n},r),!1),o=s.baseTexture.resource;return s.baseTexture.valid?Promise.resolve(s):o.load().then(function(){return Promise.resolve(s)})},e.fromBuffer=function(t,r,n,s){return new e(It.fromBuffer(t,r,n,s))},e.fromLoader=function(t,r,n){var s=new nu(t);s.url=r;var o=new It(s,{scaleMode:nt.SCALE_MODE,resolution:Zi(r)}),a=new e(o);return n||(n=r),It.addToCache(a.baseTexture,n),e.addToCache(a,n),n!==r&&(It.addToCache(a.baseTexture,r),e.addToCache(a,r)),a},e.addToCache=function(t,r){r&&(t.textureCacheIds.indexOf(r)===-1&&t.textureCacheIds.push(r),Qt[r]&&console.warn("Texture added to the cache with an id ["+r+"] that already had an entry"),Qt[r]=t)},e.removeFromCache=function(t){if(typeof t=="string"){var r=Qt[t];if(r){var n=r.textureCacheIds.indexOf(t);return n>-1&&r.textureCacheIds.splice(n,1),delete Qt[t],r}}else if(t&&t.textureCacheIds){for(var s=0;s<t.textureCacheIds.length;++s)Qt[t.textureCacheIds[s]]===t&&delete Qt[t.textureCacheIds[s]];return t.textureCacheIds.length=0,t}return null},Object.defineProperty(e.prototype,"resolution",{get:function(){return this.baseTexture.resolution},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"frame",{get:function(){return this._frame},set:function(t){this._frame=t,this.noFrame=!1;var r=t.x,n=t.y,s=t.width,o=t.height,a=r+s>this.baseTexture.width,l=n+o>this.baseTexture.height;if(a||l){var u=a&&l?"and":"or",h="X: "+r+" + "+s+" = "+(r+s)+" > "+this.baseTexture.width,c="Y: "+n+" + "+o+" = "+(n+o)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+(h+" "+u+" "+c))}this.valid=s&&o&&this.baseTexture.valid,!this.trim&&!this.rotate&&(this.orig=t),this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rotate",{get:function(){return this._rotate},set:function(t){this._rotate=t,this.valid&&this.updateUvs()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this.orig.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.orig.height},enumerable:!1,configurable:!0}),e.prototype.castToBaseTexture=function(){return this.baseTexture},e})(_i);function Sg(){var i=document.createElement("canvas");i.width=16,i.height=16;var e=i.getContext("2d");return e.fillStyle="white",e.fillRect(0,0,16,16),new lt(new It(new iu(i)))}function Cs(i){i.destroy=function(){},i.on=function(){},i.once=function(){},i.emit=function(){}}lt.EMPTY=new lt(new It);Cs(lt.EMPTY);Cs(lt.EMPTY.baseTexture);lt.WHITE=Sg();Cs(lt.WHITE);Cs(lt.WHITE.baseTexture);var Or=(function(i){ft(e,i);function e(t,r){var n=this,s=null;if(!(t instanceof zi)){var o=arguments[1],a=arguments[2],l=arguments[3],u=arguments[4];console.warn("Please use RenderTexture.create("+o+", "+a+") instead of the ctor directly."),s=arguments[0],r=null,t=new zi({width:o,height:a,scaleMode:l,resolution:u})}return n=i.call(this,t,r)||this,n.legacyRenderer=s,n.valid=!0,n.filterFrame=null,n.filterPoolKey=null,n.updateUvs(),n}return Object.defineProperty(e.prototype,"framebuffer",{get:function(){return this.baseTexture.framebuffer},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,r,n){n===void 0&&(n=!0),t=Math.ceil(t),r=Math.ceil(r),this.valid=t>0&&r>0,this._frame.width=this.orig.width=t,this._frame.height=this.orig.height=r,n&&this.baseTexture.resize(t,r),this.updateUvs()},e.prototype.setResolution=function(t){var r=this.baseTexture;r.resolution!==t&&(r.setResolution(t),this.resize(r.width,r.height,!1))},e.create=function(t){return typeof t=="number"&&(t={width:t,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new e(new zi(t))},e})(lt),ip=(function(){function i(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}return i.prototype.createTexture=function(e,t){var r=new zi(Object.assign({width:e,height:t,resolution:1},this.textureOptions));return new Or(r)},i.prototype.getOptimalTexture=function(e,t,r){r===void 0&&(r=1);var n=i.SCREEN_KEY;e*=r,t*=r,(!this.enableFullScreen||e!==this._pixelsWidth||t!==this._pixelsHeight)&&(e=Ki(e),t=Ki(t),n=(e&65535)<<16|t&65535),this.texturePool[n]||(this.texturePool[n]=[]);var s=this.texturePool[n].pop();return s||(s=this.createTexture(e,t)),s.filterPoolKey=n,s.setResolution(r),s},i.prototype.getFilterTexture=function(e,t){var r=this.getOptimalTexture(e.width,e.height,t||e.resolution);return r.filterFrame=e.filterFrame,r},i.prototype.returnTexture=function(e){var t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)},i.prototype.returnFilterTexture=function(e){this.returnTexture(e)},i.prototype.clear=function(e){if(e=e!==!1,e)for(var t in this.texturePool){var r=this.texturePool[t];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}},i.prototype.setScreenSize=function(e){if(!(e.width===this._pixelsWidth&&e.height===this._pixelsHeight)){var t=i.SCREEN_KEY,r=this.texturePool[t];if(this.enableFullScreen=e.width>0&&e.height>0,r)for(var n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[t]=[],this._pixelsWidth=e.width,this._pixelsHeight=e.height}},i.SCREEN_KEY="screen",i})(),Ga=(function(){function i(e,t,r,n,s,o,a){t===void 0&&(t=0),r===void 0&&(r=!1),n===void 0&&(n=5126),this.buffer=e,this.size=t,this.normalized=r,this.type=n,this.stride=s,this.start=o,this.instance=a}return i.prototype.destroy=function(){this.buffer=null},i.from=function(e,t,r,n,s){return new i(e,t,r,n,s)},i})(),Ag=0,Lt=(function(){function i(e,t,r){t===void 0&&(t=!0),r===void 0&&(r=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=Ag++,this.disposeRunner=new Yt("disposeBuffer")}return i.prototype.update=function(e){this.data=e||this.data,this._updateID++},i.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},i.prototype.destroy=function(){this.dispose(),this.data=null},i.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new i(e)},i})();function np(i){if(i.BYTES_PER_ELEMENT===4)return i instanceof Float32Array?"Float32Array":i instanceof Uint32Array?"Uint32Array":"Int32Array";if(i.BYTES_PER_ELEMENT===2){if(i instanceof Uint16Array)return"Uint16Array"}else if(i.BYTES_PER_ELEMENT===1&&i instanceof Uint8Array)return"Uint8Array";return null}var Cg={Float32Array,Uint32Array,Int32Array,Uint8Array};function Pg(i,e){for(var t=0,r=0,n={},s=0;s<i.length;s++)r+=e[s],t+=i[s].length;for(var o=new ArrayBuffer(t*4),a=null,l=0,s=0;s<i.length;s++){var u=e[s],h=i[s],c=np(h);n[c]||(n[c]=new Cg[c](o)),a=n[c];for(var f=0;f<h.length;f++){var d=(f/u|0)*r+l,p=f%u;a[d+p]=h[f]}l+=u}return new Float32Array(o)}var pc={5126:4,5123:2,5121:1},Og=0,Fg={Float32Array,Uint32Array,Int32Array,Uint8Array,Uint16Array},Nr=(function(){function i(e,t){e===void 0&&(e=[]),t===void 0&&(t={}),this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=Og++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new Yt("disposeGeometry"),this.refCount=0}return i.prototype.addAttribute=function(e,t,r,n,s,o,a,l){if(r===void 0&&(r=0),n===void 0&&(n=!1),l===void 0&&(l=!1),!t)throw new Error("You must pass a buffer when creating an attribute");t instanceof Lt||(t instanceof Array&&(t=new Float32Array(t)),t=new Lt(t));var u=e.split("|");if(u.length>1){for(var h=0;h<u.length;h++)this.addAttribute(u[h],t,r,n,s);return this}var c=this.buffers.indexOf(t);return c===-1&&(this.buffers.push(t),c=this.buffers.length-1),this.attributes[e]=new Ga(c,r,n,s,o,a,l),this.instanced=this.instanced||l,this},i.prototype.getAttribute=function(e){return this.attributes[e]},i.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},i.prototype.addIndex=function(e){return e instanceof Lt||(e instanceof Array&&(e=new Uint16Array(e)),e=new Lt(e)),e.index=!0,this.indexBuffer=e,this.buffers.indexOf(e)===-1&&this.buffers.push(e),this},i.prototype.getIndex=function(){return this.indexBuffer},i.prototype.interleave=function(){if(this.buffers.length===1||this.buffers.length===2&&this.indexBuffer)return this;var e=[],t=[],r=new Lt,n;for(n in this.attributes){var s=this.attributes[n],o=this.buffers[s.buffer];e.push(o.data),t.push(s.size*pc[s.type]/4),s.buffer=0}for(r.data=Pg(e,t),n=0;n<this.buffers.length;n++)this.buffers[n]!==this.indexBuffer&&this.buffers[n].destroy();return this.buffers=[r],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},i.prototype.getSize=function(){for(var e in this.attributes){var t=this.attributes[e],r=this.buffers[t.buffer];return r.data.length/(t.stride/4||t.size)}return 0},i.prototype.dispose=function(){this.disposeRunner.emit(this,!1)},i.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null},i.prototype.clone=function(){for(var e=new i,t=0;t<this.buffers.length;t++)e.buffers[t]=new Lt(this.buffers[t].data.slice(0));for(var t in this.attributes){var r=this.attributes[t];e.attributes[t]=new Ga(r.buffer,r.size,r.normalized,r.type,r.stride,r.start,r.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.index=!0),e},i.merge=function(e){for(var t=new i,r=[],n=[],s=[],o,a=0;a<e.length;a++){o=e[a];for(var l=0;l<o.buffers.length;l++)n[l]=n[l]||0,n[l]+=o.buffers[l].data.length,s[l]=0}for(var a=0;a<o.buffers.length;a++)r[a]=new Fg[np(o.buffers[a].data)](n[a]),t.buffers[a]=new Lt(r[a]);for(var a=0;a<e.length;a++){o=e[a];for(var l=0;l<o.buffers.length;l++)r[l].set(o.buffers[l].data,s[l]),s[l]+=o.buffers[l].data.length}if(t.attributes=o.attributes,o.indexBuffer){t.indexBuffer=t.buffers[o.buffers.indexOf(o.indexBuffer)],t.indexBuffer.index=!0;for(var u=0,h=0,c=0,f=0,a=0;a<o.buffers.length;a++)if(o.buffers[a]!==o.indexBuffer){f=a;break}for(var a in o.attributes){var d=o.attributes[a];(d.buffer|0)===f&&(h+=d.size*pc[d.type]/4)}for(var a=0;a<e.length;a++){for(var p=e[a].indexBuffer.data,l=0;l<p.length;l++)t.indexBuffer.data[l+c]+=u;u+=o.buffers[f].data.length/h,c+=p.length}}return t},i})(),sp=(function(i){ft(e,i);function e(){var t=i.call(this)||this;return t.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2]),t}return e})(Nr),ou=(function(i){ft(e,i);function e(){var t=i.call(this)||this;return t.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),t.uvs=new Float32Array([0,0,1,0,1,1,0,1]),t.vertexBuffer=new Lt(t.vertices),t.uvBuffer=new Lt(t.uvs),t.addAttribute("aVertexPosition",t.vertexBuffer).addAttribute("aTextureCoord",t.uvBuffer).addIndex([0,1,2,0,2,3]),t}return e.prototype.map=function(t,r){var n=0,s=0;return this.uvs[0]=n,this.uvs[1]=s,this.uvs[2]=n+r.width/t.width,this.uvs[3]=s,this.uvs[4]=n+r.width/t.width,this.uvs[5]=s+r.height/t.height,this.uvs[6]=n,this.uvs[7]=s+r.height/t.height,n=r.x,s=r.y,this.vertices[0]=n,this.vertices[1]=s,this.vertices[2]=n+r.width,this.vertices[3]=s,this.vertices[4]=n+r.width,this.vertices[5]=s+r.height,this.vertices[6]=n,this.vertices[7]=s+r.height,this.invalidate(),this},e.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},e})(Nr),Rg=0,lr=(function(){function i(e,t){this.uniforms=e,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Rg++,this.static=!!t}return i.prototype.update=function(){this.dirtyId++},i.prototype.add=function(e,t,r){this.uniforms[e]=new i(t,r)},i.from=function(e,t){return new i(e,t)},i})(),op=(function(){function i(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new vt,this.destinationFrame=new vt,this.filters=[]}return i.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null},i})(),ap=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.defaultFilterStack=[{}],r.texturePool=new ip,r.texturePool.setScreenSize(t.view),r.statePool=[],r.quad=new sp,r.quadUv=new ou,r.tempRect=new vt,r.activeState={},r.globalUniforms=new lr({outputFrame:r.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),r.forceClear=!1,r.useMaxPadding=!1,r}return e.prototype.push=function(t,r){for(var n=this.renderer,s=this.defaultFilterStack,o=this.statePool.pop()||new op,a=r[0].resolution,l=r[0].padding,u=r[0].autoFit,h=r[0].legacy,c=1;c<r.length;c++){var f=r[c];a=Math.min(a,f.resolution),l=this.useMaxPadding?Math.max(l,f.padding):l+f.padding,u=u&&f.autoFit,h=h||f.legacy}s.length===1&&(this.defaultFilterStack[0].renderTexture=n.renderTexture.current),s.push(o),o.resolution=a,o.legacy=h,o.target=t,o.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),o.sourceFrame.pad(l),u&&o.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),o.sourceFrame.ceil(a),o.renderTexture=this.getOptimalFilterTexture(o.sourceFrame.width,o.sourceFrame.height,a),o.filters=r,o.destinationFrame.width=o.renderTexture.width,o.destinationFrame.height=o.renderTexture.height;var d=this.tempRect;d.width=o.sourceFrame.width,d.height=o.sourceFrame.height,o.renderTexture.filterFrame=o.sourceFrame,n.renderTexture.bind(o.renderTexture,o.sourceFrame,d),n.renderTexture.clear()},e.prototype.pop=function(){var t=this.defaultFilterStack,r=t.pop(),n=r.filters;this.activeState=r;var s=this.globalUniforms.uniforms;s.outputFrame=r.sourceFrame,s.resolution=r.resolution;var o=s.inputSize,a=s.inputPixel,l=s.inputClamp;if(o[0]=r.destinationFrame.width,o[1]=r.destinationFrame.height,o[2]=1/o[0],o[3]=1/o[1],a[0]=o[0]*r.resolution,a[1]=o[1]*r.resolution,a[2]=1/a[0],a[3]=1/a[1],l[0]=.5*a[2],l[1]=.5*a[3],l[2]=r.sourceFrame.width*o[2]-.5*a[2],l[3]=r.sourceFrame.height*o[3]-.5*a[3],r.legacy){var u=s.filterArea;u[0]=r.destinationFrame.width,u[1]=r.destinationFrame.height,u[2]=r.sourceFrame.x,u[3]=r.sourceFrame.y,s.filterClamp=s.inputClamp}this.globalUniforms.update();var h=t[t.length-1];if(r.renderTexture.framebuffer.multisample>1&&this.renderer.framebuffer.blit(),n.length===1)n[0].apply(this,r.renderTexture,h.renderTexture,xe.BLEND,r),this.returnFilterTexture(r.renderTexture);else{var c=r.renderTexture,f=this.getOptimalFilterTexture(c.width,c.height,r.resolution);f.filterFrame=c.filterFrame;var d=0;for(d=0;d<n.length-1;++d){n[d].apply(this,c,f,xe.CLEAR,r);var p=c;c=f,f=p}n[d].apply(this,c,h.renderTexture,xe.BLEND,r),this.returnFilterTexture(c),this.returnFilterTexture(f)}r.clear(),this.statePool.push(r)},e.prototype.bindAndClear=function(t,r){if(r===void 0&&(r=xe.CLEAR),t&&t.filterFrame){var n=this.tempRect;n.width=t.filterFrame.width,n.height=t.filterFrame.height,this.renderer.renderTexture.bind(t,t.filterFrame,n)}else this.renderer.renderTexture.bind(t);typeof r=="boolean"&&(r=r?xe.CLEAR:xe.BLEND,K("5.2.1","Use CLEAR_MODES when using clear applyFilter option")),(r===xe.CLEAR||r===xe.BLIT&&this.forceClear)&&this.renderer.renderTexture.clear()},e.prototype.applyFilter=function(t,r,n,s){var o=this.renderer;this.bindAndClear(n,s),t.uniforms.uSampler=r,t.uniforms.filterGlobals=this.globalUniforms,o.state.set(t.state),o.shader.bind(t),t.legacy?(this.quadUv.map(r._frame,r.filterFrame),o.geometry.bind(this.quadUv),o.geometry.draw(ue.TRIANGLES)):(o.geometry.bind(this.quad),o.geometry.draw(ue.TRIANGLE_STRIP))},e.prototype.calculateSpriteMatrix=function(t,r){var n=this.activeState,s=n.sourceFrame,o=n.destinationFrame,a=r._texture.orig,l=t.set(o.width,0,0,o.height,s.x,s.y),u=r.worldTransform.copyTo(Mt.TEMP_MATRIX);return u.invert(),l.prepend(u),l.scale(1/a.width,1/a.height),l.translate(r.anchor.x,r.anchor.y),l},e.prototype.destroy=function(){this.texturePool.clear(!1)},e.prototype.getOptimalFilterTexture=function(t,r,n){return n===void 0&&(n=1),this.texturePool.getOptimalTexture(t,r,n)},e.prototype.getFilterTexture=function(t,r){if(typeof t=="number"){var n=t;t=r,r=n}t=t||this.activeState.renderTexture;var s=this.texturePool.getOptimalTexture(t.width,t.height,r||t.resolution);return s.filterFrame=t.filterFrame,s},e.prototype.returnFilterTexture=function(t){this.texturePool.returnTexture(t)},e.prototype.emptyPool=function(){this.texturePool.clear(!0)},e.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},e})(ne),wi=(function(){function i(e){this.renderer=e}return i.prototype.flush=function(){},i.prototype.destroy=function(){this.renderer=null},i.prototype.start=function(){},i.prototype.stop=function(){this.flush()},i.prototype.render=function(e){},i})(),lp=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.emptyRenderer=new wi(t),r.currentRenderer=r.emptyRenderer,r}return e.prototype.setObjectRenderer=function(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())},e.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},e.prototype.copyBoundTextures=function(t,r){for(var n=this.renderer.texture.boundTextures,s=r-1;s>=0;--s)t[s]=n[s]||null,t[s]&&(t[s]._batchLocation=s)},e.prototype.boundArray=function(t,r,n,s){for(var o=t.elements,a=t.ids,l=t.count,u=0,h=0;h<l;h++){var c=o[h],f=c._batchLocation;if(f>=0&&f<s&&r[f]===c){a[h]=f;continue}for(;u<s;){var d=r[u];if(d&&d._batchEnabled===n&&d._batchLocation===u){u++;continue}a[h]=u,c._batchLocation=u,r[u]=c;break}}},e})(ne),yc=0,up=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.webGLVersion=1,r.extensions={},r.supports={uint32Indices:!1},r.handleContextLost=r.handleContextLost.bind(r),r.handleContextRestored=r.handleContextRestored.bind(r),t.view.addEventListener("webglcontextlost",r.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",r.handleContextRestored,!1),r}return Object.defineProperty(e.prototype,"isLost",{get:function(){return!this.gl||this.gl.isContextLost()},enumerable:!1,configurable:!0}),e.prototype.contextChange=function(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=yc++,t.isContextLost()&&t.getExtension("WEBGL_lose_context")&&t.getExtension("WEBGL_lose_context").restoreContext()},e.prototype.initFromContext=function(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=yc++,this.renderer.runners.contextChange.emit(t)},e.prototype.initFromOptions=function(t){var r=this.createContext(this.renderer.view,t);this.initFromContext(r)},e.prototype.createContext=function(t,r){var n;if(nt.PREFER_ENV>=Pe.WEBGL2&&(n=t.getContext("webgl2",r)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=t.getContext("webgl",r)||t.getContext("experimental-webgl",r),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl},e.prototype.getExtensions=function(){var t=this.gl;this.webGLVersion===1?Object.assign(this.extensions,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),loseContext:t.getExtension("WEBGL_lose_context"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):this.webGLVersion===2&&Object.assign(this.extensions,{anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:t.getExtension("EXT_color_buffer_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear")})},e.prototype.handleContextLost=function(t){t.preventDefault()},e.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.emit(this.gl)},e.prototype.destroy=function(){var t=this.renderer.view;t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},e.prototype.postrender=function(){this.renderer.renderingToScreen&&this.gl.flush()},e.prototype.validateContext=function(t){var r=t.getContextAttributes(),n="WebGL2RenderingContext"in window&&t instanceof window.WebGL2RenderingContext;n&&(this.webGLVersion=2),r.stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");var s=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=s,s||console.warn("Provided WebGL context does not support 32 index buffer, complex graphics may not render correctly")},e})(ne),hp=(function(){function i(e){this.framebuffer=e,this.stencil=null,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.multisample=Ar.NONE,this.msaaBuffer=null,this.blitFramebuffer=null}return i})(),Mg=new vt,cp=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.managedFramebuffers=[],r.unknownFramebuffer=new ys(10,10),r.msaaSamples=null,r}return e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new vt,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),this.renderer.context.webGLVersion===1){var r=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;nt.PREFER_ENV===Pe.WEBGL_LEGACY&&(r=null,n=null),r?t.drawBuffers=function(s){return r.drawBuffersWEBGL(s)}:(this.hasMRT=!1,t.drawBuffers=function(){}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)},e.prototype.bind=function(t,r){var n=this.gl;if(t){var s=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)),s.dirtyId!==t.dirtyId&&(s.dirtyId=t.dirtyId,s.dirtyFormat!==t.dirtyFormat?(s.dirtyFormat=t.dirtyFormat,this.updateFramebuffer(t)):s.dirtySize!==t.dirtySize&&(s.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(var o=0;o<t.colorTextures.length;o++){var a=t.colorTextures[o];this.renderer.texture.unbind(a.parentTextureArray||a)}t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,t.width,t.height)}else this.current&&(this.current=null,n.bindFramebuffer(n.FRAMEBUFFER,null)),r?this.setViewport(r.x,r.y,r.width,r.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},e.prototype.setViewport=function(t,r,n,s){var o=this.viewport;(o.width!==n||o.height!==s||o.x!==t||o.y!==r)&&(o.x=t,o.y=r,o.width=n,o.height=s,this.gl.viewport(t,r,n,s))},Object.defineProperty(e.prototype,"size",{get:function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},enumerable:!1,configurable:!0}),e.prototype.clear=function(t,r,n,s,o){o===void 0&&(o=Wi.COLOR|Wi.DEPTH);var a=this.gl;a.clearColor(t,r,n,s),a.clear(o)},e.prototype.initFramebuffer=function(t){var r=this.gl,n=new hp(r.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n},e.prototype.resizeFramebuffer=function(t){var r=this.gl,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height));for(var s=t.colorTextures,o=0;o<s.length;o++)this.renderer.texture.bind(s[o],0);t.depthTexture&&this.renderer.texture.bind(t.depthTexture,0)},e.prototype.updateFramebuffer=function(t){var r=this.gl,n=t.glFramebuffers[this.CONTEXT_UID],s=t.colorTextures,o=s.length;r.drawBuffers||(o=Math.min(o,1)),n.multisample>1&&(n.msaaBuffer=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.msaaBuffer),r.renderbufferStorageMultisample(r.RENDERBUFFER,n.multisample,r.RGBA8,t.width,t.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,n.msaaBuffer));for(var a=[],l=0;l<o;l++)if(!(l===0&&n.multisample>1)){var u=t.colorTextures[l],h=u.parentTextureArray||u;this.renderer.texture.bind(h,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+l,u.target,h._glTextures[this.CONTEXT_UID].texture,0),a.push(r.COLOR_ATTACHMENT0+l)}if(a.length>1&&r.drawBuffers(a),t.depthTexture){var c=this.writeDepthTexture;if(c){var f=t.depthTexture;this.renderer.texture.bind(f,0),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,f._glTextures[this.CONTEXT_UID].texture,0)}}!n.stencil&&(t.stencil||t.depth)&&(n.stencil=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,n.stencil),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_STENCIL,t.width,t.height),t.depthTexture||r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.RENDERBUFFER,n.stencil))},e.prototype.detectSamples=function(t){var r=this.msaaSamples,n=Ar.NONE;if(t<=1||r===null)return n;for(var s=0;s<r.length;s++)if(r[s]<=t){n=r[s];break}return n===1&&(n=Ar.NONE),n},e.prototype.blit=function(t,r,n){var s=this,o=s.current,a=s.renderer,l=s.gl,u=s.CONTEXT_UID;if(a.context.webGLVersion===2&&o){var h=o.glFramebuffers[u];if(h){if(!t){if(h.multisample<=1)return;h.blitFramebuffer||(h.blitFramebuffer=new ys(o.width,o.height),h.blitFramebuffer.addColorTexture(0,o.colorTextures[0])),t=h.blitFramebuffer,t.width=o.width,t.height=o.height}r||(r=Mg,r.width=o.width,r.height=o.height),n||(n=r);var c=r.width===n.width&&r.height===n.height;this.bind(t),l.bindFramebuffer(l.READ_FRAMEBUFFER,h.framebuffer),l.blitFramebuffer(r.x,r.y,r.width,r.height,n.x,n.y,n.width,n.height,l.COLOR_BUFFER_BIT,c?l.NEAREST:l.LINEAR)}}},e.prototype.disposeFramebuffer=function(t,r){var n=t.glFramebuffers[this.CONTEXT_UID],s=this.gl;if(n){delete t.glFramebuffers[this.CONTEXT_UID];var o=this.managedFramebuffers.indexOf(t);o>=0&&this.managedFramebuffers.splice(o,1),t.disposeRunner.remove(this),r||(s.deleteFramebuffer(n.framebuffer),n.stencil&&s.deleteRenderbuffer(n.stencil))}},e.prototype.disposeAll=function(t){var r=this.managedFramebuffers;this.managedFramebuffers=[];for(var n=0;n<r.length;n++)this.disposeFramebuffer(r[n],t)},e.prototype.forceStencil=function(){var t=this.current;if(t){var r=t.glFramebuffers[this.CONTEXT_UID];if(!(!r||r.stencil)){t.enableStencil();var n=t.width,s=t.height,o=this.gl,a=o.createRenderbuffer();o.bindRenderbuffer(o.RENDERBUFFER,a),o.renderbufferStorage(o.RENDERBUFFER,o.DEPTH_STENCIL,n,s),r.stencil=a,o.framebufferRenderbuffer(o.FRAMEBUFFER,o.DEPTH_STENCIL_ATTACHMENT,o.RENDERBUFFER,a)}}},e.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new vt},e})(ne),Lg=(function(){function i(e){this.buffer=e||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}return i})(),Jo={5126:4,5123:2,5121:1},fp=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r._activeGeometry=null,r._activeVao=null,r.hasVao=!0,r.hasInstance=!0,r.canUseUInt32ElementIndex=!1,r.managedGeometries={},r.managedBuffers={},r}return e.prototype.contextChange=function(){this.disposeAll(!0);var t=this.gl=this.renderer.gl,r=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,r.webGLVersion!==2){var n=this.renderer.context.extensions.vertexArrayObject;nt.PREFER_ENV===Pe.WEBGL_LEGACY&&(n=null),n?(t.createVertexArray=function(){return n.createVertexArrayOES()},t.bindVertexArray=function(o){return n.bindVertexArrayOES(o)},t.deleteVertexArray=function(o){return n.deleteVertexArrayOES(o)}):(this.hasVao=!1,t.createVertexArray=function(){return null},t.bindVertexArray=function(){return null},t.deleteVertexArray=function(){return null})}if(r.webGLVersion!==2){var s=t.getExtension("ANGLE_instanced_arrays");s?(t.vertexAttribDivisor=function(o,a){return s.vertexAttribDivisorANGLE(o,a)},t.drawElementsInstanced=function(o,a,l,u,h){return s.drawElementsInstancedANGLE(o,a,l,u,h)},t.drawArraysInstanced=function(o,a,l,u){return s.drawArraysInstancedANGLE(o,a,l,u)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=r.webGLVersion===2||!!r.extensions.uint32ElementIndex},e.prototype.bind=function(t,r){r=r||this.renderer.shader.shader;var n=this.gl,s=t.glVertexArrayObjects[this.CONTEXT_UID],o=!1;s||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=s={},o=!0);var a=s[r.program.id]||this.initGeometryVao(t,r.program,o);this._activeGeometry=t,this._activeVao!==a&&(this._activeVao=a,this.hasVao?n.bindVertexArray(a):this.activateVao(t,r.program)),this.updateBuffers()},e.prototype.reset=function(){this.unbind()},e.prototype.updateBuffers=function(){for(var t=this._activeGeometry,r=this.gl,n=0;n<t.buffers.length;n++){var s=t.buffers[n],o=s._glBuffers[this.CONTEXT_UID];if(s._updateID!==o.updateID){o.updateID=s._updateID;var a=s.index?r.ELEMENT_ARRAY_BUFFER:r.ARRAY_BUFFER;if(r.bindBuffer(a,o.buffer),this._boundBuffer=o,o.byteLength>=s.data.byteLength)r.bufferSubData(a,0,s.data);else{var l=s.static?r.STATIC_DRAW:r.DYNAMIC_DRAW;o.byteLength=s.data.byteLength,r.bufferData(a,s.data,l)}}}},e.prototype.checkCompatibility=function(t,r){var n=t.attributes,s=r.attributeData;for(var o in s)if(!n[o])throw new Error('shader and geometry incompatible, geometry missing the "'+o+'" attribute')},e.prototype.getSignature=function(t,r){var n=t.attributes,s=r.attributeData,o=["g",t.id];for(var a in n)s[a]&&o.push(a);return o.join("-")},e.prototype.initGeometryVao=function(t,r,n){n===void 0&&(n=!0),this.checkCompatibility(t,r);var s=this.gl,o=this.CONTEXT_UID,a=this.getSignature(t,r),l=t.glVertexArrayObjects[this.CONTEXT_UID],u=l[a];if(u)return l[r.id]=u,u;var h=t.buffers,c=t.attributes,f={},d={};for(var p in h)f[p]=0,d[p]=0;for(var p in c)!c[p].size&&r.attributeData[p]?c[p].size=r.attributeData[p].size:c[p].size||console.warn("PIXI Geometry attribute '"+p+"' size cannot be determined (likely the bound shader does not have the attribute)"),f[c[p].buffer]+=c[p].size*Jo[c[p].type];for(var p in c){var v=c[p],m=v.size;v.stride===void 0&&(f[v.buffer]===m*Jo[v.type]?v.stride=0:v.stride=f[v.buffer]),v.start===void 0&&(v.start=d[v.buffer],d[v.buffer]+=m*Jo[v.type])}u=s.createVertexArray(),s.bindVertexArray(u);for(var g=0;g<h.length;g++){var E=h[g];E._glBuffers[o]||(E._glBuffers[o]=new Lg(s.createBuffer()),this.managedBuffers[E.id]=E,E.disposeRunner.add(this)),n&&E._glBuffers[o].refCount++}return this.activateVao(t,r),this._activeVao=u,l[r.id]=u,l[a]=u,u},e.prototype.disposeBuffer=function(t,r){if(this.managedBuffers[t.id]){delete this.managedBuffers[t.id];var n=t._glBuffers[this.CONTEXT_UID],s=this.gl;t.disposeRunner.remove(this),n&&(r||s.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}},e.prototype.disposeGeometry=function(t,r){if(this.managedGeometries[t.id]){delete this.managedGeometries[t.id];var n=t.glVertexArrayObjects[this.CONTEXT_UID],s=this.gl,o=t.buffers;if(t.disposeRunner.remove(this),!!n){for(var a=0;a<o.length;a++){var l=o[a]._glBuffers[this.CONTEXT_UID];l.refCount--,l.refCount===0&&!r&&this.disposeBuffer(o[a],r)}if(!r){for(var u in n)if(u[0]==="g"){var h=n[u];this._activeVao===h&&this.unbind(),s.deleteVertexArray(h)}}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}},e.prototype.disposeAll=function(t){for(var r=Object.keys(this.managedGeometries),n=0;n<r.length;n++)this.disposeGeometry(this.managedGeometries[r[n]],t);r=Object.keys(this.managedBuffers);for(var n=0;n<r.length;n++)this.disposeBuffer(this.managedBuffers[r[n]],t)},e.prototype.activateVao=function(t,r){var n=this.gl,s=this.CONTEXT_UID,o=t.buffers,a=t.attributes;t.indexBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t.indexBuffer._glBuffers[s].buffer);var l=null;for(var u in a){var h=a[u],c=o[h.buffer],f=c._glBuffers[s];if(r.attributeData[u]){l!==f&&(n.bindBuffer(n.ARRAY_BUFFER,f.buffer),l=f);var d=r.attributeData[u].location;if(n.enableVertexAttribArray(d),n.vertexAttribPointer(d,h.size,h.type||n.FLOAT,h.normalized,h.stride,h.start),h.instance)if(this.hasInstance)n.vertexAttribDivisor(d,1);else throw new Error("geometry error, GPU Instancing is not supported on this device")}}},e.prototype.draw=function(t,r,n,s){var o=this.gl,a=this._activeGeometry;if(a.indexBuffer){var l=a.indexBuffer.data.BYTES_PER_ELEMENT,u=l===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT;l===2||l===4&&this.canUseUInt32ElementIndex?a.instanced?o.drawElementsInstanced(t,r||a.indexBuffer.data.length,u,(n||0)*l,s||1):o.drawElements(t,r||a.indexBuffer.data.length,u,(n||0)*l):console.warn("unsupported index buffer type: uint32")}else a.instanced?o.drawArraysInstanced(t,n,r||a.getSize(),s||1):o.drawArrays(t,n,r||a.getSize());return this},e.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},e})(ne),dp=(function(){function i(e){e===void 0&&(e=null),this.type=Jt.NONE,this.autoDetect=!0,this.maskObject=e||null,this.pooled=!1,this.isMaskData=!0,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._target=null}return i.prototype.reset=function(){this.pooled&&(this.maskObject=null,this.type=Jt.NONE,this.autoDetect=!0),this._target=null},i.prototype.copyCountersOrReset=function(e){e?(this._stencilCounter=e._stencilCounter,this._scissorCounter=e._scissorCounter,this._scissorRect=e._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)},i})();function mc(i,e,t){var r=i.createShader(e);return i.shaderSource(r,t),i.compileShader(r),r}function pp(i,e,t,r){var n=mc(i,i.VERTEX_SHADER,e),s=mc(i,i.FRAGMENT_SHADER,t),o=i.createProgram();if(i.attachShader(o,n),i.attachShader(o,s),r)for(var a in r)i.bindAttribLocation(o,r[a],a);return i.linkProgram(o),i.getProgramParameter(o,i.LINK_STATUS)||(i.getShaderParameter(n,i.COMPILE_STATUS)||(console.warn(e),console.error(i.getShaderInfoLog(n))),i.getShaderParameter(s,i.COMPILE_STATUS)||(console.warn(t),console.error(i.getShaderInfoLog(s))),console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",i.getProgramParameter(o,i.VALIDATE_STATUS)),console.error("gl.getError()",i.getError()),i.getProgramInfoLog(o)!==""&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",i.getProgramInfoLog(o)),i.deleteProgram(o),o=null),i.deleteShader(n),i.deleteShader(s),o}function Qo(i){for(var e=new Array(i),t=0;t<e.length;t++)e[t]=!1;return e}function yp(i,e){switch(i){case"float":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"bool":return!1;case"bvec2":return Qo(2*e);case"bvec3":return Qo(3*e);case"bvec4":return Qo(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}var mp={},Oi=mp;function vp(){if(Oi===mp||Oi&&Oi.isContextLost()){var i=document.createElement("canvas"),e=void 0;nt.PREFER_ENV>=Pe.WEBGL2&&(e=i.getContext("webgl2",{})),e||(e=i.getContext("webgl",{})||i.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),Oi=e}return Oi}var An;function Ng(){if(!An){An=Ie.MEDIUM;var i=vp();if(i&&i.getShaderPrecisionFormat){var e=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT);An=e.precision?Ie.HIGH:Ie.MEDIUM}}return An}function vc(i,e,t){if(i.substring(0,9)!=="precision"){var r=e;return e===Ie.HIGH&&t!==Ie.HIGH&&(r=Ie.MEDIUM),"precision "+r+` float;
`+i}else if(t!==Ie.HIGH&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}var Bg={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function Dg(i){return Bg[i]}var Cn=null,gc={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function bc(i,e){if(!Cn){var t=Object.keys(gc);Cn={};for(var r=0;r<t.length;++r){var n=t[r];Cn[i[n]]=gc[n]}}return Cn[e]}var Jn=[{test:function(i){return i.type==="float"&&i.size===1},code:function(i){return`
            if(uv["`+i+'"] !== ud["'+i+`"].value)
            {
                ud["`+i+'"].value = uv["'+i+`"]
                gl.uniform1f(ud["`+i+'"].location, uv["'+i+`"])
            }
            `}},{test:function(i){return(i.type==="sampler2D"||i.type==="samplerCube"||i.type==="sampler2DArray")&&i.size===1&&!i.isArray},code:function(i){return`t = syncData.textureCount++;

            renderer.texture.bind(uv["`+i+`"], t);

            if(ud["`+i+`"].value !== t)
            {
                ud["`+i+`"].value = t;
                gl.uniform1i(ud["`+i+`"].location, t);
; // eslint-disable-line max-len
            }`}},{test:function(i,e){return i.type==="mat3"&&i.size===1&&e.a!==void 0},code:function(i){return`
            gl.uniformMatrix3fv(ud["`+i+'"].location, false, uv["'+i+`"].toArray(true));
            `}},{test:function(i,e){return i.type==="vec2"&&i.size===1&&e.x!==void 0},code:function(i){return`
                cv = ud["`+i+`"].value;
                v = uv["`+i+`"];

                if(cv[0] !== v.x || cv[1] !== v.y)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    gl.uniform2f(ud["`+i+`"].location, v.x, v.y);
                }`}},{test:function(i){return i.type==="vec2"&&i.size===1},code:function(i){return`
                cv = ud["`+i+`"].value;
                v = uv["`+i+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    gl.uniform2f(ud["`+i+`"].location, v[0], v[1]);
                }
            `}},{test:function(i,e){return i.type==="vec4"&&i.size===1&&e.width!==void 0},code:function(i){return`
                cv = ud["`+i+`"].value;
                v = uv["`+i+`"];

                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)
                {
                    cv[0] = v.x;
                    cv[1] = v.y;
                    cv[2] = v.width;
                    cv[3] = v.height;
                    gl.uniform4f(ud["`+i+`"].location, v.x, v.y, v.width, v.height)
                }`}},{test:function(i){return i.type==="vec4"&&i.size===1},code:function(i){return`
                cv = ud["`+i+`"].value;
                v = uv["`+i+`"];

                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])
                {
                    cv[0] = v[0];
                    cv[1] = v[1];
                    cv[2] = v[2];
                    cv[3] = v[3];

                    gl.uniform4f(ud["`+i+`"].location, v[0], v[1], v[2], v[3])
                }`}}],kg={float:`
    if(cv !== v)
    {
        cv.v = v;
        gl.uniform1f(location, v)
    }`,vec2:`
    if(cv[0] !== v[0] || cv[1] !== v[1])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        gl.uniform2f(location, v[0], v[1])
    }`,vec3:`
    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])
    {
        cv[0] = v[0];
        cv[1] = v[1];
        cv[2] = v[2];

        gl.uniform3f(location, v[0], v[1], v[2])
    }`,vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},Ug={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};function Xg(i,e){var t=[`
        var v = null;
        var cv = null
        var t = 0;
        var gl = renderer.gl
    `];for(var r in i.uniforms){var n=e[r];if(!n){i.uniforms[r].group&&t.push(`
                    renderer.shader.syncUniformGroup(uv["`+r+`"], syncData);
                `);continue}for(var s=i.uniforms[r],o=!1,a=0;a<Jn.length;a++)if(Jn[a].test(n,s)){t.push(Jn[a].code(r,s)),o=!0;break}if(!o){var l=n.size===1?kg:Ug,u=l[n.type].replace("location",'ud["'+r+'"].location');t.push(`
            cv = ud["`+r+`"].value;
            v = uv["`+r+`"];
            `+u+";")}}return new Function("ud","uv","renderer","syncData",t.join(`
`))}var Hg=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Gg(i){for(var e="",t=0;t<i;++t)t>0&&(e+=`
else `),t<i-1&&(e+="if(test == "+t+".0){}");return e}function gp(i,e){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var t=e.createShader(e.FRAGMENT_SHADER);;){var r=Hg.replace(/%forloop%/gi,Gg(i));if(e.shaderSource(t,r),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS))i=i/2|0;else break}return i}var Fi;function Yg(){if(typeof Fi=="boolean")return Fi;try{var i=new Function("param1","param2","param3","return param1[param2] === param3;");Fi=i({a:"b"},"a","b")===!0}catch{Fi=!1}return Fi}var zg=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor *= texture2D(uSampler, vTextureCoord);
}`,Vg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void){
   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vTextureCoord = aTextureCoord;
}
`,qg=0,Pn={},Ti=(function(){function i(e,t,r){r===void 0&&(r="pixi-shader"),this.id=qg++,this.vertexSrc=e||i.defaultVertexSrc,this.fragmentSrc=t||i.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.vertexSrc.substring(0,8)!=="#version"&&(r=r.replace(/\s+/g,"-"),Pn[r]?(Pn[r]++,r+="-"+Pn[r]):Pn[r]=1,this.vertexSrc="#define SHADER_NAME "+r+`
`+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+r+`
`+this.fragmentSrc,this.vertexSrc=vc(this.vertexSrc,nt.PRECISION_VERTEX,Ie.HIGH),this.fragmentSrc=vc(this.fragmentSrc,nt.PRECISION_FRAGMENT,Ng())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null}return i.prototype.extractData=function(e,t){var r=vp();if(r){var n=pp(r,e,t);this.attributeData=this.getAttributeData(n,r),this.uniformData=this.getUniformData(n,r),r.deleteProgram(n)}else this.uniformData={},this.attributeData={}},i.prototype.getAttributeData=function(e,t){for(var r={},n=[],s=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<s;o++){var a=t.getActiveAttrib(e,o),l=bc(t,a.type),u={type:l,name:a.name,size:Dg(l),location:0};r[a.name]=u,n.push(u)}n.sort(function(h,c){return h.name>c.name?1:-1});for(var o=0;o<n.length;o++)n[o].location=o;return r},i.prototype.getUniformData=function(e,t){for(var r={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),s=0;s<n;s++){var o=t.getActiveUniform(e,s),a=o.name.replace(/\[.*?\]$/,""),l=o.name.match(/\[.*?\]$/),u=bc(t,o.type);r[a]={type:u,size:o.size,isArray:l,value:yp(u,o.size)}}return r},Object.defineProperty(i,"defaultVertexSrc",{get:function(){return Vg},enumerable:!1,configurable:!0}),Object.defineProperty(i,"defaultFragmentSrc",{get:function(){return zg},enumerable:!1,configurable:!0}),i.from=function(e,t,r){var n=e+t,s=Na[n];return s||(Na[n]=s=new i(e,t,r)),s},i})(),qe=(function(){function i(e,t){this.program=e,t?t instanceof lr?this.uniformGroup=t:this.uniformGroup=new lr(t):this.uniformGroup=new lr({});for(var r in e.uniformData)this.uniformGroup.uniforms[r]instanceof Array&&(this.uniformGroup.uniforms[r]=new Float32Array(this.uniformGroup.uniforms[r]))}return i.prototype.checkUniformExists=function(e,t){if(t.uniforms[e])return!0;for(var r in t.uniforms){var n=t.uniforms[r];if(n.group&&this.checkUniformExists(e,n))return!0}return!1},i.prototype.destroy=function(){this.uniformGroup=null},Object.defineProperty(i.prototype,"uniforms",{get:function(){return this.uniformGroup.uniforms},enumerable:!1,configurable:!0}),i.from=function(e,t,r){var n=Ti.from(e,t);return new i(n,r)},i})(),ta=0,ea=1,ra=2,ia=3,na=4,cr=(function(){function i(){this.data=0,this.blendMode=st.NORMAL,this.polygonOffset=0,this.blend=!0}return Object.defineProperty(i.prototype,"blend",{get:function(){return!!(this.data&1<<ta)},set:function(e){!!(this.data&1<<ta)!==e&&(this.data^=1<<ta)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"offsets",{get:function(){return!!(this.data&1<<ea)},set:function(e){!!(this.data&1<<ea)!==e&&(this.data^=1<<ea)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"culling",{get:function(){return!!(this.data&1<<ra)},set:function(e){!!(this.data&1<<ra)!==e&&(this.data^=1<<ra)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"depthTest",{get:function(){return!!(this.data&1<<ia)},set:function(e){!!(this.data&1<<ia)!==e&&(this.data^=1<<ia)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"clockwiseFrontFace",{get:function(){return!!(this.data&1<<na)},set:function(e){!!(this.data&1<<na)!==e&&(this.data^=1<<na)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"blendMode",{get:function(){return this._blendMode},set:function(e){this.blend=e!==st.NONE,this._blendMode=e},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"polygonOffset",{get:function(){return this._polygonOffset},set:function(e){this.offsets=!!e,this._polygonOffset=e},enumerable:!1,configurable:!0}),i.for2d=function(){var e=new i;return e.depthTest=!1,e.blend=!0,e},i})(),$g=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,jg=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;

void main(void){
   gl_FragColor = texture2D(uSampler, vTextureCoord);
}
`,We=(function(i){ft(e,i);function e(t,r,n){var s=this,o=Ti.from(t||e.defaultVertexSrc,r||e.defaultFragmentSrc);return s=i.call(this,o,n)||this,s.padding=0,s.resolution=nt.FILTER_RESOLUTION,s.enabled=!0,s.autoFit=!0,s.legacy=!!s.program.attributeData.aTextureCoord,s.state=new cr,s}return e.prototype.apply=function(t,r,n,s,o){t.applyFilter(this,r,n,s)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultVertexSrc",{get:function(){return $g},enumerable:!1,configurable:!0}),Object.defineProperty(e,"defaultFragmentSrc",{get:function(){return jg},enumerable:!1,configurable:!0}),e})(qe),Wg=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 otherMatrix;

varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;
}
`,Kg=`varying vec2 vMaskCoord;
varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform sampler2D mask;
uniform float alpha;
uniform float npmAlpha;
uniform vec4 maskClamp;

void main(void)
{
    float clip = step(3.5,
        step(maskClamp.x, vMaskCoord.x) +
        step(maskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, maskClamp.z) +
        step(vMaskCoord.y, maskClamp.w));

    vec4 original = texture2D(uSampler, vTextureCoord);
    vec4 masky = texture2D(mask, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    original *= (alphaMul * masky.r * alpha * clip);

    gl_FragColor = original;
}
`,_c=new Mt,Ps=(function(){function i(e,t){this._texture=e,this.mapCoord=new Mt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=typeof t>"u"?.5:t,this.isSimple=!1}return Object.defineProperty(i.prototype,"texture",{get:function(){return this._texture},set:function(e){this._texture=e,this._textureID=-1},enumerable:!1,configurable:!0}),i.prototype.multiplyUvs=function(e,t){t===void 0&&(t=e);for(var r=this.mapCoord,n=0;n<e.length;n+=2){var s=e[n],o=e[n+1];t[n]=s*r.a+o*r.c+r.tx,t[n+1]=s*r.b+o*r.d+r.ty}return t},i.prototype.update=function(e){var t=this._texture;if(!t||!t.valid||!e&&this._textureID===t._updateID)return!1;this._textureID=t._updateID,this._updateID++;var r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=t.orig,s=t.trim;s&&(_c.set(n.width/s.width,0,0,n.height/s.height,-s.x/s.width,-s.y/s.height),this.mapCoord.append(_c));var o=t.baseTexture,a=this.uClampFrame,l=this.clampMargin/o.resolution,u=this.clampOffset;return a[0]=(t._frame.x+l+u)/o.width,a[1]=(t._frame.y+l+u)/o.height,a[2]=(t._frame.x+t._frame.width-l+u)/o.width,a[3]=(t._frame.y+t._frame.height-l+u)/o.height,this.uClampOffset[0]=u/o.realWidth,this.uClampOffset[1]=u/o.realHeight,this.isSimple=t._frame.width===o.width&&t._frame.height===o.height&&t.rotate===0,!0},i})(),bp=(function(i){ft(e,i);function e(t){var r=this,n=new Mt;return r=i.call(this,Wg,Kg)||this,t.renderable=!1,r.maskSprite=t,r.maskMatrix=n,r}return e.prototype.apply=function(t,r,n,s){var o=this.maskSprite,a=o._texture;a.valid&&(a.uvMatrix||(a.uvMatrix=new Ps(a,0)),a.uvMatrix.update(),this.uniforms.npmAlpha=a.baseTexture.alphaMode?0:1,this.uniforms.mask=a,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,o).prepend(a.uvMatrix.mapCoord),this.uniforms.alpha=o.worldAlpha,this.uniforms.maskClamp=a.uvMatrix.uClampFrame,t.applyFilter(this,r,n,s))},e})(We),_p=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.enableScissor=!1,r.alphaMaskPool=[],r.maskDataPool=[],r.maskStack=[],r.alphaMaskIndex=0,r}return e.prototype.setMaskStack=function(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)},e.prototype.push=function(t,r){var n=r;if(!n.isMaskData){var s=this.maskDataPool.pop()||new dp;s.pooled=!0,s.maskObject=r,n=s}switch(n.autoDetect&&this.detect(n),n.copyCountersOrReset(this.maskStack[this.maskStack.length-1]),n._target=t,n.type){case Jt.SCISSOR:this.maskStack.push(n),this.renderer.scissor.push(n);break;case Jt.STENCIL:this.maskStack.push(n),this.renderer.stencil.push(n);break;case Jt.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n),this.maskStack.push(n);break}},e.prototype.pop=function(t){var r=this.maskStack.pop();if(!(!r||r._target!==t)){switch(r.type){case Jt.SCISSOR:this.renderer.scissor.pop();break;case Jt.STENCIL:this.renderer.stencil.pop(r.maskObject);break;case Jt.SPRITE:this.popSpriteMask();break}r.reset(),r.pooled&&this.maskDataPool.push(r)}},e.prototype.detect=function(t){var r=t.maskObject;if(r.isSprite){t.type=Jt.SPRITE;return}if(t.type=Jt.STENCIL,this.enableScissor&&r.isFastRect&&r.isFastRect()){var n=r.worldTransform,s=Math.atan2(n.b,n.a),o=Math.atan2(n.d,n.c);s=Math.round(s*(180/Math.PI)*100),o=Math.round(o*(180/Math.PI)*100)-s,s=(s%9e3+9e3)%9e3,o=(o%18e3+18e3)%18e3,s===0&&o===9e3&&(t.type=Jt.SCISSOR)}},e.prototype.pushSpriteMask=function(t){var r=t.maskObject,n=t._target,s=this.alphaMaskPool[this.alphaMaskIndex];s||(s=this.alphaMaskPool[this.alphaMaskIndex]=[new bp(r)]),s[0].resolution=this.renderer.resolution,s[0].maskSprite=r;var o=n.filterArea;n.filterArea=r.getBounds(!0),this.renderer.filter.push(n,s),n.filterArea=o,this.alphaMaskIndex++},e.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},e})(ne),xp=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.maskStack=[],r.glConst=0,r}return e.prototype.getStackLength=function(){return this.maskStack.length},e.prototype.setMaskStack=function(t){var r=this.renderer.gl,n=this.getStackLength();this.maskStack=t;var s=this.getStackLength();s!==n&&(s===0?r.disable(this.glConst):(r.enable(this.glConst),this._useCurrent()))},e.prototype._useCurrent=function(){},e.prototype.destroy=function(){i.prototype.destroy.call(this),this.maskStack=null},e})(ne),wp=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.glConst=WebGLRenderingContext.SCISSOR_TEST,r}return e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0},e.prototype.push=function(t){var r=t.maskObject;r.renderable=!0;var n=t._scissorRect,s=r.getBounds(!0),o=this.renderer.gl;r.renderable=!1,n?s.fit(n):o.enable(o.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=s,this._useCurrent()},e.prototype.pop=function(){var t=this.renderer.gl;this.getStackLength()>0?this._useCurrent():t.disable(t.SCISSOR_TEST)},e.prototype._useCurrent=function(){var t=this.maskStack[this.maskStack.length-1]._scissorRect,r=this.renderer.renderTexture.current,n=this.renderer.projection,s=n.transform,o=n.sourceFrame,a=n.destinationFrame,l=r?r.resolution:this.renderer.resolution,u=(t.x-o.x)*l+a.x,h=(t.y-o.y)*l+a.y,c=t.width*l,f=t.height*l;s&&(u+=s.tx*l,h+=s.ty*l),r||(h=this.renderer.height-f-h),this.renderer.gl.scissor(u,h,c,f)},e})(xp),Tp=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.glConst=WebGLRenderingContext.STENCIL_TEST,r}return e.prototype.getStackLength=function(){var t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0},e.prototype.push=function(t){var r=t.maskObject,n=this.renderer.gl,s=t._stencilCounter;s===0&&(this.renderer.framebuffer.forceStencil(),n.enable(n.STENCIL_TEST)),t._stencilCounter++,n.colorMask(!1,!1,!1,!1),n.stencilFunc(n.EQUAL,s,this._getBitwiseMask()),n.stencilOp(n.KEEP,n.KEEP,n.INCR),r.renderable=!0,r.render(this.renderer),this.renderer.batch.flush(),r.renderable=!1,this._useCurrent()},e.prototype.pop=function(t){var r=this.renderer.gl;this.getStackLength()===0?(r.disable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),r.clearStencil(0)):(r.colorMask(!1,!1,!1,!1),r.stencilOp(r.KEEP,r.KEEP,r.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},e.prototype._useCurrent=function(){var t=this.renderer.gl;t.colorMask(!0,!0,!0,!0),t.stencilFunc(t.EQUAL,this.getStackLength(),this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)},e.prototype._getBitwiseMask=function(){return(1<<this.getStackLength())-1},e})(xp),Ip=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.destinationFrame=null,r.sourceFrame=null,r.defaultFrame=null,r.projectionMatrix=new Mt,r.transform=null,r}return e.prototype.update=function(t,r,n,s){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=r||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,s),this.transform&&this.projectionMatrix.append(this.transform);var o=this.renderer;o.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,o.globalUniforms.update(),o.shader.shader&&o.shader.syncUniformGroup(o.shader.shader.uniforms.globals)},e.prototype.calculateProjection=function(t,r,n,s){var o=this.projectionMatrix,a=s?-1:1;o.identity(),o.a=1/r.width*2,o.d=a*(1/r.height*2),o.tx=-1-r.x*o.a,o.ty=-a-r.y*o.d},e.prototype.setTransform=function(t){},e})(ne),yr=new vt,Ri=new vt,Mi=new vt,Ep=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.clearColor=t._backgroundColorRgba,r.defaultMaskStack=[],r.current=null,r.sourceFrame=new vt,r.destinationFrame=new vt,r}return e.prototype.bind=function(t,r,n){t===void 0&&(t=null);var s=this.renderer;this.current=t;var o,a,l;t?(o=t.baseTexture,l=o.resolution,r||(yr.width=t.frame.width,yr.height=t.frame.height,r=yr),n||(Ri.x=t.frame.x,Ri.y=t.frame.y,Ri.width=r.width,Ri.height=r.height,n=Ri),a=o.framebuffer):(l=s.resolution,r||(yr.width=s.screen.width,yr.height=s.screen.height,r=yr),n||(n=yr,n.width=r.width,n.height=r.height)),Mi.x=n.x*l,Mi.y=n.y*l,Mi.width=n.width*l,Mi.height=n.height*l,this.renderer.framebuffer.bind(a,Mi),this.renderer.projection.update(n,r,l,!a),t?this.renderer.mask.setMaskStack(o.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(r),this.destinationFrame.copyFrom(n)},e.prototype.clear=function(t,r){this.current?t=t||this.current.baseTexture.clearColor:t=t||this.clearColor,this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],r)},e.prototype.resize=function(){this.bind(null)},e.prototype.reset=function(){this.bind(null)},e})(ne),Zg=(function(){function i(){}return i})(),Sp=(function(){function i(e,t){this.program=e,this.uniformData=t,this.uniformGroups={}}return i.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null},i})(),Jg=0,xc={textureCount:0},Ap=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.destroyed=!1,r.systemCheck(),r.gl=null,r.shader=null,r.program=null,r.cache={},r.id=Jg++,r}return e.prototype.systemCheck=function(){if(!Yg())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},e.prototype.contextChange=function(t){this.gl=t,this.reset()},e.prototype.bind=function(t,r){t.uniforms.globals=this.renderer.globalUniforms;var n=t.program,s=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(s.program)),r||(xc.textureCount=0,this.syncUniformGroup(t.uniformGroup,xc)),s},e.prototype.setUniforms=function(t){var r=this.shader.program,n=r.glPrograms[this.renderer.CONTEXT_UID];r.syncUniforms(n.uniformData,t,this.renderer)},e.prototype.syncUniformGroup=function(t,r){var n=this.getglProgram();(!t.static||t.dirtyId!==n.uniformGroups[t.id])&&(n.uniformGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,r))},e.prototype.syncUniforms=function(t,r,n){var s=t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t);s(r.uniformData,t.uniforms,this.renderer,n)},e.prototype.createSyncGroups=function(t){var r=this.getSignature(t,this.shader.program.uniformData);return this.cache[r]||(this.cache[r]=Xg(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[r],t.syncUniforms[this.shader.program.id]},e.prototype.getSignature=function(t,r){var n=t.uniforms,s=[];for(var o in n)s.push(o),r[o]&&s.push(r[o].type);return s.join("-")},e.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},e.prototype.generateShader=function(t){var r=this.gl,n=t.program,s={};for(var o in n.attributeData)s[o]=n.attributeData[o].location;var a=pp(r,n.vertexSrc,n.fragmentSrc,s),l={};for(var o in n.uniformData){var u=n.uniformData[o];l[o]={location:r.getUniformLocation(a,o),value:yp(u.type,u.size)}}var h=new Sp(a,l);return n.glPrograms[this.renderer.CONTEXT_UID]=h,h},e.prototype.reset=function(){this.program=null,this.shader=null},e.prototype.destroy=function(){this.destroyed=!0},e})(ne);function Qg(i,e){return e===void 0&&(e=[]),e[st.NORMAL]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.ADD]=[i.ONE,i.ONE],e[st.MULTIPLY]=[i.DST_COLOR,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.SCREEN]=[i.ONE,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.OVERLAY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.DARKEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.LIGHTEN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.COLOR_DODGE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.COLOR_BURN]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.HARD_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.SOFT_LIGHT]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.DIFFERENCE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.EXCLUSION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.HUE]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.SATURATION]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.COLOR]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.LUMINOSITY]=[i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.NONE]=[0,0],e[st.NORMAL_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.ADD_NPM]=[i.SRC_ALPHA,i.ONE,i.ONE,i.ONE],e[st.SCREEN_NPM]=[i.SRC_ALPHA,i.ONE_MINUS_SRC_COLOR,i.ONE,i.ONE_MINUS_SRC_ALPHA],e[st.SRC_IN]=[i.DST_ALPHA,i.ZERO],e[st.SRC_OUT]=[i.ONE_MINUS_DST_ALPHA,i.ZERO],e[st.SRC_ATOP]=[i.DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],e[st.DST_OVER]=[i.ONE_MINUS_DST_ALPHA,i.ONE],e[st.DST_IN]=[i.ZERO,i.SRC_ALPHA],e[st.DST_OUT]=[i.ZERO,i.ONE_MINUS_SRC_ALPHA],e[st.DST_ATOP]=[i.ONE_MINUS_DST_ALPHA,i.SRC_ALPHA],e[st.XOR]=[i.ONE_MINUS_DST_ALPHA,i.ONE_MINUS_SRC_ALPHA],e[st.SUBTRACT]=[i.ONE,i.ONE,i.ONE,i.ONE,i.FUNC_REVERSE_SUBTRACT,i.FUNC_ADD],e}var t0=0,e0=1,r0=2,i0=3,n0=4,Cp=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.gl=null,r.stateId=0,r.polygonOffset=0,r.blendMode=st.NONE,r._blendEq=!1,r.map=[],r.map[t0]=r.setBlend,r.map[e0]=r.setOffset,r.map[r0]=r.setCullFace,r.map[i0]=r.setDepthTest,r.map[n0]=r.setFrontFace,r.checks=[],r.defaultState=new cr,r.defaultState.blend=!0,r}return e.prototype.contextChange=function(t){this.gl=t,this.blendModes=Qg(t),this.set(this.defaultState),this.reset()},e.prototype.set=function(t){if(t=t||this.defaultState,this.stateId!==t.data){for(var r=this.stateId^t.data,n=0;r;)r&1&&this.map[n].call(this,!!(t.data&1<<n)),r=r>>1,n++;this.stateId=t.data}for(var n=0;n<this.checks.length;n++)this.checks[n](this,t)},e.prototype.forceState=function(t){t=t||this.defaultState;for(var r=0;r<this.map.length;r++)this.map[r].call(this,!!(t.data&1<<r));for(var r=0;r<this.checks.length;r++)this.checks[r](this,t);this.stateId=t.data},e.prototype.setBlend=function(t){this.updateCheck(e.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)},e.prototype.setOffset=function(t){this.updateCheck(e.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},e.prototype.setDepthTest=function(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)},e.prototype.setCullFace=function(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)},e.prototype.setFrontFace=function(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])},e.prototype.setBlendMode=function(t){if(t!==this.blendMode){this.blendMode=t;var r=this.blendModes[t],n=this.gl;r.length===2?n.blendFunc(r[0],r[1]):n.blendFuncSeparate(r[0],r[1],r[2],r[3]),r.length===6?(this._blendEq=!0,n.blendEquationSeparate(r[4],r[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}},e.prototype.setPolygonOffset=function(t,r){this.gl.polygonOffset(t,r)},e.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},e.prototype.updateCheck=function(t,r){var n=this.checks.indexOf(t);r&&n===-1?this.checks.push(t):!r&&n!==-1&&this.checks.splice(n,1)},e.checkBlendMode=function(t,r){t.setBlendMode(r.blendMode)},e.checkPolygonOffset=function(t,r){t.setPolygonOffset(1,r.polygonOffset)},e})(ne),Pp=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.count=0,r.checkCount=0,r.maxIdle=nt.GC_MAX_IDLE,r.checkCountMax=nt.GC_MAX_CHECK_COUNT,r.mode=nt.GC_MODE,r}return e.prototype.postrender=function(){this.renderer.renderingToScreen&&(this.count++,this.mode!==ds.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))},e.prototype.run=function(){for(var t=this.renderer.texture,r=t.managedTextures,n=!1,s=0;s<r.length;s++){var o=r[s];!o.framebuffer&&this.count-o.touched>this.maxIdle&&(t.destroyTexture(o,!0),r[s]=null,n=!0)}if(n){for(var a=0,s=0;s<r.length;s++)r[s]!==null&&(r[a++]=r[s]);r.length=a}},e.prototype.unload=function(t){var r=this.renderer.texture,n=t._texture;n&&!n.framebuffer&&r.destroyTexture(n);for(var s=t.children.length-1;s>=0;s--)this.unload(t.children[s])},e})(ne),Qn=(function(){function i(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121}return i})(),Op=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.boundTextures=[],r.currentLocation=-1,r.managedTextures=[],r._unknownBoundTextures=!1,r.unknownTexture=new It,r}return e.prototype.contextChange=function(){var t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var r=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=r;for(var n=0;n<r;n++)this.boundTextures[n]=null;this.emptyTextures={};var s=new Qn(t.createTexture());t.bindTexture(t.TEXTURE_2D,s.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=s,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new Qn(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(var n=0;n<6;n++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(var n=0;n<this.boundTextures.length;n++)this.bind(null,n)},e.prototype.bind=function(t,r){r===void 0&&(r=0);var n=this.gl;if(t){if(t=t.castToBaseTexture(),t.parentTextureArray)return;if(t.valid){t.touched=this.renderer.textureGC.count;var s=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[r]!==t&&(this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),n.bindTexture(t.target,s.texture)),s.dirtyId!==t.dirtyId&&(this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),this.updateTexture(t)),this.boundTextures[r]=t}}else this.currentLocation!==r&&(this.currentLocation=r,n.activeTexture(n.TEXTURE0+r)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[r]=null},e.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture},e.prototype.unbind=function(t){var r=this,n=r.gl,s=r.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var o=0;o<s.length;o++)s[o]===this.unknownTexture&&this.bind(null,o)}for(var o=0;o<s.length;o++)s[o]===t&&(this.currentLocation!==o&&(n.activeTexture(n.TEXTURE0+o),this.currentLocation=o),n.bindTexture(t.target,this.emptyTextures[t.target].texture),s[o]=null)},e.prototype.initTexture=function(t){var r=new Qn(this.gl.createTexture());return r.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=r,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),r},e.prototype.initTextureType=function(t,r){if(r.internalFormat=t.format,r.type=t.type,this.webGLVersion===2){var n=this.renderer.gl;t.type===n.FLOAT&&t.format===n.RGBA&&(r.internalFormat=n.RGBA32F),t.type===Nt.HALF_FLOAT&&(r.type=n.HALF_FLOAT),r.type===n.HALF_FLOAT&&t.format===n.RGBA&&(r.internalFormat=n.RGBA16F)}},e.prototype.updateTexture=function(t){var r=t._glTextures[this.CONTEXT_UID];if(r){var n=this.renderer;if(this.initTextureType(t,r),!(t.resource&&t.resource.upload(n,t,r))){var s=t.realWidth,o=t.realHeight,a=n.gl;(r.width!==s||r.height!==o||r.dirtyId<0)&&(r.width=s,r.height=o,a.texImage2D(t.target,0,r.internalFormat,s,o,0,t.format,r.type,null))}t.dirtyStyleId!==r.dirtyStyleId&&this.updateTextureStyle(t),r.dirtyId=t.dirtyId}},e.prototype.destroyTexture=function(t,r){var n=this.gl;if(t=t.castToBaseTexture(),t._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!r)){var s=this.managedTextures.indexOf(t);s!==-1&&Sr(this.managedTextures,s,1)}},e.prototype.updateTextureStyle=function(t){var r=t._glTextures[this.CONTEXT_UID];r&&((t.mipmap===hi.POW2||this.webGLVersion!==2)&&!t.isPowerOfTwo?r.mipmap=!1:r.mipmap=t.mipmap>=1,this.webGLVersion!==2&&!t.isPowerOfTwo?r.wrapMode=Ae.CLAMP:r.wrapMode=t.wrapMode,t.resource&&t.resource.style(this.renderer,t,r)||this.setStyle(t,r),r.dirtyStyleId=t.dirtyStyleId)},e.prototype.setStyle=function(t,r){var n=this.gl;if(r.mipmap&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,r.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,r.wrapMode),r.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===Te.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);var s=this.renderer.context.extensions.anisotropicFiltering;if(s&&t.anisotropicLevel>0&&t.scaleMode===Te.LINEAR){var o=Math.min(t.anisotropicLevel,n.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,s.TEXTURE_MAX_ANISOTROPY_EXT,o)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===Te.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===Te.LINEAR?n.LINEAR:n.NEAREST)},e})(ne),s0={FilterSystem:ap,BatchSystem:lp,ContextSystem:up,FramebufferSystem:cp,GeometrySystem:fp,MaskSystem:_p,ScissorSystem:wp,StencilSystem:Tp,ProjectionSystem:Ip,RenderTextureSystem:Ep,ShaderSystem:Ap,StateSystem:Cp,TextureGCSystem:Pp,TextureSystem:Op},sa=new Mt,Fp=(function(i){ft(e,i);function e(t,r){t===void 0&&(t=li.UNKNOWN);var n=i.call(this)||this;return r=Object.assign({},nt.RENDER_OPTIONS,r),r.roundPixels&&(nt.ROUND_PIXELS=r.roundPixels,K("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),n.options=r,n.type=t,n.screen=new vt(0,0,r.width,r.height),n.view=r.view||document.createElement("canvas"),n.resolution=r.resolution||nt.RESOLUTION,n.transparent=r.transparent,n.autoDensity=r.autoDensity||r.autoResize||!1,n.preserveDrawingBuffer=r.preserveDrawingBuffer,n.clearBeforeRender=r.clearBeforeRender,n._backgroundColor=0,n._backgroundColorRgba=[0,0,0,0],n._backgroundColorString="#000000",n.backgroundColor=r.backgroundColor||n._backgroundColor,n._lastObjectRendered=null,n.plugins={},n}return e.prototype.initPlugins=function(t){for(var r in t)this.plugins[r]=new t[r](this)},Object.defineProperty(e.prototype,"width",{get:function(){return this.view.width},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.view.height},enumerable:!1,configurable:!0}),e.prototype.resize=function(t,r){this.screen.width=t,this.screen.height=r,this.view.width=t*this.resolution,this.view.height=r*this.resolution,this.autoDensity&&(this.view.style.width=t+"px",this.view.style.height=r+"px"),this.emit("resize",t,r)},e.prototype.generateTexture=function(t,r,n,s){s=s||t.getLocalBounds(null,!0),s.width===0&&(s.width=1),s.height===0&&(s.height=1);var o=Or.create({width:s.width|0,height:s.height|0,scaleMode:r,resolution:n});return sa.tx=-s.x,sa.ty=-s.y,this.render(t,o,!1,sa,!!t.parent),o},e.prototype.destroy=function(t){for(var r in this.plugins)this.plugins[r].destroy(),this.plugins[r]=null;t&&this.view.parentNode&&this.view.parentNode.removeChild(this.view);var n=this;n.plugins=null,n.type=li.UNKNOWN,n.view=null,n.screen=null,n._tempDisplayObjectParent=null,n.options=null,this._backgroundColorRgba=null,this._backgroundColorString=null,this._lastObjectRendered=null},Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(t){this._backgroundColor=t,this._backgroundColorString=ql(t),Cr(t,this._backgroundColorRgba)},enumerable:!1,configurable:!0}),e})(_i),Me=(function(i){ft(e,i);function e(t){var r=i.call(this,li.WEBGL,t)||this;return t=r.options,r.gl=null,r.CONTEXT_UID=0,r.runners={destroy:new Yt("destroy"),contextChange:new Yt("contextChange"),reset:new Yt("reset"),update:new Yt("update"),postrender:new Yt("postrender"),prerender:new Yt("prerender"),resize:new Yt("resize")},r.globalUniforms=new lr({projectionMatrix:new Mt},!0),r.addSystem(_p,"mask").addSystem(up,"context").addSystem(Cp,"state").addSystem(Ap,"shader").addSystem(Op,"texture").addSystem(fp,"geometry").addSystem(cp,"framebuffer").addSystem(wp,"scissor").addSystem(Tp,"stencil").addSystem(Ip,"projection").addSystem(Pp,"textureGC").addSystem(ap,"filter").addSystem(Ep,"renderTexture").addSystem(lp,"batch"),r.initPlugins(e.__plugins),t.context?r.context.initFromContext(t.context):r.context.initFromOptions({alpha:!!r.transparent,antialias:t.antialias,premultipliedAlpha:r.transparent&&r.transparent!=="notMultiplied",stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:r.options.powerPreference}),r.renderingToScreen=!0,Rd(r.context.webGLVersion===2?"WebGL 2":"WebGL 1"),r.resize(r.options.width,r.options.height),r}return e.create=function(t){if(Md())return new e(t);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},e.prototype.addSystem=function(t,r){r||(r=t.name);var n=new t(this);if(this[r])throw new Error('Whoops! The name "'+r+'" is already in use');this[r]=n;for(var s in this.runners)this.runners[s].add(n);return this},e.prototype.render=function(t,r,n,s,o){if(this.renderingToScreen=!r,this.runners.prerender.emit(),this.emit("prerender"),this.projection.transform=s,!this.context.isLost){if(r||(this._lastObjectRendered=t),!o){var a=t.enableTempParent();t.updateTransform(),t.disableTempParent(a)}this.renderTexture.bind(r),this.batch.currentRenderer.start(),(n!==void 0?n:this.clearBeforeRender)&&this.renderTexture.clear(),t.render(this),this.batch.currentRenderer.flush(),r&&r.baseTexture.update(),this.runners.postrender.emit(),this.projection.transform=null,this.emit("postrender")}},e.prototype.resize=function(t,r){i.prototype.resize.call(this,t,r),this.runners.resize.emit(t,r)},e.prototype.reset=function(){return this.runners.reset.emit(),this},e.prototype.clear=function(){this.renderTexture.bind(),this.renderTexture.clear()},e.prototype.destroy=function(t){this.runners.destroy.emit();for(var r in this.runners)this.runners[r].destroy();i.prototype.destroy.call(this,t),this.gl=null},e.registerPlugin=function(t,r){e.__plugins=e.__plugins||{},e.__plugins[t]=r},e})(Fp);function Rp(i){return Me.create(i)}var Mp=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
    vTextureCoord = aTextureCoord;
}`,au=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 vTextureCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
    gl_Position = filterVertexPosition();
    vTextureCoord = filterTextureCoord();
}
`,ms=(function(){function i(){this.texArray=null,this.blend=0,this.type=ue.TRIANGLES,this.start=0,this.size=0,this.data=null}return i})(),vs=(function(){function i(){this.elements=[],this.ids=[],this.count=0}return i.prototype.clear=function(){for(var e=0;e<this.count;e++)this.elements[e]=null;this.count=0},i})(),Lp=(function(){function i(e){this.rawBinaryData=new ArrayBuffer(e),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}return Object.defineProperty(i.prototype,"int8View",{get:function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uint8View",{get:function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"int16View",{get:function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"uint16View",{get:function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"int32View",{get:function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},enumerable:!1,configurable:!0}),i.prototype.view=function(e){return this[e+"View"]},i.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},i.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},i})(),Np=(function(i){ft(e,i);function e(t){var r=i.call(this,t)||this;return r.shaderGenerator=null,r.geometryClass=null,r.vertexSize=null,r.state=cr.for2d(),r.size=nt.SPRITE_BATCH_SIZE*4,r._vertexCount=0,r._indexCount=0,r._bufferedElements=[],r._bufferedTextures=[],r._bufferSize=0,r._shader=null,r._packedGeometries=[],r._packedGeometryPoolSize=2,r._flushId=0,r._aBuffers={},r._iBuffers={},r.MAX_TEXTURES=1,r.renderer.on("prerender",r.onPrerender,r),t.runners.contextChange.add(r),r._dcIndex=0,r._aIndex=0,r._iIndex=0,r._attributeBuffer=null,r._indexBuffer=null,r._tempBoundTextures=[],r}return e.prototype.contextChange=function(){var t=this.renderer.gl;nt.PREFER_ENV===Pe.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),nt.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=gp(this.MAX_TEXTURES,t)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var r=0;r<this._packedGeometryPoolSize;r++)this._packedGeometries[r]=new this.geometryClass;this.initFlushBuffers()},e.prototype.initFlushBuffers=function(){for(var t=e._drawCallPool,r=e._textureArrayPool,n=this.size/4,s=Math.floor(n/this.MAX_TEXTURES)+1;t.length<n;)t.push(new ms);for(;r.length<s;)r.push(new vs);for(var o=0;o<this.MAX_TEXTURES;o++)this._tempBoundTextures[o]=null},e.prototype.onPrerender=function(){this._flushId=0},e.prototype.render=function(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)},e.prototype.buildTexturesAndDrawCalls=function(){var t=this,r=t._bufferedTextures,n=t.MAX_TEXTURES,s=e._textureArrayPool,o=this.renderer.batch,a=this._tempBoundTextures,l=this.renderer.textureGC.count,u=++It._globalBatch,h=0,c=s[0],f=0;o.copyBoundTextures(a,n);for(var d=0;d<this._bufferSize;++d){var p=r[d];r[d]=null,p._batchEnabled!==u&&(c.count>=n&&(o.boundArray(c,a,u,n),this.buildDrawCalls(c,f,d),f=d,c=s[++h],++u),p._batchEnabled=u,p.touched=l,c.elements[c.count++]=p)}c.count>0&&(o.boundArray(c,a,u,n),this.buildDrawCalls(c,f,this._bufferSize),++h,++u);for(var d=0;d<a.length;d++)a[d]=null;It._globalBatch=u},e.prototype.buildDrawCalls=function(t,r,n){var s=this,o=s._bufferedElements,a=s._attributeBuffer,l=s._indexBuffer,u=s.vertexSize,h=e._drawCallPool,c=this._dcIndex,f=this._aIndex,d=this._iIndex,p=h[c];p.start=this._iIndex,p.texArray=t;for(var v=r;v<n;++v){var m=o[v],g=m._texture.baseTexture,E=jl[g.alphaMode?1:0][m.blendMode];o[v]=null,r<v&&p.blend!==E&&(p.size=d-p.start,r=v,p=h[++c],p.texArray=t,p.start=d),this.packInterleavedGeometry(m,a,l,f,d),f+=m.vertexData.length/2*u,d+=m.indices.length,p.blend=E}r<n&&(p.size=d-p.start,++c),this._dcIndex=c,this._aIndex=f,this._iIndex=d},e.prototype.bindAndClearTexArray=function(t){for(var r=this.renderer.texture,n=0;n<t.count;n++)r.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0},e.prototype.updateGeometry=function(){var t=this,r=t._packedGeometries,n=t._attributeBuffer,s=t._indexBuffer;nt.CAN_UPLOAD_SAME_BUFFER?(r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(s),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,r[this._flushId]=new this.geometryClass),r[this._flushId]._buffer.update(n.rawBinaryData),r[this._flushId]._indexBuffer.update(s),this.renderer.geometry.bind(r[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)},e.prototype.drawBatches=function(){for(var t=this._dcIndex,r=this.renderer,n=r.gl,s=r.state,o=e._drawCallPool,a=null,l=0;l<t;l++){var u=o[l],h=u.texArray,c=u.type,f=u.size,d=u.start,p=u.blend;a!==h&&(a=h,this.bindAndClearTexArray(h)),this.state.blendMode=p,s.set(this.state),n.drawElements(c,f,n.UNSIGNED_SHORT,d*2)}},e.prototype.flush=function(){this._vertexCount!==0&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)},e.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),nt.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},e.prototype.stop=function(){this.flush()},e.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),i.prototype.destroy.call(this)},e.prototype.getAttributeBuffer=function(t){var r=Ki(Math.ceil(t/8)),n=La(r),s=r*8;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._aBuffers[s];return o||(this._aBuffers[s]=o=new Lp(s*this.vertexSize*4)),o},e.prototype.getIndexBuffer=function(t){var r=Ki(Math.ceil(t/12)),n=La(r),s=r*12;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);var o=this._iBuffers[n];return o||(this._iBuffers[n]=o=new Uint16Array(s)),o},e.prototype.packInterleavedGeometry=function(t,r,n,s,o){for(var a=r.uint32View,l=r.float32View,u=s/this.vertexSize,h=t.uvs,c=t.indices,f=t.vertexData,d=t._texture.baseTexture._batchLocation,p=Math.min(t.worldAlpha,1),v=p<1&&t._texture.baseTexture.alphaMode?Ss(t._tintRGB,p):t._tintRGB+(p*255<<24),m=0;m<f.length;m+=2)l[s++]=f[m],l[s++]=f[m+1],l[s++]=h[m],l[s++]=h[m+1],a[s++]=v,l[s++]=d;for(var m=0;m<c.length;m++)n[o++]=u+c[m]},e._drawCallPool=[],e._textureArrayPool=[],e})(wi),Bp=(function(){function i(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},t.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(t.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')}return i.prototype.generateShader=function(e){if(!this.programCache[e]){for(var t=new Int32Array(e),r=0;r<e;r++)t[r]=r;this.defaultGroupCache[e]=lr.from({uSamplers:t},!0);var n=this.fragTemplate;n=n.replace(/%count%/gi,""+e),n=n.replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new Ti(this.vertexSrc,n)}var s={tint:new Float32Array([1,1,1,1]),translationMatrix:new Mt,default:this.defaultGroupCache[e]};return new qe(this.programCache[e],s)},i.prototype.generateSampleSrc=function(e){var t="";t+=`
`,t+=`
`;for(var r=0;r<e;r++)r>0&&(t+=`
else `),r<e-1&&(t+="if(vTextureId < "+r+".5)"),t+=`
{`,t+=`
	color = texture2D(uSamplers[`+r+"], vTextureCoord);",t+=`
}`;return t+=`
`,t+=`
`,t},i})(),lu=(function(i){ft(e,i);function e(t){t===void 0&&(t=!1);var r=i.call(this)||this;return r._buffer=new Lt(null,t,!1),r._indexBuffer=new Lt(null,t,!0),r.addAttribute("aVertexPosition",r._buffer,2,!1,Nt.FLOAT).addAttribute("aTextureCoord",r._buffer,2,!1,Nt.FLOAT).addAttribute("aColor",r._buffer,4,!0,Nt.UNSIGNED_BYTE).addAttribute("aTextureId",r._buffer,1,!0,Nt.FLOAT).addIndex(r._indexBuffer),r}return e})(Nr),wc=`precision highp float;
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;
attribute float aTextureId;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform vec4 tint;

varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;

void main(void){
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vTextureId = aTextureId;
    vColor = aColor * tint;
}
`,Tc=`varying vec2 vTextureCoord;
varying vec4 vColor;
varying float vTextureId;
uniform sampler2D uSamplers[%count%];

void main(void){
    vec4 color;
    %forloop%
    gl_FragColor = color * vColor;
}
`,Dp=(function(){function i(){}return i.create=function(e){var t=Object.assign({vertex:wc,fragment:Tc,geometryClass:lu,vertexSize:6},e),r=t.vertex,n=t.fragment,s=t.vertexSize,o=t.geometryClass;return(function(a){ft(l,a);function l(u){var h=a.call(this,u)||this;return h.shaderGenerator=new Bp(r,n),h.geometryClass=o,h.vertexSize=s,h}return l})(Np)},Object.defineProperty(i,"defaultVertexSrc",{get:function(){return wc},enumerable:!1,configurable:!0}),Object.defineProperty(i,"defaultFragmentTemplate",{get:function(){return Tc},enumerable:!1,configurable:!0}),i})(),kp=Dp.create();/*!
 * @pixi/app - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/app is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var an=(function(){function i(e){var t=this;e=Object.assign({forceCanvas:!1},e),this.renderer=Rp(e),this.stage=new ee,i._plugins.forEach(function(r){r.init.call(t,e)})}return i.registerPlugin=function(e){i._plugins.push(e)},i.prototype.render=function(){this.renderer.render(this.stage)},Object.defineProperty(i.prototype,"view",{get:function(){return this.renderer.view},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"screen",{get:function(){return this.renderer.screen},enumerable:!1,configurable:!0}),i.prototype.destroy=function(e,t){var r=this,n=i._plugins.slice(0);n.reverse(),n.forEach(function(s){s.destroy.call(r)}),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null},i})();an._plugins=[];var o0=(function(){function i(){}return i.init=function(e){var t=this;Object.defineProperty(this,"resizeTo",{set:function(r){window.removeEventListener("resize",this.queueResize),this._resizeTo=r,r&&(window.addEventListener("resize",this.queueResize),this.resize())},get:function(){return this._resizeTo}}),this.queueResize=function(){t._resizeTo&&(t.cancelResize(),t._resizeId=requestAnimationFrame(function(){return t.resize()}))},this.cancelResize=function(){t._resizeId&&(cancelAnimationFrame(t._resizeId),t._resizeId=null)},this.resize=function(){if(t._resizeTo){t.cancelResize();var r,n;if(t._resizeTo===window)r=window.innerWidth,n=window.innerHeight;else{var s=t._resizeTo,o=s.clientWidth,a=s.clientHeight;r=o,n=a}t.renderer.resize(r,n)}},this._resizeId=null,this._resizeTo=null,this.resizeTo=e.resizeTo||null},i.destroy=function(){window.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null},i})();an.registerPlugin(o0);/*!
 * @pixi/extract - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/extract is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Ic=new vt,Ec=4,Up=(function(){function i(e){this.renderer=e,e.extract=this}return i.prototype.image=function(e,t,r){var n=new Image;return n.src=this.base64(e,t,r),n},i.prototype.base64=function(e,t,r){return this.canvas(e).toDataURL(t,r)},i.prototype.canvas=function(e){var t=this.renderer,r,n,s=!1,o,a=!1;e&&(e instanceof Or?o=e:(o=this.renderer.generateTexture(e),a=!0)),o?(r=o.baseTexture.resolution,n=o.frame,s=!1,t.renderTexture.bind(o)):(r=this.renderer.resolution,s=!0,n=Ic,n.width=this.renderer.width,n.height=this.renderer.height,t.renderTexture.bind(null));var l=Math.floor(n.width*r+1e-4),u=Math.floor(n.height*r+1e-4),h=new Ba(l,u,1),c=new Uint8Array(Ec*l*u),f=t.gl;f.readPixels(n.x*r,n.y*r,l,u,f.RGBA,f.UNSIGNED_BYTE,c);var d=h.context.getImageData(0,0,l,u);if(i.arrayPostDivide(c,d.data),h.context.putImageData(d,0,0),s){var p=new Ba(h.width,h.height,1);p.context.scale(1,-1),p.context.drawImage(h.canvas,0,-u),h.destroy(),h=p}return a&&o.destroy(!0),h.canvas},i.prototype.pixels=function(e){var t=this.renderer,r,n,s,o=!1;e&&(e instanceof Or?s=e:(s=this.renderer.generateTexture(e),o=!0)),s?(r=s.baseTexture.resolution,n=s.frame,t.renderTexture.bind(s)):(r=t.resolution,n=Ic,n.width=t.width,n.height=t.height,t.renderTexture.bind(null));var a=n.width*r,l=n.height*r,u=new Uint8Array(Ec*a*l),h=t.gl;return h.readPixels(n.x*r,n.y*r,a,l,h.RGBA,h.UNSIGNED_BYTE,u),o&&s.destroy(!0),i.arrayPostDivide(u,u),u},i.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},i.arrayPostDivide=function(e,t){for(var r=0;r<e.length;r+=4){var n=t[r+3]=e[r+3];n!==0?(t[r]=Math.round(Math.min(e[r]*255/n,255)),t[r+1]=Math.round(Math.min(e[r+1]*255/n,255)),t[r+2]=Math.round(Math.min(e[r+2]*255/n,255))):(t[r]=e[r],t[r+1]=e[r+1],t[r+2]=e[r+2])}},i})(),oa,Sc;function a0(){return Sc||(Sc=1,oa=(i,e={})=>{if(!i)return;const t=/(?:^|&)([^&=]*)=?([^&]*)/g,r={strict:/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*)|([^?#]*?))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,loose:/^(?:([^:/?#.]+):)?(?:\/\/([^/?#]*)|([^?#]*?))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/},s=(e.strictMode?r.strict:r.loose).exec(i);if(!s)return;const[,o="",a="",l="",u="",h="",c=""]=s,f=a||"",d=a?u:l+u,p={source:i,protocol:o,authority:f,relative:d,query:h,anchor:c,userInfo:"",user:"",password:"",host:"",port:"",path:d,directory:"",file:"",queryKey:{}};if(f){const m=/^(?:(([^:@]*)(?::([^:@]*))?)?@)?([^:/?#]*)(?::(\d*))?/.exec(f);if(m){const[,g="",E="",I="",M="",_=""]=m;Object.assign(p,{userInfo:g,user:E,password:I,host:M,port:_})}}if(d){const v=d.lastIndexOf("/");v>-1?(p.directory=d.substring(0,v+1),p.file=d.substring(v+1)):p.file=d}if(h)for(const[,v,m]of h.matchAll(t))v&&(p.queryKey[v]=m);return p}),oa}var l0=a0();const Xp=bi(l0);class On{constructor(e,t=!1,r){this._fn=e,this._once=t,this._thisArg=r,this._next=this._prev=this._owner=null}detach(){return this._owner===null?!1:(this._owner.detach(this),!0)}}function Ac(i,e){return i._head?(i._tail._next=e,e._prev=i._tail,i._tail=e):(i._head=e,i._tail=e),e._owner=i,e}class Be{constructor(){this._head=this._tail=void 0}handlers(e=!1){let t=this._head;if(e)return!!t;const r=[];for(;t;)r.push(t),t=t._next;return r}has(e){if(!(e instanceof On))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return e._owner===this}dispatch(){let e=this._head;if(!e)return!1;for(;e;)e._once&&this.detach(e),e._fn.apply(e._thisArg,arguments),e=e._next;return!0}add(e,t=null){if(typeof e!="function")throw new Error("MiniSignal#add(): First arg must be a Function.");return Ac(this,new On(e,!1,t))}once(e,t=null){if(typeof e!="function")throw new Error("MiniSignal#once(): First arg must be a Function.");return Ac(this,new On(e,!0,t))}detach(e){if(!(e instanceof On))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return e._owner!==this?this:(e._prev&&(e._prev._next=e._next),e._next&&(e._next._prev=e._prev),e===this._head?(this._head=e._next,e._next===null&&(this._tail=null)):e===this._tail&&(this._tail=e._prev,this._tail._next=null),e._owner=null,this)}detachAll(){let e=this._head;if(!e)return this;for(this._head=this._tail=null;e;)e._owner=null,e=e._next;return this}}/*!
 * resource-loader - v3.0.1
 * https://github.com/pixijs/pixi-sound
 * Compiled Tue, 02 Jul 2019 14:06:18 UTC
 *
 * resource-loader is licensed under the MIT license.
 * http://www.opensource.org/licenses/mit-license
 */function mr(){}function Cc(i,e,t,r){var n=0,s=i.length;(function o(a){if(a||n===s){t&&t(a);return}r?setTimeout(function(){e(i[n++],o)},1):e(i[n++],o)})()}function u0(i){return function(){if(i===null)throw new Error("Callback was already called.");var t=i;i=null,t.apply(this,arguments)}}function h0(i,e){if(e==null)e=1;else if(e===0)throw new Error("Concurrency must not be zero");var t=0,r={_tasks:[],concurrency:e,saturated:mr,unsaturated:mr,buffer:e/4,empty:mr,drain:mr,error:mr,started:!1,paused:!1,push:function(a,l){n(a,!1,l)},kill:function(){t=0,r.drain=mr,r.started=!1,r._tasks=[]},unshift:function(a,l){n(a,!0,l)},process:function(){for(;!r.paused&&t<r.concurrency&&r._tasks.length;){var a=r._tasks.shift();r._tasks.length===0&&r.empty(),t+=1,t===r.concurrency&&r.saturated(),i(a.data,u0(s(a)))}},length:function(){return r._tasks.length},running:function(){return t},idle:function(){return r._tasks.length+t===0},pause:function(){r.paused!==!0&&(r.paused=!0)},resume:function(){if(r.paused!==!1){r.paused=!1;for(var a=1;a<=r.concurrency;a++)r.process()}}};function n(o,a,l){if(l!=null&&typeof l!="function")throw new Error("task callback must be a function");if(r.started=!0,o==null&&r.idle()){setTimeout(function(){return r.drain()},1);return}var u={data:o,callback:typeof l=="function"?l:mr};a?r._tasks.unshift(u):r._tasks.push(u),setTimeout(function(){return r.process()},1)}function s(o){return function(){t-=1,o.callback.apply(o,arguments),arguments[0]!=null&&r.error(arguments[0],o.data),t<=r.concurrency-r.buffer&&r.unsaturated(),r.idle()&&r.drain(),r.process()}}return r}function c0(i,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(i,r.key,r)}}function Hp(i,e,t){return e&&c0(i.prototype,e),i}var f0=!!(window.XDomainRequest&&!("withCredentials"in new XMLHttpRequest)),Fn=null,d0=0,Pc=200,p0=204,y0=1223,m0=2;function v0(){}var ot=(function(){i.setExtensionLoadType=function(r,n){Oc(i._loadTypeMap,r,n)},i.setExtensionXhrType=function(r,n){Oc(i._xhrTypeMap,r,n)};function i(t,r,n){if(typeof t!="string"||typeof r!="string")throw new Error("Both name and url are required for constructing a resource.");n=n||{},this._flags=0,this._setFlag(i.STATUS_FLAGS.DATA_URL,r.indexOf("data:")===0),this.name=t,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=n.crossOrigin===!0?"anonymous":n.crossOrigin,this.timeout=n.timeout||0,this.loadType=n.loadType||this._determineLoadType(),this.xhrType=n.xhrType,this.metadata=n.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=i.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=v0,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new Be,this.onProgress=new Be,this.onComplete=new Be,this.onAfterMiddleware=new Be}var e=i.prototype;return e.complete=function(){this._clearEvents(),this._finish()},e.abort=function(r){if(!this.error){if(this.error=new Error(r),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=i.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},e.load=function(r){var n=this;if(!this.isLoading){if(this.isComplete){r&&setTimeout(function(){return r(n)},1);return}else r&&this.onComplete.once(r);switch(this._setFlag(i.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),(this.crossOrigin===!1||typeof this.crossOrigin!="string")&&(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case i.LOAD_TYPE.IMAGE:this.type=i.TYPE.IMAGE,this._loadElement("image");break;case i.LOAD_TYPE.AUDIO:this.type=i.TYPE.AUDIO,this._loadSourceElement("audio");break;case i.LOAD_TYPE.VIDEO:this.type=i.TYPE.VIDEO,this._loadSourceElement("video");break;case i.LOAD_TYPE.XHR:default:f0&&this.crossOrigin?this._loadXdr():this._loadXhr();break}}},e._hasFlag=function(r){return(this._flags&r)!==0},e._setFlag=function(r,n){this._flags=n?this._flags|r:this._flags&~r},e._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},e._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(i.STATUS_FLAGS.COMPLETE,!0),this._setFlag(i.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},e._loadElement=function(r){this.metadata.loadElement?this.data=this.metadata.loadElement:r==="image"&&typeof window.Image<"u"?this.data=new Image:this.data=document.createElement(r),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadSourceElement=function(r){if(this.metadata.loadElement?this.data=this.metadata.loadElement:r==="audio"&&typeof window.Audio<"u"?this.data=new Audio:this.data=document.createElement(r),this.data===null){this.abort("Unsupported element: "+r);return}if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var n=this.metadata.mimeType,s=0;s<this.url.length;++s)this.data.appendChild(this._createSource(r,this.url[s],Array.isArray(n)?n[s]:n));else{var o=this.metadata.mimeType;this.data.appendChild(this._createSource(r,this.url,Array.isArray(o)?o[0]:o))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},e._loadXhr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var r=this.xhr=new XMLHttpRequest;r.open("GET",this.url,!0),r.timeout=this.timeout,this.xhrType===i.XHR_RESPONSE_TYPE.JSON||this.xhrType===i.XHR_RESPONSE_TYPE.DOCUMENT?r.responseType=i.XHR_RESPONSE_TYPE.TEXT:r.responseType=this.xhrType,r.addEventListener("error",this._boundXhrOnError,!1),r.addEventListener("timeout",this._boundXhrOnTimeout,!1),r.addEventListener("abort",this._boundXhrOnAbort,!1),r.addEventListener("progress",this._boundOnProgress,!1),r.addEventListener("load",this._boundXhrOnLoad,!1),r.send()},e._loadXdr=function(){typeof this.xhrType!="string"&&(this.xhrType=this._determineXhrType());var r=this.xhr=new XDomainRequest;r.timeout=this.timeout||5e3,r.onerror=this._boundXhrOnError,r.ontimeout=this._boundXhrOnTimeout,r.onprogress=this._boundOnProgress,r.onload=this._boundXhrOnLoad,r.open("GET",this.url,!0),setTimeout(function(){return r.send()},1)},e._createSource=function(r,n,s){s||(s=r+"/"+this._getExtension(n));var o=document.createElement("source");return o.src=n,o.type=s,o},e._onError=function(r){this.abort("Failed to load element using: "+r.target.nodeName)},e._onProgress=function(r){r&&r.lengthComputable&&this.onProgress.dispatch(this,r.loaded/r.total)},e._onTimeout=function(){this.abort("Load timed out.")},e._xhrOnError=function(){var r=this.xhr;this.abort(aa(r)+" Request failed. Status: "+r.status+', text: "'+r.statusText+'"')},e._xhrOnTimeout=function(){var r=this.xhr;this.abort(aa(r)+" Request timed out.")},e._xhrOnAbort=function(){var r=this.xhr;this.abort(aa(r)+" Request was aborted by the user.")},e._xhrOnLoad=function(){var r=this.xhr,n="",s=typeof r.status>"u"?Pc:r.status;(r.responseType===""||r.responseType==="text"||typeof r.responseType>"u")&&(n=r.responseText),s===d0&&(n.length>0||r.responseType===i.XHR_RESPONSE_TYPE.BUFFER)?s=Pc:s===y0&&(s=p0);var o=s/100|0;if(o===m0)if(this.xhrType===i.XHR_RESPONSE_TYPE.TEXT)this.data=n,this.type=i.TYPE.TEXT;else if(this.xhrType===i.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(n),this.type=i.TYPE.JSON}catch(u){this.abort("Error trying to parse loaded json: "+u);return}else if(this.xhrType===i.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var a=new DOMParser;this.data=a.parseFromString(n,"text/xml")}else{var l=document.createElement("div");l.innerHTML=n,this.data=l}this.type=i.TYPE.XML}catch(u){this.abort("Error trying to parse loaded xml: "+u);return}else this.data=r.response||n;else{this.abort("["+r.status+"] "+r.statusText+": "+r.responseURL);return}this.complete()},e._determineCrossOrigin=function(r,n){if(r.indexOf("data:")===0)return"";if(window.origin!==window.location.origin)return"anonymous";n=n||window.location,Fn||(Fn=document.createElement("a")),Fn.href=r,r=Xp(Fn.href,{strictMode:!0});var s=!r.port&&n.port===""||r.port===n.port,o=r.protocol?r.protocol+":":"";return r.host!==n.hostname||!s||o!==n.protocol?"anonymous":""},e._determineXhrType=function(){return i._xhrTypeMap[this.extension]||i.XHR_RESPONSE_TYPE.TEXT},e._determineLoadType=function(){return i._loadTypeMap[this.extension]||i.LOAD_TYPE.XHR},e._getExtension=function(){var r=this.url,n="";if(this.isDataUrl){var s=r.indexOf("/");n=r.substring(s+1,r.indexOf(";",s))}else{var o=r.indexOf("?"),a=r.indexOf("#"),l=Math.min(o>-1?o:r.length,a>-1?a:r.length);r=r.substring(0,l),n=r.substring(r.lastIndexOf(".")+1)}return n.toLowerCase()},e._getMimeFromXhrType=function(r){switch(r){case i.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case i.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case i.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case i.XHR_RESPONSE_TYPE.JSON:return"application/json";case i.XHR_RESPONSE_TYPE.DEFAULT:case i.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},Hp(i,[{key:"isDataUrl",get:function(){return this._hasFlag(i.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(i.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(i.STATUS_FLAGS.LOADING)}}]),i})();ot.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4};ot.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6};ot.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4};ot.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"};ot._loadTypeMap={gif:ot.LOAD_TYPE.IMAGE,png:ot.LOAD_TYPE.IMAGE,bmp:ot.LOAD_TYPE.IMAGE,jpg:ot.LOAD_TYPE.IMAGE,jpeg:ot.LOAD_TYPE.IMAGE,tif:ot.LOAD_TYPE.IMAGE,tiff:ot.LOAD_TYPE.IMAGE,webp:ot.LOAD_TYPE.IMAGE,tga:ot.LOAD_TYPE.IMAGE,svg:ot.LOAD_TYPE.IMAGE,"svg+xml":ot.LOAD_TYPE.IMAGE,mp3:ot.LOAD_TYPE.AUDIO,ogg:ot.LOAD_TYPE.AUDIO,wav:ot.LOAD_TYPE.AUDIO,mp4:ot.LOAD_TYPE.VIDEO,webm:ot.LOAD_TYPE.VIDEO};ot._xhrTypeMap={xhtml:ot.XHR_RESPONSE_TYPE.DOCUMENT,html:ot.XHR_RESPONSE_TYPE.DOCUMENT,htm:ot.XHR_RESPONSE_TYPE.DOCUMENT,xml:ot.XHR_RESPONSE_TYPE.DOCUMENT,tmx:ot.XHR_RESPONSE_TYPE.DOCUMENT,svg:ot.XHR_RESPONSE_TYPE.DOCUMENT,tsx:ot.XHR_RESPONSE_TYPE.DOCUMENT,gif:ot.XHR_RESPONSE_TYPE.BLOB,png:ot.XHR_RESPONSE_TYPE.BLOB,bmp:ot.XHR_RESPONSE_TYPE.BLOB,jpg:ot.XHR_RESPONSE_TYPE.BLOB,jpeg:ot.XHR_RESPONSE_TYPE.BLOB,tif:ot.XHR_RESPONSE_TYPE.BLOB,tiff:ot.XHR_RESPONSE_TYPE.BLOB,webp:ot.XHR_RESPONSE_TYPE.BLOB,tga:ot.XHR_RESPONSE_TYPE.BLOB,json:ot.XHR_RESPONSE_TYPE.JSON,text:ot.XHR_RESPONSE_TYPE.TEXT,txt:ot.XHR_RESPONSE_TYPE.TEXT,ttf:ot.XHR_RESPONSE_TYPE.BUFFER,otf:ot.XHR_RESPONSE_TYPE.BUFFER};ot.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";function Oc(i,e,t){e&&e.indexOf(".")===0&&(e=e.substring(1)),e&&(i[e]=t)}function aa(i){return i.toString().replace("object ","")}var g0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function b0(i){for(var e="",t=0;t<i.length;){for(var r=[0,0,0],n=[0,0,0,0],s=0;s<r.length;++s)t<i.length?r[s]=i.charCodeAt(t++)&255:r[s]=0;n[0]=r[0]>>2,n[1]=(r[0]&3)<<4|r[1]>>4,n[2]=(r[1]&15)<<2|r[2]>>6,n[3]=r[2]&63;var o=t-(i.length-1);switch(o){case 2:n[3]=64,n[2]=64;break;case 1:n[3]=64;break}for(var a=0;a<n.length;++a)e+=g0.charAt(n[a])}return e}var Fc=window.URL||window.webkitURL;function _0(i,e){if(!i.data){e();return}if(i.xhr&&i.xhrType===ot.XHR_RESPONSE_TYPE.BLOB){if(!window.Blob||typeof i.data=="string"){var t=i.xhr.getResponseHeader("content-type");if(t&&t.indexOf("image")===0){i.data=new Image,i.data.src="data:"+t+";base64,"+b0(i.xhr.responseText),i.type=ot.TYPE.IMAGE,i.data.onload=function(){i.data.onload=null,e()};return}}else if(i.data.type.indexOf("image")===0){var r=Fc.createObjectURL(i.data);i.blob=i.data,i.data=new Image,i.data.src=r,i.type=ot.TYPE.IMAGE,i.data.onload=function(){Fc.revokeObjectURL(r),i.data.onload=null,e()};return}}e()}var x0={parsing:_0},la=100,w0=/(#[\w-]+)?$/,He=(function(){function i(t,r){var n=this;t===void 0&&(t=""),r===void 0&&(r=10),this.baseUrl=t,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(a,l){return n._loadResource(a,l)},this._queue=h0(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new Be,this.onError=new Be,this.onLoad=new Be,this.onStart=new Be,this.onComplete=new Be;for(var s=0;s<i._defaultBeforeMiddleware.length;++s)this.pre(i._defaultBeforeMiddleware[s]);for(var o=0;o<i._defaultAfterMiddleware.length;++o)this.use(i._defaultAfterMiddleware[o])}var e=i.prototype;return e.add=function(r,n,s,o){if(Array.isArray(r)){for(var a=0;a<r.length;++a)this.add(r[a]);return this}if(typeof r=="object"&&(o=n||r.callback||r.onComplete,s=r,n=r.url,r=r.name||r.key||r.url),typeof n!="string"&&(o=s,s=n,n=r),typeof n!="string")throw new Error("No url passed to add resource to loader.");if(typeof s=="function"&&(o=s,s=null),this.loading&&(!s||!s.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[r])throw new Error('Resource named "'+r+'" already exists.');if(n=this._prepareUrl(n),this.resources[r]=new ot(r,n,s),typeof o=="function"&&this.resources[r].onAfterMiddleware.once(o),this.loading){for(var l=s.parentResource,u=[],h=0;h<l.children.length;++h)l.children[h].isComplete||u.push(l.children[h]);var c=l.progressChunk*(u.length+1),f=c/(u.length+2);l.children.push(this.resources[r]),l.progressChunk=f;for(var d=0;d<u.length;++d)u[d].progressChunk=f;this.resources[r].progressChunk=f}return this._queue.push(this.resources[r]),this},e.pre=function(r){return this._beforeMiddleware.push(r),this},e.use=function(r){return this._afterMiddleware.push(r),this},e.reset=function(){this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause();for(var r in this.resources){var n=this.resources[r];n._onLoadBinding&&n._onLoadBinding.detach(),n.isLoading&&n.abort()}return this.resources={},this},e.load=function(r){if(typeof r=="function"&&this.onComplete.once(r),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var n=this._queue._tasks.length,s=la/n,o=0;o<this._queue._tasks.length;++o)this._queue._tasks[o].data.progressChunk=s;this._onStart(),this._queue.resume()}return this},e._prepareUrl=function(r){var n=Xp(r,{strictMode:!0}),s;if(n.protocol||!n.path||r.indexOf("//")===0?s=r:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&r.charAt(0)!=="/"?s=this.baseUrl+"/"+r:s=this.baseUrl+r,this.defaultQueryString){var o=w0.exec(s)[0];s=s.substr(0,s.length-o.length),s.indexOf("?")!==-1?s+="&"+this.defaultQueryString:s+="?"+this.defaultQueryString,s+=o}return s},e._loadResource=function(r,n){var s=this;r._dequeue=n,Cc(this._beforeMiddleware,function(o,a){o.call(s,r,function(){a(r.isComplete?{}:null)})},function(){r.isComplete?s._onLoad(r):(r._onLoadBinding=r.onComplete.once(s._onLoad,s),r.load())},!0)},e._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},e._onComplete=function(){this.progress=la,this.loading=!1,this.onComplete.dispatch(this,this.resources)},e._onLoad=function(r){var n=this;r._onLoadBinding=null,this._resourcesParsing.push(r),r._dequeue(),Cc(this._afterMiddleware,function(s,o){s.call(n,r,o)},function(){r.onAfterMiddleware.dispatch(r),n.progress=Math.min(la,n.progress+r.progressChunk),n.onProgress.dispatch(n,r),r.error?n.onError.dispatch(r.error,n,r):n.onLoad.dispatch(n,r),n._resourcesParsing.splice(n._resourcesParsing.indexOf(r),1),n._queue.idle()&&n._resourcesParsing.length===0&&n._onComplete()},!0)},Hp(i,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(r){this._queue.concurrency=r}}]),i})();He._defaultBeforeMiddleware=[];He._defaultAfterMiddleware=[];He.pre=function(e){return He._defaultBeforeMiddleware.push(e),He};He.use=function(e){return He._defaultAfterMiddleware.push(e),He};/*!
 * @pixi/loaders - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/loaders is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var Vi=ot;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Ya=function(i,e){return Ya=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},Ya(i,e)};function T0(i,e){Ya(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Gp=(function(){function i(){}return i.use=function(e,t){e.data&&e.type===ot.TYPE.IMAGE&&(e.texture=lt.fromLoader(e.data,e.url,e.name)),t()},i})(),Fr=(function(i){T0(e,i);function e(t,r){for(var n=i.call(this,t,r)||this,s=0;s<e._plugins.length;++s){var o=e._plugins[s],a=o.pre,l=o.use;a&&n.pre(a),l&&n.use(l)}return n._protected=!1,n}return e.prototype.destroy=function(){this._protected||this.reset()},Object.defineProperty(e,"shared",{get:function(){var t=e._shared;return t||(t=new e,t._protected=!0,e._shared=t),t},enumerable:!1,configurable:!0}),e.registerPlugin=function(t){return e._plugins.push(t),t.add&&t.add(),e},e._plugins=[],e})(He);Fr.registerPlugin({use:x0.parsing});Fr.registerPlugin(Gp);var Yp=(function(){function i(){}return i.init=function(e){e=Object.assign({sharedLoader:!1},e),this.loader=e.sharedLoader?Fr.shared:new Fr},i.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},i})();/*!
 * @pixi/particles - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/particles is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var za=function(i,e){return za=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},za(i,e)};function zp(i,e){za(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var I0=(function(i){zp(e,i);function e(t,r,n,s){t===void 0&&(t=1500),n===void 0&&(n=16384),s===void 0&&(s=!1);var o=i.call(this)||this,a=16384;return n>a&&(n=a),o._properties=[!1,!0,!1,!1,!1],o._maxSize=t,o._batchSize=n,o._buffers=null,o._bufferUpdateIDs=[],o._updateID=0,o.interactiveChildren=!1,o.blendMode=st.NORMAL,o.autoResize=s,o.roundPixels=!0,o.baseTexture=null,o.setProperties(r),o._tint=0,o.tintRgb=new Float32Array(4),o.tint=16777215,o}return e.prototype.setProperties=function(t){t&&(this._properties[0]="vertices"in t||"scale"in t?!!t.vertices||!!t.scale:this._properties[0],this._properties[1]="position"in t?!!t.position:this._properties[1],this._properties[2]="rotation"in t?!!t.rotation:this._properties[2],this._properties[3]="uvs"in t?!!t.uvs:this._properties[3],this._properties[4]="tint"in t||"alpha"in t?!!t.tint||!!t.alpha:this._properties[4])},e.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,Cr(t,this.tintRgb)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){var r=this;!this.visible||this.worldAlpha<=0||!this.children.length||!this.renderable||(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",function(){return r.onChildrenChange(0)})),t.batch.setObjectRenderer(t.plugins.particle),t.plugins.particle.render(this))},e.prototype.onChildrenChange=function(t){for(var r=Math.floor(t/this._batchSize);this._bufferUpdateIDs.length<r;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[r]=++this._updateID},e.prototype.dispose=function(){if(this._buffers){for(var t=0;t<this._buffers.length;++t)this._buffers[t].destroy();this._buffers=null}},e.prototype.destroy=function(t){i.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},e})(ee),Rc=(function(){function i(e,t,r){this.geometry=new Nr,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;++n){var s=e[n];s={attributeName:s.attributeName,size:s.size,uploadFunction:s.uploadFunction,type:s.type||Nt.FLOAT,offset:s.offset},t[n]?this.dynamicProperties.push(s):this.staticProperties.push(s)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}return i.prototype.initBuffers=function(){var e=this.geometry,t=0;this.indexBuffer=new Lt(Zl(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];n.offset=t,t+=n.size,this.dynamicStride+=n.size}var s=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(s),this.dynamicDataUint32=new Uint32Array(s),this.dynamicBuffer=new Lt(this.dynamicData,!1,!1);var o=0;this.staticStride=0;for(var r=0;r<this.staticProperties.length;++r){var n=this.staticProperties[r];n.offset=o,o+=n.size,this.staticStride+=n.size}var a=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(a),this.staticDataUint32=new Uint32Array(a),this.staticBuffer=new Lt(this.staticData,!0,!1);for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];e.addAttribute(n.attributeName,this.dynamicBuffer,0,n.type===Nt.UNSIGNED_BYTE,n.type,this.dynamicStride*4,n.offset*4)}for(var r=0;r<this.staticProperties.length;++r){var n=this.staticProperties[r];e.addAttribute(n.attributeName,this.staticBuffer,0,n.type===Nt.UNSIGNED_BYTE,n.type,this.staticStride*4,n.offset*4)}},i.prototype.uploadDynamic=function(e,t,r){for(var n=0;n<this.dynamicProperties.length;n++){var s=this.dynamicProperties[n];s.uploadFunction(e,t,r,s.type===Nt.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,s.offset)}this.dynamicBuffer._updateID++},i.prototype.uploadStatic=function(e,t,r){for(var n=0;n<this.staticProperties.length;n++){var s=this.staticProperties[n];s.uploadFunction(e,t,r,s.type===Nt.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,s.offset)}this.staticBuffer._updateID++},i.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()},i})(),E0=`varying vec2 vTextureCoord;
varying vec4 vColor;

uniform sampler2D uSampler;

void main(void){
    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;
    gl_FragColor = color;
}`,S0=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aColor;

attribute vec2 aPositionCoord;
attribute float aRotation;

uniform mat3 translationMatrix;
uniform vec4 uColor;

varying vec2 vTextureCoord;
varying vec4 vColor;

void main(void){
    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);
    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);

    vec2 v = vec2(x, y);
    v = v + aPositionCoord;

    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = aTextureCoord;
    vColor = aColor * uColor;
}
`,Vp=(function(i){zp(e,i);function e(t){var r=i.call(this,t)||this;return r.shader=null,r.properties=null,r.tempMatrix=new Mt,r.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:r.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:r.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:r.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:r.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Nt.UNSIGNED_BYTE,uploadFunction:r.uploadTint,offset:0}],r.shader=qe.from(S0,E0,{}),r.state=cr.for2d(),r}return e.prototype.render=function(t){var r=t.children,n=t._maxSize,s=t._batchSize,o=this.renderer,a=r.length;if(a!==0){a>n&&!t.autoResize&&(a=n);var l=t._buffers;l||(l=t._buffers=this.generateBuffers(t));var u=r[0]._texture.baseTexture;this.state.blendMode=Wl(t.blendMode,u.alphaMode),o.state.set(this.state);var h=o.gl,c=t.worldTransform.copyTo(this.tempMatrix);c.prepend(o.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=c.toArray(!0),this.shader.uniforms.uColor=Ld(t.tintRgb,t.worldAlpha,this.shader.uniforms.uColor,u.alphaMode),this.shader.uniforms.uSampler=u,this.renderer.shader.bind(this.shader);for(var f=!1,d=0,p=0;d<a;d+=s,p+=1){var v=a-d;v>s&&(v=s),p>=l.length&&l.push(this._generateOneMoreBuffer(t));var m=l[p];m.uploadDynamic(r,d,v);var g=t._bufferUpdateIDs[p]||0;f=f||m._updateID<g,f&&(m._updateID=t._updateID,m.uploadStatic(r,d,v)),o.geometry.bind(m.geometry),h.drawElements(h.TRIANGLES,v*6,h.UNSIGNED_SHORT,0)}}},e.prototype.generateBuffers=function(t){for(var r=[],n=t._maxSize,s=t._batchSize,o=t._properties,a=0;a<n;a+=s)r.push(new Rc(this.properties,o,s));return r},e.prototype._generateOneMoreBuffer=function(t){var r=t._batchSize,n=t._properties;return new Rc(this.properties,n,r)},e.prototype.uploadVertices=function(t,r,n,s,o,a){for(var l=0,u=0,h=0,c=0,f=0;f<n;++f){var d=t[r+f],p=d._texture,v=d.scale.x,m=d.scale.y,g=p.trim,E=p.orig;g?(u=g.x-d.anchor.x*E.width,l=u+g.width,c=g.y-d.anchor.y*E.height,h=c+g.height):(l=E.width*(1-d.anchor.x),u=E.width*-d.anchor.x,h=E.height*(1-d.anchor.y),c=E.height*-d.anchor.y),s[a]=u*v,s[a+1]=c*m,s[a+o]=l*v,s[a+o+1]=c*m,s[a+o*2]=l*v,s[a+o*2+1]=h*m,s[a+o*3]=u*v,s[a+o*3+1]=h*m,a+=o*4}},e.prototype.uploadPosition=function(t,r,n,s,o,a){for(var l=0;l<n;l++){var u=t[r+l].position;s[a]=u.x,s[a+1]=u.y,s[a+o]=u.x,s[a+o+1]=u.y,s[a+o*2]=u.x,s[a+o*2+1]=u.y,s[a+o*3]=u.x,s[a+o*3+1]=u.y,a+=o*4}},e.prototype.uploadRotation=function(t,r,n,s,o,a){for(var l=0;l<n;l++){var u=t[r+l].rotation;s[a]=u,s[a+o]=u,s[a+o*2]=u,s[a+o*3]=u,a+=o*4}},e.prototype.uploadUvs=function(t,r,n,s,o,a){for(var l=0;l<n;++l){var u=t[r+l]._texture._uvs;u?(s[a]=u.x0,s[a+1]=u.y0,s[a+o]=u.x1,s[a+o+1]=u.y1,s[a+o*2]=u.x2,s[a+o*2+1]=u.y2,s[a+o*3]=u.x3,s[a+o*3+1]=u.y3,a+=o*4):(s[a]=0,s[a+1]=0,s[a+o]=0,s[a+o+1]=0,s[a+o*2]=0,s[a+o*2+1]=0,s[a+o*3]=0,s[a+o*3+1]=0,a+=o*4)}},e.prototype.uploadTint=function(t,r,n,s,o,a){for(var l=0;l<n;++l){var u=t[r+l],h=u._texture.baseTexture.alphaMode>0,c=u.alpha,f=c<1&&h?Ss(u._tintRGB,c):u._tintRGB+(c*255<<24);s[a]=f,s[a+o]=f,s[a+o*2]=f,s[a+o*3]=f,a+=o*4}},e.prototype.destroy=function(){i.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},e})(wi);/*!
 * @pixi/graphics - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/graphics is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ke;(function(i){i.MITER="miter",i.BEVEL="bevel",i.ROUND="round"})(ke||(ke={}));var Ue;(function(i){i.BUTT="butt",i.ROUND="round",i.SQUARE="square"})(Ue||(Ue={}));var di={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount:function(i,e){if(e===void 0&&(e=20),!this.adaptive||!i||isNaN(i))return e;var t=Math.ceil(i/this.maxLength);return t<this.minSegments?t=this.minSegments:t>this.maxSegments&&(t=this.maxSegments),t}},uu=(function(){function i(){this.color=16777215,this.alpha=1,this.texture=lt.WHITE,this.matrix=null,this.visible=!1,this.reset()}return i.prototype.clone=function(){var e=new i;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},i.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=lt.WHITE,this.matrix=null,this.visible=!1},i.prototype.destroy=function(){this.texture=null,this.matrix=null},i})();/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Va=function(i,e){return Va=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},Va(i,e)};function Os(i,e){Va(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var hu={build:function(i){i.points=i.shape.points.slice()},triangulate:function(i,e){var t=i.points,r=i.holes,n=e.points,s=e.indices;if(t.length>=6){for(var o=[],a=0;a<r.length;a++){var l=r[a];o.push(t.length/2),t=t.concat(l.points)}var u=Gl(t,o,2);if(!u)return;for(var h=n.length/2,a=0;a<u.length;a+=3)s.push(u[a]+h),s.push(u[a+1]+h),s.push(u[a+2]+h);for(var a=0;a<t.length;a++)n.push(t[a])}}},qa={build:function(i){var e=i.shape,t=i.points,r=e.x,n=e.y,s,o;if(t.length=0,i.type===Rt.CIRC)s=e.radius,o=e.radius;else{var a=i.shape;s=a.width,o=a.height}if(!(s===0||o===0)){var l=Math.floor(30*Math.sqrt(e.radius))||Math.floor(15*Math.sqrt(s+o));l/=2.3;for(var u=Math.PI*2/l,h=0;h<l-.5;h++)t.push(r+Math.sin(-u*h)*s,n+Math.cos(-u*h)*o);t.push(t[0],t[1])}},triangulate:function(i,e){var t=i.points,r=e.points,n=e.indices,s=r.length/2,o=s,a=i.shape,l=i.matrix,u=a.x,h=a.y;r.push(i.matrix?l.a*u+l.c*h+l.tx:u,i.matrix?l.b*u+l.d*h+l.ty:h);for(var c=0;c<t.length;c+=2)r.push(t[c],t[c+1]),n.push(s++,o,s)}},qp={build:function(i){var e=i.shape,t=e.x,r=e.y,n=e.width,s=e.height,o=i.points;o.length=0,o.push(t,r,t+n,r,t+n,r+s,t,r+s)},triangulate:function(i,e){var t=i.points,r=e.points,n=r.length/2;r.push(t[0],t[1],t[2],t[3],t[6],t[7],t[4],t[5]),e.indices.push(n,n+1,n+2,n+1,n+2,n+3)}};function qr(i,e,t){var r=e-i;return i+r*t}function Rn(i,e,t,r,n,s,o){o===void 0&&(o=[]);for(var a=20,l=o,u=0,h=0,c=0,f=0,d=0,p=0,v=0,m=0;v<=a;++v)m=v/a,u=qr(i,t,m),h=qr(e,r,m),c=qr(t,n,m),f=qr(r,s,m),d=qr(u,c,m),p=qr(h,f,m),l.push(d,p);return l}var $p={build:function(i){var e=i.shape,t=i.points,r=e.x,n=e.y,s=e.width,o=e.height,a=Math.max(0,Math.min(e.radius,Math.min(s,o)/2));t.length=0,a?(Rn(r,n+a,r,n,r+a,n,t),Rn(r+s-a,n,r+s,n,r+s,n+a,t),Rn(r+s,n+o-a,r+s,n+o,r+s-a,n+o,t),Rn(r+a,n+o,r,n+o,r,n+o-a,t)):t.push(r,n,r+s,n,r+s,n+o,r,n+o)},triangulate:function(i,e){for(var t=i.points,r=e.points,n=e.indices,s=r.length/2,o=Gl(t,null,2),a=0,l=o.length;a<l;a+=3)n.push(o[a]+s),n.push(o[a+1]+s),n.push(o[a+2]+s);for(var a=0,l=t.length;a<l;a++)r.push(t[a],t[++a])}};function Mc(i,e,t,r,n,s,o,a){var l=i-t*n,u=e-r*n,h=i+t*s,c=e+r*s,f,d;o?(f=r,d=-t):(f=-r,d=t);var p=l+f,v=u+d,m=h+f,g=c+d;return a.push(p,v),a.push(m,g),2}function $r(i,e,t,r,n,s,o,a){var l=t-i,u=r-e,h=Math.atan2(l,u),c=Math.atan2(n-i,s-e);a&&h<c?h+=Math.PI*2:!a&&h>c&&(c+=Math.PI*2);var f=h,d=c-h,p=Math.abs(d),v=Math.sqrt(l*l+u*u),m=(15*p*Math.sqrt(v)/Math.PI>>0)+1,g=d/m;if(f+=g,a){o.push(i,e),o.push(t,r);for(var E=1,I=f;E<m;E++,I+=g)o.push(i,e),o.push(i+Math.sin(I)*v,e+Math.cos(I)*v);o.push(i,e),o.push(n,s)}else{o.push(t,r),o.push(i,e);for(var E=1,I=f;E<m;E++,I+=g)o.push(i+Math.sin(I)*v,e+Math.cos(I)*v),o.push(i,e);o.push(n,s),o.push(i,e)}return m*2}function A0(i,e){var t=i.shape,r=i.points||t.points.slice(),n=e.closePointEps;if(r.length!==0){var s=i.lineStyle,o=new Ht(r[0],r[1]),a=new Ht(r[r.length-2],r[r.length-1]),l=t.type!==Rt.POLY||t.closeStroke,u=Math.abs(o.x-a.x)<n&&Math.abs(o.y-a.y)<n;if(l){r=r.slice(),u&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));var h=(o.x+a.x)*.5,c=(a.y+o.y)*.5;r.unshift(h,c),r.push(h,c)}var f=e.points,d=r.length/2,p=r.length,v=f.length/2,m=s.width/2,g=m*m,E=s.miterLimit*s.miterLimit,I=r[0],M=r[1],_=r[2],F=r[3],C=0,H=0,R=-(M-F),N=I-_,Y=0,D=0,J=Math.sqrt(R*R+N*N);R/=J,N/=J,R*=m,N*=m;var Q=s.alignment,V=(1-Q)*2,A=Q*2;l||(s.cap===Ue.ROUND?p+=$r(I-R*(V-A)*.5,M-N*(V-A)*.5,I-R*V,M-N*V,I+R*A,M+N*A,f,!0)+2:s.cap===Ue.SQUARE&&(p+=Mc(I,M,R,N,V,A,!0,f))),f.push(I-R*V,M-N*V),f.push(I+R*A,M+N*A);for(var O=1;O<d-1;++O){I=r[(O-1)*2],M=r[(O-1)*2+1],_=r[O*2],F=r[O*2+1],C=r[(O+1)*2],H=r[(O+1)*2+1],R=-(M-F),N=I-_,J=Math.sqrt(R*R+N*N),R/=J,N/=J,R*=m,N*=m,Y=-(F-H),D=_-C,J=Math.sqrt(Y*Y+D*D),Y/=J,D/=J,Y*=m,D*=m;var y=_-I,b=M-F,x=_-C,T=H-F,S=b*x-T*y,P=S<0;if(Math.abs(S)<.1){f.push(_-R*V,F-N*V),f.push(_+R*A,F+N*A);continue}var L=(-R+I)*(-N+F)-(-R+_)*(-N+M),B=(-Y+C)*(-D+F)-(-Y+_)*(-D+H),k=(y*B-x*L)/S,U=(T*L-b*B)/S,q=(k-_)*(k-_)+(U-F)*(U-F),W=_+(k-_)*V,z=F+(U-F)*V,Z=_-(k-_)*A,j=F-(U-F)*A,it=Math.min(y*y+b*b,x*x+T*T),at=P?V:A,et=it+at*at*g,rt=q<=et;rt?s.join===ke.BEVEL||q/g>E?(P?(f.push(W,z),f.push(_+R*A,F+N*A),f.push(W,z),f.push(_+Y*A,F+D*A)):(f.push(_-R*V,F-N*V),f.push(Z,j),f.push(_-Y*V,F-D*V),f.push(Z,j)),p+=2):s.join===ke.ROUND?P?(f.push(W,z),f.push(_+R*A,F+N*A),p+=$r(_,F,_+R*A,F+N*A,_+Y*A,F+D*A,f,!0)+4,f.push(W,z),f.push(_+Y*A,F+D*A)):(f.push(_-R*V,F-N*V),f.push(Z,j),p+=$r(_,F,_-R*V,F-N*V,_-Y*V,F-D*V,f,!1)+4,f.push(_-Y*V,F-D*V),f.push(Z,j)):(f.push(W,z),f.push(Z,j)):(f.push(_-R*V,F-N*V),f.push(_+R*A,F+N*A),s.join===ke.BEVEL||q/g>E||(s.join===ke.ROUND?P?p+=$r(_,F,_+R*A,F+N*A,_+Y*A,F+D*A,f,!0)+2:p+=$r(_,F,_-R*V,F-N*V,_-Y*V,F-D*V,f,!1)+2:(P?(f.push(Z,j),f.push(Z,j)):(f.push(W,z),f.push(W,z)),p+=2)),f.push(_-Y*V,F-D*V),f.push(_+Y*A,F+D*A),p+=2)}I=r[(d-2)*2],M=r[(d-2)*2+1],_=r[(d-1)*2],F=r[(d-1)*2+1],R=-(M-F),N=I-_,J=Math.sqrt(R*R+N*N),R/=J,N/=J,R*=m,N*=m,f.push(_-R*V,F-N*V),f.push(_+R*A,F+N*A),l||(s.cap===Ue.ROUND?p+=$r(_-R*(V-A)*.5,F-N*(V-A)*.5,_-R*V,F-N*V,_+R*A,F+N*A,f,!1)+2:s.cap===Ue.SQUARE&&(p+=Mc(_,F,R,N,V,A,!1,f)));for(var wt=e.indices,xt=di.epsilon*di.epsilon,O=v;O<p+v-2;++O)I=f[O*2],M=f[O*2+1],_=f[(O+1)*2],F=f[(O+1)*2+1],C=f[(O+2)*2],H=f[(O+2)*2+1],!(Math.abs(I*(F-H)+_*(H-M)+C*(M-F))<xt)&&wt.push(O,O+1,O+2)}}function C0(i,e){var t=0,r=i.shape,n=i.points||r.points,s=r.type!==Rt.POLY||r.closeStroke;if(n.length!==0){var o=e.points,a=e.indices,l=n.length/2,u=o.length/2,h=u;for(o.push(n[0],n[1]),t=1;t<l;t++)o.push(n[t*2],n[t*2+1]),a.push(h,h+1),h++;s&&a.push(h,u)}}function $a(i,e){i.lineStyle.native?C0(i,e):A0(i,e)}var jp=(function(i){Os(e,i);function e(t,r,n,s,o,a){a===void 0&&(a=0);var l=this;o=o||s/2;for(var u=-1*Math.PI/2+a,h=n*2,c=ci/h,f=[],d=0;d<h;d++){var p=d%2?o:s,v=d*c+u;f.push(t+p*Math.cos(v),r+p*Math.sin(v))}return l=i.call(this,f)||this,l}return e})(ii),ja=(function(){function i(){}return i.curveTo=function(e,t,r,n,s,o){var a=o[o.length-2],l=o[o.length-1],u=l-t,h=a-e,c=n-t,f=r-e,d=Math.abs(u*f-h*c);if(d<1e-8||s===0)return(o[o.length-2]!==e||o[o.length-1]!==t)&&o.push(e,t),null;var p=u*u+h*h,v=c*c+f*f,m=u*c+h*f,g=s*Math.sqrt(p)/d,E=s*Math.sqrt(v)/d,I=g*m/p,M=E*m/v,_=g*f+E*h,F=g*c+E*u,C=h*(E+I),H=u*(E+I),R=f*(g+M),N=c*(g+M),Y=Math.atan2(H-F,C-_),D=Math.atan2(N-F,R-_);return{cx:_+e,cy:F+t,radius:s,startAngle:Y,endAngle:D,anticlockwise:h*c>f*u}},i.arc=function(e,t,r,n,s,o,a,l,u){for(var h=a-o,c=di._segmentsCount(Math.abs(h)*s,Math.ceil(Math.abs(h)/ci)*40),f=h/(c*2),d=f*2,p=Math.cos(f),v=Math.sin(f),m=c-1,g=m%1/m,E=0;E<=m;++E){var I=E+g*E,M=f+o+d*I,_=Math.cos(M),F=-Math.sin(M);u.push((p*_+v*F)*s+r,(p*-F+v*_)*s+n)}},i})(),Wp=(function(){function i(){}return i.curveLength=function(e,t,r,n,s,o,a,l){for(var u=10,h=0,c=0,f=0,d=0,p=0,v=0,m=0,g=0,E=0,I=0,M=0,_=e,F=t,C=1;C<=u;++C)c=C/u,f=c*c,d=f*c,p=1-c,v=p*p,m=v*p,g=m*e+3*v*c*r+3*p*f*s+d*a,E=m*t+3*v*c*n+3*p*f*o+d*l,I=_-g,M=F-E,_=g,F=E,h+=Math.sqrt(I*I+M*M);return h},i.curveTo=function(e,t,r,n,s,o,a){var l=a[a.length-2],u=a[a.length-1];a.length-=2;var h=di._segmentsCount(i.curveLength(l,u,e,t,r,n,s,o)),c=0,f=0,d=0,p=0,v=0;a.push(l,u);for(var m=1,g=0;m<=h;++m)g=m/h,c=1-g,f=c*c,d=f*c,p=g*g,v=p*g,a.push(d*l+3*f*g*e+3*c*p*r+v*s,d*u+3*f*g*t+3*c*p*n+v*o)},i})(),Kp=(function(){function i(){}return i.curveLength=function(e,t,r,n,s,o){var a=e-2*r+s,l=t-2*n+o,u=2*r-2*e,h=2*n-2*t,c=4*(a*a+l*l),f=4*(a*u+l*h),d=u*u+h*h,p=2*Math.sqrt(c+f+d),v=Math.sqrt(c),m=2*c*v,g=2*Math.sqrt(d),E=f/v;return(m*p+v*f*(p-g)+(4*d*c-f*f)*Math.log((2*v+E+p)/(E+g)))/(4*m)},i.curveTo=function(e,t,r,n,s){for(var o=s[s.length-2],a=s[s.length-1],l=di._segmentsCount(i.curveLength(o,a,e,t,r,n)),u=0,h=0,c=1;c<=l;++c){var f=c/l;u=o+(e-o)*f,h=a+(t-a)*f,s.push(u+(e+(r-e)*f-u)*f,h+(t+(n-t)*f-h)*f)}},i})(),Zp=(function(){function i(){this.reset()}return i.prototype.begin=function(e,t,r){this.reset(),this.style=e,this.start=t,this.attribStart=r},i.prototype.end=function(e,t){this.attribSize=t-this.attribStart,this.size=e-this.start},i.prototype.reset=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},i})(),vr,ts=(vr={},vr[Rt.POLY]=hu,vr[Rt.CIRC]=qa,vr[Rt.ELIP]=qa,vr[Rt.RECT]=qp,vr[Rt.RREC]=$p,vr),Wa=[],Xi=[],P0={buildPoly:hu,buildCircle:qa,buildRectangle:qp,buildRoundedRectangle:$p,FILL_COMMANDS:ts,BATCH_POOL:Wa,DRAW_CALL_POOL:Xi,buildLine:$a,Star:jp,ArcUtils:ja,BezierUtils:Wp,QuadraticUtils:Kp,BatchPart:Zp},Ka=(function(){function i(e,t,r,n){t===void 0&&(t=null),r===void 0&&(r=null),n===void 0&&(n=null),this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=n,this.type=e.type,this.points=[],this.holes=[]}return i.prototype.clone=function(){return new i(this.shape,this.fillStyle,this.lineStyle,this.matrix)},i.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null},i})(),jr=new Ht,O0=new Ji,Jp=(function(i){Os(e,i);function e(){var t=i.call(this)||this;return t.uvsFloat32=null,t.indicesUint16=null,t.points=[],t.colors=[],t.uvs=[],t.indices=[],t.textureIds=[],t.graphicsData=[],t.dirty=0,t.batchDirty=-1,t.cacheDirty=-1,t.clearDirty=0,t.drawCalls=[],t.batches=[],t.shapeIndex=0,t._bounds=new Ji,t.boundsDirty=-1,t.boundsPadding=0,t.batchable=!1,t.indicesUint16=null,t.uvsFloat32=null,t.closePointEps=1e-4,t}return Object.defineProperty(e.prototype,"bounds",{get:function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},enumerable:!1,configurable:!0}),e.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),Xi.push(this.drawCalls[t]);this.drawCalls.length=0;for(var t=0;t<this.batches.length;t++){var r=this.batches[t];r.reset(),Wa.push(r)}this.batches.length=0},e.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},e.prototype.drawShape=function(t,r,n,s){r===void 0&&(r=null),n===void 0&&(n=null),s===void 0&&(s=null);var o=new Ka(t,r,n,s);return this.graphicsData.push(o),this.dirty++,this},e.prototype.drawHole=function(t,r){if(r===void 0&&(r=null),!this.graphicsData.length)return null;var n=new Ka(t,null,null,r),s=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=s.lineStyle,s.holes.push(n),this.dirty++,this},e.prototype.destroy=function(){i.prototype.destroy.call(this);for(var t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},e.prototype.containsPoint=function(t){for(var r=this.graphicsData,n=0;n<r.length;++n){var s=r[n];if(s.fillStyle.visible&&s.shape&&(s.matrix?s.matrix.applyInverse(t,jr):jr.copyFrom(t),s.shape.contains(jr.x,jr.y))){var o=!1;if(s.holes)for(var a=0;a<s.holes.length;a++){var l=s.holes[a];if(l.shape.contains(jr.x,jr.y)){o=!0;break}}if(!o)return!0}}return!1},e.prototype.updateBatches=function(t){if(!this.graphicsData.length){this.batchable=!0;return}if(this.validateBatching()){this.cacheDirty=this.dirty;var r=this.uvs,n=this.graphicsData,s=null,o=null;this.batches.length>0&&(s=this.batches[this.batches.length-1],o=s.style);for(var a=this.shapeIndex;a<n.length;a++){this.shapeIndex++;var l=n[a],u=l.fillStyle,h=l.lineStyle,c=ts[l.type];c.build(l),l.matrix&&this.transformPoints(l.points,l.matrix);for(var f=0;f<2;f++){var d=f===0?u:h;if(d.visible){var p=d.texture.baseTexture,v=this.indices.length,m=this.points.length/2;p.wrapMode=Ae.REPEAT,f===0?this.processFill(l):this.processLine(l);var g=this.points.length/2-m;g!==0&&(s&&!this._compareStyles(o,d)&&(s.end(v,m),s=null),s||(s=Wa.pop()||new Zp,s.begin(d,v,m),this.batches.push(s),o=d),this.addUvs(this.points,r,d.texture,m,g,d.matrix))}}}var E=this.indices.length,I=this.points.length/2;if(s&&s.end(E,I),this.batches.length===0){this.batchable=!0;return}if(this.indicesUint16&&this.indices.length===this.indicesUint16.length)this.indicesUint16.set(this.indices);else{var M=I>65535&&t;this.indicesUint16=M?new Uint32Array(this.indices):new Uint16Array(this.indices)}this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}},e.prototype._compareStyles=function(t,r){return!(!t||!r||t.texture.baseTexture!==r.texture.baseTexture||t.color+t.alpha!==r.color+r.alpha||!!t.native!=!!r.native)},e.prototype.validateBatching=function(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(var t=0,r=this.graphicsData.length;t<r;t++){var n=this.graphicsData[t],s=n.fillStyle,o=n.lineStyle;if(s&&!s.texture.baseTexture.valid||o&&!o.texture.baseTexture.valid)return!1}return!0},e.prototype.packBatches=function(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var t=this.batches,r=0,n=t.length;r<n;r++)for(var s=t[r],o=0;o<s.size;o++){var a=s.start+o;this.indicesUint16[a]=this.indicesUint16[a]-s.attribStart}},e.prototype.isBatchable=function(){if(this.points.length>65535*2)return!1;for(var t=this.batches,r=0;r<t.length;r++)if(t[r].style.native)return!1;return this.points.length<e.BATCHABLE_SIZE*2},e.prototype.buildDrawCalls=function(){for(var t=++It._globalBatch,r=0;r<this.drawCalls.length;r++)this.drawCalls[r].texArray.clear(),Xi.push(this.drawCalls[r]);this.drawCalls.length=0;var n=this.colors,s=this.textureIds,o=Xi.pop();o||(o=new ms,o.texArray=new vs),o.texArray.count=0,o.start=0,o.size=0,o.type=ue.TRIANGLES;var a=0,l=null,u=0,h=!1,c=ue.TRIANGLES,f=0;this.drawCalls.push(o);for(var r=0;r<this.batches.length;r++){var d=this.batches[r],p=8,v=d.style,m=v.texture.baseTexture;h!==!!v.native&&(h=!!v.native,c=h?ue.LINES:ue.TRIANGLES,l=null,a=p,t++),l!==m&&(l=m,m._batchEnabled!==t&&(a===p&&(t++,a=0,o.size>0&&(o=Xi.pop(),o||(o=new ms,o.texArray=new vs),this.drawCalls.push(o)),o.start=f,o.size=0,o.texArray.count=0,o.type=c),m.touched=1,m._batchEnabled=t,m._batchLocation=a,m.wrapMode=10497,o.texArray.elements[o.texArray.count++]=m,a++)),o.size+=d.size,f+=d.size,u=m._batchLocation,this.addColors(n,v.color,v.alpha,d.attribSize,d.attribStart),this.addTextureIds(s,u,d.attribSize,d.attribStart)}It._globalBatch=t,this.packAttributes()},e.prototype.packAttributes=function(){for(var t=this.points,r=this.uvs,n=this.colors,s=this.textureIds,o=new ArrayBuffer(t.length*3*4),a=new Float32Array(o),l=new Uint32Array(o),u=0,h=0;h<t.length/2;h++)a[u++]=t[h*2],a[u++]=t[h*2+1],a[u++]=r[h*2],a[u++]=r[h*2+1],l[u++]=n[h],a[u++]=s[h];this._buffer.update(o),this._indexBuffer.update(this.indicesUint16)},e.prototype.processFill=function(t){if(t.holes.length)this.processHoles(t.holes),hu.triangulate(t,this);else{var r=ts[t.type];r.triangulate(t,this)}},e.prototype.processLine=function(t){$a(t,this);for(var r=0;r<t.holes.length;r++)$a(t.holes[r],this)},e.prototype.processHoles=function(t){for(var r=0;r<t.length;r++){var n=t[r],s=ts[n.type];s.build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}},e.prototype.calculateBounds=function(){var t=this._bounds,r=O0,n=Mt.IDENTITY;this._bounds.clear(),r.clear();for(var s=0;s<this.graphicsData.length;s++){var o=this.graphicsData[s],a=o.shape,l=o.type,u=o.lineStyle,h=o.matrix||Mt.IDENTITY,c=0;if(u&&u.visible){var f=u.alignment;c=u.width,l===Rt.POLY?c=c*(.5+Math.abs(.5-f)):c=c*Math.max(0,f)}if(n!==h&&(r.isEmpty()||(t.addBoundsMatrix(r,n),r.clear()),n=h),l===Rt.RECT||l===Rt.RREC){var d=a;r.addFramePad(d.x,d.y,d.x+d.width,d.y+d.height,c,c)}else if(l===Rt.CIRC){var p=a;r.addFramePad(p.x,p.y,p.x,p.y,p.radius+c,p.radius+c)}else if(l===Rt.ELIP){var v=a;r.addFramePad(v.x,v.y,v.x,v.y,v.width+c,v.height+c)}else{var m=a;t.addVerticesMatrix(n,m.points,0,m.points.length,c,c)}}r.isEmpty()||t.addBoundsMatrix(r,n),t.pad(this.boundsPadding,this.boundsPadding)},e.prototype.transformPoints=function(t,r){for(var n=0;n<t.length/2;n++){var s=t[n*2],o=t[n*2+1];t[n*2]=r.a*s+r.c*o+r.tx,t[n*2+1]=r.b*s+r.d*o+r.ty}},e.prototype.addColors=function(t,r,n,s,o){o===void 0&&(o=0);var a=(r>>16)+(r&65280)+((r&255)<<16),l=Ss(a,n);t.length=Math.max(t.length,o+s);for(var u=0;u<s;u++)t[o+u]=l},e.prototype.addTextureIds=function(t,r,n,s){s===void 0&&(s=0),t.length=Math.max(t.length,s+n);for(var o=0;o<n;o++)t[s+o]=r},e.prototype.addUvs=function(t,r,n,s,o,a){a===void 0&&(a=null);for(var l=0,u=r.length,h=n.frame;l<o;){var c=t[(s+l)*2],f=t[(s+l)*2+1];if(a){var d=a.a*c+a.c*f+a.tx;f=a.b*c+a.d*f+a.ty,c=d}l++,r.push(c/h.width,f/h.height)}var p=n.baseTexture;(h.width<p.width||h.height<p.height)&&this.adjustUvs(r,n,u,o)},e.prototype.adjustUvs=function(t,r,n,s){for(var o=r.baseTexture,a=1e-6,l=n+s*2,u=r.frame,h=u.width/o.width,c=u.height/o.height,f=u.x/u.width,d=u.y/u.height,p=Math.floor(t[n]+a),v=Math.floor(t[n+1]+a),m=n+2;m<l;m+=2)p=Math.min(p,Math.floor(t[m]+a)),v=Math.min(v,Math.floor(t[m+1]+a));f-=p,d-=v;for(var m=n;m<l;m+=2)t[m]=(t[m]+f)*h,t[m+1]=(t[m+1]+d)*c},e.BATCHABLE_SIZE=100,e})(lu),Qp=(function(i){Os(e,i);function e(){var t=i!==null&&i.apply(this,arguments)||this;return t.width=0,t.alignment=.5,t.native=!1,t.cap=Ue.BUTT,t.join=ke.MITER,t.miterLimit=10,t}return e.prototype.clone=function(){var t=new e;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t},e.prototype.reset=function(){i.prototype.reset.call(this),this.color=0,this.alignment=.5,this.width=0,this.native=!1},e})(uu),F0=new Float32Array(3),ua={},Fs=(function(i){Os(e,i);function e(t){t===void 0&&(t=null);var r=i.call(this)||this;return r._geometry=t||new Jp,r._geometry.refCount++,r.shader=null,r.state=cr.for2d(),r._fillStyle=new uu,r._lineStyle=new Qp,r._matrix=null,r._holeMode=!1,r.currentPath=null,r.batches=[],r.batchTint=-1,r.batchDirty=-1,r.vertexData=null,r.pluginName="batch",r._transformID=-1,r.tint=16777215,r.blendMode=st.NORMAL,r}return Object.defineProperty(e.prototype,"geometry",{get:function(){return this._geometry},enumerable:!1,configurable:!0}),e.prototype.clone=function(){return this.finishPoly(),new e(this._geometry)},Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fill",{get:function(){return this._fillStyle},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"line",{get:function(){return this._lineStyle},enumerable:!1,configurable:!0}),e.prototype.lineStyle=function(t){if(t===void 0&&(t=null),typeof t=="number"){var r=arguments;t={width:r[0]||0,color:r[1]||0,alpha:r[2]!==void 0?r[2]:1,alignment:r[3]!==void 0?r[3]:.5,native:!!r[4]}}return this.lineTextureStyle(t)},e.prototype.lineTextureStyle=function(t){if(typeof t=="number"){K("v5.2.0","Please use object-based options for Graphics#lineTextureStyle");var r=arguments,n=r[0],s=r[1],o=r[2],a=r[3],l=r[4],u=r[5],h=r[6];t={width:n,texture:s,color:o,alpha:a,matrix:l,alignment:u,native:h},Object.keys(t).forEach(function(f){return t[f]===void 0&&delete t[f]})}t=Object.assign({width:0,texture:lt.WHITE,color:t&&t.texture?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:Ue.BUTT,join:ke.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();var c=t.width>0&&t.alpha>0;return c?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:c},t)):this._lineStyle.reset(),this},e.prototype.startPoly=function(){if(this.currentPath){var t=this.currentPath.points,r=this.currentPath.points.length;r>2&&(this.drawShape(this.currentPath),this.currentPath=new ii,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[r-2],t[r-1]))}else this.currentPath=new ii,this.currentPath.closeStroke=!1},e.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},e.prototype.moveTo=function(t,r){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=r,this},e.prototype.lineTo=function(t,r){this.currentPath||this.moveTo(0,0);var n=this.currentPath.points,s=n[n.length-2],o=n[n.length-1];return(s!==t||o!==r)&&n.push(t,r),this},e.prototype._initCurve=function(t,r){t===void 0&&(t=0),r===void 0&&(r=0),this.currentPath?this.currentPath.points.length===0&&(this.currentPath.points=[t,r]):this.moveTo(t,r)},e.prototype.quadraticCurveTo=function(t,r,n,s){this._initCurve();var o=this.currentPath.points;return o.length===0&&this.moveTo(0,0),Kp.curveTo(t,r,n,s,o),this},e.prototype.bezierCurveTo=function(t,r,n,s,o,a){return this._initCurve(),Wp.curveTo(t,r,n,s,o,a,this.currentPath.points),this},e.prototype.arcTo=function(t,r,n,s,o){this._initCurve(t,r);var a=this.currentPath.points,l=ja.curveTo(t,r,n,s,o,a);if(l){var u=l.cx,h=l.cy,c=l.radius,f=l.startAngle,d=l.endAngle,p=l.anticlockwise;this.arc(u,h,c,f,d,p)}return this},e.prototype.arc=function(t,r,n,s,o,a){if(a===void 0&&(a=!1),s===o)return this;!a&&o<=s?o+=ci:a&&s<=o&&(s+=ci);var l=o-s;if(l===0)return this;var u=t+Math.cos(s)*n,h=r+Math.sin(s)*n,c=this._geometry.closePointEps,f=this.currentPath?this.currentPath.points:null;if(f){var d=Math.abs(f[f.length-2]-u),p=Math.abs(f[f.length-1]-h);d<c&&p<c||f.push(u,h)}else this.moveTo(u,h),f=this.currentPath.points;return ja.arc(u,h,t,r,n,s,o,a,f),this},e.prototype.beginFill=function(t,r){return t===void 0&&(t=0),r===void 0&&(r=1),this.beginTextureFill({texture:lt.WHITE,color:t,alpha:r})},e.prototype.beginTextureFill=function(t){if(t instanceof lt){K("v5.2.0","Please use object-based options for Graphics#beginTextureFill");var r=arguments,n=r[0],s=r[1],o=r[2],a=r[3];t={texture:n,color:s,alpha:o,matrix:a},Object.keys(t).forEach(function(u){return t[u]===void 0&&delete t[u]})}t=Object.assign({texture:lt.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();var l=t.alpha>0;return l?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:l},t)):this._fillStyle.reset(),this},e.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},e.prototype.drawRect=function(t,r,n,s){return this.drawShape(new vt(t,r,n,s))},e.prototype.drawRoundedRect=function(t,r,n,s,o){return this.drawShape(new Yd(t,r,n,s,o))},e.prototype.drawCircle=function(t,r,n){return this.drawShape(new Hd(t,r,n))},e.prototype.drawEllipse=function(t,r,n,s){return this.drawShape(new Gd(t,r,n,s))},e.prototype.drawPolygon=function(){for(var t=arguments,r=[],n=0;n<arguments.length;n++)r[n]=t[n];var s,o=!0,a=r[0];a.points?(o=a.closeStroke,s=a.points):Array.isArray(r[0])?s=r[0]:s=r;var l=new ii(s);return l.closeStroke=o,this.drawShape(l),this},e.prototype.drawShape=function(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},e.prototype.drawStar=function(t,r,n,s,o,a){return a===void 0&&(a=0),this.drawPolygon(new jp(t,r,n,s,o,a))},e.prototype.clear=function(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this},e.prototype.isFastRect=function(){var t=this._geometry.graphicsData;return t.length===1&&t[0].shape.type===Rt.RECT&&!(t[0].lineStyle.visible&&t[0].lineStyle.width)},e.prototype._render=function(t){this.finishPoly();var r=this._geometry,n=t.context.supports.uint32Indices;r.updateBatches(n),r.batchable?(this.batchDirty!==r.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))},e.prototype._populateBatches=function(){var t=this._geometry,r=this.blendMode,n=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(t.points);for(var s=0;s<n;s++){var o=t.batches[s],a=o.style.color,l=new Float32Array(this.vertexData.buffer,o.attribStart*4*2,o.attribSize*2),u=new Float32Array(t.uvsFloat32.buffer,o.attribStart*4*2,o.attribSize*2),h=new Uint16Array(t.indicesUint16.buffer,o.start*2,o.size),c={vertexData:l,blendMode:r,indices:h,uvs:u,_batchRGB:Cr(a),_tintRGB:a,_texture:o.style.texture,alpha:o.style.alpha,worldAlpha:1};this.batches[s]=c}},e.prototype._renderBatched=function(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var r=0,n=this.batches.length;r<n;r++){var s=this.batches[r];s.worldAlpha=this.worldAlpha*s.alpha,t.plugins[this.pluginName].render(s)}}},e.prototype._renderDirect=function(t){var r=this._resolveDirectShader(t),n=this._geometry,s=this.tint,o=this.worldAlpha,a=r.uniforms,l=n.drawCalls;a.translationMatrix=this.transform.worldTransform,a.tint[0]=(s>>16&255)/255*o,a.tint[1]=(s>>8&255)/255*o,a.tint[2]=(s&255)/255*o,a.tint[3]=o,t.shader.bind(r),t.geometry.bind(n,r),t.state.set(this.state);for(var u=0,h=l.length;u<h;u++)this._renderDrawCallDirect(t,n.drawCalls[u])},e.prototype._renderDrawCallDirect=function(t,r){for(var n=r.texArray,s=r.type,o=r.size,a=r.start,l=n.count,u=0;u<l;u++)t.texture.bind(n.elements[u],u);t.geometry.draw(s,o,a)},e.prototype._resolveDirectShader=function(t){var r=this.shader,n=this.pluginName;if(!r){if(!ua[n]){for(var s=t.plugins.batch.MAX_TEXTURES,o=new Int32Array(s),a=0;a<s;a++)o[a]=a;var l={tint:new Float32Array([1,1,1,1]),translationMatrix:new Mt,default:lr.from({uSamplers:o},!0)},u=t.plugins[n]._shader.program;ua[n]=new qe(u,l)}r=ua[n]}return r},e.prototype._calculateBounds=function(){this.finishPoly();var t=this._geometry;if(t.graphicsData.length){var r=t.bounds,n=r.minX,s=r.minY,o=r.maxX,a=r.maxY;this._bounds.addFrame(this.transform,n,s,o,a)}},e.prototype.containsPoint=function(t){return this.worldTransform.applyInverse(t,e._TEMP_POINT),this._geometry.containsPoint(e._TEMP_POINT)},e.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var t=Cr(this.tint,F0),r=0;r<this.batches.length;r++){var n=this.batches[r],s=n._batchRGB,o=t[0]*s[0]*255,a=t[1]*s[1]*255,l=t[2]*s[2]*255,u=(o<<16)+(a<<8)+(l|0);n._tintRGB=(u>>16)+(u&65280)+((u&255)<<16)}}},e.prototype.calculateVertices=function(){var t=this.transform._worldID;if(this._transformID!==t){this._transformID=t;for(var r=this.transform.worldTransform,n=r.a,s=r.b,o=r.c,a=r.d,l=r.tx,u=r.ty,h=this._geometry.points,c=this.vertexData,f=0,d=0;d<h.length;d+=2){var p=h[d],v=h[d+1];c[f++]=n*p+o*v+l,c[f++]=a*v+s*p+u}}},e.prototype.closePath=function(){var t=this.currentPath;return t&&(t.closeStroke=!0),this},e.prototype.setMatrix=function(t){return this._matrix=t,this},e.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},e.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},e.prototype.destroy=function(t){this._geometry.refCount--,this._geometry.refCount===0&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,i.prototype.destroy.call(this,t)},e._TEMP_POINT=new Ht,e})(ee);/*!
 * @pixi/sprite - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/sprite is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Za=function(i,e){return Za=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},Za(i,e)};function R0(i,e){Za(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Li=new Ht,M0=new Uint16Array([0,1,2,0,2,3]),Br=(function(i){R0(e,i);function e(t){var r=i.call(this)||this;return r._anchor=new Er(r._onAnchorUpdate,r,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),r._texture=null,r._width=0,r._height=0,r._tint=null,r._tintRGB=null,r.tint=16777215,r.blendMode=st.NORMAL,r._cachedTint=16777215,r.uvs=null,r.texture=t||lt.EMPTY,r.vertexData=new Float32Array(8),r.vertexTrimmedData=null,r._transformID=-1,r._textureID=-1,r._transformTrimmedID=-1,r._textureTrimmedID=-1,r.indices=M0,r.pluginName="batch",r.isSprite=!0,r._roundPixels=nt.ROUND_PIXELS,r}return e.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=Ir(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=Ir(this.scale.y)*this._height/this._texture.orig.height)},e.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},e.prototype.calculateVertices=function(){var t=this._texture;if(!(this._transformID===this.transform._worldID&&this._textureID===t._updateID)){this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;var r=this.transform.worldTransform,n=r.a,s=r.b,o=r.c,a=r.d,l=r.tx,u=r.ty,h=this.vertexData,c=t.trim,f=t.orig,d=this._anchor,p=0,v=0,m=0,g=0;if(c?(v=c.x-d._x*f.width,p=v+c.width,g=c.y-d._y*f.height,m=g+c.height):(v=-d._x*f.width,p=v+f.width,g=-d._y*f.height,m=g+f.height),h[0]=n*v+o*g+l,h[1]=a*g+s*v+u,h[2]=n*p+o*g+l,h[3]=a*g+s*p+u,h[4]=n*p+o*m+l,h[5]=a*m+s*p+u,h[6]=n*v+o*m+l,h[7]=a*m+s*v+u,this._roundPixels)for(var E=nt.RESOLUTION,I=0;I<h.length;++I)h[I]=Math.round((h[I]*E|0)/E)}},e.prototype.calculateTrimmedVertices=function(){if(!this.vertexTrimmedData)this.vertexTrimmedData=new Float32Array(8);else if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return;this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var t=this._texture,r=this.vertexTrimmedData,n=t.orig,s=this._anchor,o=this.transform.worldTransform,a=o.a,l=o.b,u=o.c,h=o.d,c=o.tx,f=o.ty,d=-s._x*n.width,p=d+n.width,v=-s._y*n.height,m=v+n.height;r[0]=a*d+u*v+c,r[1]=h*v+l*d+f,r[2]=a*p+u*v+c,r[3]=h*v+l*p+f,r[4]=a*p+u*m+c,r[5]=h*m+l*p+f,r[6]=a*d+u*m+c,r[7]=h*m+l*d+f},e.prototype._render=function(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)},e.prototype._calculateBounds=function(){var t=this._texture.trim,r=this._texture.orig;!t||t.width===r.width&&t.height===r.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},e.prototype.getLocalBounds=function(t){return this.children.length===0?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new vt),t=this._localBoundsRect),this._bounds.getRectangle(t)):i.prototype.getLocalBounds.call(this,t)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Li);var r=this._texture.orig.width,n=this._texture.orig.height,s=-r*this.anchor.x,o=0;return Li.x>=s&&Li.x<s+r&&(o=-n*this.anchor.y,Li.y>=o&&Li.y<o+n)},e.prototype.destroy=function(t){i.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;var r=typeof t=="boolean"?t:t&&t.texture;if(r){var n=typeof t=="boolean"?t:t&&t.baseTexture;this._texture.destroy(!!n)}this._texture=null},e.from=function(t,r){var n=t instanceof lt?t:lt.from(t,r);return new e(n)},Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){var r=Ir(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){var r=Ir(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||lt.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))},enumerable:!1,configurable:!0}),e})(ee);/*!
 * @pixi/text - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/text is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Ja=function(i,e){return Ja=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},Ja(i,e)};function L0(i,e){Ja(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var pi;(function(i){i[i.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",i[i.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL"})(pi||(pi={}));var ha={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:pi.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},N0=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Rr=(function(){function i(e){this.styleID=0,this.reset(),fa(this,e,e)}return i.prototype.clone=function(){var e={};return fa(e,this,ha),new i(e)},i.prototype.reset=function(){fa(this,ha,ha)},Object.defineProperty(i.prototype,"align",{get:function(){return this._align},set:function(e){this._align!==e&&(this._align=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"breakWords",{get:function(){return this._breakWords},set:function(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadow",{get:function(){return this._dropShadow},set:function(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowAlpha",{get:function(){return this._dropShadowAlpha},set:function(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowAngle",{get:function(){return this._dropShadowAngle},set:function(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowBlur",{get:function(){return this._dropShadowBlur},set:function(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowColor",{get:function(){return this._dropShadowColor},set:function(e){var t=ca(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"dropShadowDistance",{get:function(){return this._dropShadowDistance},set:function(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fill",{get:function(){return this._fill},set:function(e){var t=ca(e);this._fill!==t&&(this._fill=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fillGradientType",{get:function(){return this._fillGradientType},set:function(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fillGradientStops",{get:function(){return this._fillGradientStops},set:function(e){B0(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontFamily",{get:function(){return this._fontFamily},set:function(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontSize",{get:function(){return this._fontSize},set:function(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontStyle",{get:function(){return this._fontStyle},set:function(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontVariant",{get:function(){return this._fontVariant},set:function(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineHeight",{get:function(){return this._lineHeight},set:function(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"leading",{get:function(){return this._leading},set:function(e){this._leading!==e&&(this._leading=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"lineJoin",{get:function(){return this._lineJoin},set:function(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"miterLimit",{get:function(){return this._miterLimit},set:function(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"padding",{get:function(){return this._padding},set:function(e){this._padding!==e&&(this._padding=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"stroke",{get:function(){return this._stroke},set:function(e){var t=ca(e);this._stroke!==t&&(this._stroke=t,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"strokeThickness",{get:function(){return this._strokeThickness},set:function(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"textBaseline",{get:function(){return this._textBaseline},set:function(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"trim",{get:function(){return this._trim},set:function(e){this._trim!==e&&(this._trim=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"whiteSpace",{get:function(){return this._whiteSpace},set:function(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"wordWrapWidth",{get:function(){return this._wordWrapWidth},set:function(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)},enumerable:!1,configurable:!0}),i.prototype.toFontString=function(){var e=typeof this.fontSize=="number"?this.fontSize+"px":this.fontSize,t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(var r=t.length-1;r>=0;r--){var n=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&N0.indexOf(n)<0&&(n='"'+n+'"'),t[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+t.join(",")},i})();function Lc(i){return typeof i=="number"?ql(i):(typeof i=="string"&&i.indexOf("0x")===0&&(i=i.replace("0x","#")),i)}function ca(i){if(Array.isArray(i)){for(var e=0;e<i.length;++e)i[e]=Lc(i[e]);return i}else return Lc(i)}function B0(i,e){if(!Array.isArray(i)||!Array.isArray(e)||i.length!==e.length)return!1;for(var t=0;t<i.length;++t)if(i[t]!==e[t])return!1;return!0}function fa(i,e,t){for(var r in t)Array.isArray(e[r])?i[r]=e[r].slice():i[r]=e[r]}var ge=(function(){function i(e,t,r,n,s,o,a,l,u){this.text=e,this.style=t,this.width=r,this.height=n,this.lines=s,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=u}return i.measureText=function(e,t,r,n){n===void 0&&(n=i._canvas),r=r??t.wordWrap;var s=t.toFontString(),o=i.measureFont(s);o.fontSize===0&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);var a=n.getContext("2d");a.font=s;for(var l=r?i.wordWrap(e,t,n):e,u=l.split(/(?:\r\n|\r|\n)/),h=new Array(u.length),c=0,f=0;f<u.length;f++){var d=a.measureText(u[f]).width+(u[f].length-1)*t.letterSpacing;h[f]=d,c=Math.max(c,d)}var p=c+t.strokeThickness;t.dropShadow&&(p+=t.dropShadowDistance);var v=t.lineHeight||o.fontSize+t.strokeThickness,m=Math.max(v,o.fontSize+t.strokeThickness)+(u.length-1)*(v+t.leading);return t.dropShadow&&(m+=t.dropShadowDistance),new i(e,t,p,m,u,h,v+t.leading,c,o)},i.wordWrap=function(e,t,r){r===void 0&&(r=i._canvas);for(var n=r.getContext("2d"),s=0,o="",a="",l=Object.create(null),u=t.letterSpacing,h=t.whiteSpace,c=i.collapseSpaces(h),f=i.collapseNewlines(h),d=!c,p=t.wordWrapWidth+u,v=i.tokenize(e),m=0;m<v.length;m++){var g=v[m];if(i.isNewline(g)){if(!f){a+=i.addLine(o),d=!c,o="",s=0;continue}g=" "}if(c){var E=i.isBreakingSpace(g),I=i.isBreakingSpace(o[o.length-1]);if(E&&I)continue}var M=i.getFromCache(g,u,l,n);if(M>p)if(o!==""&&(a+=i.addLine(o),o="",s=0),i.canBreakWords(g,t.breakWords))for(var _=i.wordWrapSplit(g),F=0;F<_.length;F++){for(var C=_[F],H=1;_[F+H];){var R=_[F+H],N=C[C.length-1];if(!i.canBreakChars(N,R,g,F,t.breakWords))C+=R;else break;H++}F+=C.length-1;var Y=i.getFromCache(C,u,l,n);Y+s>p&&(a+=i.addLine(o),d=!1,o="",s=0),o+=C,s+=Y}else{o.length>0&&(a+=i.addLine(o),o="",s=0);var D=m===v.length-1;a+=i.addLine(g,!D),d=!1,o="",s=0}else M+s>p&&(d=!1,a+=i.addLine(o),o="",s=0),(o.length>0||!i.isBreakingSpace(g)||d)&&(o+=g,s+=M)}return a+=i.addLine(o,!1),a},i.addLine=function(e,t){return t===void 0&&(t=!0),e=i.trimRight(e),e=t?e+`
`:e,e},i.getFromCache=function(e,t,r,n){var s=r[e];if(typeof s!="number"){var o=e.length*t;s=n.measureText(e).width+o,r[e]=s}return s},i.collapseSpaces=function(e){return e==="normal"||e==="pre-line"},i.collapseNewlines=function(e){return e==="normal"},i.trimRight=function(e){if(typeof e!="string")return"";for(var t=e.length-1;t>=0;t--){var r=e[t];if(!i.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},i.isNewline=function(e){return typeof e!="string"?!1:i._newlines.indexOf(e.charCodeAt(0))>=0},i.isBreakingSpace=function(e){return typeof e!="string"?!1:i._breakingSpaces.indexOf(e.charCodeAt(0))>=0},i.tokenize=function(e){var t=[],r="";if(typeof e!="string")return t;for(var n=0;n<e.length;n++){var s=e[n];if(i.isBreakingSpace(s)||i.isNewline(s)){r!==""&&(t.push(r),r=""),t.push(s);continue}r+=s}return r!==""&&t.push(r),t},i.canBreakWords=function(e,t){return t},i.canBreakChars=function(e,t,r,n,s){return!0},i.wordWrapSplit=function(e){return e.split("")},i.measureFont=function(e){if(i._fonts[e])return i._fonts[e];var t={ascent:0,descent:0,fontSize:0},r=i._canvas,n=i._context;n.font=e;var s=i.METRICS_STRING+i.BASELINE_SYMBOL,o=Math.ceil(n.measureText(s).width),a=Math.ceil(n.measureText(i.BASELINE_SYMBOL).width),l=2*a;a=a*i.BASELINE_MULTIPLIER|0,r.width=o,r.height=l,n.fillStyle="#f00",n.fillRect(0,0,o,l),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(s,0,a);var u=n.getImageData(0,0,o,l).data,h=u.length,c=o*4,f=0,d=0,p=!1;for(f=0;f<a;++f){for(var v=0;v<c;v+=4)if(u[d+v]!==255){p=!0;break}if(!p)d+=c;else break}for(t.ascent=a-f,d=h-c,p=!1,f=l;f>a;--f){for(var v=0;v<c;v+=4)if(u[d+v]!==255){p=!0;break}if(!p)d-=c;else break}return t.descent=f-a,t.fontSize=t.ascent+t.descent,i._fonts[e]=t,t},i.clearMetrics=function(e){e===void 0&&(e=""),e?delete i._fonts[e]:i._fonts={}},i})(),gs=(function(){try{var i=new OffscreenCanvas(0,0),e=i.getContext("2d");return e&&e.measureText?i:document.createElement("canvas")}catch{return document.createElement("canvas")}})();gs.width=gs.height=10;ge._canvas=gs;ge._context=gs.getContext("2d");ge._fonts={};ge.METRICS_STRING="|q";ge.BASELINE_SYMBOL="M";ge.BASELINE_MULTIPLIER=1.4;ge._newlines=[10,13];ge._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var D0={texture:!0,children:!1,baseTexture:!0},cu=(function(i){L0(e,i);function e(t,r,n){var s=this,o=!1;n||(n=document.createElement("canvas"),o=!0),n.width=3,n.height=3;var a=lt.from(n);return a.orig=new vt,a.trim=new vt,s=i.call(this,a)||this,s._ownCanvas=o,s.canvas=n,s.context=s.canvas.getContext("2d"),s._resolution=nt.RESOLUTION,s._autoResolution=!0,s._text=null,s._style=null,s._styleListener=null,s._font="",s.text=t,s.style=r,s.localStyleID=-1,s}return e.prototype.updateText=function(t){var r=this._style;if(this.localStyleID!==r.styleID&&(this.dirty=!0,this.localStyleID=r.styleID),!(!this.dirty&&t)){this._font=this._style.toFontString();var n=this.context,s=ge.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),o=s.width,a=s.height,l=s.lines,u=s.lineHeight,h=s.lineWidths,c=s.maxLineWidth,f=s.fontProperties;this.canvas.width=Math.ceil((Math.max(1,o)+r.padding*2)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,a)+r.padding*2)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=r.strokeThickness,n.textBaseline=r.textBaseline,n.lineJoin=r.lineJoin,n.miterLimit=r.miterLimit;for(var d,p,v=r.dropShadow?2:1,m=0;m<v;++m){var g=r.dropShadow&&m===0,E=g?Math.ceil(Math.max(1,a)+r.padding*2):0,I=E*this._resolution;if(g){n.fillStyle="black",n.strokeStyle="black";var M=r.dropShadowColor,_=Cr(typeof M=="number"?M:$l(M)),F=r.dropShadowBlur*this._resolution,C=r.dropShadowDistance*this._resolution;n.shadowColor="rgba("+_[0]*255+","+_[1]*255+","+_[2]*255+","+r.dropShadowAlpha+")",n.shadowBlur=F,n.shadowOffsetX=Math.cos(r.dropShadowAngle)*C,n.shadowOffsetY=Math.sin(r.dropShadowAngle)*C+I}else n.fillStyle=this._generateFillStyle(r,l,s),n.strokeStyle=r.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;for(var H=0;H<l.length;H++)d=r.strokeThickness/2,p=r.strokeThickness/2+H*u+f.ascent,r.align==="right"?d+=c-h[H]:r.align==="center"&&(d+=(c-h[H])/2),r.stroke&&r.strokeThickness&&this.drawLetterSpacing(l[H],d+r.padding,p+r.padding-E,!0),r.fill&&this.drawLetterSpacing(l[H],d+r.padding,p+r.padding-E)}this.updateTexture()}},e.prototype.drawLetterSpacing=function(t,r,n,s){s===void 0&&(s=!1);var o=this._style,a=o.letterSpacing;if(a===0){s?this.context.strokeText(t,r,n):this.context.fillText(t,r,n);return}for(var l=r,u=Array.from?Array.from(t):t.split(""),h=this.context.measureText(t).width,c=0,f=0;f<u.length;++f){var d=u[f];s?this.context.strokeText(d,l,n):this.context.fillText(d,l,n),c=this.context.measureText(t.substring(f+1)).width,l+=h-c+a,h=c}},e.prototype.updateTexture=function(){var t=this.canvas;if(this._style.trim){var r=Bd(t);r.data&&(t.width=r.width,t.height=r.height,this.context.putImageData(r.data,0,0))}var n=this._texture,s=this._style,o=s.trim?0:s.padding,a=n.baseTexture;n.trim.width=n._frame.width=Math.ceil(t.width/this._resolution),n.trim.height=n._frame.height=Math.ceil(t.height/this._resolution),n.trim.x=-o,n.trim.y=-o,n.orig.width=n._frame.width-o*2,n.orig.height=n._frame.height-o*2,this._onTextureUpdate(),a.setRealSize(t.width,t.height,this._resolution),this._recursivePostUpdateTransform(),this.dirty=!1},e.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),i.prototype._render.call(this,t)},e.prototype.getLocalBounds=function(t){return this.updateText(!0),i.prototype.getLocalBounds.call(this,t)},e.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},e.prototype._generateFillStyle=function(t,r,n){var s=t.fill;if(Array.isArray(s)){if(s.length===1)return s[0]}else return s;var o,a=t.dropShadow?t.dropShadowDistance:0,l=t.padding||0,u=Math.ceil(this.canvas.width/this._resolution)-a-l*2,h=Math.ceil(this.canvas.height/this._resolution)-a-l*2,c=s.slice(),f=t.fillGradientStops.slice();if(!f.length)for(var d=c.length+1,p=1;p<d;++p)f.push(p/d);if(c.unshift(s[0]),f.unshift(0),c.push(s[s.length-1]),f.push(1),t.fillGradientType===pi.LINEAR_VERTICAL){o=this.context.createLinearGradient(u/2,l,u/2,h+l);for(var v=0,m=n.fontProperties.fontSize+t.strokeThickness,g=m/h,p=0;p<r.length;p++)for(var E=n.lineHeight*p,I=0;I<c.length;I++){var M=0;typeof f[I]=="number"?M=f[I]:M=I/c.length;var _=E/h+M*g,F=Math.max(v,_);F=Math.min(F,1),o.addColorStop(F,c[I]),v=F}}else{o=this.context.createLinearGradient(l,h/2,u+l,h/2);for(var C=c.length+1,H=1,p=0;p<c.length;p++){var R=void 0;typeof f[p]=="number"?R=f[p]:R=H/C,o.addColorStop(R,c[p]),H++}}return o},e.prototype.destroy=function(t){typeof t=="boolean"&&(t={children:t}),t=Object.assign({},D0,t),i.prototype.destroy.call(this,t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null},Object.defineProperty(e.prototype,"width",{get:function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},set:function(t){this.updateText(!0);var r=Ir(this.scale.x)||1;this.scale.x=r*t/this._texture.orig.width,this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},set:function(t){this.updateText(!0);var r=Ir(this.scale.y)||1;this.scale.y=r*t/this._texture.orig.height,this._height=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this._style},set:function(t){t=t||{},t instanceof Rr?this._style=t:this._style=new Rr(t),this.localStyleID=-1,this.dirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)},enumerable:!1,configurable:!0}),e})(Br);/*!
 * @pixi/prepare - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/prepare is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */nt.UPLOADS_PER_FRAME=4;/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var Qa=function(i,e){return Qa=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},Qa(i,e)};function k0(i,e){Qa(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ty=(function(){function i(e){this.maxItemsPerFrame=e,this.itemsLeft=0}return i.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},i.prototype.allowedToUpload=function(){return this.itemsLeft-- >0},i})();function U0(i,e){var t=!1;if(i&&i._textures&&i._textures.length){for(var r=0;r<i._textures.length;r++)if(i._textures[r]instanceof lt){var n=i._textures[r].baseTexture;e.indexOf(n)===-1&&(e.push(n),t=!0)}}return t}function X0(i,e){if(i.baseTexture instanceof It){var t=i.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function H0(i,e){if(i._texture&&i._texture instanceof lt){var t=i._texture.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function G0(i,e){return e instanceof cu?(e.updateText(!0),!0):!1}function Y0(i,e){if(e instanceof Rr){var t=e.toFontString();return ge.measureFont(t),!0}return!1}function z0(i,e){if(i instanceof cu){e.indexOf(i.style)===-1&&e.push(i.style),e.indexOf(i)===-1&&e.push(i);var t=i._texture.baseTexture;return e.indexOf(t)===-1&&e.push(t),!0}return!1}function V0(i,e){return i instanceof Rr?(e.indexOf(i)===-1&&e.push(i),!0):!1}var ey=(function(){function i(e){var t=this;this.limiter=new ty(nt.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){t.queue&&t.prepareItems()},this.registerFindHook(z0),this.registerFindHook(V0),this.registerFindHook(U0),this.registerFindHook(X0),this.registerFindHook(H0),this.registerUploadHook(G0),this.registerUploadHook(Y0)}return i.prototype.upload=function(e,t){typeof e=="function"&&(t=e,e=null),e&&this.add(e),this.queue.length?(t&&this.completes.push(t),this.ticking||(this.ticking=!0,Xt.system.addOnce(this.tick,this,Oe.UTILITY))):t&&t()},i.prototype.tick=function(){setTimeout(this.delayedTick,0)},i.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],t=!1;if(e&&!e._destroyed){for(var r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}}t||this.queue.shift()}if(this.queue.length)Xt.system.addOnce(this.tick,this,Oe.UTILITY);else{this.ticking=!1;var s=this.completes.slice(0);this.completes.length=0;for(var r=0,n=s.length;r<n;r++)s[r]()}},i.prototype.registerFindHook=function(e){return e&&this.addHooks.push(e),this},i.prototype.registerUploadHook=function(e){return e&&this.uploadHooks.push(e),this},i.prototype.add=function(e){for(var t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof ee)for(var t=e.children.length-1;t>=0;t--)this.add(e.children[t]);return this},i.prototype.destroy=function(){this.ticking&&Xt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null},i})();function ry(i,e){return e instanceof It?(e._glTextures[i.CONTEXT_UID]||i.texture.bind(e),!0):!1}function q0(i,e){if(!(e instanceof Fs))return!1;var t=e.geometry;e.finishPoly(),t.updateBatches();for(var r=t.batches,n=0;n<r.length;n++){var s=r[n].style.texture;s&&ry(i,s.baseTexture)}return t.batchable||i.geometry.bind(t,e._resolveDirectShader(i)),!0}function $0(i,e){return i instanceof Fs?(e.push(i),!0):!1}var iy=(function(i){k0(e,i);function e(t){var r=i.call(this,t)||this;return r.uploadHookHelper=r.renderer,r.registerFindHook($0),r.registerUploadHook(ry),r.registerUploadHook(q0),r}return e})(ey),j0=(function(){function i(e){this.maxMilliseconds=e,this.frameStart=0}return i.prototype.beginFrame=function(){this.frameStart=Date.now()},i.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds},i})();/*!
 * @pixi/spritesheet - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/spritesheet is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var ny=(function(){function i(e,t,r){r===void 0&&(r=null),this._texture=e instanceof lt?e:null,this.baseTexture=e instanceof It?e:this._texture.baseTexture,this.textures={},this.animations={},this.data=t;var n=this.baseTexture.resource;this.resolution=this._updateResolution(r||(n?n.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}return i.prototype._updateResolution=function(e){e===void 0&&(e=null);var t=this.data.meta.scale,r=Zi(e,null);return r===null&&(r=t!==void 0?parseFloat(t):1),r!==1&&this.baseTexture.setResolution(r),r},i.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=i.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},i.prototype._processFrames=function(e){for(var t=e,r=i.BATCH_SIZE;t-e<r&&t<this._frameKeys.length;){var n=this._frameKeys[t],s=this._frames[n],o=s.frame;if(o){var a=null,l=null,u=s.trimmed!==!1&&s.sourceSize?s.sourceSize:s.frame,h=new vt(0,0,Math.floor(u.w)/this.resolution,Math.floor(u.h)/this.resolution);s.rotated?a=new vt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new vt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),s.trimmed!==!1&&s.spriteSourceSize&&(l=new vt(Math.floor(s.spriteSourceSize.x)/this.resolution,Math.floor(s.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new lt(this.baseTexture,a,h,l,s.rotated?2:0,s.anchor),lt.addToCache(this.textures[n],n)}t++}},i.prototype._processAnimations=function(){var e=this.data.animations||{};for(var t in e){this.animations[t]=[];for(var r=0;r<e[t].length;r++){var n=e[t][r];this.animations[t].push(this.textures[n])}}},i.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},i.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*i.BATCH_SIZE),this._batchIndex++,setTimeout(function(){e._batchIndex*i.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())},0)},i.prototype.destroy=function(e){var t;e===void 0&&(e=!1);for(var r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&((t=this._texture)===null||t===void 0||t.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null},i.BATCH_SIZE=1e3,i})(),sy=(function(){function i(){}return i.use=function(e,t){var r=this,n=e.name+"_image";if(!e.data||e.type!==Vi.TYPE.JSON||!e.data.frames||r.resources[n]){t();return}var s={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},o=i.getResourcePath(e,r.baseUrl);r.add(n,o,s,function(l){if(l.error){t(l.error);return}var u=new ny(l.texture,e.data,e.url);u.parse(function(){e.spritesheet=u,e.textures=u.textures,t()})})},i.getResourcePath=function(e,t){return e.isDataUrl?e.data.meta.image:Fd.resolve(e.url.replace(t,""),e.data.meta.image)},i})();/*!
 * @pixi/sprite-tiling - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/sprite-tiling is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var tl=function(i,e){return tl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},tl(i,e)};function oy(i,e){tl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ni=new Ht,W0=(function(i){oy(e,i);function e(t,r,n){r===void 0&&(r=100),n===void 0&&(n=100);var s=i.call(this,t)||this;return s.tileTransform=new Jl,s._width=r,s._height=n,s.uvMatrix=s.texture.uvMatrix||new Ps(t),s.pluginName="tilingSprite",s.uvRespectAnchor=!1,s}return Object.defineProperty(e.prototype,"clampMargin",{get:function(){return this.uvMatrix.clampMargin},set:function(t){this.uvMatrix.clampMargin=t,this.uvMatrix.update(!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tileScale",{get:function(){return this.tileTransform.scale},set:function(t){this.tileTransform.scale.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tilePosition",{get:function(){return this.tileTransform.position},set:function(t){this.tileTransform.position.copyFrom(t)},enumerable:!1,configurable:!0}),e.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},e.prototype._render=function(t){var r=this._texture;!r||!r.valid||(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this))},e.prototype._calculateBounds=function(){var t=this._width*-this._anchor._x,r=this._height*-this._anchor._y,n=this._width*(1-this._anchor._x),s=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,t,r,n,s)},e.prototype.getLocalBounds=function(t){return this.children.length===0?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new vt),t=this._localBoundsRect),this._bounds.getRectangle(t)):i.prototype.getLocalBounds.call(this,t)},e.prototype.containsPoint=function(t){this.worldTransform.applyInverse(t,Ni);var r=this._width,n=this._height,s=-r*this.anchor._x;if(Ni.x>=s&&Ni.x<s+r){var o=-n*this.anchor._y;if(Ni.y>=o&&Ni.y<o+n)return!0}return!1},e.prototype.destroy=function(t){i.prototype.destroy.call(this,t),this.tileTransform=null,this.uvMatrix=null},e.from=function(t,r){return typeof r=="number"&&(K("5.3.0","TilingSprite.from use options instead of width and height args"),r={width:r,height:arguments[2]}),new e(lt.from(t,r),r.width,r.height)},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t},enumerable:!1,configurable:!0}),e})(Br),Nc=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTransform;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;
}
`,K0=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;
uniform mat3 uMapCoord;
uniform vec4 uClampFrame;
uniform vec2 uClampOffset;

void main(void)
{
    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);
    coord = (uMapCoord * vec3(coord, 1.0)).xy;
    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

    vec4 texSample = texture2D(uSampler, coord);
    gl_FragColor = texSample * uColor;
}
`,Z0=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform vec4 uColor;

void main(void)
{
    vec4 texSample = texture2D(uSampler, vTextureCoord);
    gl_FragColor = texSample * uColor;
}
`,Mn=new Mt,ay=(function(i){oy(e,i);function e(t){var r=i.call(this,t)||this,n={globals:r.renderer.globalUniforms};return r.shader=qe.from(Nc,K0,n),r.simpleShader=qe.from(Nc,Z0,n),r.quad=new ou,r.state=cr.for2d(),r}return e.prototype.render=function(t){var r=this.renderer,n=this.quad,s=n.vertices;s[0]=s[6]=t._width*-t.anchor.x,s[1]=s[3]=t._height*-t.anchor.y,s[2]=s[4]=t._width*(1-t.anchor.x),s[5]=s[7]=t._height*(1-t.anchor.y),t.uvRespectAnchor&&(s=n.uvs,s[0]=s[6]=-t.anchor.x,s[1]=s[3]=-t.anchor.y,s[2]=s[4]=1-t.anchor.x,s[5]=s[7]=1-t.anchor.y),n.invalidate();var o=t._texture,a=o.baseTexture,l=t.tileTransform.localTransform,u=t.uvMatrix,h=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;h&&(a._glTextures[r.CONTEXT_UID]?h=a.wrapMode!==Ae.CLAMP:a.wrapMode===Ae.CLAMP&&(a.wrapMode=Ae.REPEAT));var c=h?this.simpleShader:this.shader,f=o.width,d=o.height,p=t._width,v=t._height;Mn.set(l.a*f/p,l.b*f/v,l.c*d/p,l.d*d/v,l.tx/p,l.ty/v),Mn.invert(),h?Mn.prepend(u.mapCoord):(c.uniforms.uMapCoord=u.mapCoord.toArray(!0),c.uniforms.uClampFrame=u.uClampFrame,c.uniforms.uClampOffset=u.uClampOffset),c.uniforms.uTransform=Mn.toArray(!0),c.uniforms.uColor=Kl(t.tint,t.worldAlpha,c.uniforms.uColor,a.alphaMode),c.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),c.uniforms.uSampler=o,r.shader.bind(c),r.geometry.bind(n),this.state.blendMode=Wl(t.blendMode,a.alphaMode),r.state.set(this.state),r.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},e})(wi);/*!
 * @pixi/mesh - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mesh is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var el=function(i,e){return el=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},el(i,e)};function fu(i,e){el(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ly=(function(){function i(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}return i.prototype.update=function(e){if(!(!e&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var t=this.uvBuffer.data;(!this.data||this.data.length!==t.length)&&(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}},i})(),da=new Ht,Bc=new ii,yi=(function(i){fu(e,i);function e(t,r,n,s){s===void 0&&(s=ue.TRIANGLES);var o=i.call(this)||this;return o.geometry=t,t.refCount++,o.shader=r,o.state=n||cr.for2d(),o.drawMode=s,o.start=0,o.size=0,o.uvs=null,o.indices=null,o.vertexData=new Float32Array(1),o.vertexDirty=0,o._transformID=-1,o._roundPixels=nt.ROUND_PIXELS,o.batchUvs=null,o}return Object.defineProperty(e.prototype,"uvBuffer",{get:function(){return this.geometry.buffers[1]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"verticesBuffer",{get:function(){return this.geometry.buffers[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"material",{get:function(){return this.shader},set:function(t){this.shader=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.state.blendMode},set:function(t){this.state.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this.shader.tint},set:function(t){this.shader.tint=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){var r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===ue.TRIANGLES&&r.length<e.BATCHABLE_SIZE*2?this._renderToBatch(t):this._renderDefault(t)},e.prototype._renderDefault=function(t){var r=this.shader;r.alpha=this.worldAlpha,r.update&&r.update(),t.batch.flush(),r.program.uniformData.translationMatrix&&(r.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),t.shader.bind(r),t.state.set(this.state),t.geometry.bind(this.geometry,r),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},e.prototype._renderToBatch=function(t){var r=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=r.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var n=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[n]),t.plugins[n].render(this)},e.prototype.calculateVertices=function(){var t=this.geometry,r=t.buffers[0].data;if(!(t.vertexDirtyId===this.vertexDirty&&this._transformID===this.transform._worldID)){this._transformID=this.transform._worldID,this.vertexData.length!==r.length&&(this.vertexData=new Float32Array(r.length));for(var n=this.transform.worldTransform,s=n.a,o=n.b,a=n.c,l=n.d,u=n.tx,h=n.ty,c=this.vertexData,f=0;f<c.length/2;f++){var d=r[f*2],p=r[f*2+1];c[f*2]=s*d+a*p+u,c[f*2+1]=o*d+l*p+h}if(this._roundPixels)for(var v=nt.RESOLUTION,f=0;f<c.length;++f)c[f]=Math.round((c[f]*v|0)/v);this.vertexDirty=t.vertexDirtyId}},e.prototype.calculateUvs=function(){var t=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new ly(t,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},e.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},e.prototype.containsPoint=function(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,da);for(var r=this.geometry.getBuffer("aVertexPosition").data,n=Bc.points,s=this.geometry.getIndex().data,o=s.length,a=this.drawMode===4?3:1,l=0;l+2<o;l+=a){var u=s[l]*2,h=s[l+1]*2,c=s[l+2]*2;if(n[0]=r[u],n[1]=r[u+1],n[2]=r[h],n[3]=r[h+1],n[4]=r[c],n[5]=r[c+1],Bc.contains(da.x,da.y))return!0}return!1},e.prototype.destroy=function(t){i.prototype.destroy.call(this,t),this.geometry.refCount--,this.geometry.refCount===0&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},e.BATCHABLE_SIZE=100,e})(ee),J0=`varying vec2 vTextureCoord;
uniform vec4 uColor;

uniform sampler2D uSampler;

void main(void)
{
    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;
}
`,Q0=`attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;

uniform mat3 projectionMatrix;
uniform mat3 translationMatrix;
uniform mat3 uTextureMatrix;

varying vec2 vTextureCoord;

void main(void)
{
    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);

    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;
}
`,ln=(function(i){fu(e,i);function e(t,r){var n=this,s={uSampler:t,alpha:1,uTextureMatrix:Mt.IDENTITY,uColor:new Float32Array([1,1,1,1])};return r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r),r.uniforms&&Object.assign(s,r.uniforms),n=i.call(this,r.program||Ti.from(Q0,J0),s)||this,n._colorDirty=!1,n.uvMatrix=new Ps(t),n.batchable=r.program===void 0,n.pluginName=r.pluginName,n.tint=r.tint,n.alpha=r.alpha,n}return Object.defineProperty(e.prototype,"texture",{get:function(){return this.uniforms.uSampler},set:function(t){this.uniforms.uSampler!==t&&(this.uniforms.uSampler=t,this.uvMatrix.texture=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this._alpha},set:function(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(t&65280)+((t&255)<<16),this._colorDirty=!0)},enumerable:!1,configurable:!0}),e.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var t=this.texture.baseTexture;Kl(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},e})(qe),un=(function(i){fu(e,i);function e(t,r,n){var s=i.call(this)||this,o=new Lt(t),a=new Lt(r,!0),l=new Lt(n,!0,!0);return s.addAttribute("aVertexPosition",o,2,!1,Nt.FLOAT).addAttribute("aTextureCoord",a,2,!1,Nt.FLOAT).addIndex(l),s._updateId=-1,s}return Object.defineProperty(e.prototype,"vertexDirtyId",{get:function(){return this.buffers[0]._updateID},enumerable:!1,configurable:!0}),e})(Nr);/*!
 * @pixi/text-bitmap - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/text-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var rl=function(i,e){return rl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},rl(i,e)};function tb(i,e){rl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Qi=(function(){function i(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[]}return i})(),eb=(function(){function i(){}return i.test=function(e){return typeof e=="string"&&e.indexOf("info face=")===0},i.parse=function(e){var t=e.match(/^[a-z]+\s+.+$/gm),r={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[]};for(var n in t){var s=t[n].match(/^[a-z]+/gm)[0],o=t[n].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),a={};for(var l in o){var u=o[l].split("="),h=u[0],c=u[1].replace(/"/gm,""),f=parseFloat(c),d=isNaN(f)?c:f;a[h]=d}r[s].push(a)}var p=new Qi;return r.info.forEach(function(v){return p.info.push({face:v.face,size:parseInt(v.size,10)})}),r.common.forEach(function(v){return p.common.push({lineHeight:parseInt(v.lineHeight,10)})}),r.page.forEach(function(v){return p.page.push({id:parseInt(v.id,10),file:v.file})}),r.char.forEach(function(v){return p.char.push({id:parseInt(v.id,10),page:parseInt(v.page,10),x:parseInt(v.x,10),y:parseInt(v.y,10),width:parseInt(v.width,10),height:parseInt(v.height,10),xoffset:parseInt(v.xoffset,10),yoffset:parseInt(v.yoffset,10),xadvance:parseInt(v.xadvance,10)})}),r.kerning.forEach(function(v){return p.kerning.push({first:parseInt(v.first,10),second:parseInt(v.second,10),amount:parseInt(v.amount,10)})}),p},i})(),il=(function(){function i(){}return i.test=function(e){return e instanceof XMLDocument&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},i.parse=function(e){for(var t=new Qi,r=e.getElementsByTagName("info"),n=e.getElementsByTagName("common"),s=e.getElementsByTagName("page"),o=e.getElementsByTagName("char"),a=e.getElementsByTagName("kerning"),l=0;l<r.length;l++)t.info.push({face:r[l].getAttribute("face"),size:parseInt(r[l].getAttribute("size"),10)});for(var l=0;l<n.length;l++)t.common.push({lineHeight:parseInt(n[l].getAttribute("lineHeight"),10)});for(var l=0;l<s.length;l++)t.page.push({id:parseInt(s[l].getAttribute("id"),10)||0,file:s[l].getAttribute("file")});for(var l=0;l<o.length;l++){var u=o[l];t.char.push({id:parseInt(u.getAttribute("id"),10),page:parseInt(u.getAttribute("page"),10)||0,x:parseInt(u.getAttribute("x"),10),y:parseInt(u.getAttribute("y"),10),width:parseInt(u.getAttribute("width"),10),height:parseInt(u.getAttribute("height"),10),xoffset:parseInt(u.getAttribute("xoffset"),10),yoffset:parseInt(u.getAttribute("yoffset"),10),xadvance:parseInt(u.getAttribute("xadvance"),10)})}for(var l=0;l<a.length;l++)t.kerning.push({first:parseInt(a[l].getAttribute("first"),10),second:parseInt(a[l].getAttribute("second"),10),amount:parseInt(a[l].getAttribute("amount"),10)});return t},i})(),rb=(function(){function i(){}return i.test=function(e){if(typeof e=="string"&&e.indexOf("<font>")>-1){var t=new self.DOMParser().parseFromString(e,"text/xml");return il.test(t)}return!1},i.parse=function(e){var t=new window.DOMParser().parseFromString(e,"text/xml");return il.parse(t)},i})(),pa=[eb,il,rb];function uy(i){for(var e=0;e<pa.length;e++)if(pa[e].test(i))return pa[e];return null}function ib(i,e,t,r,n,s){var o=t.fill;if(Array.isArray(o)){if(o.length===1)return o[0]}else return o;var a,l=t.dropShadow?t.dropShadowDistance:0,u=t.padding||0,h=Math.ceil(i.width/r)-l-u*2,c=Math.ceil(i.height/r)-l-u*2,f=o.slice(),d=t.fillGradientStops.slice();if(!d.length)for(var p=f.length+1,v=1;v<p;++v)d.push(v/p);if(f.unshift(o[0]),d.unshift(0),f.push(o[o.length-1]),d.push(1),t.fillGradientType===pi.LINEAR_VERTICAL){a=e.createLinearGradient(h/2,u,h/2,c+u);for(var m=0,g=s.fontProperties.fontSize+t.strokeThickness,E=g/c,v=0;v<n.length;v++)for(var I=s.lineHeight*v,M=0;M<f.length;M++){var _=0;typeof d[M]=="number"?_=d[M]:_=M/f.length;var F=I/c+_*E,C=Math.max(m,F);C=Math.min(C,1),a.addColorStop(C,f[M]),m=C}}else{a=e.createLinearGradient(u,c/2,h+u,c/2);for(var H=f.length+1,R=1,v=0;v<f.length;v++){var N=void 0;typeof d[v]=="number"?N=d[v]:N=R/H,a.addColorStop(N,f[v]),R++}}return a}function nb(i,e,t,r,n,s,o){var a=t.text,l=t.fontProperties;e.translate(r,n),e.scale(s,s);var u=o.strokeThickness/2,h=-(o.strokeThickness/2);if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=ib(i,e,o,s,[a],t),e.strokeStyle=o.stroke,o.dropShadow){var c=o.dropShadowColor,f=Cr(typeof c=="number"?c:$l(c)),d=o.dropShadowBlur*s,p=o.dropShadowDistance*s;e.shadowColor="rgba("+f[0]*255+","+f[1]*255+","+f[2]*255+","+o.dropShadowAlpha+")",e.shadowBlur=d,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*p,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*p}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,u,h+t.lineHeight-l.descent),o.fill&&e.fillText(a,u,h+t.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function sb(i){typeof i=="string"&&(i=[i]);for(var e=[],t=0,r=i.length;t<r;t++){var n=i[t];if(Array.isArray(n)){if(n.length!==2)throw new Error("[BitmapFont]: Invalid character range length, expecting 2 got "+n.length+".");var s=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<s)throw new Error("[BitmapFont]: Invalid character range.");for(var a=s,l=o;a<=l;a++)e.push(String.fromCharCode(a))}else e.push.apply(e,n.split(""))}if(e.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}var er=(function(){function i(e,t,r){var n=e.info[0],s=e.common[0],o=e.page[0],a=Zi(o.file),l={};this._ownsTextures=r,this.font=n.face,this.size=n.size,this.lineHeight=s.lineHeight/a,this.chars={},this.pageTextures=l;for(var u=0;u<e.page.length;u++){var h=e.page[u],c=h.id,f=h.file;l[c]=t instanceof Array?t[u]:t[f]}for(var u=0;u<e.char.length;u++){var d=e.char[u],c=d.id,p=d.page,v=e.char[u],m=v.x,g=v.y,E=v.width,I=v.height,M=v.xoffset,_=v.yoffset,F=v.xadvance;m/=a,g/=a,E/=a,I/=a,M/=a,_/=a,F/=a;var C=new vt(m+l[p].frame.x/a,g+l[p].frame.y/a,E,I);this.chars[c]={xOffset:M,yOffset:_,xAdvance:F,kerning:{},texture:new lt(l[p].baseTexture,C),page:p}}for(var u=0;u<e.kerning.length;u++){var H=e.kerning[u],R=H.first,N=H.second,Y=H.amount;R/=a,N/=a,Y/=a,this.chars[N]&&(this.chars[N].kerning[R]=Y)}}return i.prototype.destroy=function(){for(var e in this.chars)this.chars[e].texture.destroy(),this.chars[e].texture=null;for(var e in this.pageTextures)this._ownsTextures&&this.pageTextures[e].destroy(!0),this.pageTextures[e]=null;this.chars=null,this.pageTextures=null},i.install=function(e,t,r){var n;if(e instanceof Qi)n=e;else{var s=uy(e);if(!s)throw new Error("Unrecognized data format for font.");n=s.parse(e)}t instanceof lt&&(t=[t]);var o=new i(n,t,r);return i.available[o.font]=o,o},i.uninstall=function(e){var t=i.available[e];if(!t)throw new Error("No font found named '"+e+"'");t.destroy(),delete i.available[e]},i.from=function(e,t,r){if(!e)throw new Error("[BitmapFont] Property `name` is required.");var n=Object.assign({},i.defaultOptions,r),s=n.chars,o=n.padding,a=n.resolution,l=n.textureWidth,u=n.textureHeight,h=sb(s),c=t instanceof Rr?t:new Rr(t),f=l,d=new Qi;d.info[0]={face:c.fontFamily,size:c.fontSize},d.common[0]={lineHeight:c.fontSize};for(var p=0,v=0,m,g,E,I=0,M=[],_=0;_<h.length;_++){m||(m=document.createElement("canvas"),m.width=l,m.height=u,g=m.getContext("2d"),E=new It(m,{resolution:a}),M.push(new lt(E)),d.page.push({id:M.length-1,file:""}));var F=ge.measureText(h[_],c,!1,m),C=F.width,H=Math.ceil(F.height),R=Math.ceil((c.fontStyle==="italic"?2:1)*C);if(v>=u-H*a){if(v===0)throw new Error("[BitmapFont] textureHeight "+u+"px is "+("too small for "+c.fontSize+"px fonts"));--_,m=null,g=null,E=null,v=0,p=0,I=0;continue}if(I=Math.max(H+F.fontProperties.descent,I),R*a+p>=f){--_,v+=I*a,v=Math.ceil(v),p=0,I=0;continue}nb(m,g,F,p,v,a,c);var N=F.text.charCodeAt(0);d.char.push({id:N,page:M.length-1,x:p/a,y:v/a,width:R,height:H,xoffset:0,yoffset:0,xadvance:Math.ceil(C-(c.dropShadow?c.dropShadowDistance:0)-(c.stroke?c.strokeThickness:0))}),p+=(R+2*o)*a,p=Math.ceil(p)}var Y=new i(d,M,!0);return i.available[e]!==void 0&&i.uninstall(e),i.available[e]=Y,Y},i.ALPHA=[["a","z"],["A","Z"]," "],i.NUMERIC=[["0","9"]],i.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],i.ASCII=[[" ","~"]],i.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:i.ALPHANUMERIC},i.available={},i})(),Dc=[],kc=[],ob=(function(i){tb(e,i);function e(t,r){r===void 0&&(r={});var n=i.call(this)||this;n._tint=16777215,r.font&&(K("5.3.0","PIXI.BitmapText constructor style.font property is deprecated."),n._upgradeStyle(r));var s=Object.assign({},e.styleDefaults,r),o=s.align,a=s.tint,l=s.maxWidth,u=s.letterSpacing,h=s.fontName,c=s.fontSize;if(!er.available[h])throw new Error('Missing BitmapFont "'+h+'"');return n._activePagesMeshData=[],n._textWidth=0,n._textHeight=0,n._align=o,n._tint=a,n._fontName=h,n._fontSize=c||er.available[h].size,n._text=t,n._maxWidth=l,n._maxLineHeight=0,n._letterSpacing=u,n._anchor=new Er(function(){n.dirty=!0},n,0,0),n._roundPixels=nt.ROUND_PIXELS,n.dirty=!0,n._textureCache={},n}return e.prototype.updateText=function(){for(var t,r=er.available[this._fontName],n=this._fontSize/r.size,s=new Ht,o=[],a=[],l=this._text.replace(/(?:\r\n|\r)/g,`
`)||" ",u=l.length,h=this._maxWidth*r.size/this._fontSize,c=null,f=0,d=0,p=0,v=-1,m=0,g=0,E=0,I=0;I<u;I++){var M=l.charCodeAt(I),_=l.charAt(I);if(/(?:\s)/.test(_)&&(v=I,m=f),_==="\r"||_===`
`){a.push(f),d=Math.max(d,f),++p,++g,s.x=0,s.y+=r.lineHeight,c=null;continue}var F=r.chars[M];if(F){c&&F.kerning[c]&&(s.x+=F.kerning[c]);var C=kc.pop()||{texture:lt.EMPTY,line:0,charCode:0,position:new Ht};C.texture=F.texture,C.line=p,C.charCode=M,C.position.x=s.x+F.xOffset+this._letterSpacing/2,C.position.y=s.y+F.yOffset,o.push(C),s.x+=F.xAdvance+this._letterSpacing,f=s.x,E=Math.max(E,F.yOffset+F.texture.height),c=M,v!==-1&&h>0&&s.x>h&&(++g,Sr(o,1+v-g,1+I-v),I=v,v=-1,a.push(m),d=Math.max(d,m),p++,s.x=0,s.y+=r.lineHeight,c=null)}}var H=l.charAt(l.length-1);H!=="\r"&&H!==`
`&&(/(?:\s)/.test(H)&&(f=m),a.push(f),d=Math.max(d,f));for(var R=[],I=0;I<=p;I++){var N=0;this._align==="right"?N=d-a[I]:this._align==="center"&&(N=(d-a[I])/2),R.push(N)}for(var Y=o.length,D={},J=[],Q=this._activePagesMeshData,I=0;I<Q.length;I++)Dc.push(Q[I]);for(var I=0;I<Y;I++){var V=o[I].texture,A=V.baseTexture.uid;if(!D[A]){var O=Dc.pop();if(!O){var y=new un,b=new ln(lt.EMPTY),x=new yi(y,b);O={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:x,vertices:null,uvs:null,indices:null}}O.index=0,O.indexCount=0,O.vertexCount=0,O.uvsCount=0,O.total=0;var T=this._textureCache;T[A]=T[A]||new lt(V.baseTexture),O.mesh.texture=T[A],O.mesh.tint=this._tint,J.push(O),D[A]=O}D[A].total++}for(var I=0;I<Q.length;I++)J.indexOf(Q[I])===-1&&this.removeChild(Q[I].mesh);for(var I=0;I<J.length;I++)J[I].mesh.parent!==this&&this.addChild(J[I].mesh);this._activePagesMeshData=J;for(var I in D){var O=D[I],S=O.total;if(!(((t=O.indices)===null||t===void 0?void 0:t.length)>6*S)||O.vertices.length<yi.BATCHABLE_SIZE*2)O.vertices=new Float32Array(8*S),O.uvs=new Float32Array(8*S),O.indices=new Uint16Array(6*S);else for(var P=O.total,L=O.vertices,B=P*4*2;B<L.length;B++)L[B]=0;O.mesh.size=6*S}for(var I=0;I<Y;I++){var _=o[I],k=_.position.x+R[_.line];this._roundPixels&&(k=Math.round(k));var U=k*n,q=_.position.y*n,V=_.texture,W=D[V.baseTexture.uid],z=V.frame,Z=V._uvs,j=W.index++;W.indices[j*6+0]=0+j*4,W.indices[j*6+1]=1+j*4,W.indices[j*6+2]=2+j*4,W.indices[j*6+3]=0+j*4,W.indices[j*6+4]=2+j*4,W.indices[j*6+5]=3+j*4,W.vertices[j*8+0]=U,W.vertices[j*8+1]=q,W.vertices[j*8+2]=U+z.width*n,W.vertices[j*8+3]=q,W.vertices[j*8+4]=U+z.width*n,W.vertices[j*8+5]=q+z.height*n,W.vertices[j*8+6]=U,W.vertices[j*8+7]=q+z.height*n,W.uvs[j*8+0]=Z.x0,W.uvs[j*8+1]=Z.y0,W.uvs[j*8+2]=Z.x1,W.uvs[j*8+3]=Z.y1,W.uvs[j*8+4]=Z.x2,W.uvs[j*8+5]=Z.y2,W.uvs[j*8+6]=Z.x3,W.uvs[j*8+7]=Z.y3}this._textWidth=d*n,this._textHeight=(s.y+r.lineHeight)*n;for(var I in D){var O=D[I];if(this.anchor.x!==0||this.anchor.y!==0)for(var it=0,at=this._textWidth*this.anchor.x,et=this._textHeight*this.anchor.y,rt=0;rt<O.total;rt++)O.vertices[it++]-=at,O.vertices[it++]-=et,O.vertices[it++]-=at,O.vertices[it++]-=et,O.vertices[it++]-=at,O.vertices[it++]-=et,O.vertices[it++]-=at,O.vertices[it++]-=et;this._maxLineHeight=E*n;var wt=O.mesh.geometry.getBuffer("aVertexPosition"),xt=O.mesh.geometry.getBuffer("aTextureCoord"),At=O.mesh.geometry.getIndex();wt.data=O.vertices,xt.data=O.uvs,At.data=O.indices,wt.update(),xt.update(),At.update()}for(var I=0;I<o.length;I++)kc.push(o[I])},e.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},e.prototype.getLocalBounds=function(){return this.validate(),i.prototype.getLocalBounds.call(this)},e.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},Object.defineProperty(e.prototype,"tint",{get:function(){return this._tint},set:function(t){if(this._tint!==t){this._tint=t;for(var r=0;r<this._activePagesMeshData.length;r++)this._activePagesMeshData[r].mesh.tint=t}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"align",{get:function(){return this._align},set:function(t){this._align!==t&&(this._align=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontName",{get:function(){return this._fontName},set:function(t){if(!er.available[t])throw new Error('Missing BitmapFont "'+t+'"');this._fontName!==t&&(this._fontName=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"fontSize",{get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"anchor",{get:function(){return this._anchor},set:function(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},set:function(t){t=String(t??""),this._text!==t&&(this._text=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxWidth",{get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxLineHeight",{get:function(){return this.validate(),this._maxLineHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textWidth",{get:function(){return this.validate(),this._textWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"letterSpacing",{get:function(){return this._letterSpacing},set:function(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"roundPixels",{get:function(){return this._roundPixels},set:function(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textHeight",{get:function(){return this.validate(),this._textHeight},enumerable:!1,configurable:!0}),e.prototype._upgradeStyle=function(t){if(typeof t.font=="string"){var r=t.font.split(" ");t.fontName=r.length===1?r[0]:r.slice(1).join(" "),r.length>=2&&(t.fontSize=parseInt(r[0],10))}else t.fontName=t.font.name,t.fontSize=typeof t.font.size=="number"?t.font.size:parseInt(t.font.size,10)},e.prototype.destroy=function(t){var r=this._textureCache;for(var n in r){var s=r[n];s.destroy(),delete r[n]}this._textureCache=null,i.prototype.destroy.call(this,t)},e.registerFont=function(t,r){return K("5.3.0","PIXI.BitmapText.registerFont is deprecated, use PIXI.BitmapFont.install"),er.install(t,r)},Object.defineProperty(e,"fonts",{get:function(){return K("5.3.0","PIXI.BitmapText.fonts is deprecated, use PIXI.BitmapFont.available"),er.available},enumerable:!1,configurable:!0}),e.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0},e})(ee),hy=(function(){function i(){}return i.add=function(){Vi.setExtensionXhrType("fnt",Vi.XHR_RESPONSE_TYPE.TEXT)},i.use=function(e,t){var r=uy(e.data);if(!r){t();return}for(var n=i.getBaseUrl(this,e),s=r.parse(e.data),o={},a=function(v){o[v.metadata.pageFile]=v.texture,Object.keys(o).length===s.page.length&&(e.bitmapFont=er.install(s,o,!0),t())},l=0;l<s.page.length;++l){var u=s.page[l].file,h=n+u,c=!1;for(var f in this.resources){var d=this.resources[f];if(d.url===h){d.metadata.pageFile=u,d.texture?a(d):d.onAfterMiddleware.add(a),c=!0;break}}if(!c){var p={crossOrigin:e.crossOrigin,loadType:Vi.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:u},e.metadata.imageMetadata),parentResource:e};this.add(h,p,a)}}},i.getBaseUrl=function(e,t){var r=t.isDataUrl?"":i.dirname(t.url);return t.isDataUrl&&(r==="."&&(r=""),e.baseUrl&&r&&e.baseUrl.charAt(e.baseUrl.length-1)==="/"&&(r+="/")),r=r.replace(e.baseUrl,""),r&&r.charAt(r.length-1)!=="/"&&(r+="/"),r},i.dirname=function(e){var t=e.replace(/\\/g,"/").replace(/\/$/,"").replace(/\/[^\/]*$/,"");return t===e?".":t===""?"/":t},i})();/*!
 * @pixi/filter-alpha - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-alpha is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var nl=function(i,e){return nl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},nl(i,e)};function ab(i,e){nl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var lb=`varying vec2 vTextureCoord;

uniform sampler2D uSampler;
uniform float uAlpha;

void main(void)
{
   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;
}
`,ub=(function(i){ab(e,i);function e(t){t===void 0&&(t=1);var r=i.call(this,Mp,lb,{uAlpha:1})||this;return r.alpha=t,r}return Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e})(We);/*!
 * @pixi/filter-blur - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-blur is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var sl=function(i,e){return sl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},sl(i,e)};function cy(i,e){sl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var hb=`
    attribute vec2 aVertexPosition;

    uniform mat3 projectionMatrix;

    uniform float strength;

    varying vec2 vBlurTexCoords[%size%];

    uniform vec4 inputSize;
    uniform vec4 outputFrame;

    vec4 filterVertexPosition( void )
    {
        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
    }

    vec2 filterTextureCoord( void )
    {
        return aVertexPosition * (outputFrame.zw * inputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function cb(i,e){var t=Math.ceil(i/2),r=hb,n="",s;e?s="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":s="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var o=0;o<i;o++){var a=s.replace("%index%",o.toString());a=a.replace("%sampleIndex%",o-(t-1)+".0"),n+=a,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}var fb={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},db=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join(`
`);function pb(i){for(var e=fb[i],t=e.length,r=db,n="",s="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;",o,a=0;a<i;a++){var l=s.replace("%index%",a.toString());o=a,a>=t&&(o=i-a-1),l=l.replace("%value%",e[o].toString()),n+=l,n+=`
`}return r=r.replace("%blur%",n),r=r.replace("%size%",i.toString()),r}var Uc;(function(i){i[i.WEBGL_LEGACY=0]="WEBGL_LEGACY",i[i.WEBGL=1]="WEBGL",i[i.WEBGL2=2]="WEBGL2"})(Uc||(Uc={}));var Xc;(function(i){i[i.UNKNOWN=0]="UNKNOWN",i[i.WEBGL=1]="WEBGL",i[i.CANVAS=2]="CANVAS"})(Xc||(Xc={}));var Hc;(function(i){i[i.COLOR=16384]="COLOR",i[i.DEPTH=256]="DEPTH",i[i.STENCIL=1024]="STENCIL"})(Hc||(Hc={}));var Gc;(function(i){i[i.NORMAL=0]="NORMAL",i[i.ADD=1]="ADD",i[i.MULTIPLY=2]="MULTIPLY",i[i.SCREEN=3]="SCREEN",i[i.OVERLAY=4]="OVERLAY",i[i.DARKEN=5]="DARKEN",i[i.LIGHTEN=6]="LIGHTEN",i[i.COLOR_DODGE=7]="COLOR_DODGE",i[i.COLOR_BURN=8]="COLOR_BURN",i[i.HARD_LIGHT=9]="HARD_LIGHT",i[i.SOFT_LIGHT=10]="SOFT_LIGHT",i[i.DIFFERENCE=11]="DIFFERENCE",i[i.EXCLUSION=12]="EXCLUSION",i[i.HUE=13]="HUE",i[i.SATURATION=14]="SATURATION",i[i.COLOR=15]="COLOR",i[i.LUMINOSITY=16]="LUMINOSITY",i[i.NORMAL_NPM=17]="NORMAL_NPM",i[i.ADD_NPM=18]="ADD_NPM",i[i.SCREEN_NPM=19]="SCREEN_NPM",i[i.NONE=20]="NONE",i[i.SRC_OVER=0]="SRC_OVER",i[i.SRC_IN=21]="SRC_IN",i[i.SRC_OUT=22]="SRC_OUT",i[i.SRC_ATOP=23]="SRC_ATOP",i[i.DST_OVER=24]="DST_OVER",i[i.DST_IN=25]="DST_IN",i[i.DST_OUT=26]="DST_OUT",i[i.DST_ATOP=27]="DST_ATOP",i[i.ERASE=26]="ERASE",i[i.SUBTRACT=28]="SUBTRACT",i[i.XOR=29]="XOR"})(Gc||(Gc={}));var Yc;(function(i){i[i.POINTS=0]="POINTS",i[i.LINES=1]="LINES",i[i.LINE_LOOP=2]="LINE_LOOP",i[i.LINE_STRIP=3]="LINE_STRIP",i[i.TRIANGLES=4]="TRIANGLES",i[i.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",i[i.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(Yc||(Yc={}));var zc;(function(i){i[i.RGBA=6408]="RGBA",i[i.RGB=6407]="RGB",i[i.ALPHA=6406]="ALPHA",i[i.LUMINANCE=6409]="LUMINANCE",i[i.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",i[i.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",i[i.DEPTH_STENCIL=34041]="DEPTH_STENCIL"})(zc||(zc={}));var Vc;(function(i){i[i.TEXTURE_2D=3553]="TEXTURE_2D",i[i.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",i[i.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",i[i.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",i[i.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",i[i.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",i[i.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",i[i.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z"})(Vc||(Vc={}));var qc;(function(i){i[i.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",i[i.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",i[i.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",i[i.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",i[i.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",i[i.FLOAT=5126]="FLOAT",i[i.HALF_FLOAT=36193]="HALF_FLOAT"})(qc||(qc={}));var $c;(function(i){i[i.NEAREST=0]="NEAREST",i[i.LINEAR=1]="LINEAR"})($c||($c={}));var jc;(function(i){i[i.CLAMP=33071]="CLAMP",i[i.REPEAT=10497]="REPEAT",i[i.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(jc||(jc={}));var Wc;(function(i){i[i.OFF=0]="OFF",i[i.POW2=1]="POW2",i[i.ON=2]="ON"})(Wc||(Wc={}));var Kc;(function(i){i[i.NPM=0]="NPM",i[i.UNPACK=1]="UNPACK",i[i.PMA=2]="PMA",i[i.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",i[i.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",i[i.PREMULTIPLY_ALPHA=2]="PREMULTIPLY_ALPHA"})(Kc||(Kc={}));var tn;(function(i){i[i.NO=0]="NO",i[i.YES=1]="YES",i[i.AUTO=2]="AUTO",i[i.BLEND=0]="BLEND",i[i.CLEAR=1]="CLEAR",i[i.BLIT=2]="BLIT"})(tn||(tn={}));var Zc;(function(i){i[i.AUTO=0]="AUTO",i[i.MANUAL=1]="MANUAL"})(Zc||(Zc={}));var Jc;(function(i){i.LOW="lowp",i.MEDIUM="mediump",i.HIGH="highp"})(Jc||(Jc={}));var Qc;(function(i){i[i.NONE=0]="NONE",i[i.SCISSOR=1]="SCISSOR",i[i.STENCIL=2]="STENCIL",i[i.SPRITE=3]="SPRITE"})(Qc||(Qc={}));var tf;(function(i){i[i.NONE=0]="NONE",i[i.LOW=2]="LOW",i[i.MEDIUM=4]="MEDIUM",i[i.HIGH=8]="HIGH"})(tf||(tf={}));var ol=(function(i){cy(e,i);function e(t,r,n,s,o){r===void 0&&(r=8),n===void 0&&(n=4),s===void 0&&(s=nt.FILTER_RESOLUTION),o===void 0&&(o=5);var a=this,l=cb(o,t),u=pb(o);return a=i.call(this,l,u)||this,a.horizontal=t,a.resolution=s,a._quality=0,a.quality=n,a.blur=r,a}return e.prototype.apply=function(t,r,n,s){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/r.width):this.uniforms.strength=1/n.height*(n.height/r.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/r.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/r.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,this.passes===1)t.applyFilter(this,r,n,s);else{var o=t.getFilterTexture(),a=t.renderer,l=r,u=o;this.state.blend=!1,t.applyFilter(this,l,u,tn.CLEAR);for(var h=1;h<this.passes-1;h++){t.bindAndClear(l,tn.BLIT),this.uniforms.uSampler=u;var c=u;u=l,l=c,a.shader.bind(this),a.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,u,n,s),t.returnFilterTexture(o)}},Object.defineProperty(e.prototype,"blur",{get:function(){return this.strength},set:function(t){this.padding=1+Math.abs(t)*2,this.strength=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this._quality},set:function(t){this._quality=t,this.passes=t},enumerable:!1,configurable:!0}),e})(We),yb=(function(i){cy(e,i);function e(t,r,n,s){t===void 0&&(t=8),r===void 0&&(r=4),n===void 0&&(n=nt.FILTER_RESOLUTION),s===void 0&&(s=5);var o=i.call(this)||this;return o.blurXFilter=new ol(!0,t,r,n,s),o.blurYFilter=new ol(!1,t,r,n,s),o.resolution=n,o.quality=r,o.blur=t,o.repeatEdgePixels=!1,o}return e.prototype.apply=function(t,r,n,s){var o=Math.abs(this.blurXFilter.strength),a=Math.abs(this.blurYFilter.strength);if(o&&a){var l=t.getFilterTexture();this.blurXFilter.apply(t,r,l,tn.CLEAR),this.blurYFilter.apply(t,l,n,s),t.returnFilterTexture(l)}else a?this.blurYFilter.apply(t,r,n,s):this.blurXFilter.apply(t,r,n,s)},e.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))*2},Object.defineProperty(e.prototype,"blur",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"quality",{get:function(){return this.blurXFilter.quality},set:function(t){this.blurXFilter.quality=this.blurYFilter.quality=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurX",{get:function(){return this.blurXFilter.blur},set:function(t){this.blurXFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blurY",{get:function(){return this.blurYFilter.blur},set:function(t){this.blurYFilter.blur=t,this.updatePadding()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"blendMode",{get:function(){return this.blurYFilter.blendMode},set:function(t){this.blurYFilter.blendMode=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"repeatEdgePixels",{get:function(){return this._repeatEdgePixels},set:function(t){this._repeatEdgePixels=t,this.updatePadding()},enumerable:!1,configurable:!0}),e})(We);/*!
 * @pixi/filter-color-matrix - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-color-matrix is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var al=function(i,e){return al=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},al(i,e)};function mb(i,e){al(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var vb=`varying vec2 vTextureCoord;
uniform sampler2D uSampler;
uniform float m[20];
uniform float uAlpha;

void main(void)
{
    vec4 c = texture2D(uSampler, vTextureCoord);

    if (uAlpha == 0.0) {
        gl_FragColor = c;
        return;
    }

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (c.a > 0.0) {
      c.rgb /= c.a;
    }

    vec4 result;

    result.r = (m[0] * c.r);
        result.r += (m[1] * c.g);
        result.r += (m[2] * c.b);
        result.r += (m[3] * c.a);
        result.r += m[4];

    result.g = (m[5] * c.r);
        result.g += (m[6] * c.g);
        result.g += (m[7] * c.b);
        result.g += (m[8] * c.a);
        result.g += m[9];

    result.b = (m[10] * c.r);
       result.b += (m[11] * c.g);
       result.b += (m[12] * c.b);
       result.b += (m[13] * c.a);
       result.b += m[14];

    result.a = (m[15] * c.r);
       result.a += (m[16] * c.g);
       result.a += (m[17] * c.b);
       result.a += (m[18] * c.a);
       result.a += m[19];

    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);

    // Premultiply alpha again.
    rgb *= result.a;

    gl_FragColor = vec4(rgb, result.a);
}
`,ll=(function(i){mb(e,i);function e(){var t=this,r={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};return t=i.call(this,au,vb,r)||this,t.alpha=1,t}return e.prototype._loadMatrix=function(t,r){r===void 0&&(r=!1);var n=t;r&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n},e.prototype._multiply=function(t,r,n){return t[0]=r[0]*n[0]+r[1]*n[5]+r[2]*n[10]+r[3]*n[15],t[1]=r[0]*n[1]+r[1]*n[6]+r[2]*n[11]+r[3]*n[16],t[2]=r[0]*n[2]+r[1]*n[7]+r[2]*n[12]+r[3]*n[17],t[3]=r[0]*n[3]+r[1]*n[8]+r[2]*n[13]+r[3]*n[18],t[4]=r[0]*n[4]+r[1]*n[9]+r[2]*n[14]+r[3]*n[19]+r[4],t[5]=r[5]*n[0]+r[6]*n[5]+r[7]*n[10]+r[8]*n[15],t[6]=r[5]*n[1]+r[6]*n[6]+r[7]*n[11]+r[8]*n[16],t[7]=r[5]*n[2]+r[6]*n[7]+r[7]*n[12]+r[8]*n[17],t[8]=r[5]*n[3]+r[6]*n[8]+r[7]*n[13]+r[8]*n[18],t[9]=r[5]*n[4]+r[6]*n[9]+r[7]*n[14]+r[8]*n[19]+r[9],t[10]=r[10]*n[0]+r[11]*n[5]+r[12]*n[10]+r[13]*n[15],t[11]=r[10]*n[1]+r[11]*n[6]+r[12]*n[11]+r[13]*n[16],t[12]=r[10]*n[2]+r[11]*n[7]+r[12]*n[12]+r[13]*n[17],t[13]=r[10]*n[3]+r[11]*n[8]+r[12]*n[13]+r[13]*n[18],t[14]=r[10]*n[4]+r[11]*n[9]+r[12]*n[14]+r[13]*n[19]+r[14],t[15]=r[15]*n[0]+r[16]*n[5]+r[17]*n[10]+r[18]*n[15],t[16]=r[15]*n[1]+r[16]*n[6]+r[17]*n[11]+r[18]*n[16],t[17]=r[15]*n[2]+r[16]*n[7]+r[17]*n[12]+r[18]*n[17],t[18]=r[15]*n[3]+r[16]*n[8]+r[17]*n[13]+r[18]*n[18],t[19]=r[15]*n[4]+r[16]*n[9]+r[17]*n[14]+r[18]*n[19]+r[19],t},e.prototype._colorMatrix=function(t){var r=new Float32Array(t);return r[4]/=255,r[9]/=255,r[14]/=255,r[19]/=255,r},e.prototype.brightness=function(t,r){var n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.greyscale=function(t,r){var n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.blackAndWhite=function(t){var r=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.hue=function(t,r){t=(t||0)/180*Math.PI;var n=Math.cos(t),s=Math.sin(t),o=Math.sqrt,a=1/3,l=o(a),u=n+(1-n)*a,h=a*(1-n)-l*s,c=a*(1-n)+l*s,f=a*(1-n)+l*s,d=n+a*(1-n),p=a*(1-n)-l*s,v=a*(1-n)-l*s,m=a*(1-n)+l*s,g=n+a*(1-n),E=[u,h,c,0,0,f,d,p,0,0,v,m,g,0,0,0,0,0,1,0];this._loadMatrix(E,r)},e.prototype.contrast=function(t,r){var n=(t||0)+1,s=-.5*(n-1),o=[n,0,0,0,s,0,n,0,0,s,0,0,n,0,s,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.saturate=function(t,r){t===void 0&&(t=0);var n=t*2/3+1,s=(n-1)*-.5,o=[n,s,s,0,0,s,n,s,0,0,s,s,n,0,0,0,0,0,1,0];this._loadMatrix(o,r)},e.prototype.desaturate=function(){this.saturate(-1)},e.prototype.negative=function(t){var r=[-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.sepia=function(t){var r=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.technicolor=function(t){var r=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.polaroid=function(t){var r=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.toBGR=function(t){var r=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.kodachrome=function(t){var r=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.browni=function(t){var r=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.vintage=function(t){var r=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.colorTone=function(t,r,n,s,o){t=t||.2,r=r||.15,n=n||16770432,s=s||3375104;var a=(n>>16&255)/255,l=(n>>8&255)/255,u=(n&255)/255,h=(s>>16&255)/255,c=(s>>8&255)/255,f=(s&255)/255,d=[.3,.59,.11,0,0,a,l,u,t,0,h,c,f,r,0,a-h,l-c,u-f,0,0];this._loadMatrix(d,o)},e.prototype.night=function(t,r){t=t||.1;var n=[t*-2,-t,0,0,0,-t,0,t,0,0,0,t,t*2,0,0,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.predator=function(t,r){var n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,r)},e.prototype.lsd=function(t){var r=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(r,t)},e.prototype.reset=function(){var t=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(t,!1)},Object.defineProperty(e.prototype,"matrix",{get:function(){return this.uniforms.m},set:function(t){this.uniforms.m=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"alpha",{get:function(){return this.uniforms.uAlpha},set:function(t){this.uniforms.uAlpha=t},enumerable:!1,configurable:!0}),e})(We);ll.prototype.grayscale=ll.prototype.greyscale;/*!
 * @pixi/filter-displacement - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-displacement is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ul=function(i,e){return ul=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},ul(i,e)};function gb(i,e){ul(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var bb=`varying vec2 vFilterCoord;
varying vec2 vTextureCoord;

uniform vec2 scale;
uniform mat2 rotation;
uniform sampler2D uSampler;
uniform sampler2D mapSampler;

uniform highp vec4 inputSize;
uniform vec4 inputClamp;

void main(void)
{
  vec4 map =  texture2D(mapSampler, vFilterCoord);

  map -= 0.5;
  map.xy = scale * inputSize.zw * (rotation * map.xy);

  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));
}
`,_b=`attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;
uniform mat3 filterMatrix;

varying vec2 vTextureCoord;
varying vec2 vFilterCoord;

uniform vec4 inputSize;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

vec2 filterTextureCoord( void )
{
    return aVertexPosition * (outputFrame.zw * inputSize.zw);
}

void main(void)
{
	gl_Position = filterVertexPosition();
	vTextureCoord = filterTextureCoord();
	vFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;
}
`,xb=(function(i){gb(e,i);function e(t,r){var n=this,s=new Mt;return t.renderable=!1,n=i.call(this,_b,bb,{mapSampler:t._texture,filterMatrix:s,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])})||this,n.maskSprite=t,n.maskMatrix=s,r==null&&(r=20),n.scale=new Ht(r,r),n}return e.prototype.apply=function(t,r,n,s){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var o=this.maskSprite.worldTransform,a=Math.sqrt(o.a*o.a+o.b*o.b),l=Math.sqrt(o.c*o.c+o.d*o.d);a!==0&&l!==0&&(this.uniforms.rotation[0]=o.a/a,this.uniforms.rotation[1]=o.b/a,this.uniforms.rotation[2]=o.c/l,this.uniforms.rotation[3]=o.d/l),t.applyFilter(this,r,n,s)},Object.defineProperty(e.prototype,"map",{get:function(){return this.uniforms.mapSampler},set:function(t){this.uniforms.mapSampler=t},enumerable:!1,configurable:!0}),e})(We);/*!
 * @pixi/filter-fxaa - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-fxaa is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var hl=function(i,e){return hl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},hl(i,e)};function wb(i,e){hl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Tb=`
attribute vec2 aVertexPosition;

uniform mat3 projectionMatrix;

varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;

uniform vec4 inputPixel;
uniform vec4 outputFrame;

vec4 filterVertexPosition( void )
{
    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;

    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);
}

void texcoords(vec2 fragCoord, vec2 inverseVP,
               out vec2 v_rgbNW, out vec2 v_rgbNE,
               out vec2 v_rgbSW, out vec2 v_rgbSE,
               out vec2 v_rgbM) {
    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;
    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;
    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;
    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;
    v_rgbM = vec2(fragCoord * inverseVP);
}

void main(void) {

   gl_Position = filterVertexPosition();

   vFragCoord = aVertexPosition * outputFrame.zw;

   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);
}
`,Ib=`varying vec2 v_rgbNW;
varying vec2 v_rgbNE;
varying vec2 v_rgbSW;
varying vec2 v_rgbSE;
varying vec2 v_rgbM;

varying vec2 vFragCoord;
uniform sampler2D uSampler;
uniform highp vec4 inputPixel;


/**
 Basic FXAA implementation based on the code on geeks3d.com with the
 modification that the texture2DLod stuff was removed since it's
 unsupported by WebGL.

 --

 From:
 https://github.com/mitsuhiko/webgl-meincraft

 Copyright (c) 2011 by Armin Ronacher.

 Some rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are
 met:

 * Redistributions of source code must retain the above copyright
 notice, this list of conditions and the following disclaimer.

 * Redistributions in binary form must reproduce the above
 copyright notice, this list of conditions and the following
 disclaimer in the documentation and/or other materials provided
 with the distribution.

 * The names of the contributors may not be used to endorse or
 promote products derived from this software without specific
 prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

#ifndef FXAA_REDUCE_MIN
#define FXAA_REDUCE_MIN   (1.0/ 128.0)
#endif
#ifndef FXAA_REDUCE_MUL
#define FXAA_REDUCE_MUL   (1.0 / 8.0)
#endif
#ifndef FXAA_SPAN_MAX
#define FXAA_SPAN_MAX     8.0
#endif

//optimized version for mobile, where dependent
//texture reads can be a bottleneck
vec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,
          vec2 v_rgbNW, vec2 v_rgbNE,
          vec2 v_rgbSW, vec2 v_rgbSE,
          vec2 v_rgbM) {
    vec4 color;
    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;
    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;
    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;
    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;
    vec4 texColor = texture2D(tex, v_rgbM);
    vec3 rgbM  = texColor.xyz;
    vec3 luma = vec3(0.299, 0.587, 0.114);
    float lumaNW = dot(rgbNW, luma);
    float lumaNE = dot(rgbNE, luma);
    float lumaSW = dot(rgbSW, luma);
    float lumaSE = dot(rgbSE, luma);
    float lumaM  = dot(rgbM,  luma);
    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));
    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));

    mediump vec2 dir;
    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));
    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));

    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *
                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);

    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);
    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),
              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),
                  dir * rcpDirMin)) * inverseVP;

    vec3 rgbA = 0.5 * (
                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +
                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);
    vec3 rgbB = rgbA * 0.5 + 0.25 * (
                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +
                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);

    float lumaB = dot(rgbB, luma);
    if ((lumaB < lumaMin) || (lumaB > lumaMax))
        color = vec4(rgbA, texColor.a);
    else
        color = vec4(rgbB, texColor.a);
    return color;
}

void main() {

      vec4 color;

      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);

      gl_FragColor = color;
}
`,Eb=(function(i){wb(e,i);function e(){return i.call(this,Tb,Ib)||this}return e})(We);/*!
 * @pixi/filter-noise - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/filter-noise is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var cl=function(i,e){return cl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},cl(i,e)};function Sb(i,e){cl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Ab=`precision highp float;

varying vec2 vTextureCoord;
varying vec4 vColor;

uniform float uNoise;
uniform float uSeed;
uniform sampler2D uSampler;

float rand(vec2 co)
{
    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);
}

void main()
{
    vec4 color = texture2D(uSampler, vTextureCoord);
    float randomValue = rand(gl_FragCoord.xy * uSeed);
    float diff = (randomValue - 0.5) * uNoise;

    // Un-premultiply alpha before applying the color matrix. See issue #3539.
    if (color.a > 0.0) {
        color.rgb /= color.a;
    }

    color.r += diff;
    color.g += diff;
    color.b += diff;

    // Premultiply alpha again.
    color.rgb *= color.a;

    gl_FragColor = color;
}
`,Cb=(function(i){Sb(e,i);function e(t,r){t===void 0&&(t=.5),r===void 0&&(r=Math.random());var n=i.call(this,au,Ab,{uNoise:0,uSeed:0})||this;return n.noise=t,n.seed=r,n}return Object.defineProperty(e.prototype,"noise",{get:function(){return this.uniforms.uNoise},set:function(t){this.uniforms.uNoise=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"seed",{get:function(){return this.uniforms.uSeed},set:function(t){this.uniforms.uSeed=t},enumerable:!1,configurable:!0}),e})(We);/*!
 * @pixi/mixin-cache-as-bitmap - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mixin-cache-as-bitmap is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */var fy=new Mt;Dt.prototype._cacheAsBitmap=!1;Dt.prototype._cacheData=null;var Pb=(function(){function i(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}return i})();Object.defineProperties(Dt.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(i){if(this._cacheAsBitmap!==i){this._cacheAsBitmap=i;var e;i?(this._cacheData||(this._cacheData=new Pb),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}});Dt.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))};Dt.prototype._initCachedDisplayObject=function(e){if(!(this._cacheData&&this._cacheData.sprite)){var t=this.alpha;this.alpha=1,e.batch.flush();var r=this.getLocalBounds(null,!0).clone();if(this.filters){var n=this.filters[0].padding;r.pad(n)}r.ceil(nt.RESOLUTION);var s=e.renderTexture.current,o=e.renderTexture.sourceFrame.clone(),a=e.renderTexture.destinationFrame.clone(),l=e.projection.transform,u=Or.create({width:r.width,height:r.height}),h="cacheAsBitmap_"+Pr();this._cacheData.textureCacheId=h,It.addToCache(u.baseTexture,h),lt.addToCache(u,h);var c=this.transform.localTransform.copyTo(fy).invert().translate(-r.x,-r.y);this.render=this._cacheData.originalRender,e.render(this,u,!0,c,!1),e.projection.transform=l,e.renderTexture.bind(s,o,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var f=new Br(u);f.transform.worldTransform=this.transform.worldTransform,f.anchor.x=-(r.x/r.width),f.anchor.y=-(r.y/r.height),f.alpha=t,f._bounds=this._bounds,this._cacheData.sprite=f,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=f.containsPoint.bind(f)}};Dt.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))};Dt.prototype._initCachedDisplayObjectCanvas=function(e){if(!(this._cacheData&&this._cacheData.sprite)){var t=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;var n=e.context,s=e._projTransform;t.ceil(nt.RESOLUTION);var o=Or.create({width:t.width,height:t.height}),a="cacheAsBitmap_"+Pr();this._cacheData.textureCacheId=a,It.addToCache(o.baseTexture,a),lt.addToCache(o,a);var l=fy;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=t.x,l.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,o,!0,l,!1),e.context=n,e._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var u=new Br(o);u.transform.worldTransform=this.transform.worldTransform,u.anchor.x=-(t.x/t.width),u.anchor.y=-(t.y/t.height),u.alpha=r,u._bounds=this._bounds,this._cacheData.sprite=u,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=u.containsPoint.bind(u)}};Dt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID};Dt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)};Dt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,It.removeFromCache(this._cacheData.textureCacheId),lt.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null};Dt.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)};/*!
 * @pixi/mixin-get-child-by-name - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mixin-get-child-by-name is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Dt.prototype.name=null;ee.prototype.getChildByName=function(e,t){for(var r=0,n=this.children.length;r<n;r++)if(this.children[r].name===e)return this.children[r];if(t)for(var r=0,n=this.children.length;r<n;r++){var s=this.children[r];if(s.getChildByName){var o=this.children[r].getChildByName(e,!0);if(o)return o}}return null};/*!
 * @pixi/mixin-get-global-position - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mixin-get-global-position is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */Dt.prototype.getGlobalPosition=function(e,t){return e===void 0&&(e=new Ht),t===void 0&&(t=!1),this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};/*!
 * @pixi/mesh-extras - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/mesh-extras is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var fl=function(i,e){return fl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},fl(i,e)};function Ii(i,e){fl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var dy=(function(i){Ii(e,i);function e(t,r,n,s){t===void 0&&(t=100),r===void 0&&(r=100),n===void 0&&(n=10),s===void 0&&(s=10);var o=i.call(this)||this;return o.segWidth=n,o.segHeight=s,o.width=t,o.height=r,o.build(),o}return e.prototype.build=function(){for(var t=this.segWidth*this.segHeight,r=[],n=[],s=[],o=this.segWidth-1,a=this.segHeight-1,l=this.width/o,u=this.height/a,h=0;h<t;h++){var c=h%this.segWidth,f=h/this.segWidth|0;r.push(c*l,f*u),n.push(c/o,f/a)}for(var d=o*a,h=0;h<d;h++){var p=h%o,v=h/o|0,m=v*this.segWidth+p,g=v*this.segWidth+p+1,E=(v+1)*this.segWidth+p,I=(v+1)*this.segWidth+p+1;s.push(m,g,E,g,I,E)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(n),this.indexBuffer.data=new Uint16Array(s),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},e})(un),py=(function(i){Ii(e,i);function e(t,r,n){t===void 0&&(t=200),n===void 0&&(n=0);var s=i.call(this,new Float32Array(r.length*4),new Float32Array(r.length*4),new Uint16Array((r.length-1)*6))||this;return s.points=r,s._width=t,s.textureScale=n,s.build(),s}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),e.prototype.build=function(){var t=this.points;if(t){var r=this.getBuffer("aVertexPosition"),n=this.getBuffer("aTextureCoord"),s=this.getIndex();if(!(t.length<1)){r.data.length/4!==t.length&&(r.data=new Float32Array(t.length*4),n.data=new Float32Array(t.length*4),s.data=new Uint16Array((t.length-1)*6));var o=n.data,a=s.data;o[0]=0,o[1]=0,o[2]=0,o[3]=1;for(var l=0,u=t[0],h=this._width*this.textureScale,c=t.length,f=0;f<c;f++){var d=f*4;if(this.textureScale>0){var p=u.x-t[f].x,v=u.y-t[f].y,m=Math.sqrt(p*p+v*v);u=t[f],l+=m/h}else l=f/(c-1);o[d]=l,o[d+1]=0,o[d+2]=l,o[d+3]=1}for(var g=0,f=0;f<c-1;f++){var d=f*2;a[g++]=d,a[g++]=d+1,a[g++]=d+2,a[g++]=d+2,a[g++]=d+1,a[g++]=d+3}n.update(),s.update(),this.updateVertices()}}},e.prototype.updateVertices=function(){var t=this.points;if(!(t.length<1)){for(var r=t[0],n,s=0,o=0,a=this.buffers[0].data,l=t.length,u=0;u<l;u++){var h=t[u],c=u*4;u<t.length-1?n=t[u+1]:n=h,o=-(n.x-r.x),s=n.y-r.y;var f=Math.sqrt(s*s+o*o),d=this.textureScale>0?this.textureScale*this._width/2:this._width/2;s/=f,o/=f,s*=d,o*=d,a[c]=h.x+s,a[c+1]=h.y+o,a[c+2]=h.x-s,a[c+3]=h.y-o,r=h}this.buffers[0].update()}},e.prototype.update=function(){this.textureScale>0?this.build():this.updateVertices()},e})(un),Ob=(function(i){Ii(e,i);function e(t,r,n){n===void 0&&(n=0);var s=this,o=new py(t.height,r,n),a=new ln(t);return n>0&&(t.baseTexture.wrapMode=Ae.REPEAT),s=i.call(this,o,a)||this,s.autoUpdate=!0,s}return e.prototype._render=function(t){var r=this.geometry;(this.autoUpdate||r._width!==this.shader.texture.height)&&(r._width=this.shader.texture.height,r.update()),i.prototype._render.call(this,t)},e})(yi),yy=(function(i){Ii(e,i);function e(t,r,n){var s=this,o=new dy(t.width,t.height,r,n),a=new ln(lt.WHITE);return s=i.call(this,o,a)||this,s.texture=t,s}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID;var t=this.geometry;t.width=this.shader.texture.width,t.height=this.shader.texture.height,t.build()},Object.defineProperty(e.prototype,"texture",{get:function(){return this.shader.texture},set:function(t){this.shader.texture!==t&&(this.shader.texture=t,this._textureID=-1,t.baseTexture.valid?this.textureUpdated():t.once("update",this.textureUpdated,this))},enumerable:!1,configurable:!0}),e.prototype._render=function(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),i.prototype._render.call(this,t)},e.prototype.destroy=function(t){this.shader.texture.off("update",this.textureUpdated,this),i.prototype.destroy.call(this,t)},e})(yi),Fb=(function(i){Ii(e,i);function e(t,r,n,s,o){t===void 0&&(t=lt.EMPTY);var a=this,l=new un(r,n,s);l.getBuffer("aVertexPosition").static=!1;var u=new ln(t);return a=i.call(this,l,u,null,o)||this,a.autoUpdate=!0,a}return Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype._render=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),i.prototype._render.call(this,t)},e})(yi),Ln=10,Rb=(function(i){Ii(e,i);function e(t,r,n,s,o){r===void 0&&(r=Ln),n===void 0&&(n=Ln),s===void 0&&(s=Ln),o===void 0&&(o=Ln);var a=i.call(this,lt.WHITE,4,4)||this;return a._origWidth=t.orig.width,a._origHeight=t.orig.height,a._width=a._origWidth,a._height=a._origHeight,a._leftWidth=r,a._rightWidth=s,a._topHeight=n,a._bottomHeight=o,a.texture=t,a}return e.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},Object.defineProperty(e.prototype,"vertices",{get:function(){return this.geometry.getBuffer("aVertexPosition").data},set:function(t){this.geometry.getBuffer("aVertexPosition").data=t},enumerable:!1,configurable:!0}),e.prototype.updateHorizontalVertices=function(){var t=this.vertices,r=this._getMinScale();t[9]=t[11]=t[13]=t[15]=this._topHeight*r,t[17]=t[19]=t[21]=t[23]=this._height-this._bottomHeight*r,t[25]=t[27]=t[29]=t[31]=this._height},e.prototype.updateVerticalVertices=function(){var t=this.vertices,r=this._getMinScale();t[2]=t[10]=t[18]=t[26]=this._leftWidth*r,t[4]=t[12]=t[20]=t[28]=this._width-this._rightWidth*r,t[6]=t[14]=t[22]=t[30]=this._width},e.prototype._getMinScale=function(){var t=this._leftWidth+this._rightWidth,r=this._width>t?1:this._width/t,n=this._topHeight+this._bottomHeight,s=this._height>n?1:this._height/n,o=Math.min(r,s);return o},Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftWidth",{get:function(){return this._leftWidth},set:function(t){this._leftWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightWidth",{get:function(){return this._rightWidth},set:function(t){this._rightWidth=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topHeight",{get:function(){return this._topHeight},set:function(t){this._topHeight=t,this._refresh()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomHeight",{get:function(){return this._bottomHeight},set:function(t){this._bottomHeight=t,this._refresh()},enumerable:!1,configurable:!0}),e.prototype._refresh=function(){var t=this.texture,r=this.geometry.buffers[1].data;this._origWidth=t.orig.width,this._origHeight=t.orig.height;var n=1/this._origWidth,s=1/this._origHeight;r[0]=r[8]=r[16]=r[24]=0,r[1]=r[3]=r[5]=r[7]=0,r[6]=r[14]=r[22]=r[30]=1,r[25]=r[27]=r[29]=r[31]=1,r[2]=r[10]=r[18]=r[26]=n*this._leftWidth,r[4]=r[12]=r[20]=r[28]=1-n*this._rightWidth,r[9]=r[11]=r[13]=r[15]=s*this._topHeight,r[17]=r[19]=r[21]=r[23]=1-s*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},e})(yy);/*!
 * @pixi/sprite-animated - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * @pixi/sprite-animated is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var dl=function(i,e){return dl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},dl(i,e)};function Mb(i,e){dl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Lb=(function(i){Mb(e,i);function e(t,r){r===void 0&&(r=!0);var n=i.call(this,t[0]instanceof lt?t[0]:t[0].texture)||this;return n._textures=null,n._durations=null,n._autoUpdate=r,n._isConnectedToTicker=!1,n.animationSpeed=1,n.loop=!0,n.updateAnchor=!1,n.onComplete=null,n.onFrameChange=null,n.onLoop=null,n._currentTime=0,n._playing=!1,n._previousFrame=null,n.textures=t,n}return e.prototype.stop=function(){this._playing&&(this._playing=!1,this._autoUpdate&&this._isConnectedToTicker&&(Xt.shared.remove(this.update,this),this._isConnectedToTicker=!1))},e.prototype.play=function(){this._playing||(this._playing=!0,this._autoUpdate&&!this._isConnectedToTicker&&(Xt.shared.add(this.update,this,Oe.HIGH),this._isConnectedToTicker=!0))},e.prototype.gotoAndStop=function(t){this.stop();var r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture()},e.prototype.gotoAndPlay=function(t){var r=this.currentFrame;this._currentTime=t,r!==this.currentFrame&&this.updateTexture(),this.play()},e.prototype.update=function(t){if(this._playing){var r=this.animationSpeed*t,n=this.currentFrame;if(this._durations!==null){var s=this._currentTime%1*this._durations[this.currentFrame];for(s+=r/60*1e3;s<0;)this._currentTime--,s+=this._durations[this.currentFrame];var o=Math.sign(this.animationSpeed*t);for(this._currentTime=Math.floor(this._currentTime);s>=this._durations[this.currentFrame];)s-=this._durations[this.currentFrame]*o,this._currentTime+=o;this._currentTime+=s/this._durations[this.currentFrame]}else this._currentTime+=r;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):n!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<n?this.onLoop():this.animationSpeed<0&&this.currentFrame>n&&this.onLoop()),this.updateTexture())}},e.prototype.updateTexture=function(){var t=this.currentFrame;this._previousFrame!==t&&(this._previousFrame=t,this._texture=this._textures[t],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame))},e.prototype.destroy=function(t){this.stop(),i.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},e.fromFrames=function(t){for(var r=[],n=0;n<t.length;++n)r.push(lt.from(t[n]));return new e(r)},e.fromImages=function(t){for(var r=[],n=0;n<t.length;++n)r.push(lt.from(t[n]));return new e(r)},Object.defineProperty(e.prototype,"totalFrames",{get:function(){return this._textures.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textures",{get:function(){return this._textures},set:function(t){if(t[0]instanceof lt)this._textures=t,this._durations=null;else{this._textures=[],this._durations=[];for(var r=0;r<t.length;r++)this._textures.push(t[r].texture),this._durations.push(t[r].time)}this._previousFrame=null,this.gotoAndStop(0),this.updateTexture()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentFrame",{get:function(){var t=Math.floor(this._currentTime)%this._textures.length;return t<0&&(t+=this._textures.length),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playing",{get:function(){return this._playing},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoUpdate",{get:function(){return this._autoUpdate},set:function(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(Xt.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._playing&&(Xt.shared.add(this.update,this),this._isConnectedToTicker=!0))},enumerable:!1,configurable:!0}),e})(Br);/*!
 * pixi.js - v5.3.12
 * Compiled Wed, 23 Mar 2022 18:34:28 UTC
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var pl=function(i,e){return pl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])},pl(i,e)};function ef(i,e){pl(i,e);function t(){this.constructor=i}i.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var tt="5.0.0";function Nb(){var i=this;Object.defineProperties(i,{SVG_SIZE:{get:function(){return K(tt,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),i.SVGResource.SVG_SIZE}},TransformStatic:{get:function(){return K(tt,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),i.Transform}},TransformBase:{get:function(){return K(tt,"PIXI.TransformBase class has been removed, use PIXI.Transform"),i.Transform}},TRANSFORM_MODE:{get:function(){return K(tt,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function(){return K(tt,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),i.Renderer}},CanvasRenderTarget:{get:function(){return K(tt,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),i.utils.CanvasRenderTarget}},loader:{get:function(){return K(tt,"PIXI.loader instance has moved to PIXI.Loader.shared"),i.Loader.shared}},FilterManager:{get:function(){return K(tt,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),i.systems.FilterSystem}},CanvasTinter:{get:function(){return K("5.2.0","PIXI.CanvasTinter namespace has moved to PIXI.canvasUtils"),i.canvasUtils}},GroupD8:{get:function(){return K("5.2.0","PIXI.GroupD8 namespace has moved to PIXI.groupD8"),i.groupD8}}}),i.accessibility={},Object.defineProperties(i.accessibility,{AccessibilityManager:{get:function(){return K("5.3.0","PIXI.accessibility.AccessibilityManager moved to PIXI.AccessibilityManager"),i.AccessibilityManager}}}),i.interaction={},Object.defineProperties(i.interaction,{InteractionManager:{get:function(){return K("5.3.0","PIXI.interaction.InteractionManager moved to PIXI.InteractionManager"),i.InteractionManager}},InteractionData:{get:function(){return K("5.3.0","PIXI.interaction.InteractionData moved to PIXI.InteractionData"),i.InteractionData}},InteractionEvent:{get:function(){return K("5.3.0","PIXI.interaction.InteractionEvent moved to PIXI.InteractionEvent"),i.InteractionEvent}}}),i.prepare={},Object.defineProperties(i.prepare,{BasePrepare:{get:function(){return K("5.2.1","PIXI.prepare.BasePrepare moved to PIXI.BasePrepare"),i.BasePrepare}},Prepare:{get:function(){return K("5.2.1","PIXI.prepare.Prepare moved to PIXI.Prepare"),i.Prepare}},CanvasPrepare:{get:function(){return K("5.2.1","PIXI.prepare.CanvasPrepare moved to PIXI.CanvasPrepare"),i.CanvasPrepare}}}),i.extract={},Object.defineProperties(i.extract,{Extract:{get:function(){return K("5.2.1","PIXI.extract.Extract moved to PIXI.Extract"),i.Extract}},CanvasExtract:{get:function(){return K("5.2.1","PIXI.extract.CanvasExtract moved to PIXI.CanvasExtract"),i.CanvasExtract}}}),i.extras={},Object.defineProperties(i.extras,{TilingSprite:{get:function(){return K(tt,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),i.TilingSprite}},TilingSpriteRenderer:{get:function(){return K(tt,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),i.TilingSpriteRenderer}},AnimatedSprite:{get:function(){return K(tt,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),i.AnimatedSprite}},BitmapText:{get:function(){return K(tt,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),i.BitmapText}}}),i.TilingSprite.fromFrame=function(f,d,p){return K("5.3.0","TilingSprite.fromFrame is deprecated, use TilingSprite.from"),i.TilingSprite.from(f,{width:d,height:p})},i.TilingSprite.fromImage=function(f,d,p,v){return v===void 0&&(v={}),K("5.3.0","TilingSprite.fromImage is deprecated, use TilingSprite.from"),v&&typeof v!="object"&&(v={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),v.width=d,v.height=p,i.TilingSprite.from(f,v)},Object.defineProperties(i.utils,{getSvgSize:{get:function(){return K(tt,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),i.resources.SVGResource.getSize}}}),i.mesh={},Object.defineProperties(i.mesh,{Mesh:{get:function(){return K(tt,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),i.SimpleMesh}},NineSlicePlane:{get:function(){return K(tt,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),i.NineSlicePlane}},Plane:{get:function(){return K(tt,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),i.SimplePlane}},Rope:{get:function(){return K(tt,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),i.SimpleRope}},RawMesh:{get:function(){return K(tt,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),i.Mesh}},CanvasMeshRenderer:{get:function(){return K(tt,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),i.CanvasMeshRenderer}},MeshRenderer:{get:function(){return K(tt,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),i.MeshRenderer}}}),i.particles={},Object.defineProperties(i.particles,{ParticleContainer:{get:function(){return K(tt,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),i.ParticleContainer}},ParticleRenderer:{get:function(){return K(tt,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),i.ParticleRenderer}}}),i.ticker={},Object.defineProperties(i.ticker,{Ticker:{get:function(){return K(tt,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),i.Ticker}},shared:{get:function(){return K(tt,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),i.Ticker.shared}}}),i.loaders={},Object.defineProperties(i.loaders,{Loader:{get:function(){return K(tt,"PIXI.loaders.Loader class has moved to PIXI.Loader"),i.Loader}},Resource:{get:function(){return K(tt,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),i.LoaderResource}},bitmapFontParser:{get:function(){return K(tt,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),i.BitmapFontLoader.use}},parseBitmapFontData:{get:function(){K(tt,"PIXI.loaders.parseBitmapFontData function has removed")}},spritesheetParser:{get:function(){return K(tt,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),i.SpritesheetLoader.use}},getResourcePath:{get:function(){return K(tt,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),i.SpritesheetLoader.getResourcePath}}}),i.Loader.addPixiMiddleware=function(f){return K(tt,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),i.loaders.Loader.registerPlugin({use:f()})};var e=function(c){return"on"+c.charAt(0).toUpperCase()+c.slice(1)};Object.assign(i.Loader.prototype,{on:function(c){var f=e(c);K(tt,"PIXI.Loader#on is completely deprecated, use PIXI.Loader#"+f+".add")},once:function(c){var f=e(c);K(tt,"PIXI.Loader#once is completely deprecated, use PIXI.Loader#"+f+".once")},off:function(c){var f=e(c);K(tt,"PIXI.Loader#off is completely deprecated, use PIXI.Loader#"+f+".detach")}}),Object.defineProperty(i.extract,"WebGLExtract",{get:function(){return K(tt,"PIXI.extract.WebGLExtract method has moved to PIXI.Extract"),i.Extract}}),Object.defineProperty(i.prepare,"WebGLPrepare",{get:function(){return K(tt,"PIXI.prepare.WebGLPrepare class has moved to PIXI.Prepare"),i.Prepare}}),i.Container.prototype._renderWebGL=function(f){K(tt,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(f)},i.Container.prototype.renderWebGL=function(f){K(tt,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(f)},i.DisplayObject.prototype.renderWebGL=function(f){K(tt,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(f)},i.Container.prototype.renderAdvancedWebGL=function(f){K(tt,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(f)},Object.defineProperties(i.settings,{TRANSFORM_MODE:{get:function(){return K(tt,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function(){K(tt,"PIXI.settings.TRANSFORM_MODE property has been removed")}}});var t=i.BaseTexture;t.prototype.loadSource=function(f){K(tt,"PIXI.BaseTexture.loadSource method has been deprecated");var d=i.resources.autoDetectResource(f);d.internal=!0,this.setResource(d),this.update()};var r=!1;Object.defineProperties(t.prototype,{hasLoaded:{get:function(){return K(tt,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function(){var c;return K(tt,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),(c=this.resource)===null||c===void 0?void 0:c.url},set:function(c){K(tt,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=c)}},source:{get:function(){return K(tt,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource.source},set:function(c){K(tt,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=c)}},premultiplyAlpha:{get:function(){return K("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode!==0},set:function(c){K("5.2.0","PIXI.BaseTexture.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(c)}},_id:{get:function(){return r||(K("5.2.0","PIXI.BaseTexture._id batch local field has been changed to `_batchLocation`"),r=!0),this._batchLocation},set:function(c){this._batchLocation=c}}}),t.fromImage=function(f,d,p,v){K(tt,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from");var m={scale:v,crossorigin:d};return t.from(f,{scaleMode:p,resourceOptions:m})},t.fromCanvas=function(f,d){return K(tt,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),t.from(f,{scaleMode:d})},t.fromSVG=function(f,d,p,v){K(tt,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from");var m={scale:v,crossorigin:d};return t.from(f,{scaleMode:p,resourceOptions:m})},Object.defineProperties(i.resources.ImageResource.prototype,{premultiplyAlpha:{get:function(){return K("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode!==0},set:function(c){K("5.2.0","PIXI.resources.ImageResource.premultiplyAlpha property has been changed to `alphaMode`, see `PIXI.ALPHA_MODES`"),this.alphaMode=Number(c)}}}),i.Point.prototype.copy=function(f){return K(tt,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(f)},i.ObservablePoint.prototype.copy=function(f){return K(tt,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(f)},i.Rectangle.prototype.copy=function(f){return K(tt,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(f)},i.Matrix.prototype.copy=function(f){return K(tt,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(f)},i.systems.StateSystem.prototype.setState=function(f){return K("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(f)},Object.assign(i.systems.FilterSystem.prototype,{getRenderTarget:function(c,f){return K(tt,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(null,f)},returnRenderTarget:function(c){K(tt,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(c)},calculateScreenSpaceMatrix:function(c){K(tt,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var f=c.identity(),d=this.activeState,p=d.sourceFrame,v=d.destinationFrame;return f.translate(p.x/v.width,p.y/v.height),f.scale(v.width,v.height),f},calculateNormalizedScreenSpaceMatrix:function(c){K(tt,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var f=this.activeState,d=f.sourceFrame,p=f.destinationFrame,v=c.identity();v.translate(d.x/p.width,d.y/p.height);var m=p.width/d.width,g=p.height/d.height;return v.scale(m,g),v}}),Object.defineProperties(i.RenderTexture.prototype,{sourceFrame:{get:function(){return K(tt,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function(){return K(tt,"PIXI.RenderTexture.size property has been removed"),this._frame}}});var n=(function(c){ef(f,c);function f(d,p,v,m){var g=this;return K(tt,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),g=c.call(this,!0,d,p,v,m)||this,g}return f})(i.filters.BlurFilterPass),s=(function(c){ef(f,c);function f(d,p,v,m){var g=this;return K(tt,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),g=c.call(this,!1,d,p,v,m)||this,g}return f})(i.filters.BlurFilterPass);Object.assign(i.filters,{BlurXFilter:n,BlurYFilter:s});var o=i.Sprite,a=i.Texture,l=i.Graphics;l.prototype.generateCanvasTexture||(l.prototype.generateCanvasTexture=function(){K(tt,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(l.prototype,"graphicsData",{get:function(){return K(tt,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}});function u(c,f,d,p){return K(tt,"PIXI.Sprite."+c+" method is deprecated, use PIXI.Sprite.from"),o.from(f,{resourceOptions:{scale:p,crossorigin:d}})}o.fromImage=u.bind(null,"fromImage"),o.fromSVG=u.bind(null,"fromSVG"),o.fromCanvas=u.bind(null,"fromCanvas"),o.fromVideo=u.bind(null,"fromVideo"),o.fromFrame=u.bind(null,"fromFrame");function h(c,f,d,p){return K(tt,"PIXI.Texture."+c+" method is deprecated, use PIXI.Texture.from"),a.from(f,{resourceOptions:{scale:p,crossorigin:d}})}a.fromImage=h.bind(null,"fromImage"),a.fromSVG=h.bind(null,"fromSVG"),a.fromCanvas=h.bind(null,"fromCanvas"),a.fromVideo=h.bind(null,"fromVideo"),a.fromFrame=h.bind(null,"fromFrame"),Object.defineProperty(i.AbstractRenderer.prototype,"autoResize",{get:function(){return K(tt,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function(c){K(tt,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=c}}),Object.defineProperty(i.Renderer.prototype,"textureManager",{get:function(){return K(tt,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),i.utils.mixins={mixin:function(){K(tt,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function(){K(tt,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function(){K(tt,"PIXI.utils.mixins.performMixins function is no longer available")}},Object.defineProperty(i.BitmapText.prototype,"font",{get:function(){return K("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),{name:this._fontName,size:this._fontSize,tint:this._tint,align:this._align}},set:function(c){if(K("5.3.0","PIXI.BitmapText.font property is deprecated, use fontName, fontSize, tint or align properties"),!!c){var f={font:c};this._upgradeStyle(f),f.fontSize=f.fontSize||i.BitmapFont.available[f.fontName].size,this._fontName=f.fontName,this._fontSize=f.fontSize,this.dirty=!0}}})}Me.registerPlugin("accessibility",qd);Me.registerPlugin("extract",Up);Me.registerPlugin("interaction",Kd);Me.registerPlugin("particle",Vp);Me.registerPlugin("prepare",iy);Me.registerPlugin("batch",kp);Me.registerPlugin("tilingSprite",ay);Fr.registerPlugin(hy);Fr.registerPlugin(sy);an.registerPlugin($d);an.registerPlugin(Yp);var Bb="5.3.12",Db={AlphaFilter:ub,BlurFilter:yb,BlurFilterPass:ol,ColorMatrixFilter:ll,DisplacementFilter:xb,FXAAFilter:Eb,NoiseFilter:Cb};const kb=Object.freeze(Object.defineProperty({__proto__:null,get ALPHA_MODES(){return ze},AbstractBatchRenderer:Np,AbstractRenderer:Fp,AccessibilityManager:qd,AnimatedSprite:Lb,AppLoaderPlugin:Yp,Application:an,Attribute:Ga,get BLEND_MODES(){return st},get BUFFER_BITS(){return Wi},BasePrepare:ey,BaseRenderTexture:zi,BaseTexture:It,BatchDrawCall:ms,BatchGeometry:lu,BatchPluginFactory:Dp,BatchRenderer:kp,BatchShaderGenerator:Bp,BatchTextureArray:vs,BitmapFont:er,BitmapFontData:Qi,BitmapFontLoader:hy,BitmapText:ob,Bounds:Ji,Buffer:Lt,get CLEAR_MODES(){return xe},Circle:Hd,Container:ee,CountLimiter:ty,DEG_TO_RAD:Xd,get DRAW_MODES(){return ue},DisplayObject:Dt,get ENV(){return Pe},Ellipse:Gd,Extract:Up,get FORMATS(){return ui},FillStyle:uu,Filter:We,FilterState:op,Framebuffer:ys,get GC_MODES(){return ds},GLFramebuffer:hp,GLProgram:Sp,GLTexture:Qn,GRAPHICS_CURVES:di,Geometry:Nr,Graphics:Fs,GraphicsData:Ka,GraphicsGeometry:Jp,IGLUniformData:Zg,InteractionData:Ua,InteractionEvent:jd,InteractionManager:Kd,InteractionTrackingData:Zn,get LINE_CAP(){return Ue},get LINE_JOIN(){return ke},LineStyle:Qp,Loader:Fr,LoaderResource:Vi,get MASK_TYPES(){return Jt},get MIPMAP_MODES(){return hi},get MSAA_QUALITY(){return Ar},MaskData:dp,Matrix:Mt,Mesh:yi,MeshBatchUvs:ly,MeshGeometry:un,MeshMaterial:ln,NineSlicePlane:Rb,ObjectRenderer:wi,ObservablePoint:Er,PI_2:ci,get PRECISION(){return Ie},ParticleContainer:I0,ParticleRenderer:Vp,PlaneGeometry:dy,Point:Ht,Polygon:ii,Prepare:iy,Program:Ti,Quad:sp,QuadUv:ou,RAD_TO_DEG:Ud,get RENDERER_TYPE(){return li},Rectangle:vt,RenderTexture:Or,RenderTexturePool:ip,Renderer:Me,RopeGeometry:py,RoundedRectangle:Yd,Runner:Yt,get SCALE_MODES(){return Te},get SHAPES(){return Rt},Shader:qe,SimpleMesh:Fb,SimplePlane:yy,SimpleRope:Ob,Sprite:Br,SpriteMaskFilter:bp,Spritesheet:ny,SpritesheetLoader:sy,State:cr,System:ne,get TARGETS(){return ar},get TEXT_GRADIENT(){return pi},get TYPES(){return Nt},TemporaryDisplayObject:tu,Text:cu,TextMetrics:ge,TextStyle:Rr,Texture:lt,TextureLoader:Gp,TextureMatrix:Ps,TextureUvs:su,Ticker:Xt,TickerPlugin:$d,TilingSprite:W0,TilingSpriteRenderer:ay,TimeLimiter:j0,Transform:Jl,get UPDATE_PRIORITY(){return Oe},UniformGroup:lr,VERSION:Bb,ViewableBuffer:Lp,get WRAP_MODES(){return Ae},accessibleTarget:Vd,autoDetectRenderer:Rp,checkMaxIfStatementsInShader:gp,defaultFilterVertex:au,defaultVertex:Mp,filters:Db,graphicsUtils:P0,groupD8:Pt,interactiveTarget:Wd,isMobile:ye,resources:rp,settings:nt,systems:s0,uniformParsers:Jn,useDeprecated:Nb,utils:dg},Symbol.toStringTag,{value:"Module"}));var gt;(function(i){var e=(function(){function t(r){this.tileAnim=[0,0],this.dontUseTransform=!1,this.renderer=r,this.tileAnim=[0,0]}return t})();i.CanvasTileRenderer=e})(gt||(gt={}));var Ge=(function(){var i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){i(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}})(),gt;(function(i){var e=(function(t){Ge(r,t);function r(n,s,o){var a=t.call(this)||this;return a.modificationMarker=0,a.shadowColor=new Float32Array([0,0,0,.5]),a._globalMat=null,a.initialize.apply(a,arguments),a}return r.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},r.prototype.initialize=function(n,s,o){o===!0&&(o=0),this.z=this.zIndex=n,this.texPerChild=o||i.Constant.boundCountPerBuffer*i.Constant.maxTextures,s&&this.setBitmaps(s)},r.prototype.setBitmaps=function(n){var s=this.texPerChild,o=this.children.length,a=Math.ceil(n.length/s),l;for(l=0;l<o;l++)this.children[l].textures=n.slice(l*s,(l+1)*s);for(l=o;l<a;l++){var u=new i.RectTileLayer(this.zIndex,n.slice(l*s,(l+1)*s));u.compositeParent=!0,u.offsetX=i.Constant.boundSize,u.offsetY=i.Constant.boundSize,this.addChild(u)}},r.prototype.clear=function(){for(var n=0;n<this.children.length;n++)this.children[n].clear();this.modificationMarker=0},r.prototype.addRect=function(n,s,o,a,l,u,h){var c=n/this.texPerChild>>0,f=n%this.texPerChild;this.children[c]&&this.children[c].textures&&this.children[c].addRect(f,s,o,a,l,u,h)},r.prototype.addFrame=function(n,s,o,a,l){var u,h=null,c=0,f=this.children;if(typeof n=="number"){var d=n/this.texPerChild>>0;if(h=f[d],h)c=n%this.texPerChild;else{if(h=f[0],!h)return!1;c=0}u=h.textures[c]}else{typeof n=="string"?u=lt.from(n):u=n;for(var p=0;p<f.length;p++){for(var v=f[p],m=v.textures,g=0;g<m.length;g++)if(m[g].baseTexture===u.baseTexture){h=v,c=g;break}if(h)break}if(!h){for(var p=0;p<f.length;p++){var v=f[p];if(v.textures.length<this.texPerChild){h=v,c=v.textures.length,v.textures.push(u);break}}h||(h=new i.RectTileLayer(this.zIndex,u),h.compositeParent=!0,h.offsetX=i.Constant.boundSize,h.offsetY=i.Constant.boundSize,f.push(h),c=0)}}return h.addRect(c,u.frame.x,u.frame.y,s,o,u.frame.width,u.frame.height,a,l),!0},r.prototype.renderCanvas=function(n){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){var s=n.plugins.tilemap;if(!s.dontUseTransform){var o=this.worldTransform;n.context.setTransform(o.a,o.b,o.c,o.d,o.tx*n.resolution,o.ty*n.resolution)}for(var a=this.children,l=0;l<a.length;l++)a[l].renderCanvasCore(n)}},r.prototype.render=function(n){if(!(!this.visible||this.worldAlpha<=0||!this.renderable)){var s=n.plugins.tilemap,o=s.getShader();n.batch.setObjectRenderer(s),this._globalMat=o.uniforms.projTransMatrix,n.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),o.uniforms.shadowColor=this.shadowColor,o.uniforms.animationFrame=s.tileAnim,n.shader.bind(o,!1);for(var a=this.children,l=0;l<a.length;l++)a[l].renderWebGLCore(n,s)}},r.prototype.isModified=function(n){var s=this.children;if(this.modificationMarker!==s.length)return!0;for(var o=0;o<s.length;o++)if(s[o].isModified(n))return!0;return!1},r.prototype.clearModify=function(){var n=this.children;this.modificationMarker=n.length;for(var s=0;s<n.length;s++)n[s].clearModify()},r})(ee);i.CompositeRectTileLayer=e})(gt||(gt={}));var gt;(function(i){i.Constant={maxTextures:4,bufferSize:2048,boundSize:1024,boundCountPerBuffer:4,use32bitIndex:!1,SCALE_MODE:Te.LINEAR,DO_CLEAR:!0}})(gt||(gt={}));var gt;(function(i){(function(e){Ge(t,e);function t(r){var n=e.call(this)||this;return n.zIndex=r,n}return t.prototype.renderCanvas=function(r){var n=null;r.plugins.tilemap.dontUseTransform&&(n=this.transform.worldTransform,this.transform.worldTransform=Mt.IDENTITY),r.plugins.graphics.render(this),r.plugins.tilemap.dontUseTransform&&(this.transform.worldTransform=n),r.context.globalAlpha=1},t.prototype.isModified=function(r){return!1},t.prototype.clearModify=function(){},t})(Fs)})(gt||(gt={}));var gt;(function(i){var e=(function(t){Ge(r,t);function r(n){var s=t.call(this,n.bufferSize,n.bufferSize)||this;s.DO_CLEAR=!1,s.boundSize=0,s._clearBuffer=null,s.baseTex=null,s.boundSprites=[],s.dirties=[];var o=s.boundSprites,a=s.dirties;s.boundSize=n.boundSize;for(var l=0;l<n.boundCountPerBuffer;l++){var u=new Br;u.position.x=n.boundSize*(l&1),u.position.y=n.boundSize*(l>>1),o.push(u),a.push(0)}return s.DO_CLEAR=!!n.DO_CLEAR,s}return r.prototype.bind=function(n){if(this.baseTex)throw new Error("Only one baseTexture is allowed for this resource!");this.baseTex=n,t.prototype.bind.call(this,n)},r.prototype.setTexture=function(n,s){var o=this.boundSprites[n];o.texture.baseTexture!==s.baseTexture&&(o.texture=s,this.baseTex.update(),this.dirties[n]=this.baseTex.dirtyId)},r.prototype.upload=function(n,s,o){var a=n.gl,l=this,u=l.width,h=l.height;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s.premultiplyAlpha),o.dirtyId<0&&(o.width=u,o.height=h,a.texImage2D(s.target,0,s.format,u,h,0,s.format,s.type,null));var c=this.DO_CLEAR;c&&!this._clearBuffer&&(this._clearBuffer=new Uint8Array(i.Constant.boundSize*i.Constant.boundSize*4));for(var f=this.boundSprites,d=0;d<f.length;d++){var p=f[d],v=p.texture.baseTexture;if(!(o.dirtyId>=this.dirties[d])){var m=v.resource;!v.valid||!m||!m.source||(c&&(v.width<this.boundSize||v.height<this.boundSize)&&a.texSubImage2D(s.target,0,p.position.x,p.position.y,this.boundSize,this.boundSize,s.format,s.type,this._clearBuffer),a.texSubImage2D(s.target,0,p.position.x,p.position.y,s.format,s.type,m.source))}}return!0},r})(rp.Resource);i.MultiTextureResource=e})(gt||(gt={}));var gt;(function(i){var e=(function(t){Ge(r,t);function r(n,s){var o=t.call(this)||this;return o.zIndex=0,o.modificationMarker=0,o.shadowColor=new Float32Array([0,0,0,.5]),o._globalMat=null,o.pointsBuf=[],o.hasAnim=!1,o.offsetX=0,o.offsetY=0,o.compositeParent=!1,o.vbId=0,o.vb=null,o.vbBuffer=null,o.vbArray=null,o.vbInts=null,o.initialize(n,s),o}return r.prototype.initialize=function(n,s){s?!(s instanceof Array)&&s.baseTexture&&(s=[s]):s=[],this.textures=s,this.zIndex=n},r.prototype.clear=function(){this.pointsBuf.length=0,this.modificationMarker=0,this.hasAnim=!1},r.prototype.addFrame=function(n,s,o,a,l){var u,h=0;if(typeof n=="number")h=n,u=this.textures[h];else{typeof n=="string"?u=lt.from(n):u=n;for(var c=!1,f=this.textures,d=0;d<f.length;d++)if(f[d].baseTexture===u.baseTexture){h=d,c=!0;break}if(!c)return!1}return this.addRect(h,u.frame.x,u.frame.y,s,o,u.frame.width,u.frame.height,a,l),!0},r.prototype.addRect=function(n,s,o,a,l,u,h,c,f){c===void 0&&(c=0),f===void 0&&(f=0);var d=this.pointsBuf;if(this.hasAnim=this.hasAnim||c>0||f>0,u===h)d.push(s),d.push(o),d.push(a),d.push(l),d.push(u),d.push(h),d.push(c|0),d.push(f|0),d.push(n);else{var p=void 0;if(u%h===0)for(p=0;p<u/h;p++)d.push(s+p*h),d.push(o),d.push(a+p*h),d.push(l),d.push(h),d.push(h),d.push(c|0),d.push(f|0),d.push(n);else if(h%u===0)for(p=0;p<h/u;p++)d.push(s),d.push(o+p*u),d.push(a),d.push(l+p*u),d.push(u),d.push(u),d.push(c|0),d.push(f|0),d.push(n);else d.push(s),d.push(o),d.push(a),d.push(l),d.push(u),d.push(h),d.push(c|0),d.push(f|0),d.push(n)}},r.prototype.renderCanvas=function(n){var s=n.plugins.tilemap;if(!s.dontUseTransform){var o=this.worldTransform;n.context.setTransform(o.a,o.b,o.c,o.d,o.tx*n.resolution,o.ty*n.resolution)}this.renderCanvasCore(n)},r.prototype.renderCanvasCore=function(n){if(this.textures.length!==0){var s=this.pointsBuf;n.context.fillStyle="#000000";for(var o=0,a=s.length;o<a;o+=9){var l=s[o],u=s[o+1],h=s[o+2],c=s[o+3],f=s[o+4],d=s[o+5];l+=s[o+6]*n.plugins.tilemap.tileAnim[0],u+=s[o+7]*n.plugins.tilemap.tileAnim[1];var p=s[o+8];p>=0?n.context.drawImage(this.textures[p].baseTexture.source,l,u,f,d,h,c,f,d):(n.context.globalAlpha=.5,n.context.fillRect(h,c,f,d),n.context.globalAlpha=1)}}},r.prototype.destroyVb=function(){this.vb&&(this.vb.destroy(),this.vb=null)},r.prototype.render=function(n){var s=n.plugins.tilemap,o=s.getShader();n.batch.setObjectRenderer(s),this._globalMat=o.uniforms.projTransMatrix,n.globalUniforms.uniforms.projectionMatrix.copyTo(this._globalMat).append(this.worldTransform),o.uniforms.shadowColor=this.shadowColor,o.uniforms.animationFrame=s.tileAnim,n.shader.bind(o,!1),this.renderWebGLCore(n,s)},r.prototype.renderWebGLCore=function(n,s){var o=this.pointsBuf;if(o.length!==0){var a=o.length/9,l=s.getShader(),u=this.textures;if(u.length!==0){s.bindTextures(n,l,u);var h=this.vb;h||(h=s.createVb(),this.vb=h,this.vbId=h.id,this.vbBuffer=null,this.modificationMarker=0),s.checkIndexBuffer(a,h);var c=i.Constant.boundCountPerBuffer,f=h.getBuffer("aVertexPosition"),d=a*h.vertPerQuad;if(d!==0){if(this.modificationMarker!==d){this.modificationMarker=d;var p=h.stride*d;if(!this.vbBuffer||this.vbBuffer.byteLength<p){for(var v=h.stride;v<p;)v*=2;this.vbBuffer=new ArrayBuffer(v),this.vbArray=new Float32Array(this.vbBuffer),this.vbInts=new Uint32Array(this.vbBuffer),f.update(this.vbBuffer)}var m=this.vbArray;this.vbInts;for(var g=0,E=0,I=this.offsetX,M=this.offsetY,_=0;_<o.length;_+=9){var F=.5;this.compositeParent&&(c>1?(E=o[_+8]>>2,I=this.offsetX*(o[_+8]&1),M=this.offsetY*(o[_+8]>>1&1)):(E=o[_+8],I=0,M=0));var C=o[_+2],H=o[_+3],R=o[_+4],N=o[_+5],Y=o[_]+I,D=o[_+1]+M,J=o[_+6],Q=o[_+7];m[g++]=C,m[g++]=H,m[g++]=Y,m[g++]=D,m[g++]=Y+F,m[g++]=D+F,m[g++]=Y+R-F,m[g++]=D+N-F,m[g++]=J,m[g++]=Q,m[g++]=E,m[g++]=C+R,m[g++]=H,m[g++]=Y+R,m[g++]=D,m[g++]=Y+F,m[g++]=D+F,m[g++]=Y+R-F,m[g++]=D+N-F,m[g++]=J,m[g++]=Q,m[g++]=E,m[g++]=C+R,m[g++]=H+N,m[g++]=Y+R,m[g++]=D+N,m[g++]=Y+F,m[g++]=D+F,m[g++]=Y+R-F,m[g++]=D+N-F,m[g++]=J,m[g++]=Q,m[g++]=E,m[g++]=C,m[g++]=H+N,m[g++]=Y,m[g++]=D+N,m[g++]=Y+F,m[g++]=D+F,m[g++]=Y+R-F,m[g++]=D+N-F,m[g++]=J,m[g++]=Q,m[g++]=E}f.update(m)}n.geometry.bind(h,l),n.geometry.draw(ue.TRIANGLES,a*6,0)}}}},r.prototype.isModified=function(n){return!!(this.modificationMarker!==this.pointsBuf.length||n&&this.hasAnim)},r.prototype.clearModify=function(){this.modificationMarker=this.pointsBuf.length},r.prototype.destroy=function(n){t.prototype.destroy.call(this,n),this.destroyVb()},r})(ee);i.RectTileLayer=e})(gt||(gt={}));var gt;(function(i){var e=`
varying vec2 vTextureCoord;
varying vec4 vFrame;
varying float vTextureId;
uniform vec4 shadowColor;
uniform sampler2D uSamplers[%count%];
uniform vec2 uSamplerSize[%count%];

void main(void){
   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);
   float textureId = floor(vTextureId + 0.5);

   vec4 color;
   %forloop%
   gl_FragColor = color;
}
`,t=`
attribute vec2 aVertexPosition;
attribute vec2 aTextureCoord;
attribute vec4 aFrame;
attribute vec2 aAnim;
attribute float aTextureId;

uniform mat3 projTransMatrix;
uniform vec2 animationFrame;

varying vec2 vTextureCoord;
varying float vTextureId;
varying vec4 vFrame;

void main(void){
   gl_Position = vec4((projTransMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);
   vec2 anim = aAnim * animationFrame;
   vTextureCoord = aTextureCoord + anim;
   vFrame = aFrame + vec4(anim, anim);
   vTextureId = aTextureId;
}
`,r=(function(o){Ge(a,o);function a(l,u,h){var c=o.call(this,new Ti(u,h),{animationFrame:new Float32Array(2),uSamplers:[],uSamplerSize:[],projTransMatrix:new Mt})||this;return c.maxTextures=0,c.maxTextures=l,i.shaderGenerator.fillSamplers(c,c.maxTextures),c}return a})(qe);i.TilemapShader=r;var n=(function(o){Ge(a,o);function a(l){var u=o.call(this,l,t,i.shaderGenerator.generateFragmentSrc(l,e))||this;return i.shaderGenerator.fillSamplers(u,u.maxTextures),u}return a})(r);i.RectTileShader=n;var s=(function(o){Ge(a,o);function a(){var l=o.call(this)||this;l.vertSize=11,l.vertPerQuad=4,l.stride=l.vertSize*4,l.lastTimeAccess=0;var u=l.buf=new Lt(new Float32Array(2),!0,!1);return l.addAttribute("aVertexPosition",u,0,!1,0,l.stride,0).addAttribute("aTextureCoord",u,0,!1,0,l.stride,8).addAttribute("aFrame",u,0,!1,0,l.stride,16).addAttribute("aAnim",u,0,!1,0,l.stride,32).addAttribute("aTextureId",u,0,!1,0,l.stride,40),l}return a})(Nr);i.RectTileGeom=s})(gt||(gt={}));var gt;(function(i){var e=(function(t){Ge(r,t);function r(n){var s=t.call(this,n)||this;return s.sn=-1,s.indexBuffer=null,s.ibLen=0,s.tileAnim=[0,0],s.texLoc=[],s.texResources=[],s.rectShader=new i.RectTileShader(i.Constant.maxTextures),s.indexBuffer=new Lt(void 0,!0,!0),s.checkIndexBuffer(2e3),s.initBounds(),s}return r.prototype.initBounds=function(){if(!(i.Constant.boundCountPerBuffer<=1))for(var n=i.Constant.maxTextures,s=0;s<n;s++){var o=new i.MultiTextureResource(i.Constant),a=new It(o);a.scaleMode=i.Constant.SCALE_MODE,a.wrapMode=Ae.CLAMP,this.texResources.push(o)}},r.prototype.bindTexturesWithoutRT=function(n,s,o){var a=s.uniforms.uSamplerSize;this.texLoc.length=0;for(var l=0;l<o.length;l++){var u=o[l];if(!u||!u.valid)return;n.texture.bind(o[l],l),a[l*2]=1/o[l].baseTexture.width,a[l*2+1]=1/o[l].baseTexture.height}s.uniforms.uSamplerSize=a},r.prototype.bindTextures=function(n,s,o){var a=o.length,l=i.Constant.maxTextures;if(!(a>i.Constant.boundCountPerBuffer*l)){if(i.Constant.boundCountPerBuffer<=1){this.bindTexturesWithoutRT(n,s,o);return}for(var u=0;u<a;u++){var h=o[u];if(!(!h||!h.valid)){var c=this.texResources[u>>2];c.setTexture(u&3,h)}}var f=u+3>>2;for(u=0;u<f;u++)n.texture.bind(this.texResources[u].baseTex,u)}},r.prototype.start=function(){},r.prototype.createVb=function(){var n=new i.RectTileGeom;return n.addIndex(this.indexBuffer),n.lastTimeAccess=Date.now(),n},r.prototype.checkIndexBuffer=function(n,s){var o=n*6;o<=this.ibLen||(this.ibLen=o,this.indexBuffer.update(Zl(n,i.Constant.use32bitIndex)))},r.prototype.getShader=function(){return this.rectShader},r.prototype.destroy=function(){t.prototype.destroy.call(this),this.rectShader=null},r})(wi);i.TileRenderer=e,Me.registerPlugin("tilemap",e)})(gt||(gt={}));var gt;(function(i){var e=(function(t){Ge(r,t);function r(n,s){var o=t.call(this)||this;return o._lastAnimationFrame=-1,o.tilemap=n,o.z=s,o}return r.prototype.clear=function(){for(var n=this.children,s=0;s<n.length;s++)n[s].clear();this._previousLayers=0},r.prototype.cacheIfDirty=function(){var n=this.tilemap,s=this.children,o=this._previousLayers!==s.length;this._previousLayers=s.length;var a=this.canvasBuffer,l=this._tempRender;a||(a=this.canvasBuffer=document.createElement("canvas"),l=this._tempRender=new(void 0)(100,100,{view:a}),l.context=l.rootContext,l.plugins.tilemap.dontUseTransform=!0),(a.width!==n._layerWidth||a.height!==n._layerHeight)&&(a.width=n._layerWidth,a.height=n._layerHeight,o=!0);var u;if(!o){for(u=0;u<s.length;u++)if(s[u].isModified(this._lastAnimationFrame!==n.animationFrame)){o=!0;break}}if(this._lastAnimationFrame=n.animationFrame,o)for(n._hackRenderer&&n._hackRenderer(l),l.context.clearRect(0,0,a.width,a.height),u=0;u<s.length;u++)s[u].clearModify(),s[u].renderCanvas(l);for(this.layerTransform=this.worldTransform,u=0;u<s.length;u++){this.layerTransform=s[u].worldTransform;break}},r.prototype.renderCanvas=function(n){this.cacheIfDirty();var s=this.layerTransform;n.context.setTransform(s.a,s.b,s.c,s.d,s.tx*n.resolution,s.ty*n.resolution),this.tilemap,n.context.drawImage(this.canvasBuffer,0,0)},r})(ee);i.ZLayer=e})(gt||(gt={}));const Ub=i=>(i&&Object.isExtensible(i)&&!i.tilemap&&(i.tilemap=gt),gt);var gt;(function(i){(function(e){function t(s,o){for(var a=[],l=0;l<o;l++)a[l]=l;s.uniforms.uSamplers=a;for(var u=[],l=0;l<o;l++)u.push(1/i.Constant.bufferSize),u.push(1/i.Constant.bufferSize);s.uniforms.uSamplerSize=u}e.fillSamplers=t;function r(s,o){return o.replace(/%count%/gi,s+"").replace(/%forloop%/gi,this.generateSampleSrc(s))}e.generateFragmentSrc=r;function n(s){var o="";o+=`
`,o+=`
`,o+="if(vTextureId <= -1.0) {",o+=`
	color = shadowColor;`,o+=`
}`;for(var a=0;a<s;a++)o+=`
else `,a<s-1&&(o+="if(textureId == "+a+".0)"),o+=`
{`,o+=`
	color = texture2D(uSamplers[`+a+"], textureCoord * uSamplerSize["+a+"]);",o+=`
}`;return o+=`
`,o+=`
`,o}e.generateSampleSrc=n})(i.shaderGenerator||(i.shaderGenerator={}))})(gt||(gt={}));const $={...kb};Ub($);$.settings&&($.settings.CREATE_IMAGE_BITMAP=!1,$.SCALE_MODES&&($.settings.SCALE_MODE=$.SCALE_MODES.NEAREST));typeof window<"u"&&(window.PIXI=$);var es={exports:{}},Xb=es.exports,rf;function Hb(){return rf||(rf=1,(function(i,e){(function(t,r){i.exports=r()})(Xb,function(){var t=function(){function r(d){return o.appendChild(d.dom),d}function n(d){for(var p=0;p<o.children.length;p++)o.children[p].style.display=p===d?"block":"none";s=d}var s=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(d){d.preventDefault(),n(++s%o.children.length)},!1);var a=(performance||Date).now(),l=a,u=0,h=r(new t.Panel("FPS","#0ff","#002")),c=r(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var f=r(new t.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:o,addPanel:r,showPanel:n,begin:function(){a=(performance||Date).now()},end:function(){u++;var d=(performance||Date).now();if(c.update(d-a,200),d>l+1e3&&(h.update(1e3*u/(d-l),100),l=d,u=0,f)){var p=performance.memory;f.update(p.usedJSHeapSize/1048576,p.jsHeapSizeLimit/1048576)}return d},update:function(){a=this.end()},domElement:o,setMode:n}};return t.Panel=function(r,n,s){var o=1/0,a=0,l=Math.round,u=l(window.devicePixelRatio||1),h=80*u,c=48*u,f=3*u,d=2*u,p=3*u,v=15*u,m=74*u,g=30*u,E=document.createElement("canvas");E.width=h,E.height=c,E.style.cssText="width:80px;height:48px";var I=E.getContext("2d");return I.font="bold "+9*u+"px Helvetica,Arial,sans-serif",I.textBaseline="top",I.fillStyle=s,I.fillRect(0,0,h,c),I.fillStyle=n,I.fillText(r,f,d),I.fillRect(p,v,m,g),I.fillStyle=s,I.globalAlpha=.9,I.fillRect(p,v,m,g),{dom:E,update:function(M,_){o=Math.min(o,M),a=Math.max(a,M),I.fillStyle=s,I.globalAlpha=1,I.fillRect(0,0,h,v),I.fillStyle=n,I.fillText(l(M)+" "+r+" ("+l(o)+"-"+l(a)+")",f,d),I.drawImage(E,p+u,v,m-u,g,p,v,m-u,g),I.fillRect(p+m-u,v,u,g),I.fillStyle=s,I.globalAlpha=.9,I.fillRect(p+m-u,v,u,l((1-M/_)*g))}}},t})})(es)),es.exports}var Gb=Hb();const Yb=bi(Gb),zb=650,Vb=6,nf=(i,e=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const t=parseFloat(i);if(!Number.isNaN(t))return t}return e},qb=i=>{i&&(i.cameraShake={remaining:0,duration:0,intensity:0,offsetX:0,offsetY:0})},$b=(i,e={})=>{if(!i||!i.cameraShake)return;const t=Math.max(0,nf(e.duration,zb)),r=Math.max(0,nf(e.intensity,Vb));i.cameraShake.remaining=t,i.cameraShake.duration=t,i.cameraShake.intensity=r},jb=(i,e=0)=>{if(!i||!i.cameraShake)return{x:0,y:0};const t=i.cameraShake,r=Number.isFinite(e)&&e>0?e:0;if(t.remaining<=0||t.intensity<=0)return t.remaining=0,t.offsetX=0,t.offsetY=0,{x:0,y:0};t.remaining=Math.max(0,t.remaining-r);const n=t.duration>0?t.remaining/t.duration:0,s=t.intensity*n,o=Math.random()*Math.PI*2;return t.offsetX=Math.cos(o)*s,t.offsetY=Math.sin(o)*s,t.remaining<=0&&(t.offsetX=0,t.offsetY=0),{x:t.offsetX,y:t.offsetY}},rs=1024,is=768,Wb=2400,sf=24,Kb=100,Zb=80,Jb=Object.freeze({offsetX:28,offsetY:8,width:138,height:138}),Qb=70,t_=69,yl=.5,ml=.8,Xe=2,Se=101,du=200,pu=201,yu=202,mu=203,ir=103,e_=1,Qe=-1,r_=650,i_=650,n_=500,of=5e3,s_=5e3,my=5,o_=8,a_=5,mi=40,l_=95e6,Hi=5e5,af=2,lf=1,vy=1,vu=2,hn=3,u_=.1,Fe=0,kt=1,Rs=2,vl=3,jt=4,h_=100,c_=50,St=0,sr=1,uf=2,gy=200,Qr=300,hf=412,f_=112,Nn=401,d_=101,Bn=409,p_=109,Dn=400,y_=100,ya=402,m_=102,kn=411,v_=111,ma=404,g_=104,va=405,b_=105,cf=403,__=103,ff=410,x_=110,df=408,w_=108,pf=407,T_=107,yf=406,I_=106,en=0,Ms=1,ni=2,Ot=3,te=4,si=5,Ls=6,me=7,Le=8,Kt=9,ve=10,he=11,gu=12,mf=Object.freeze({[Le]:40,[Kt]:32,[ve]:16,[he]:40}),vf=Object.freeze({[Le]:20,[Kt]:8,[ve]:16,[he]:20}),E_={[en]:4,[Ms]:4,[ni]:5,[Ot]:20,[te]:10,[si]:1,[Ls]:4,[me]:5,[Le]:20,[Kt]:10,[ve]:5,[he]:5,[gu]:4},bu=[{key:"CAN_BUILD_HOSPITAL",type:gy,label:"Hospital",icon:12,image:Rs,parent:ya,initial:St},{key:"CAN_BUILD_HOUSE",type:Qr,label:"Housing",icon:0,image:vl,parent:0,initial:sr},{key:"CAN_BUILD_LASER_RESEARCH",type:hf,label:"Laser Research",icon:1,image:jt,parent:Qr,initial:sr},{key:"CAN_BUILD_LASER_FACTORY",type:f_,label:"Laser Factory",icon:1,image:kt,parent:hf,initial:St},{key:"CAN_BUILD_BAZOOKA_RESEARCH",type:Nn,label:"Bazooka Research",icon:2,image:jt,parent:Qr,initial:sr},{key:"CAN_BUILD_BAZOOKA_FACTORY",type:d_,label:"Bazooka Factory",icon:2,image:kt,parent:Nn,initial:St},{key:"CAN_BUILD_TURRET_RESEARCH",type:Bn,label:"Turret Research",icon:9,image:jt,parent:Qr,initial:sr},{key:"CAN_BUILD_TURRET_FACTORY",type:p_,label:"Turret Factory",icon:9,image:kt,parent:Bn,initial:St},{key:"CAN_BUILD_CLOAK_RESEARCH",type:Dn,label:"Cloak Research",icon:1,image:jt,parent:Nn,initial:St},{key:"CAN_BUILD_CLOAK_FACTORY",type:y_,label:"Cloak Factory",icon:1,image:kt,parent:Dn,initial:St},{key:"CAN_BUILD_MEDKIT_RESEARCH",type:ya,label:"MedKit Research",icon:3,image:jt,parent:Nn,initial:St},{key:"CAN_BUILD_MEDKIT_FACTORY",type:m_,label:"MedKit Factory",icon:3,image:kt,parent:ya,initial:St},{key:"CAN_BUILD_PLASMA_RESEARCH",type:kn,label:"Plasma Turret Research",icon:10,image:jt,parent:Bn,initial:St},{key:"CAN_BUILD_PLASMA_FACTORY",type:v_,label:"Plasma Turret Factory",icon:10,image:kt,parent:kn,initial:St},{key:"CAN_BUILD_MINE_RESEARCH",type:ma,label:"Mine Research",icon:5,image:jt,parent:Bn,initial:St},{key:"CAN_BUILD_MINE_FACTORY",type:g_,label:"Mine Factory",icon:5,image:kt,parent:ma,initial:St},{key:"CAN_BUILD_ORB_RESEARCH",type:va,label:"Orb Research",icon:6,image:jt,parent:Dn,initial:St},{key:"CAN_BUILD_ORB_FACTORY",type:b_,label:"Orb Factory",icon:6,image:kt,parent:va,initial:St},{key:"CAN_BUILD_BOMB_RESEARCH",type:cf,label:"Time Bomb Research",icon:4,image:jt,parent:Dn,initial:St},{key:"CAN_BUILD_BOMB_FACTORY",type:__,label:"Time Bomb Factory",icon:4,image:kt,parent:cf,initial:St},{key:"CAN_BUILD_SLEEPER_RESEARCH",type:ff,label:"Sleeper Research",icon:8,image:jt,parent:kn,initial:St},{key:"CAN_BUILD_SLEEPER_FACTORY",type:x_,label:"Sleeper Factory",icon:8,image:kt,parent:ff,initial:St},{key:"CAN_BUILD_WALL_RESEARCH",type:df,label:"Wall Research",icon:11,image:jt,parent:kn,initial:St},{key:"CAN_BUILD_WALL_FACTORY",type:w_,label:"Wall Factory",icon:11,image:kt,parent:df,initial:St},{key:"CAN_BUILD_DFG_RESEARCH",type:pf,label:"DFG Research",icon:8,image:jt,parent:ma,initial:St},{key:"CAN_BUILD_DFG_FACTORY",type:T_,label:"DFG Factory",icon:8,image:kt,parent:pf,initial:St},{key:"CAN_BUILD_FLARE_RESEARCH",type:yf,label:"Flare Gun Research",icon:7,image:jt,parent:va,initial:St},{key:"CAN_BUILD_FLARE_FACTORY",type:I_,label:"Flare Gun Factory",icon:7,image:kt,parent:yf,initial:St}],S_=bu.map(i=>({id:i.type,parentid:i.parent??0})),or=bu.reduce((i,e)=>(i[e.key]={ICON:e.icon,IMAGE:e.image,TYPE:e.type,LABEL:e.label},i),{}),A_=Object.freeze(bu.reduce((i,e)=>(i[e.key]=e.initial??St,i),{})),vi={0:{name:"Balkh",tileX:415,tileY:479},1:{name:"Iqaluit",tileX:351,tileY:479},2:{name:"Reykjavik",tileX:287,tileY:479},3:{name:"Jumarity",tileX:223,tileY:479},4:{name:"Helsinki",tileX:159,tileY:479},5:{name:"Copenhagen",tileX:95,tileY:479},6:{name:"Kiev",tileX:31,tileY:479},7:{name:"Barentsburg",tileX:479,tileY:478},8:{name:"Nunivak",tileX:415,tileY:415},9:{name:"Algiers",tileX:351,tileY:415},10:{name:"Paga Pago",tileX:287,tileY:415},11:{name:"St. Johns",tileX:223,tileY:415},12:{name:"Parana",tileX:159,tileY:415},13:{name:"San Salvador de Jujuy",tileX:95,tileY:415},14:{name:"Tallinn",tileX:31,tileY:415},15:{name:"Bergen",tileX:479,tileY:414},16:{name:"Bangui",tileX:415,tileY:351},17:{name:"Annaba",tileX:351,tileY:351},18:{name:"Andorra-la-Vella",tileX:287,tileY:351},19:{name:"Bahia Blanca",tileX:223,tileY:351},20:{name:"Posadas",tileX:159,tileY:351},21:{name:"Santa Fe",tileX:95,tileY:351},22:{name:"Buckland",tileX:31,tileY:351},23:{name:"Kabul",tileX:479,tileY:350},24:{name:"Lahij",tileX:415,tileY:287},25:{name:"Banta",tileX:351,tileY:287},26:{name:"Benguela",tileX:287,tileY:287},27:{name:"Buenos Aires",tileX:223,tileY:287},28:{name:"Resistencia",tileX:159,tileY:287},29:{name:"Santiago del Estero",tileX:95,tileY:287},30:{name:"Armidale",tileX:31,tileY:287},31:{name:"Harbin",tileX:479,tileY:286},32:{name:"Fajardo",tileX:415,tileY:223},33:{name:"Blida",tileX:351,tileY:223},34:{name:"Huambo",tileX:287,tileY:223},35:{name:"Cordoba",tileX:223,tileY:223},36:{name:"Rio Cuarto",tileX:159,tileY:223},37:{name:"Kumayari",tileX:95,tileY:223},38:{name:"Kuala Lumpur",tileX:31,tileY:223},39:{name:"Mango",tileX:479,tileY:222},40:{name:"Arequipa",tileX:415,tileY:159},41:{name:"Constantine",tileX:351,tileY:159},42:{name:"Luanda",tileX:287,tileY:159},43:{name:"Corrientes",tileX:223,tileY:159},44:{name:"Rosario",tileX:159,tileY:159},45:{name:"Kirovakan",tileX:95,tileY:159},46:{name:"Jakarta",tileX:31,tileY:159},47:{name:"Skopje",tileX:479,tileY:158},48:{name:"Bogota",tileX:415,tileY:95},49:{name:"Canberra",tileX:351,tileY:95},50:{name:"Pretoria",tileX:287,tileY:95},51:{name:"Maracay",tileX:223,tileY:95},52:{name:"Cambridge",tileX:159,tileY:95},53:{name:"Laketown",tileX:95,tileY:95},54:{name:"Hanoi",tileX:31,tileY:95},55:{name:"Bishkek",tileX:479,tileY:94},56:{name:"Tirana",tileX:479,tileY:31},57:{name:"Dakar",tileX:415,tileY:31},58:{name:"Aquin",tileX:351,tileY:31},59:{name:"Bismarck",tileX:287,tileY:31},60:{name:"Albany",tileX:223,tileY:31},61:{name:"Manukau",tileX:159,tileY:31},62:{name:"Utrecht",tileX:95,tileY:31},63:{name:"Admin Inn",tileX:31,tileY:31}},Gi=48,C_=3,P_=2,O_=Gi/2,F_=48,gf=F_/2,R_=6.5,M_=5.5,by=i=>{if(i==null)return null;const e=Number(i);return Number.isFinite(e)?String(Math.max(0,Math.floor(e))):null},L_=i=>{if(!i||typeof i!="object")return null;const e=Number(i.pixelX),t=Number(i.pixelY),r=Number(i.tileX),n=Number(i.tileY),s=Number.isFinite(e),o=Number.isFinite(t),a=Number.isFinite(r),l=Number.isFinite(n);if(s&&o)return{x:e,y:t,tileX:a?r:null,tileY:l?n:null};if(a&&l){const u=r*Gi,h=n*Gi,c=u+C_*Gi/2,f=h+P_*Gi+O_;return{x:c-gf-R_,y:f-gf-M_,tileX:r,tileY:n}}return{x:0,y:0,tileX:a?r:null,tileY:l?n:null}},Ns=i=>{const e=by(i);if(e===null)return null;const t=vi?.[e],r=L_(t);if(!r)return null;const n=t?.name||`City ${Number(e)+1}`;return{...r,name:n}},Ft=i=>{const e=by(i);if(e!==null){const r=vi?.[e];if(r?.name)return r.name}const t=Number(i);return Number.isFinite(t)?`City ${Math.max(1,Math.floor(t)+1)}`:"City"},N_=(i,e,t=3)=>{const r=Number(i),n=Number(e);if(!Number.isFinite(r)||!Number.isFinite(n))return null;let s=null,o=1/0;if(Object.keys(vi||{}).forEach(l=>{const u=vi[l];if(!u)return;const h=Number(u.tileX),c=Number(u.tileY);if(!Number.isFinite(h)||!Number.isFinite(c))return;const f=Math.abs(h-r),d=Math.abs(c-n),p=Math.max(f,d);if(!(p>t)){if(p<o)o=p,s=l;else if(p===o){const v=Number(s),m=Number(l);Number.isFinite(m)&&(!Number.isFinite(v)||m<v)&&(s=l)}}}),s==null)return null;const a=Number(s);return Number.isFinite(a)?a:null};function B_(i){for(var e=0;e<512;e++){i.map[e]=[];for(var t=0;t<512;t++)i.map[e][t]=0}}function D_(i){for(var e=0;e<512;e++){i.tiles[e]=[];for(var t=0;t<512;t++)i.tiles[e][t]=0}}function k_(i,e){const r=new Uint8Array(e);for(let n=0;n<512;n++)for(let s=0;s<512;s++){const o=511-n,a=511-s;i.map[n][s]=r[o+a*512]}for(let n=0;n<i.map.length;n++)for(let s=0;s<i.map.length;s++)if(i.map[s][n]===hn){const o=N_(s,n);i.buildingFactory.newBuilding(null,s,n,Fe,{notifyServer:!1,city:o??0,updateCity:!1,itemsLeft:0})}else if(i.map[s][n]===vy||i.map[s][n]===vu){const o=i.map[s][n],a=s===0||i.map[s-1][n]!==o?1:0,l=s===511||i.map[s+1][n]!==o?1:0,u=n===0||i.map[s][n-1]!==o?1:0,h=n===511||i.map[s][n+1]!==o?1:0;i.tiles[s][n]=(a+l*2+h*4+u*8)*48}}const U_=(i,e)=>{B_(i),D_(i),k_(i,e)},X_=[{cityId:55,name:"Sentinel Anchorage"},{cityId:56,name:"Bastion Ridge"},{cityId:57,name:"Citadel Spire"},{cityId:58,name:"Rampart Cove"},{cityId:59,name:"Bulwark Flats"},{cityId:60,name:"Outrider Yard"}],bf={cities:X_},H_=()=>({...A_}),G_=()=>({canBuild:H_(),cash:l_,income:0,itemProduction:0,research:0,hospital:0,construction:0,grossIncome:0});function Y_(i){if(!i||!Array.isArray(i.cities))return;(Array.isArray(bf?.cities)?bf.cities:[]).forEach(t=>{const r=Number(t?.cityId);if(!Number.isFinite(r))return;const n=i.cities[r];n&&(t?.name&&(n.name=t.name),n.isFakeCandidate=!0)})}function z_(i){i.cities=[],Object.keys(vi||{}).forEach(e=>{const t=Number(e);if(!Number.isFinite(t))return;const r=vi[e],n=Ns(t),s=G_();s.id=t;const o=Number(r?.tileX),a=Number(r?.tileY),l=Number.isFinite(o)?o:n?.tileX??0,u=Number.isFinite(a)?a:n?.tileY??0;s.tileX=l,s.tileY=u,s.x=l*48,s.y=u*48,s.name=Ft(t),i.cities[t]=s})}const V_=i=>{z_(i),Y_(i)},$e=(i,e)=>{if(!i||!e)return!1;const t=i.x,r=i.y,n=t+i.w,s=r+i.h,o=e.x,a=e.y,l=o+e.w,u=a+e.h;return!(n<=o||l<=t||s<=a||u<=r)},_y=i=>i.x<0?du:i.x>510*48?pu:i.y<0?yu:i.y>510*48?mu:!1,xy=(i,e)=>{var t=i.itemFactory.getHead();const r=i.player?.city??null;for(;t;){var n={x:t.x,y:t.y,w:48,h:48};if($e(e,n)){if(t.type===te&&t.active!==!1){const s=t.teamId??null;if(s===null||s!==r)return i.player.collidedItem=t,Se}else if(t.type===me&&t.active!==!1){const s=t.teamId??t.city??null;if(s===null||s!==r)return i.player.collidedItem=t,ir}else if(t.active!==!1&&t.type!==me)return Xe}t=t.next}return!1},wy=(i,e)=>{var t=i.map,r=Math.floor(e.x/48),n=Math.floor((e.x+e.w)/48),s=Math.floor(e.y/48),o=Math.floor((e.y+e.h)/48);if(r&&n&&s&&o)try{if(t[r][s]!=0&&t[r][s]!=3||t[r][o]!=0&&t[r][o]!=3||t[n][s]!=0&&t[n][s]!=3||t[n][o]!=0&&t[n][o]!=3)return Xe}catch{console.error("Invalid map reference")}return!1},hr=i=>{var e=8;return{x:parseInt(i.offset.x+e),y:parseInt(i.offset.y+e),w:48-e-e,h:48-e-e}},Bi=48,q_=i=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const e=Number(i);if(Number.isFinite(e))return e}return NaN},$_=new Set([gy,301,401]),_u=i=>{const e=i&&typeof i=="object"?i.type:i,t=q_(e);return Number.isFinite(t)?$_.has(t)?!0:Math.floor(t/100)===Rs&&t>=200&&t<300:!1},j_=i=>{if(!i)return null;const e=Number.isFinite(i.x)?i.x:parseInt(i.x,10)||0,t=Number.isFinite(i.y)?i.y:parseInt(i.y,10)||0;return{x:e*Bi,y:t*Bi+Bi*2,w:Bi*3,h:Bi}};var W_=(i,e)=>{for(var t=i.buildingFactory.getHead();t;){var r={x:t.x*48,y:t.y*48,w:144,h:144};const n=Number(t.type),s=Number.isFinite(n)?Math.floor(n/100):NaN;if((n===Fe||s===kt||_u(n))&&(r.h=Math.max(0,r.h-48)),$e(e,r))return Xe;t=t.next}return!1};const De=i=>{var e=hr(i.player);i.player.collidedItem=null;var t=_y(e);return t||(t=wy(i,e)),t||(t=W_(i,e)),t||(t=xy(i,e)),t},ga=()=>typeof window<"u",Wr=(i,e=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const t=Number(i);if(Number.isFinite(t))return t}return e},ct={LASER:"laser",ROCKET:"rocket",TURRET:"turret",FLARE:"flare",ENGINE:"engine",EXPLOSION:"explosion",BUILD:"build",DEMOLISH:"demolish",HIT:"hit",DIE:"die",BUZZ:"buzz",CLICK:"click",SCREECH:"screech",CLOAK:"cloak",FIRE:"fire"},K_={[ct.LASER]:{src:new URL("/wav/laser.wav",import.meta.url).href,volume:.58,maxDistance:2e3,spatial:!0},[ct.ROCKET]:{src:new URL("/wav/bturr.wav",import.meta.url).href,volume:.68,maxDistance:2100,spatial:!0},[ct.TURRET]:{src:new URL("/wav/turretfire.wav",import.meta.url).href,volume:.62,maxDistance:1900,spatial:!0},[ct.FLARE]:{src:new URL("/flare.wav",import.meta.url).href,volume:.55,maxDistance:1900,spatial:!0},[ct.ENGINE]:{src:new URL("/wav/engine.wav",import.meta.url).href,volume:.3,loop:!0,spatial:!1},[ct.EXPLOSION]:{src:new URL("/wav/explode.wav",import.meta.url).href,volume:.7,maxDistance:2400,spatial:!0},[ct.BUILD]:{src:new URL("/wav/build.wav",import.meta.url).href,volume:.55,maxDistance:1400,spatial:!0},[ct.DEMOLISH]:{src:new URL("/wav/demo.wav",import.meta.url).href,volume:.65,maxDistance:1800,spatial:!0},[ct.HIT]:{src:new URL("/wav/hit.wav",import.meta.url).href,volume:.7,spatial:!1},[ct.DIE]:{src:new URL("/wav/die.wav",import.meta.url).href,volume:.75,spatial:!1},[ct.BUZZ]:{src:new URL("/wav/buzz.wav",import.meta.url).href,volume:.5,spatial:!1},[ct.CLICK]:{src:new URL("/wav/click.wav",import.meta.url).href,volume:.5,spatial:!1},[ct.SCREECH]:{src:new URL("/wav/screech.wav",import.meta.url).href,volume:.7,spatial:!1},[ct.CLOAK]:{src:new URL("/cloak.wav",import.meta.url).href,volume:.6,spatial:!1},[ct.FIRE]:{src:new URL("/wav/fire.wav",import.meta.url).href,volume:.55,maxDistance:1600,spatial:!0}},Z_=2400,_f=.001,Un=(i,e,t)=>Math.max(e,Math.min(t,i));class J_{constructor(e={}){this.enabled=e.enabled!==void 0?!!e.enabled:!0,this.defaultMaxDistance=Wr(e.defaultMaxDistance,Z_),this.definitions=e.definitions||K_,this.buffers=new Map,this.loading=new Map,this.loopSources=new Map,this.listenerPosition={x:0,y:0},this.pendingQueue=[],this.unlockBound=!1,this.context=null}isSupported(){return!(!ga()||typeof window.AudioContext>"u"&&typeof window.webkitAudioContext>"u")}getContext(){if(!this.enabled)return null;if(!this.isSupported())return this.enabled=!1,null;if(this.context)return this.context;const e=window.AudioContext||window.webkitAudioContext;return e?(this.context=new e,this.context):(this.enabled=!1,null)}async resumeContext(){const e=this.getContext();if(!e)return!1;if(e.state==="suspended")try{await e.resume()}catch(t){return console.warn("Unable to resume audio context",t),!1}return e.state==="running"}enqueuePlayback(e){typeof e=="function"&&(this.pendingQueue.push(e),this.bindGestureUnlock())}flushQueue(){if(!this.pendingQueue.length)return;this.pendingQueue.splice(0,this.pendingQueue.length).forEach(t=>{try{t()}catch(r){console.warn("Deferred audio callback failed",r)}})}bindGestureUnlock(){if(!ga()||this.unlockBound)return;const e=async()=>{await this.resumeContext(),this.flushQueue()},t=async r=>{try{await e(r)}finally{this.unbindGestureUnlock()}};this.unlockBound=!0,this.unlockHandler=t,["pointerdown","touchstart","keydown"].forEach(r=>{window.addEventListener(r,t,{once:!0,passive:!0})})}unbindGestureUnlock(){if(!ga()||!this.unlockBound||!this.unlockHandler){this.unlockBound=!1,this.unlockHandler=null;return}["pointerdown","touchstart","keydown"].forEach(e=>{window.removeEventListener(e,this.unlockHandler)}),this.unlockBound=!1,this.unlockHandler=null}async preloadAll(){const e=Object.entries(this.definitions);await Promise.all(e.map(([t,r])=>this.loadDefinition(t,r)))}async loadDefinition(e,t){if(!this.enabled)return null;if(this.buffers.has(e))return this.buffers.get(e);if(!t||!t.src)return null;if(this.loading.has(e))return this.loading.get(e);const r=this.fetchAndDecode(t.src).then(n=>(n&&this.buffers.set(e,n),n)).finally(()=>{this.loading.delete(e)});return this.loading.set(e,r),r}async fetchAndDecode(e){try{const t=this.getContext();if(!t)return null;const r=await fetch(e);if(!r.ok)throw new Error(`Failed to fetch audio: ${r.status}`);const n=await r.arrayBuffer();return await t.decodeAudioData(n)}catch(t){return console.warn("Failed to load audio asset",e,t),null}}setListenerPosition(e,t){this.listenerPosition={x:Wr(e,this.listenerPosition.x),y:Wr(t,this.listenerPosition.y)}}calculateSpatialParams(e,t,r={}){const n=this.definitions[e]||{};if(!(r.spatial??n.spatial??!1)||!t)return{volume:r.volume??n.volume??1,pan:0};const o=this.listenerPosition||{x:0,y:0},a=Wr(t.x,0)-o.x,l=Wr(t.y,0)-o.y,u=Math.sqrt(a*a+l*l),h=Wr(r.maxDistance,n.maxDistance??this.defaultMaxDistance);if(h<=0)return{volume:0,pan:0};const f=1-Un(u/h,0,1),d=r.volume??n.volume??1,p=Un(d*(f*f),0,d),v=Un(a/h,-1,1);return{volume:p,pan:v}}buildNodeGraph(e,t,r){const n=e.createGain();if(n.gain.value=Math.max(r.volume,_f),e.createStereoPanner){const s=e.createStereoPanner();s.pan.value=Un(r.pan??0,-1,1),t.connect(s),s.connect(n)}else t.connect(n);return n.connect(e.destination),n}playEffect(e,t={}){if(!this.enabled)return null;const r=this.definitions[e];if(!r)return null;const n=this.getContext();if(!n)return null;const s=()=>{const a=this.buffers.get(e);if(!a)return null;const l=n.createBufferSource();l.buffer=a,l.loop=!!(t.loop||r.loop);const u=this.calculateSpatialParams(e,t.position,t);if(u.volume=t.volume??u.volume??r.volume??1,u.volume<=_f)return null;const h=this.buildNodeGraph(n,l,u);return l.start(0),l.loop?this.loopSources.set(e,{source:l,gainNode:h,options:{...t}}):l.onended=()=>{this.loopSources.get(e)?.source===l&&this.loopSources.delete(e)},l};return n.state==="suspended"?(this.enqueuePlayback(()=>this.playEffect(e,t)),null):this.buffers.get(e)?s():(this.loadDefinition(e,r).then(()=>{s()}),null)}stopEffect(e){const t=this.loopSources.get(e);if(t){try{t.source.stop()}catch(r){console.debug("Failed stopping loop",e,r)}this.loopSources.delete(e)}}setLoopState(e,t,r={}){return t?this.loopSources.has(e)?this.loopSources.get(e).source:this.playEffect(e,{...r,loop:!0,spatial:!1}):(this.stopEffect(e),null)}}const rr=48,Ty=12,Q_=150,tx=2,ex=new Set([Xe,du,pu,yu,mu]),Iy=[{dx:1,dy:0},{dx:-1,dy:0},{dx:0,dy:1},{dx:0,dy:-1},{dx:1,dy:1},{dx:-1,dy:1},{dx:1,dy:-1},{dx:-1,dy:-1}],xf=6,rx=96,Ee=i=>{!i||!i.player||(i.player.lastSafeOffset={x:i.player.offset.x,y:i.player.offset.y})},ix=i=>{if(!i||!i.player||!i.buildingFactory||typeof i.buildingFactory.findBuildingAtTile!="function")return;const e=hr(i.player),t=e.x+e.w/2,r=e.y+e.h/2,n=Math.floor(t/rr),s=Math.floor(r/rr),o=i.buildingFactory.findBuildingAtTile(n,s);if(!_u(o))return;const a=j_(o);if(!a||!$e(e,a)||!Number.isFinite(i.player.health)||i.player.health>=mi)return;const l=i.tick||Date.now(),u=Number.isFinite(i.player.lastHospitalHealAt)?i.player.lastHospitalHealAt:0;if(l<u+Q_)return;const h=i.player.health;i.player.health=Math.min(mi,h+tx),i.player.lastHospitalHealAt=l,i.player.health!==h&&(i.forceDraw=!0)},wr=i=>ex.has(i),nr=(i,e)=>{e&&(i.itemFactory.triggerMine(e),i.forceDraw=!0,i.player.collidedItem=null)},Tr=(i,e)=>{e&&(typeof i.itemFactory?.triggerDFG=="function"&&i.itemFactory.triggerDFG(e),i.player.collidedItem=null)};var nx=i=>{i.tick>i.player.timeTurn&&(i.player.direction+=i.player.isTurning,i.player.direction<0&&(i.player.direction=31),i.player.direction>31&&(i.player.direction=0),i.player.timeTurn=i.tick+50)},sx=i=>{i.player.offset.x,i.player.offset.y;var e=-i.player.direction,t=Math.sin(e/16*3.14)*i.player.isMoving*(i.timePassed*yl);t>20&&(t=20),t<-20&&(t=-20);var r=i.player.offset.x;switch(i.player.offset.x+=t,De(i)){case du:i.player.offset.x=0;break;case pu:i.player.offset.x=511*48;break;case Xe:i.player.offset.x=r;break;case Se:nr(i,i.player.collidedItem);break;case ir:Tr(i,i.player.collidedItem);break}t=Math.cos(e/16*3.14)*i.player.isMoving*(i.timePassed*yl),t>20&&(t=20),t<-20&&(t=-20);var r=i.player.offset.y;switch(i.player.offset.y+=t,De(i)){case yu:i.player.offset.y=0;break;case mu:i.player.offset.y=511*48;break;case Xe:i.player.offset.y=r;break;case Se:nr(i,i.player.collidedItem);break;case ir:Tr(i,i.player.collidedItem);break}i&&i.debug&&i.debug.logMovement};const ox=(i,e)=>{for(let t=xf;t<=rx;t+=xf)for(const r of Iy){const n=e.x+r.dx*t,s=e.y+r.dy*t;i.player.offset.x=n,i.player.offset.y=s;const o=De(i);if(o===Se)return nr(i,i.player.collidedItem),Ee(i),!0;if(!wr(o))return Ee(i),!0}return!1},wf=(i,e,t=Ty)=>{if(!i||!i.player||!Array.isArray(i.map))return null;const r=i.map.length,n=r>0&&Array.isArray(i.map[0])?i.map[0].length:0;if(r===0||n===0)return null;const s=Math.floor((e.x+rr/2)/rr),o=Math.floor((e.y+rr/2)/rr),a=[{x:s,y:o,distance:0}],l=new Set,u={x:i.player.offset.x,y:i.player.offset.y},h=i.player.collidedItem;for(;a.length;){const c=a.shift(),f=`${c.x},${c.y}`;if(l.has(f)||(l.add(f),c.distance>t)||c.x<0||c.y<0||c.x>=r||c.y>=n)continue;const d={x:c.x*rr,y:c.y*rr};i.player.offset.x=d.x,i.player.offset.y=d.y;const p=De(i),v=i.player.collidedItem;if(i.player.offset.x=u.x,i.player.offset.y=u.y,i.player.collidedItem=h,p!==Se){if(!wr(p))return{offset:d,collision:p,collidedItem:v}}Iy.forEach(({dx:m,dy:g})=>{const E={x:c.x+m,y:c.y+g,distance:c.distance+1},I=`${E.x},${E.y}`;l.has(I)||a.push(E)})}return null},ax=i=>{if(!i||!i.player)return;const e=Ns(i.player.city);if(e){i.player.offset.x=e.x,i.player.offset.y=e.y;return}const t=i.cities?.[i.player.city];if(t){i.player.offset.x=t.x+48,i.player.offset.y=t.y+100;return}i.player.offset.x=0,i.player.offset.y=0},lx=i=>{if(!i||!i.player)return;const e=De(i);if(e===Se){nr(i,i.player.collidedItem);return}if(e===ir){Tr(i,i.player.collidedItem);return}if(!wr(e)){Ee(i);return}const t={x:i.player.offset.x,y:i.player.offset.y},r=i.player.lastSafeOffset?{...i.player.lastSafeOffset}:null;if(ox(i,t))return;const n=wf(i,t);if(n){i.player.offset.x=n.offset.x,i.player.offset.y=n.offset.y;const a=De(i);if(a===Se){nr(i,i.player.collidedItem);return}if(a===ir){Tr(i,i.player.collidedItem);return}if(!wr(a)){Ee(i);return}}if(r&&(r.x!==t.x||r.y!==t.y)){i.player.offset.x=r.x,i.player.offset.y=r.y;const a=De(i);if(a===Se){nr(i,i.player.collidedItem),Ee(i);return}if(a===ir){Tr(i,i.player.collidedItem),Ee(i);return}if(!wr(a)){Ee(i);return}}i.player.offset.x=t.x,i.player.offset.y=t.y,ax(i);const s=De(i);if(s===Se){nr(i,i.player.collidedItem);return}if(s===ir){Tr(i,i.player.collidedItem);return}if(!wr(s)){Ee(i);return}const o=wf(i,i.player.offset,Ty*2);if(o){i.player.offset.x=o.offset.x,i.player.offset.y=o.offset.y;const a=De(i);if(a===Se){nr(i,i.player.collidedItem);return}if(a===ir){Tr(i,i.player.collidedItem);return}if(!wr(a)){Ee(i);return}}Ey(i)};var Ey=i=>{i.player.offset.x=0,i.player.offset.y=0,i.player.engineLoopActive&&(i.player.engineLoopActive=!1),i.audio&&i.audio.setLoopState(ct.ENGINE,!1),Ee(i)};const ux=i=>{const e=i.tick||Date.now();i.player.isCloaked&&i.player.cloakExpiresAt&&e>=i.player.cloakExpiresAt&&(i.player.isCloaked=!1,i.player.cloakExpiresAt=0,i.forceDraw=!0);let t=!1;if(i.player.isFrozen&&(!i.player.frozenUntil||e>=i.player.frozenUntil?(i.player.isFrozen=!1,i.player.frozenUntil=0,i.player.frozenBy=null):t=!0),i.player.isTurning&&nx(i),!t&&i.player.isMoving?sx(i):t&&(i.player.isMoving=0),ix(i),t||lx(i),i&&i.audio&&i.player&&Number.isFinite(i.player.offset?.x)&&Number.isFinite(i.player.offset?.y)){const r=i.player.offset.x+24,n=i.player.offset.y+24;i.audio.setListenerPosition(r,n);const s=!t&&!!i.player.isMoving&&i.player.health>0;s&&!i.player.engineLoopActive?(i.audio.setLoopState(ct.ENGINE,!0,{volume:.3}),i.player.engineLoopActive=!0):(!s||i.player.health<=0)&&i.player.engineLoopActive&&(i.audio.setLoopState(ct.ENGINE,!1),i.player.engineLoopActive=!1)}i.player.health===0&&Ey(i)},hx=new Set([Kt,he,te,Le,ve]);var Xn=0;const Tf=i=>{if(!i)return!1;const e=i.target;if(!e)return!1;const t=e.tagName?e.tagName.toLowerCase():"";return!!(t==="input"||t==="textarea"||t==="select"||e.isContentEditable)},ba=(i,e)=>{if(!i||!i.player||i.player.id===void 0||i.player.id===null||!i.iconFactory||typeof i.iconFactory.findOwnedIconByType!="function")return!1;const t=i.iconFactory.findOwnedIconByType(i.player.id,e);if(!t)return!1;if(t.quantity===void 0||t.quantity===null)return!0;const r=Number.isFinite(t.quantity)?t.quantity:parseInt(t.quantity,10);return Number.isFinite(r)?r>0:!0},If=(i,e,t)=>{!i||!i.audio||!e||(t&&Number.isFinite(t.x)&&Number.isFinite(t.y)?i.audio.playEffect(e,{position:t}):i.audio.playEffect(e))};var ae=i=>{var e={};return e.code=i,e.isDown=!1,e.isUp=!0,e.press=void 0,e.release=void 0,e.downHandler=function(t){Tf(t)||t.keyCode===e.code&&(e.isUp&&e.press&&e.press(),e.isDown=!0,e.isUp=!1,t.preventDefault())},e.upHandler=function(t){Tf(t)||t.keyCode===e.code&&(e.isDown&&e.release&&e.release(),e.isDown=!1,e.isUp=!0,t.preventDefault())},window.addEventListener("keydown",e.downHandler.bind(e),!1),window.addEventListener("keyup",e.upHandler.bind(e),!1),e};const cx=i=>{var e=ae(37),t=ae(38),r=ae(39),n=ae(40),s=ae(16),o=ae(17),a=ae(85);ae(79);var l=ae(68),u=ae(83),h=ae(66),c=ae(72),f=ae(67);e.press=function(){i.player.isTurning=-1},e.release=function(){i.player.isTurning=0},r.press=function(){i.player.isTurning=1},r.release=function(){i.player.isTurning=0},t.press=function(){i.player.isMoving=-1},t.release=function(){i.player.isMoving=0},n.press=function(){i.player.isMoving=1},n.release=function(){i.player.isMoving=0},a.press=function(){i.iconFactory.pickupIcon()},u.press=function(){console.log("Generating building output"),i.buildingFactory.outputBuildings()},l.press=function(){var d=i.iconFactory.dropSelectedIcon(),p,v,m=-i.player.direction,g=Math.sin(m/16*3.14)*-1,E=Math.cos(m/16*3.14)*-1;if(d&&hx.has(d.type))p=i.player.offset.x+12,v=i.player.offset.y+24;else{var m=-i.player.direction,g=Math.sin(m/16*3.14)*-1,E=Math.cos(m/16*3.14)*-1;p=i.player.offset.x+g*20,v=i.player.offset.y+20+E*20}if(d){var I=i.itemFactory.newItem(d,p,v,d.type);I&&(i.player.offset.x+=30,i.player.offset.x+=30),I||i.iconFactory.newIcon(null,parseInt(p),parseInt(v),d.type,{skipProductionUpdate:!0,teamId:i.player.city??null,city:i.player.city??null})}},h.press=function(){if(i.iconFactory&&typeof i.iconFactory.getSelectedIcon=="function"){const d=i.iconFactory.getSelectedIcon(i.player.id);if(d&&d.type===Ot){d.armed=!d.armed,d.selected||(d.selected=!0),i.player.bombsArmed=d.armed,i.forceDraw=!0,console.log(`Bombs ${d.armed?"activated":"deactivated"}`);return}}i.player.bombsArmed=!i.player.bombsArmed,console.log(`Bombs ${i.player.bombsArmed?"activated":"deactivated"}`)},c.press=function(){!i?.itemFactory||typeof i.itemFactory.useMedkit!="function"||i.itemFactory.useMedkit()},f.press=function(){!i?.itemFactory||typeof i.itemFactory.activateCloak!="function"||i.itemFactory.activateCloak()},o.press=function(){if(!ba(i,Ls)||i.tick<=Xn||!i||!i.player||i.player.isFrozen&&(i.player.frozenUntil??0)>i.tick)return;const d=Math.round(i.player.direction)%32,p=(d+16+32)%32,v=(d+20+32)%32,m=(d+12+32)%32,g=[v,p,m],I=p/32*360*Math.PI/180,M=Math.sin(I),_=Math.cos(I)*-1,F=i.player.offset.x+24+M*30,C=i.player.offset.y+24+_*30,H=i.player.city??null;Xn=i.tick+n_,g.forEach(R=>{const N={shooter:i.player.id,x:F,y:C,type:3,angle:-R,team:H};i.bulletFactory.newBullet(i.player.id,F,C,3,-R,H),i.socketListener.sendBulletShot(N)}),If(i,ct.FLARE,{x:F,y:C})},s.press=function(){if(i?.player?.isFrozen&&(i.player.frozenUntil??0)>(i.tick||Date.now()))return;const d=ba(i,Ms),p=ba(i,gu),v=(i?.player?.isMoving??0)===0,m=d&&v;if(!m&&!p){console.log(d&&!v?"Cougar Missiles only fire while stationary.":"Weapon unavailable: pick up a Laser or Cougar Missile.");return}const g=m?i_:r_,E=m?1:0;if(console.log("shift key pressed"),i.tick>Xn){Xn=i.tick+g;var I=i.player.direction,M=I/32*360,_=Math.sin(M*3.14/180),F=Math.cos(M*3.14/180)*-1,C=i.player.offset.x+24+_*30,H=i.player.offset.y+24+F*30;const R=i.player.city??null;i.bulletFactory.newBullet(i.player.id,C,H,E,-I,R);const N=m?ct.ROCKET:ct.LASER;If(i,N,{x:C,y:H}),i.socketListener.sendBulletShot({shooter:i.player.id,x:C,y:H,type:E,angle:-I,team:R})}}},fx=i=>{let e=new $.Container;e.hitArea=new $.Rectangle(0,0,i.maxMapX,i.maxMapY),e.interactive=!0,e.cursor="cursor",i.stage.addChild(e),i.interactionLayer=e,e.on("mousedown",t=>{if(console.log("Got mouse down event"),i.isBuilding&&i.isDragging){var r=Math.floor(i.player.offset.x%48),n=Math.floor(i.player.offset.y%48),s=Math.floor((i.player.offset.x-i.player.defaultOffset.x+r+t.data.global.x)/48),o=Math.floor((i.player.offset.y-i.player.defaultOffset.y+n+t.data.global.y)/48);i.buildingFactory.newBuilding(i.player.id,s,o,i.isBuilding)&&(i.map[s][o]=hn,i.tiles[s][o]=i.isBuilding,i.forceDraw=!0,i.clearGhostBuilding&&i.clearGhostBuilding());return}if(i.isDemolishing||(i.showBuildMenu=!i.showBuildMenu,i.forceDraw=!0,i.buildMenuOffset={x:t.data.global.x,y:t.data.global.y}),i.isDemolishing){console.log("Trying to demolish building");var a=Math.floor(i.player.offset.x%48),l=Math.floor(i.player.offset.y%48),u=Math.floor((i.player.offset.x-i.player.defaultOffset.x+a+t.data.global.x)/48),h=Math.floor((i.player.offset.y-i.player.defaultOffset.y+l+t.data.global.y)/48);i.buildingFactory.demolishBuilding(u,h),i.isDemolishing=!1,i.stage.cursor="cursor",i.interactionLayer.cursor="cursor"}}),e.on("rightdown",t=>{t.stopPropagation&&t.stopPropagation(),t.data&&t.data.originalEvent&&t.data.originalEvent.preventDefault&&t.data.originalEvent.preventDefault(),i.isBuilding&&i.clearGhostBuilding&&i.clearGhostBuilding(),i.isDemolishing&&(i.isDemolishing=!1,i.stage.cursor="cursor",i.interactionLayer.cursor="cursor");const r=t&&t.data?t.data.global:null;if(!r){typeof i.clearPanelMessage=="function"&&i.clearPanelMessage();return}if(r.x<0||r.y<0||r.x>i.maxMapX||r.y>i.maxMapY){typeof i.clearPanelMessage=="function"&&i.clearPanelMessage();return}const n=Math.floor(i.player.offset.x%48),s=Math.floor(i.player.offset.y%48),o=Math.floor((i.player.offset.x-i.player.defaultOffset.x+n+r.x)/48),a=Math.floor((i.player.offset.y-i.player.defaultOffset.y+s+r.y)/48),l=i.buildingFactory,u=l&&l.findBuildingAtTile?l.findBuildingAtTile(o,a):null;if(!u){typeof i.clearPanelMessage=="function"&&i.clearPanelMessage();return}const h=Number.isFinite(u.city)?u.city:parseInt(u.city,10),c=Number.isFinite(h)?h:0;i.socketListener&&typeof i.socketListener.requestCityInfo=="function"&&i.socketListener.requestCityInfo(c),typeof i.showCityInfo=="function"&&i.showCityInfo(c,{source:"local",building:u})}),typeof window<"u"&&(window.__battlecityContextMenuHandler||(window.__battlecityContextMenuHandler=t=>{const r=document.getElementById("game");r&&r.contains(t.target)&&t.preventDefault()},window.addEventListener("contextmenu",window.__battlecityContextMenuHandler)))};var Ef=0,Sf=0,Af=0,Cf=0;const Sy=(i,e)=>{var t=i.player.offset.x%128,r=i.player.offset.y%128;if(i.player.offset.x/128>Sf||i.player.offset.x/128<Ef||i.player.offset.y/128>Cf||i.player.offset.y/128<Af){Ef=i.player.offset.x/128-5,Sf=i.player.offset.x/128+5,Af=i.player.offset.y/128-5,Cf=i.player.offset.y/128+5,e.clear();for(var n=-12;n<12;n++)for(var s=-12;s<12;s++)e.addFrame(i.textures.groundTexture,n*128,s*128);e.position.set(i.player.defaultOffset.x+i.player.offset.x-t,i.player.defaultOffset.y+i.player.offset.y-r)}e.pivot.set(i.player.offset.x,i.player.offset.y)};var Ay=0,Cy=0,Py=0,Oy=0;const dt=48,Hn=24,ti=40,dx=Object.freeze({fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:15922943,align:"center",stroke:0,strokeThickness:4,lineHeight:16,wordWrap:!0,wordWrapWidth:120}),px=2,yx=-32,mx=i=>{if(i.tileLayer||(i.tileLayer=new $.tilemap.CompositeRectTileLayer(0,null,!0),i.addChild(i.tileLayer)),i.edgeOverlay)i.edgeOverlay.parent||i.addChild(i.edgeOverlay);else{const e=new $.Graphics;e.alpha=1,i.edgeOverlay=e,i.addChild(e)}if(!i.commandCenterLabelLayer){const e=new $.Container;e.name="commandCenterLabelLayer",i.commandCenterLabelLayer=e,i.addChild(e)}};var vx=(i,e,t,r,n,s)=>{var o=new $.Texture(i.textures.lavaTexture.baseTexture,new $.Rectangle(i.tiles[n][s],0,dt,dt));e.addFrame(o,t*dt,r*dt)},gx=(i,e,t,r,n,s)=>{var o=new $.Texture(i.textures.rockTexture.baseTexture,new $.Rectangle(i.tiles[n][s],0,dt,dt));e.addFrame(o,t*dt,r*dt)},bx=(i,e,t,r,n,s)=>{var o=i.tiles[n][s],a=o%100,l=parseInt(o/100,10);const u=i.buildingFactory.getBuildingByCoord(n,s);var h=new $.Texture(i.textures.buildings.baseTexture,new $.Rectangle(0,l*144,144,144,144));e.addFrame(h,t*dt,r*dt,1,0);let c=null;try{c=new $.Texture(i.textures.imageItems.baseTexture,new $.Rectangle(a*32,0,32,32))}catch{c=null}if(c)switch(l){case jt:e.addFrame(c,t*dt+14,r*dt+98);break;case kt:e.addFrame(c,t*dt+56,r*dt+52);break}if(u&&u.population>0&&i.textures.population){const f=dt,d=dt,v=7-1,m=u?Math.floor(Number(u.type)/100):l,g=m===vl,E=m===Fe,I=g?h_:c_;if(I>0){const M=Math.max(0,Math.min(I,u.population)),F=Math.min(v,Math.floor(M*v/I)),C=E?1:0,H=new $.Texture(i.textures.population.baseTexture,new $.Rectangle(F*f,C*d,f,d)),R={[Fe]:{x:96,y:49},[kt]:{x:96,y:48},[Rs]:{x:96,y:48},[vl]:{x:96,y:90},[jt]:{x:96,y:90}},{x:N=96,y:Y=48}=R[m]||R[l]||{x:96,y:48},D=t*dt+N,J=r*dt+Y;e.addFrame(H,D,J)}}if(l===kt&&u&&u.smokeActive&&i.textures.smoke){const f=Math.max(0,(u.smokeFrame||1)-1),d=new $.Texture(i.textures.smoke.baseTexture,new $.Rectangle(0,f*60,180,60)),p=t*dt+6,v=r*dt-15;e.addFrame(d,p,v)}if(l===kt&&u&&typeof u.itemsLeft=="number"&&i.textures.blackNumbers){const f=Math.max(0,Math.min(99,Math.floor(u.itemsLeft))),d=Math.floor(f/10),p=f%10,v=(m,g)=>{const E=new $.Texture(i.textures.blackNumbers.baseTexture,new $.Rectangle(m*16,0,16,16));e.addFrame(E,t*dt+g,r*dt+84)};v(d,56),v(p,72)}};const Pf=(i,e=0)=>{const t=Number(i);return Number.isFinite(t)?t:e},_x=i=>{if(!i||!i.buildingFactory)return;const e=i.commandCenterLabelLayer;if(!e)return;i.commandCenterLabelCache||(i.commandCenterLabelCache=new Map);const t=i.commandCenterLabelCache,r=new Set,n=Number.isFinite(i.player?.offset?.x)?i.player.offset.x:0,s=Number.isFinite(i.player?.offset?.y)?i.player.offset.y:0,o=Number.isFinite(i.player?.defaultOffset?.x)?i.player.defaultOffset.x:0,a=Number.isFinite(i.player?.defaultOffset?.y)?i.player.defaultOffset.y:0,l=o-n,u=a-s;let h=typeof i.buildingFactory.getHead=="function"?i.buildingFactory.getHead():null;for(;h;){const c=Number(h.type),f=Number.isFinite(c)?Math.floor(c/100):null;if(c===Fe||f===Fe){const p=h.id||`${h.x}_${h.y}`;r.add(p);const v=Pf(h.x,0),m=Pf(h.y,0),g=(v+1.5)*dt,E=(m+1.5)*dt,I=g+l,M=E+u,_=Ft(h.city??0),F=Math.abs(g-n)<=ti*dt&&Math.abs(E-s)<=ti*dt;let C=t.get(p);if(C)C.text!==_&&(C.label.text=_,C.text=_);else{const H=new $.Text(_,dx);H.anchor.set(.5),H.resolution=px,e.addChild(H),C={label:H,text:_},t.set(p,C)}C.label.visible=F,C.label.x=I,C.label.y=M+yx}h=h.next}t.forEach((c,f)=>{r.has(f)||(c&&c.label&&(c.label.parent&&c.label.parent.removeChild(c.label),c.label.destroy()),t.delete(f))})},xx=i=>{if(!i?.commandCenterLabelCache)return;const e=i.commandCenterLabelCache,t=i.tick||Date.now();e.forEach((r,n)=>{if(!r||!r.label){e.delete(n);return}!r.label.visible&&r.lastHiddenAt&&t-r.lastHiddenAt>1e3?(r.label.parent&&r.label.parent.removeChild(r.label),r.label.destroy(),e.delete(n)):r.label.visible?r.lastHiddenAt&&(r.lastHiddenAt=null):r.lastHiddenAt=t})};var wx=i=>{const e=i.player.offset.x/dt,t=i.player.offset.y/dt;Ay=e-Hn,Cy=e+Hn,Py=t-Hn,Oy=t+Hn},Tx=i=>{if(i.forceDraw)return!0;const e=i.player.offset.x/dt,t=i.player.offset.y/dt;return e>=Cy||e<=Ay||t>=Oy||t<=Py};const Fy=(i,e)=>{if(!i||!e||!i.map||!i.map.length)return;mx(e),_x(i);const t=e.tileLayer,r=e.edgeOverlay;if(!(!t||!r)){var n=Math.floor(i.player.offset.x%dt),s=Math.floor(i.player.offset.y%dt);if(Tx(i)){wx(i),t.clear(),r.clear(),r.beginFill(0,1);for(var o=Math.floor(i.player.offset.x/dt),a=Math.floor(i.player.offset.y/dt),l=i.map.length,u=Array.isArray(i.map[0])?i.map[0].length:0,h=-ti;h<ti;h++)for(var c=-ti;c<ti;c++){var f=o+h,d=a+c;if(f<0||d<0||f>=l||d>=u){r.drawRect(h*dt,c*dt,dt,dt);continue}i.map[f][d]==vy&&vx(i,t,h,c,f,d),i.map[f][d]==vu&&gx(i,t,h,c,f,d),i.map[f][d]>=hn&&bx(i,t,h,c,f,d)}r.endFill(),e.position.set(i.player.defaultOffset.x+i.player.offset.x-n,i.player.defaultOffset.y+i.player.offset.y-s)}e.pivot.set(i.player.offset.x,i.player.offset.y),xx(i)}},Of={small:{frameSize:48,totalFrames:10,duration:100,textureKey:"imageSExplosion",fallbackKey:"imageLEExplosion"},large:{frameSize:144,totalFrames:8,duration:90,textureKey:"imageLEExplosion",fallbackKey:"imageSExplosion"}},Ix=100,Ex=-6,Gn=Object.freeze({ally:15922943,enemy:16765286,rogue:16743034,neutral:16777215}),Sx=15e3,gl=i=>{const e=Number(i);return Number.isFinite(e)?Math.max(0,Math.floor(e)):null},Ax=(i,e)=>{if(!e)return null;if(typeof e.callsign=="string"&&e.callsign.trim().length)return e.callsign.trim();if(e.id&&typeof i?.resolveCallsign=="function"){const t=i.resolveCallsign(e.id);if(typeof t=="string"&&t.trim().length)return t.trim()}return null},Cx=(i,e,t={})=>{const r=Ax(i,e),n=gl(e?.city),s=Number.isFinite(n)?Ft(n):null,o=t.isRogue===!0||e?.city===-1,a=!!e?.isMayor;let l;o?l="Rogue":a?l="Mayor":l="Recruit";const u=r||"Unit";return o?`${l} ${u}`:s?`${l} ${u} of ${s}`:`${l} ${u}`},Px=(i,e,t={})=>{if(t.isRogue)return Gn.rogue;const r=gl(i?.city),n=gl(e);return r!==null&&n!==null&&r===n?Gn.ally:r===null?Gn.neutral:Gn.enemy},Ox=i=>i?(i.__nameLabelCache||(i.__nameLabelCache=new Map),i.__nameLabelCache):null,Fx=(i,e={})=>e.cacheKey?e.cacheKey:i&&i.id!==void 0&&i.id!==null?`entity:${i.id}`:i&&i.callsign?`callsign:${i.callsign}`:null,Rx=(i,e,t={})=>{const r=Ox(i);if(!r||!e)return null;const n=Fx(e,t);if(!n)return null;const s=Cx(i,e,t);if(!s||!s.trim())return null;const o=Px(e,t.referenceCity,t);let a=r.get(n);if(a)a.text!==s&&(a.label.text=s,a.text=s),a.fillColor!==o&&(a.label.style.fill=o,a.fillColor=o,a.label.dirty=!0);else{const l=new $.Text(s,{fontFamily:"Arial",fontSize:12,fontWeight:"bold",fill:o,align:"center",stroke:0,strokeThickness:3});l.anchor.set(.5,1),a={label:l,text:s,fillColor:o},r.set(n,a)}return a.lastUsedTick=i.tick||Date.now(),a.label},xu=(i,e,t,r={})=>{if(!t||!e)return;const n=Rx(i,e,r);n&&(n.parent!==t&&t.addChild(n),n.x=t.width/2,n.y=-t.height/2-Ex)},Mx=(i,e)=>{if(!i)return 0;const t=!!i.isMayor;return typeof i.tank=="number"?i.tank:e&&i.id===e.id||(e&&i.city!==void 0?i.city===e.city:!0)?t?1:0:t?3:2},wu=(i,e,t)=>{const r=e?.direction||0,n=Mx(e,t),s=new $.Texture(i.textures.tankTexture.baseTexture,new $.Rectangle(Math.floor(r/2)*48,n*48,48,48));return new $.Sprite(s)};var Lx=(i,e)=>{var t=wu(i,i.player,i.player);t.x=i.player.defaultOffset.x,t.y=i.player.defaultOffset.y,xu(i,i.player,t,{referenceCity:i.player.city,cacheKey:"player:self"}),e.addChild(t)},Nx=(i,e)=>{Object.keys(i.otherPlayers).forEach(t=>{var r=i.otherPlayers[t];if(r){if(r.isCloaked){const s=i.player?.id,o=(r.city??null)===(i.player?.city??null);if(t!==s&&!o)return}var n=wu(i,r,i.player);n.x=r.offset.x+(i.player.defaultOffset.x-i.player.offset.x/48*48),n.y=r.offset.y+(i.player.defaultOffset.y-i.player.offset.y/48*48),xu(i,r,n,{referenceCity:i.player.city,isRogue:r.city===-1,cacheKey:r.id||t}),e.addChild(n)}})};const Bx=(i,e)=>{const t=i.rogueTankManager;!t||!Array.isArray(t.tanks)||t.tanks.length===0||t.tanks.forEach((r,n)=>{if(!r||!r.offset)return;const s=wu(i,r,i.player);s.x=r.offset.x+(i.player.defaultOffset.x-i.player.offset.x/48*48),s.y=r.offset.y+(i.player.defaultOffset.y-i.player.offset.y/48*48),xu(i,r,s,{isRogue:!0,referenceCity:i.player.city,cacheKey:r.id||`rogue:${n}`}),e.addChild(s)})};var Dx=(i,e)=>{for(var t=i.bulletFactory.getHead();t;){var r=i.textures.bulletTexture.clone(),n=t&&Number.isFinite(t.type)?t.type:0;n<0&&(n=0);var s=new $.Rectangle(t.animation*8,n*8,8,8);r.frame=s;var o=new $.Sprite(r);o.x=t.x+(i.player.defaultOffset.x-i.player.offset.x),o.y=t.y+(i.player.defaultOffset.y-i.player.offset.y),t.animation++,t.animation>3&&(t.animation=0),e.addChild(o),t=t.next}};const kx=(i,e)=>{if(!Array.isArray(i.explosions)||i.explosions.length===0)return;const t=i.tick||Date.now();for(let r=i.explosions.length-1;r>=0;r--){const n=i.explosions[r];if(!n){i.explosions.splice(r,1);continue}const s=n.variant||"large",o=Of[s]||Of.large,a=i.textures[o.textureKey]||i.textures[o.fallbackKey];if(!a||!a.baseTexture)continue;const l=o.frameSize,u=o.totalFrames,h=o.duration??Ix,c=Math.max(1,Math.floor(a.baseTexture.width/l)),f=Math.max(1,Math.floor(a.baseTexture.height/l)),d=Math.min(u,c*f);if(d<=0)continue;if(n.nextFrameTick?t>=n.nextFrameTick&&(n.frame=(n.frame||0)+1,n.nextFrameTick=t+h):n.nextFrameTick=t+h,(n.frame||0)>=d){i.explosions.splice(r,1);continue}const p=Math.max(0,n.frame||0),v=new $.Texture(a.baseTexture,new $.Rectangle(p%c*l,Math.floor(p/c)*l,l,l)),m=new $.Sprite(v),g=i.player.defaultOffset.x-i.player.offset.x,E=i.player.defaultOffset.y-i.player.offset.y;m.x=(n.x||0)+g,m.y=(n.y||0)+E,e.addChild(m)}},Ux=i=>{i.objectContainer.removeChildren(),Lx(i,i.objectContainer),Nx(i,i.objectContainer),Bx(i,i.objectContainer),Dx(i,i.objectContainer),kx(i,i.objectContainer);const e=i.__nameLabelCache;if(e&&e.size){const t=i.tick||Date.now();for(const[r,n]of e.entries()){if(!n){e.delete(r);continue}const s=n.lastUsedTick||0;t-s<=Sx||(n.label&&(n.label.parent&&n.label.parent.removeChild(n.label),n.label.destroy()),e.delete(r))}}},Ry={},Xx=i=>{console.log("updateBotWaypoints",i),i&&i.id&&(Ry[i.id]=i.waypoints)},Hx=(i,e)=>{!i||!e||Object.values(Ry).forEach(t=>{!t||t.length===0||(e.lineStyle(2,16711680,1),e.moveTo(t[0].x,t[0].y),t.forEach((r,n)=>{n>0&&e.lineTo(r.x,r.y),e.drawCircle(r.x,r.y,5)}))})};var Gx=(i,e)=>$e(e,hr(i.player))?!0:Object.keys(i.otherPlayers).some(t=>$e(hr(i.otherPlayers[t]),e)),Yx=(i,e)=>{for(var t=i.buildingFactory.getHead();t;){var r={x:t.x*48,y:t.y*48,w:144,h:144};if($e(e,r))return!0;t=t.next}return!1};const zx=(i,e)=>{var t={x:e.x*48,y:e.y*48,w:140,h:140},r=_y(hr(i.player));return r?(console.log("Collided with edges"),r):(r=wy(i,t),r?(console.log("Collided with tiles"),r):(r=Yx(i,t),r||(r=Gx(i,t),r)?(console.log("Collided with buildings"),r):(r=xy(i,t),r)))};var My="1.13.7",Ff=typeof self=="object"&&self.self===self&&self||typeof global=="object"&&global.global===global&&global||Function("return this")()||{},Bs=Array.prototype,Tu=Object.prototype,Rf=typeof Symbol<"u"?Symbol.prototype:null,Vx=Bs.push,cn=Bs.slice,rn=Tu.toString,qx=Tu.hasOwnProperty,Ly=typeof ArrayBuffer<"u",$x=typeof DataView<"u",jx=Array.isArray,Mf=Object.keys,Lf=Object.create,Nf=Ly&&ArrayBuffer.isView,Wx=isNaN,Kx=isFinite,Ny=!{toString:null}.propertyIsEnumerable("toString"),Bf=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],Zx=Math.pow(2,53)-1;function re(i,e){return e=e==null?i.length-1:+e,function(){for(var t=Math.max(arguments.length-e,0),r=Array(t),n=0;n<t;n++)r[n]=arguments[n+e];switch(e){case 0:return i.call(this,r);case 1:return i.call(this,arguments[0],r);case 2:return i.call(this,arguments[0],arguments[1],r)}var s=Array(e+1);for(n=0;n<e;n++)s[n]=arguments[n];return s[e]=r,i.apply(this,s)}}function Dr(i){var e=typeof i;return e==="function"||e==="object"&&!!i}function Jx(i){return i===null}function By(i){return i===void 0}function Dy(i){return i===!0||i===!1||rn.call(i)==="[object Boolean]"}function Qx(i){return!!(i&&i.nodeType===1)}function qt(i){var e="[object "+i+"]";return function(t){return rn.call(t)===e}}const Iu=qt("String"),ky=qt("Number"),tw=qt("Date"),ew=qt("RegExp"),rw=qt("Error"),Uy=qt("Symbol"),Xy=qt("ArrayBuffer");var Hy=qt("Function"),iw=Ff.document&&Ff.document.childNodes;typeof/./!="function"&&typeof Int8Array!="object"&&typeof iw!="function"&&(Hy=function(i){return typeof i=="function"||!1});const Zt=Hy,Gy=qt("Object");var Yy=$x&&(!/\[native code\]/.test(String(DataView))||Gy(new DataView(new ArrayBuffer(8)))),Eu=typeof Map<"u"&&Gy(new Map),nw=qt("DataView");function sw(i){return i!=null&&Zt(i.getInt8)&&Xy(i.buffer)}const bs=Yy?sw:nw,kr=jx||qt("Array");function fr(i,e){return i!=null&&qx.call(i,e)}var bl=qt("Arguments");(function(){bl(arguments)||(bl=function(i){return fr(i,"callee")})})();const Su=bl;function ow(i){return!Uy(i)&&Kx(i)&&!isNaN(parseFloat(i))}function zy(i){return ky(i)&&Wx(i)}function Vy(i){return function(){return i}}function qy(i){return function(e){var t=i(e);return typeof t=="number"&&t>=0&&t<=Zx}}function $y(i){return function(e){return e?.[i]}}const _s=$y("byteLength"),aw=qy(_s);var lw=/\[object ((I|Ui)nt(8|16|32)|Float(32|64)|Uint8Clamped|Big(I|Ui)nt64)Array\]/;function uw(i){return Nf?Nf(i)&&!bs(i):aw(i)&&lw.test(rn.call(i))}const jy=Ly?uw:Vy(!1),ie=$y("length");function hw(i){for(var e={},t=i.length,r=0;r<t;++r)e[i[r]]=!0;return{contains:function(n){return e[n]===!0},push:function(n){return e[n]=!0,i.push(n)}}}function Wy(i,e){e=hw(e);var t=Bf.length,r=i.constructor,n=Zt(r)&&r.prototype||Tu,s="constructor";for(fr(i,s)&&!e.contains(s)&&e.push(s);t--;)s=Bf[t],s in i&&i[s]!==n[s]&&!e.contains(s)&&e.push(s)}function Gt(i){if(!Dr(i))return[];if(Mf)return Mf(i);var e=[];for(var t in i)fr(i,t)&&e.push(t);return Ny&&Wy(i,e),e}function cw(i){if(i==null)return!0;var e=ie(i);return typeof e=="number"&&(kr(i)||Iu(i)||Su(i))?e===0:ie(Gt(i))===0}function Ky(i,e){var t=Gt(e),r=t.length;if(i==null)return!r;for(var n=Object(i),s=0;s<r;s++){var o=t[s];if(e[o]!==n[o]||!(o in n))return!1}return!0}function _t(i){if(i instanceof _t)return i;if(!(this instanceof _t))return new _t(i);this._wrapped=i}_t.VERSION=My;_t.prototype.value=function(){return this._wrapped};_t.prototype.valueOf=_t.prototype.toJSON=_t.prototype.value;_t.prototype.toString=function(){return String(this._wrapped)};function Df(i){return new Uint8Array(i.buffer||i,i.byteOffset||0,_s(i))}var kf="[object DataView]";function _l(i,e,t,r){if(i===e)return i!==0||1/i===1/e;if(i==null||e==null)return!1;if(i!==i)return e!==e;var n=typeof i;return n!=="function"&&n!=="object"&&typeof e!="object"?!1:Zy(i,e,t,r)}function Zy(i,e,t,r){i instanceof _t&&(i=i._wrapped),e instanceof _t&&(e=e._wrapped);var n=rn.call(i);if(n!==rn.call(e))return!1;if(Yy&&n=="[object Object]"&&bs(i)){if(!bs(e))return!1;n=kf}switch(n){case"[object RegExp]":case"[object String]":return""+i==""+e;case"[object Number]":return+i!=+i?+e!=+e:+i==0?1/+i===1/e:+i==+e;case"[object Date]":case"[object Boolean]":return+i==+e;case"[object Symbol]":return Rf.valueOf.call(i)===Rf.valueOf.call(e);case"[object ArrayBuffer]":case kf:return Zy(Df(i),Df(e),t,r)}var s=n==="[object Array]";if(!s&&jy(i)){var o=_s(i);if(o!==_s(e))return!1;if(i.buffer===e.buffer&&i.byteOffset===e.byteOffset)return!0;s=!0}if(!s){if(typeof i!="object"||typeof e!="object")return!1;var a=i.constructor,l=e.constructor;if(a!==l&&!(Zt(a)&&a instanceof a&&Zt(l)&&l instanceof l)&&"constructor"in i&&"constructor"in e)return!1}t=t||[],r=r||[];for(var u=t.length;u--;)if(t[u]===i)return r[u]===e;if(t.push(i),r.push(e),s){if(u=i.length,u!==e.length)return!1;for(;u--;)if(!_l(i[u],e[u],t,r))return!1}else{var h=Gt(i),c;if(u=h.length,Gt(e).length!==u)return!1;for(;u--;)if(c=h[u],!(fr(e,c)&&_l(i[c],e[c],t,r)))return!1}return t.pop(),r.pop(),!0}function fw(i,e){return _l(i,e)}function fn(i){if(!Dr(i))return[];var e=[];for(var t in i)e.push(t);return Ny&&Wy(i,e),e}function Au(i){var e=ie(i);return function(t){if(t==null)return!1;var r=fn(t);if(ie(r))return!1;for(var n=0;n<e;n++)if(!Zt(t[i[n]]))return!1;return i!==tm||!Zt(t[Cu])}}var Cu="forEach",Jy="has",Pu=["clear","delete"],Qy=["get",Jy,"set"],dw=Pu.concat(Cu,Qy),tm=Pu.concat(Qy),pw=["add"].concat(Pu,Cu,Jy);const yw=Eu?Au(dw):qt("Map"),mw=Eu?Au(tm):qt("WeakMap"),vw=Eu?Au(pw):qt("Set"),gw=qt("WeakSet");function Ei(i){for(var e=Gt(i),t=e.length,r=Array(t),n=0;n<t;n++)r[n]=i[e[n]];return r}function bw(i){for(var e=Gt(i),t=e.length,r=Array(t),n=0;n<t;n++)r[n]=[e[n],i[e[n]]];return r}function em(i){for(var e={},t=Gt(i),r=0,n=t.length;r<n;r++)e[i[t[r]]]=t[r];return e}function xl(i){var e=[];for(var t in i)Zt(i[t])&&e.push(t);return e.sort()}function Ou(i,e){return function(t){var r=arguments.length;if(e&&(t=Object(t)),r<2||t==null)return t;for(var n=1;n<r;n++)for(var s=arguments[n],o=i(s),a=o.length,l=0;l<a;l++){var u=o[l];(!e||t[u]===void 0)&&(t[u]=s[u])}return t}}const rm=Ou(fn),xs=Ou(Gt),im=Ou(fn,!0);function _w(){return function(){}}function nm(i){if(!Dr(i))return{};if(Lf)return Lf(i);var e=_w();e.prototype=i;var t=new e;return e.prototype=null,t}function xw(i,e){var t=nm(i);return e&&xs(t,e),t}function ww(i){return Dr(i)?kr(i)?i.slice():rm({},i):i}function Tw(i,e){return e(i),i}function sm(i){return kr(i)?i:[i]}_t.toPath=sm;function dn(i){return _t.toPath(i)}function Fu(i,e){for(var t=e.length,r=0;r<t;r++){if(i==null)return;i=i[e[r]]}return t?i:void 0}function om(i,e,t){var r=Fu(i,dn(e));return By(r)?t:r}function Iw(i,e){e=dn(e);for(var t=e.length,r=0;r<t;r++){var n=e[r];if(!fr(i,n))return!1;i=i[n]}return!!t}function Ru(i){return i}function nn(i){return i=xs({},i),function(e){return Ky(e,i)}}function Mu(i){return i=dn(i),function(e){return Fu(e,i)}}function pn(i,e,t){if(e===void 0)return i;switch(t??3){case 1:return function(r){return i.call(e,r)};case 3:return function(r,n,s){return i.call(e,r,n,s)};case 4:return function(r,n,s,o){return i.call(e,r,n,s,o)}}return function(){return i.apply(e,arguments)}}function am(i,e,t){return i==null?Ru:Zt(i)?pn(i,e,t):Dr(i)&&!kr(i)?nn(i):Mu(i)}function Lu(i,e){return am(i,e,1/0)}_t.iteratee=Lu;function se(i,e,t){return _t.iteratee!==Lu?_t.iteratee(i,e):am(i,e,t)}function Ew(i,e,t){e=se(e,t);for(var r=Gt(i),n=r.length,s={},o=0;o<n;o++){var a=r[o];s[a]=e(i[a],a,i)}return s}function lm(){}function Sw(i){return i==null?lm:function(e){return om(i,e)}}function Aw(i,e,t){var r=Array(Math.max(0,i));e=pn(e,t,1);for(var n=0;n<i;n++)r[n]=e(n);return r}function wl(i,e){return e==null&&(e=i,i=0),i+Math.floor(Math.random()*(e-i+1))}const sn=Date.now||function(){return new Date().getTime()};function um(i){var e=function(s){return i[s]},t="(?:"+Gt(i).join("|")+")",r=RegExp(t),n=RegExp(t,"g");return function(s){return s=s==null?"":""+s,r.test(s)?s.replace(n,e):s}}const hm={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},Cw=um(hm),Pw=em(hm),Ow=um(Pw),Fw=_t.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var _a=/(.)^/,Rw={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},Mw=/\\|'|\r|\n|\u2028|\u2029/g;function Lw(i){return"\\"+Rw[i]}var Nw=/^\s*(\w|\$)+\s*$/;function Bw(i,e,t){!e&&t&&(e=t),e=im({},e,_t.templateSettings);var r=RegExp([(e.escape||_a).source,(e.interpolate||_a).source,(e.evaluate||_a).source].join("|")+"|$","g"),n=0,s="__p+='";i.replace(r,function(u,h,c,f,d){return s+=i.slice(n,d).replace(Mw,Lw),n=d+u.length,h?s+=`'+
((__t=(`+h+`))==null?'':_.escape(__t))+
'`:c?s+=`'+
((__t=(`+c+`))==null?'':__t)+
'`:f&&(s+=`';
`+f+`
__p+='`),u}),s+=`';
`;var o=e.variable;if(o){if(!Nw.test(o))throw new Error("variable is not a bare identifier: "+o)}else s=`with(obj||{}){
`+s+`}
`,o="obj";s=`var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};
`+s+`return __p;
`;var a;try{a=new Function(o,"_",s)}catch(u){throw u.source=s,u}var l=function(u){return a.call(this,u,_t)};return l.source="function("+o+`){
`+s+"}",l}function Dw(i,e,t){e=dn(e);var r=e.length;if(!r)return Zt(t)?t.call(i):t;for(var n=0;n<r;n++){var s=i?.[e[n]];s===void 0&&(s=t,n=r),i=Zt(s)?s.call(i):s}return i}var kw=0;function Uw(i){var e=++kw+"";return i?i+e:e}function Xw(i){var e=_t(i);return e._chain=!0,e}function cm(i,e,t,r,n){if(!(r instanceof e))return i.apply(t,n);var s=nm(i.prototype),o=i.apply(s,n);return Dr(o)?o:s}var Si=re(function(i,e){var t=Si.placeholder,r=function(){for(var n=0,s=e.length,o=Array(s),a=0;a<s;a++)o[a]=e[a]===t?arguments[n++]:e[a];for(;n<arguments.length;)o.push(arguments[n++]);return cm(i,r,this,this,o)};return r});Si.placeholder=_t;const fm=re(function(i,e,t){if(!Zt(i))throw new TypeError("Bind must be called on a function");var r=re(function(n){return cm(i,r,e,this,t.concat(n))});return r}),ce=qy(ie);function Ur(i,e,t,r){if(r=r||[],!e&&e!==0)e=1/0;else if(e<=0)return r.concat(i);for(var n=r.length,s=0,o=ie(i);s<o;s++){var a=i[s];if(ce(a)&&(kr(a)||Su(a)))if(e>1)Ur(a,e-1,t,r),n=r.length;else for(var l=0,u=a.length;l<u;)r[n++]=a[l++];else t||(r[n++]=a)}return r}const Hw=re(function(i,e){e=Ur(e,!1,!1);var t=e.length;if(t<1)throw new Error("bindAll must be passed function names");for(;t--;){var r=e[t];i[r]=fm(i[r],i)}return i});function Gw(i,e){var t=function(r){var n=t.cache,s=""+(e?e.apply(this,arguments):r);return fr(n,s)||(n[s]=i.apply(this,arguments)),n[s]};return t.cache={},t}const dm=re(function(i,e,t){return setTimeout(function(){return i.apply(null,t)},e)}),Yw=Si(dm,_t,1);function zw(i,e,t){var r,n,s,o,a=0;t||(t={});var l=function(){a=t.leading===!1?0:sn(),r=null,o=i.apply(n,s),r||(n=s=null)},u=function(){var h=sn();!a&&t.leading===!1&&(a=h);var c=e-(h-a);return n=this,s=arguments,c<=0||c>e?(r&&(clearTimeout(r),r=null),a=h,o=i.apply(n,s),r||(n=s=null)):!r&&t.trailing!==!1&&(r=setTimeout(l,c)),o};return u.cancel=function(){clearTimeout(r),a=0,r=n=s=null},u}function Vw(i,e,t){var r,n,s,o,a,l=function(){var h=sn()-n;e>h?r=setTimeout(l,e-h):(r=null,t||(o=i.apply(a,s)),r||(s=a=null))},u=re(function(h){return a=this,s=h,n=sn(),r||(r=setTimeout(l,e),t&&(o=i.apply(a,s))),o});return u.cancel=function(){clearTimeout(r),r=s=a=null},u}function qw(i,e){return Si(e,i)}function Nu(i){return function(){return!i.apply(this,arguments)}}function $w(){var i=arguments,e=i.length-1;return function(){for(var t=e,r=i[e].apply(this,arguments);t--;)r=i[t].call(this,r);return r}}function jw(i,e){return function(){if(--i<1)return e.apply(this,arguments)}}function pm(i,e){var t;return function(){return--i>0&&(t=e.apply(this,arguments)),i<=1&&(e=null),t}}const Ww=Si(pm,2);function ym(i,e,t){e=se(e,t);for(var r=Gt(i),n,s=0,o=r.length;s<o;s++)if(n=r[s],e(i[n],n,i))return n}function mm(i){return function(e,t,r){t=se(t,r);for(var n=ie(e),s=i>0?0:n-1;s>=0&&s<n;s+=i)if(t(e[s],s,e))return s;return-1}}const Bu=mm(1),vm=mm(-1);function gm(i,e,t,r){t=se(t,r,1);for(var n=t(e),s=0,o=ie(i);s<o;){var a=Math.floor((s+o)/2);t(i[a])<n?s=a+1:o=a}return s}function bm(i,e,t){return function(r,n,s){var o=0,a=ie(r);if(typeof s=="number")i>0?o=s>=0?s:Math.max(s+a,o):a=s>=0?Math.min(s+1,a):s+a+1;else if(t&&s&&a)return s=t(r,n),r[s]===n?s:-1;if(n!==n)return s=e(cn.call(r,o,a),zy),s>=0?s+o:-1;for(s=i>0?o:a-1;s>=0&&s<a;s+=i)if(r[s]===n)return s;return-1}}const _m=bm(1,Bu,gm),Kw=bm(-1,vm);function Tl(i,e,t){var r=ce(i)?Bu:ym,n=r(i,e,t);if(n!==void 0&&n!==-1)return i[n]}function Zw(i,e){return Tl(i,nn(e))}function je(i,e,t){e=pn(e,t);var r,n;if(ce(i))for(r=0,n=i.length;r<n;r++)e(i[r],r,i);else{var s=Gt(i);for(r=0,n=s.length;r<n;r++)e(i[s[r]],s[r],i)}return i}function Mr(i,e,t){e=se(e,t);for(var r=!ce(i)&&Gt(i),n=(r||i).length,s=Array(n),o=0;o<n;o++){var a=r?r[o]:o;s[o]=e(i[a],a,i)}return s}function xm(i){var e=function(t,r,n,s){var o=!ce(t)&&Gt(t),a=(o||t).length,l=i>0?0:a-1;for(s||(n=t[o?o[l]:l],l+=i);l>=0&&l<a;l+=i){var u=o?o[l]:l;n=r(n,t[u],u,t)}return n};return function(t,r,n,s){var o=arguments.length>=3;return e(t,pn(r,s,4),n,o)}}const xa=xm(1),Uf=xm(-1);function gi(i,e,t){var r=[];return e=se(e,t),je(i,function(n,s,o){e(n,s,o)&&r.push(n)}),r}function Jw(i,e,t){return gi(i,Nu(se(e)),t)}function Xf(i,e,t){e=se(e,t);for(var r=!ce(i)&&Gt(i),n=(r||i).length,s=0;s<n;s++){var o=r?r[s]:s;if(!e(i[o],o,i))return!1}return!0}function Hf(i,e,t){e=se(e,t);for(var r=!ce(i)&&Gt(i),n=(r||i).length,s=0;s<n;s++){var o=r?r[s]:s;if(e(i[o],o,i))return!0}return!1}function Ye(i,e,t,r){return ce(i)||(i=Ei(i)),(typeof t!="number"||r)&&(t=0),_m(i,e,t)>=0}const Qw=re(function(i,e,t){var r,n;return Zt(e)?n=e:(e=dn(e),r=e.slice(0,-1),e=e[e.length-1]),Mr(i,function(s){var o=n;if(!o){if(r&&r.length&&(s=Fu(s,r)),s==null)return;o=s[e]}return o==null?o:o.apply(s,t)})});function Du(i,e){return Mr(i,Mu(e))}function tT(i,e){return gi(i,nn(e))}function wm(i,e,t){var r=-1/0,n=-1/0,s,o;if(e==null||typeof e=="number"&&typeof i[0]!="object"&&i!=null){i=ce(i)?i:Ei(i);for(var a=0,l=i.length;a<l;a++)s=i[a],s!=null&&s>r&&(r=s)}else e=se(e,t),je(i,function(u,h,c){o=e(u,h,c),(o>n||o===-1/0&&r===-1/0)&&(r=u,n=o)});return r}function eT(i,e,t){var r=1/0,n=1/0,s,o;if(e==null||typeof e=="number"&&typeof i[0]!="object"&&i!=null){i=ce(i)?i:Ei(i);for(var a=0,l=i.length;a<l;a++)s=i[a],s!=null&&s<r&&(r=s)}else e=se(e,t),je(i,function(u,h,c){o=e(u,h,c),(o<n||o===1/0&&r===1/0)&&(r=u,n=o)});return r}var rT=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;function Tm(i){return i?kr(i)?cn.call(i):Iu(i)?i.match(rT):ce(i)?Mr(i,Ru):Ei(i):[]}function Im(i,e,t){if(e==null||t)return ce(i)||(i=Ei(i)),i[wl(i.length-1)];var r=Tm(i),n=ie(r);e=Math.max(Math.min(e,n),0);for(var s=n-1,o=0;o<e;o++){var a=wl(o,s),l=r[o];r[o]=r[a],r[a]=l}return r.slice(0,e)}function iT(i){return Im(i,1/0)}function nT(i,e,t){var r=0;return e=se(e,t),Du(Mr(i,function(n,s,o){return{value:n,index:r++,criteria:e(n,s,o)}}).sort(function(n,s){var o=n.criteria,a=s.criteria;if(o!==a){if(o>a||o===void 0)return 1;if(o<a||a===void 0)return-1}return n.index-s.index}),"value")}function Ds(i,e){return function(t,r,n){var s=e?[[],[]]:{};return r=se(r,n),je(t,function(o,a){var l=r(o,a,t);i(s,o,l)}),s}}const sT=Ds(function(i,e,t){fr(i,t)?i[t].push(e):i[t]=[e]}),oT=Ds(function(i,e,t){i[t]=e}),aT=Ds(function(i,e,t){fr(i,t)?i[t]++:i[t]=1}),lT=Ds(function(i,e,t){i[t?0:1].push(e)},!0);function uT(i){return i==null?0:ce(i)?i.length:Gt(i).length}function hT(i,e,t){return e in t}const Em=re(function(i,e){var t={},r=e[0];if(i==null)return t;Zt(r)?(e.length>1&&(r=pn(r,e[1])),e=fn(i)):(r=hT,e=Ur(e,!1,!1),i=Object(i));for(var n=0,s=e.length;n<s;n++){var o=e[n],a=i[o];r(a,o,i)&&(t[o]=a)}return t}),cT=re(function(i,e){var t=e[0],r;return Zt(t)?(t=Nu(t),e.length>1&&(r=e[1])):(e=Mr(Ur(e,!1,!1),String),t=function(n,s){return!Ye(e,s)}),Em(i,t,r)});function Sm(i,e,t){return cn.call(i,0,Math.max(0,i.length-(e==null||t?1:e)))}function wa(i,e,t){return i==null||i.length<1?e==null||t?void 0:[]:e==null||t?i[0]:Sm(i,i.length-e)}function ns(i,e,t){return cn.call(i,e==null||t?1:e)}function fT(i,e,t){return i==null||i.length<1?e==null||t?void 0:[]:e==null||t?i[i.length-1]:ns(i,Math.max(0,i.length-e))}function dT(i){return gi(i,Boolean)}function pT(i,e){return Ur(i,e,!1)}const Am=re(function(i,e){return e=Ur(e,!0,!0),gi(i,function(t){return!Ye(e,t)})}),yT=re(function(i,e){return Am(i,e)});function Il(i,e,t,r){Dy(e)||(r=t,t=e,e=!1),t!=null&&(t=se(t,r));for(var n=[],s=[],o=0,a=ie(i);o<a;o++){var l=i[o],u=t?t(l,o,i):l;e&&!t?((!o||s!==u)&&n.push(l),s=u):t?Ye(s,u)||(s.push(u),n.push(l)):Ye(n,l)||n.push(l)}return n}const mT=re(function(i){return Il(Ur(i,!0,!0))});function vT(i){for(var e=[],t=arguments.length,r=0,n=ie(i);r<n;r++){var s=i[r];if(!Ye(e,s)){var o;for(o=1;o<t&&Ye(arguments[o],s);o++);o===t&&e.push(s)}}return e}function El(i){for(var e=i&&wm(i,ie).length||0,t=Array(e),r=0;r<e;r++)t[r]=Du(i,r);return t}const gT=re(El);function bT(i,e){for(var t={},r=0,n=ie(i);r<n;r++)e?t[i[r]]=e[r]:t[i[r][0]]=i[r][1];return t}function _T(i,e,t){e==null&&(e=i||0,i=0),t||(t=e<i?-1:1);for(var r=Math.max(Math.ceil((e-i)/t),0),n=Array(r),s=0;s<r;s++,i+=t)n[s]=i;return n}function xT(i,e){if(e==null||e<1)return[];for(var t=[],r=0,n=i.length;r<n;)t.push(cn.call(i,r,r+=e));return t}function ku(i,e){return i._chain?_t(e).chain():e}function Cm(i){return je(xl(i),function(e){var t=_t[e]=i[e];_t.prototype[e]=function(){var r=[this._wrapped];return Vx.apply(r,arguments),ku(this,t.apply(_t,r))}}),_t}je(["pop","push","reverse","shift","sort","splice","unshift"],function(i){var e=Bs[i];_t.prototype[i]=function(){var t=this._wrapped;return t!=null&&(e.apply(t,arguments),(i==="shift"||i==="splice")&&t.length===0&&delete t[0]),ku(this,t)}});je(["concat","join","slice"],function(i){var e=Bs[i];_t.prototype[i]=function(){var t=this._wrapped;return t!=null&&(t=e.apply(t,arguments)),ku(this,t)}});const wT=Object.freeze(Object.defineProperty({__proto__:null,VERSION:My,after:jw,all:Xf,allKeys:fn,any:Hf,assign:xs,before:pm,bind:fm,bindAll:Hw,chain:Xw,chunk:xT,clone:ww,collect:Mr,compact:dT,compose:$w,constant:Vy,contains:Ye,countBy:aT,create:xw,debounce:Vw,default:_t,defaults:im,defer:Yw,delay:dm,detect:Tl,difference:Am,drop:ns,each:je,escape:Cw,every:Xf,extend:rm,extendOwn:xs,filter:gi,find:Tl,findIndex:Bu,findKey:ym,findLastIndex:vm,findWhere:Zw,first:wa,flatten:pT,foldl:xa,foldr:Uf,forEach:je,functions:xl,get:om,groupBy:sT,has:Iw,head:wa,identity:Ru,include:Ye,includes:Ye,indexBy:oT,indexOf:_m,initial:Sm,inject:xa,intersection:vT,invert:em,invoke:Qw,isArguments:Su,isArray:kr,isArrayBuffer:Xy,isBoolean:Dy,isDataView:bs,isDate:tw,isElement:Qx,isEmpty:cw,isEqual:fw,isError:rw,isFinite:ow,isFunction:Zt,isMap:yw,isMatch:Ky,isNaN:zy,isNull:Jx,isNumber:ky,isObject:Dr,isRegExp:ew,isSet:vw,isString:Iu,isSymbol:Uy,isTypedArray:jy,isUndefined:By,isWeakMap:mw,isWeakSet:gw,iteratee:Lu,keys:Gt,last:fT,lastIndexOf:Kw,map:Mr,mapObject:Ew,matcher:nn,matches:nn,max:wm,memoize:Gw,methods:xl,min:eT,mixin:Cm,negate:Nu,noop:lm,now:sn,object:bT,omit:cT,once:Ww,pairs:bw,partial:Si,partition:lT,pick:Em,pluck:Du,property:Mu,propertyOf:Sw,random:wl,range:_T,reduce:xa,reduceRight:Uf,reject:Jw,rest:ns,restArguments:re,result:Dw,sample:Im,select:gi,shuffle:iT,size:uT,some:Hf,sortBy:nT,sortedIndex:gm,tail:ns,take:wa,tap:Tw,template:Bw,templateSettings:Fw,throttle:zw,times:Aw,toArray:Tm,toPath:sm,transpose:El,unescape:Ow,union:mT,uniq:Il,unique:Il,uniqueId:Uw,unzip:El,values:Ei,where:tT,without:yT,wrap:qw,zip:gT},Symbol.toStringTag,{value:"Module"}));var qi=Cm(wT);qi._=qi;const fe=48,Sl=fe*20,TT=Sl*Sl,Kr=(i,e=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const t=Number(i);if(Number.isFinite(t))return t}return e},Gf=(i,e,t,r)=>{const n=i-t,s=e-r;return n*n+s*s};var Pm=function(i,e,t){t=typeof t<"u"?t:[],e=typeof e<"u"?e:{id:0};var r=qi.filter(i,function(n){return n.parentid==e.id});return qi.isEmpty(r)||(e.id==0?t=r:e.children=r,qi.each(r,function(n){Pm(i,n)})),t},IT=Pm(S_);const Yf=Object.keys(or).reduce((i,e)=>(i[or[e].TYPE]=e,i),{}),Ta=i=>i>=100&&i<200,zf=(i,e,t)=>{!i||!i.audio||!e||(t&&Number.isFinite(t.x)&&Number.isFinite(t.y)?i.audio.playEffect(e,{position:t}):i.audio.playEffect(e))};class ET{constructor(e){this.game=e,this.buildingListHead=null,this.buildingsById={},this.buildingsByCoord={},this.pendingBuildCosts=new Map,this.pendingDemolish=new Set}cycle(){}newBuilding(e,t,r,n,s={}){const{notifyServer:o=!0,id:a=`${t}_${r}`,population:l=0,attachedHouseId:u=null,updateCity:h,itemsLeft:c=0,city:f=this.game.player?.city??0}=s,d=`${t}_${r}`,p=Number.isFinite(f)?f:parseInt(f,10)||0,v=o&&e!==null&&e!==void 0&&this.game?.player&&e===this.game.player.id;if(v){const E=this.game.cities?.[p];if(!E)return console.warn("Cannot place building without city state"),!1;if((Number.isFinite(E.cash)?E.cash:parseInt(E.cash,10)||0)<Hi)return console.warn("City lacks funds for new building"),this.game.forceDraw=!0,!1}var m={id:a,owner:e,x:t,y:r,items:1,type:n,population:l,attachedHouseId:u,next:null,previous:null,coordKey:d,city:f,itemsLeft:c};if(zx(this.game,m))return console.log("Collision"),!1;if(v&&n!==Fe){const E={x:(Kr(t,0)+1.5)*fe,y:(Kr(r,0)+1.5)*fe},I=this.measureCityLayout(p,E);if(I.buildingCount>0){const M=I.nearestDistanceSq;if(M!==null&&M>TT){if(typeof this.game.notify=="function"){const _=Ft(p),F=Math.round(Sl/fe);this.game.notify({title:"Construction Denied",message:`New structures must be within ${F} tiles of your existing ${_} build grid. Try placing closer to your city.`,variant:"warn",timeout:6500})}return!1}}}if(o&&this.game.socketListener&&this.game.socketListener.sendNewBuilding&&this.game.socketListener.sendNewBuilding(m),this.buildingListHead&&(this.buildingListHead.previous=m,m.next=this.buildingListHead),(h!==void 0?h:!e||e===this.game.player.id)?this.adjustAllowedBuilds(m):this.applyResearchProgress(m.city,m.type),console.log("Created building"),console.log(m),this.buildingListHead=m,this.buildingsById[m.id]=m,this.buildingsByCoord[d]=m,this.syncFactoryItems(m),this.game.tiles[t]||(this.game.tiles[t]=[]),this.game.tiles[t][r]=n,this.game.map&&this.game.map[t]&&(this.game.map[t][r]=hn),zf(this.game,ct.BUILD,{x:t*fe,y:r*fe}),v){const E=this.game.cities?.[p];if(E){const I=Number.isFinite(E.cash)?E.cash:parseInt(E.cash,10)||0;E.cash=Math.max(0,I-Hi),E.construction=(Number.isFinite(E.construction)?E.construction:parseInt(E.construction,10)||0)+Hi,E.updatedAt=Date.now(),this.pendingBuildCosts.set(m.id,{cityId:p,cost:Hi}),this.game.forceDraw=!0}}return m}outputBuildings(){console.log("here");for(var e=this.getHead();e;)e.type!==0&&console.log(e.type+","+e.x+","+e.y),e=e.next;return!1}demolishBuilding(e,t){console.log("Trying to demolish building at "+e+" "+t);const r=this.findBuildingAtTile(e,t);r&&(this.pendingDemolish.has(r.id)||this.game.socketListener?.sendDemolishBuilding&&(this.pendingDemolish.add(r.id),this.game.socketListener.sendDemolishBuilding(r.id)))}deleteBuilding(e,t=!0){if(this.game.map[e.x][e.y]=0,this.game.tiles[e.x][e.y]=0,this.pendingDemolish.has(e.id)&&this.pendingDemolish.delete(e.id),Array.isArray(this.game.explosions)){const s=Number.isFinite(e.x)?Number(e.x):0,o=Number.isFinite(e.y)?Number(e.y):0;this.game.explosions.push({x:s*48,y:o*48,frame:0,nextFrameTick:(this.game.tick||Date.now())+75,variant:"large"}),zf(this.game,ct.DEMOLISH,{x:s*fe,y:o*fe})}if(Ta(e.type)){const s=this.getFactoryDropPosition(e),o=e.type%100,a=e.city??e.cityId??null,l=this.game.iconFactory.countUnownedIconsNear(s.x,s.y,o,48,a);l>0&&this.game.iconFactory.removeUnownedIconsNear(s.x,s.y,o,l,48,a),e.itemsLeft=0}(e.owner===null||e.owner===this.game.player.id)&&Object.keys(this.game.cities[this.game.player.city].canBuild).forEach(s=>{var o=or[s].TYPE;console.log(o+" "+this.game.isBuilding),parseInt(o)==e.type&&o!=Qr&&(this.game.cities[this.game.player.city].canBuild[s]=sr)}),t&&this.game.socketListener&&this.game.socketListener.sendDemolishBuilding&&this.game.socketListener.sendDemolishBuilding(e.id);var r=e.next;e.next&&(e.next.previous=e.previous),e.previous?e.previous.next=e.next:this.buildingListHead=e.next,delete this.buildingsById[e.id];const n=e.coordKey||`${e.x}_${e.y}`;return delete this.buildingsByCoord[n],this.pendingBuildCosts.has(e.id)&&this.pendingBuildCosts.delete(e.id),r}handleDemolishDenied(e){const t=e?.id;t&&this.pendingDemolish.has(t)&&this.pendingDemolish.delete(t),e?.reason&&console.warn(`Demolish denied (${e.reason}) for building ${t||"(unknown)"}`)}removeBuildingById(e){let t=this.getHead();for(;t;){if(t.id===e){this.deleteBuilding(t,!1);break}t=t.next}}handleBuildDenied(e){if(!e)return;const t=e.id||`${e.x}_${e.y}`;if(!t)return;const r=this.pendingBuildCosts.get(t);if(r){const s=this.game.cities?.[r.cityId];if(s){const o=Number.isFinite(s.cash)?s.cash:parseInt(s.cash,10)||0;s.cash=o+r.cost;const a=Number.isFinite(s.construction)?s.construction:parseInt(s.construction,10)||0;s.construction=Math.max(0,a-r.cost),s.updatedAt=Date.now()}this.pendingBuildCosts.delete(t)}const n=this.getBuildingById(t);n&&n.owner===this.game.player.id&&this.deleteBuilding(n,!1),this.game.forceDraw=!0}searchTree(e,t){if(e.id==t)return e;if(e.children!=null){var r,n=null;for(r=0;n==null&&r<e.children.length;r++)n=this.searchTree(e.children[r],t);return n}return null}adjustAllowedBuilds(e){if(e.type==Fe)return;const t=e.city??this.game.player.city,r=this.game.isBuilding||e.type;this.applyResearchProgress(t,r)}getHead(){return this.buildingListHead}getBuildingById(e){return this.buildingsById[e]}getBuildingByCoord(e,t){return this.buildingsByCoord[`${e}_${t}`]}findBuildingAtTile(e,t){let r=this.getHead();const n=Number.isFinite(e)?e:parseInt(e,10),s=Number.isFinite(t)?t:parseInt(t,10);if(!Number.isFinite(n)||!Number.isFinite(s))return null;for(;r;){const o=Number.isFinite(r.x)?r.x:parseInt(r.x,10)||0,a=Number.isFinite(r.y)?r.y:parseInt(r.y,10)||0;if(n>=o&&n<=o+2&&s>=a&&s<=a+2)return r;r=r.next}return null}measureCityLayout(e,t=null){const r=Number.isFinite(e)?e:parseInt(e,10),n=this.game.cities?.[r],s=Kr(n?.x,0),o=Kr(n?.y,0),a={x:s+fe*1.5,y:o+fe*1.5};let l=this.getHead(),u=0,c=Number.isFinite(t?.x)&&Number.isFinite(t?.y)?1/0:null,f=0;for(;l;){const d=Number.isFinite(l.city)?l.city:parseInt(l.city,10);if(Number.isFinite(d)&&Number.isFinite(r)&&d!==r){l=l.next;continue}const p=(Kr(l.x,0)+1.5)*fe,v=(Kr(l.y,0)+1.5)*fe,m=Gf(p,v,a.x,a.y);if(m>u&&(u=m),c!==null){const g=Gf(p,v,t.x,t.y);g<c&&(c=g)}f+=1,l=l.next}return{cityCenter:a,maxRadiusSq:u,nearestDistanceSq:c,buildingCount:f}}countBuildingsForCity(e){const t=Number.isFinite(e)?e:parseInt(e,10);if(!Number.isFinite(t))return 0;let r=0,n=this.getHead();for(;n;)(Number.isFinite(n.city)?n.city:parseInt(n.city,10)||0)===t&&(r+=1),n=n.next;return r}applyPopulationUpdate(e){if(!e||!e.id)return;if(e.removed){this.removeBuildingById(e.id),this.game.forceDraw=!0;return}let t=this.getBuildingById(e.id);!t&&e.x!==void 0&&e.y!==void 0&&e.type!==void 0&&(t=this.newBuilding(e.ownerId||null,e.x,e.y,e.type,{notifyServer:!1,id:e.id,population:e.population||0,attachedHouseId:e.attachedHouseId||null,updateCity:!1,itemsLeft:e.itemsLeft||0,city:e.city??0}),t&&this.applyResearchProgress(t.city??0,t.type)),t&&(t.coordKey=t.coordKey||`${t.x}_${t.y}`,typeof e.population=="number"&&(t.population=e.population),e.attachedHouseId!==void 0&&(t.attachedHouseId=e.attachedHouseId),e.city!==void 0&&(t.city=e.city),e.smokeActive!==void 0&&(t.smokeActive=e.smokeActive),e.smokeFrame!==void 0&&(t.smokeFrame=e.smokeFrame),e.itemsLeft!==void 0&&(t.itemsLeft=e.itemsLeft),this.syncFactoryItems(t),e.id&&this.pendingBuildCosts.has(e.id)&&this.pendingBuildCosts.delete(e.id),this.game.forceDraw=!0)}applyResearchProgress(e,t){if(t==null||e==null||e===void 0)return;const r=parseInt(e,10),n=this.game.cities?.[r];if(!n||!n.canBuild)return;const s=Number(t),o=Yf[s];if(!o||n.canBuild[o]===void 0)return;s!==Qr&&(n.canBuild[o]=uf);const a=this.searchTree(IT[0],s);a&&a.children&&a.children.forEach(l=>{const u=Yf[l.id];u&&n.canBuild[u]!==uf&&(n.canBuild[u]=sr)})}assignIconSource(e){if(!e||typeof e.type!="number")return null;if(e.sourceBuildingId&&this.buildingsById[e.sourceBuildingId])return this.buildingsById[e.sourceBuildingId];const t=this.findFactoryForIcon(e.type,e.x,e.y);return t&&(e.sourceBuildingId=t.id),t}findFactoryForIcon(e,t,r){let n=null,s=1/0,o=this.getHead();for(;o;){if(Ta(o.type)&&o.type%100===e){const a=this.getFactoryDropPosition(o),l=a.x-t,u=a.y-r,h=Math.sqrt(l*l+u*u);h<s&&h<=96&&(n=o,s=h)}o=o.next}return n}handleIconProduced(e){const t=this.assignIconSource(e);t&&(t.itemsLeft=(t.itemsLeft||0)+1,this.syncFactoryItems(t))}handleIconCollected(e){const t=this.assignIconSource(e);t&&(typeof t.itemsLeft=="number"&&t.itemsLeft>0&&(t.itemsLeft-=1),this.game.socketListener&&typeof this.game.socketListener.collectFactoryItem=="function"&&t.id&&this.game.socketListener.collectFactoryItem({buildingId:t.id,type:e.type,quantity:Math.max(1,e.quantity??1)}),this.syncFactoryItems(t))}getFactoryDropPosition(e){return{x:e.x*48+56,y:e.y*48+102}}syncFactoryItems(e){if(!e||!Ta(e.type)||!this.game.iconFactory||typeof this.game.iconFactory.countUnownedIconsNear!="function"||typeof this.game.iconFactory.removeUnownedIconsNear!="function")return;const t=e.itemsLeft||0,r=e.type%100,n=this.getFactoryDropPosition(e),s=e.city??e.cityId??null,o=this.game.iconFactory.countUnownedIconsNear(n.x,n.y,r,48,s);if(o>t)this.game.iconFactory.removeUnownedIconsNear(n.x,n.y,r,o-t,48,s);else if(o<t){const a=t-o;for(let l=0;l<a;l++)this.game.iconFactory.newIcon(null,n.x,n.y,r,{sourceBuildingId:e.id,teamId:s,skipProductionUpdate:!0})}}}const ei=48,Vf=4,ST=new Set([vu,hn]);var yn=(i,e)=>{var t={x:e.x,y:e.y,w:4,h:4};return $e(i,t)};const AT=i=>({x:i.x,y:i.y,w:Vf,h:Vf}),CT=(i,e)=>{const t=Array.isArray(i.map)?i.map.length:0,r=t>0&&Array.isArray(i.map[0])?i.map[0].length:0;if(!t||!r)return e;const n=Math.max(0,t*ei-e.w),s=Math.max(0,r*ei-e.h);return{x:Math.max(0,Math.min(e.x,n)),y:Math.max(0,Math.min(e.y,s)),w:e.w,h:e.h}},PT=(i,e)=>{const t=Array.isArray(i.map)?i.map:null;if(!t||!Array.isArray(t[0]))return!1;const r=t.length-1,n=Array.isArray(t[0])?t[0].length-1:-1;if(r<0||n<0)return!1;const s=Math.max(0,Math.floor(e.x/ei)),o=Math.min(r,Math.floor((e.x+e.w-1)/ei)),a=Math.max(0,Math.floor(e.y/ei)),l=Math.min(n,Math.floor((e.y+e.h-1)/ei));for(let u=s;u<=o;u+=1){const h=t[u];if(Array.isArray(h))for(let c=a;c<=l;c+=1){const f=h[c];if(ST.has(f))return!0}}return!1},OT=(i,e)=>{const t=CT(i,AT(e));return PT(i,t)},FT=(i,e)=>Object.keys(i.otherPlayers).some(t=>{const r=i.otherPlayers[t];if(!r||!r.offset||e.shooter&&e.shooter===t)return!1;const n=e.team??null,s=r.city??null;return n!==null&&s===n?!1:yn(hr(r),e)})||RT(i,e);function RT(i,e){const t=i.rogueTankManager;if(!t||!Array.isArray(t.tanks))return!1;const r=e.team??null;for(let n=0;n<t.tanks.length;n+=1){const s=t.tanks[n];if(!s||!s.offset||e.shooter&&e.shooter===s.id)continue;const o=s.city??null;if(!(r!==null&&o===r)&&yn(hr(s),e))return t.handleBulletCollision(e,s),!0}return!1}const MT=(i,e)=>{const t=e.team??null,r=i.player?.city??null;return t!==null&&t===r||e.shooter&&e.shooter===i.player.id?!1:yn(hr(i.player),e)},LT=(i,e)=>{for(var t=i.itemFactory.getHead();t;){var r={x:t.x,y:t.y,w:48,h:48};if(e.sourceId&&t.id&&e.sourceId===t.id){t=t.next;continue}if(yn(r,e))return t;t=t.next}return null},NT=(i,e)=>{for(var t=i.buildingFactory.getHead();t;){var r={x:t.x*48,y:t.y*48,w:144,h:96};const n=Number.isFinite(t.type)?t.type:parseInt(t.type,10),s=Number.isFinite(n)?Math.floor(n/100):NaN,o=n===Fe,a=s===kt,l=_u(t);if((o||a||l||s===Rs)&&(r.h=r.h-48),yn(r,e))return!0;t=t.next}return!1},qf={0:my,1:o_,3:a_},$f={0:ml,1:ml,3:u_},BT=i=>Object.prototype.hasOwnProperty.call(qf,i)?qf[i]:my,jf=i=>Object.prototype.hasOwnProperty.call($f,i)?$f[i]:ml;class DT{constructor(e){this.game=e,this.bulletListHead=null}cycle(){for(var e=this.bulletListHead;e;){var t=e.angle;const s=e.speed??jf(e.type);var r=Math.sin(t/16*3.14)*-1*this.game.timePassed*s,n=Math.cos(t/16*3.14)*-1*this.game.timePassed*s;e.x+=r,e.y+=n,(e.x<0||e.x>24576||e.y<0||e.y>24576)&&(e.life=Qe),OT(this.game,e)&&(e.life=Qe);const o=LT(this.game,e);o&&(this.game.itemFactory&&typeof this.game.itemFactory.handleBulletHit=="function"?(this.game.itemFactory.handleBulletHit(o,e)||{}).consumed!==!1&&(e.life=Qe):e.life=Qe),NT(this.game,e)&&(e.life=Qe),FT(this.game,e)&&(e.life=Qe),MT(this.game,e)&&(e.life=Qe),e.life==Qe?e=this.deleteBullet(e):e=e.next}}deleteBullet(e){var t=e.next;return e.next&&(e.next.previous=e.previous),e.previous?e.previous.next=e.next:this.bulletListHead=e.next,t}newBullet(e,t,r,n,s,o=null,a={}){const l=Number.isFinite(n)?n:0,u=a||{},h=Number.isFinite(u.damage)?u.damage:BT(l);var c={shooter:e,x:t,y:r,life:e_,damage:h,animation:0,type:l,angle:s,team:o,speed:jf(l),sourceId:u.sourceId??null,sourceType:u.sourceType??null,targetId:u.targetId??null,next:null,previous:null};return this.bulletListHead&&(this.bulletListHead.previous=c,c.next=this.bulletListHead),this.bulletListHead=c,c}getHead(){return this.bulletListHead}}class kT{constructor(e){this.game=e,this.iconListHead=null}cycle(){}getLimitForType(e){const t=E_?.[e];return typeof t=="number"?t:1/0}getOwnedQuantity(e,t){if(e==null)return 0;let r=0,n=this.getHead();for(;n;){if(n.owner===e&&n.type===t){const s=Number.isFinite(n.quantity)?n.quantity:parseInt(n.quantity,10)||1;r+=Math.max(1,s)}n=n.next}return r}getAllowedQuantity(e,t,r){const n=Math.max(1,parseInt(r,10)||1);if(e==null)return n;const s=this.getLimitForType(t);if(!Number.isFinite(s))return n;const o=this.getOwnedQuantity(e,t),a=s-o;return a<=0?0:Math.min(n,a)}newIcon(e,t,r,n,s={}){const o=s.quantity!==void 0?s.quantity:1;let a=Math.max(1,parseInt(o,10)||1);if(e!=null){const c=this.getAllowedQuantity(e,n,a);if(c<=0)return null;a=c}const l=s.city!==void 0?s.city:e!=null&&e===this.game.player?.id?this.game.player.city??null:null,u=s.teamId!==void 0?s.teamId:e!=null&&e===this.game.player?.id?this.game.player.city??null:null;var h={owner:e,x:t,y:r,type:n,next:null,previous:null,sourceBuildingId:s.sourceBuildingId??null,quantity:a,selected:!!s.selected,armed:!!s.armed,city:l,teamId:u};if(console.log("creating icon"),console.log(h),this.game.forceDraw=!0,this.iconListHead&&(this.iconListHead.previous=h,h.next=this.iconListHead),this.iconListHead=h,h.quantity=Math.max(1,parseInt(h.quantity,10)||1),this.game.buildingFactory&&h.owner==null){if(!h.sourceBuildingId&&typeof this.game.buildingFactory.assignIconSource=="function"){const c=this.game.buildingFactory.assignIconSource(h);c&&(h.sourceBuildingId=c.id)}!s.skipProductionUpdate&&typeof this.game.buildingFactory.handleIconProduced=="function"&&this.game.buildingFactory.handleIconProduced(h)}if(h.owner===this.game.player?.id&&h.selected){let c=this.iconListHead;for(;c;)c!==h&&c.owner===h.owner&&(c.selected=!1,c.type===Ot&&(c.armed=!1)),c=c.next;h.type===Ot&&(h.armed=!!h.armed,this.game.player.bombsArmed=h.armed),this.game.forceDraw=!0}return h}pickupIcon(){var e=this.findIconByLocation();if(e){const t=this.game.player.id,r=e.quantity??1,n=this.getAllowedQuantity(t,e.type,r);if(n<=0||n<r)return;const s=this.findOwnedIconByType(t,e.type);if(e.owner=t,e.city=this.game.player.city??null,e.teamId=this.game.player.city??null,e.quantity=r,e.selected=!1,e.armed=!1,this.game.buildingFactory&&typeof this.game.buildingFactory.handleIconCollected=="function"&&this.game.buildingFactory.handleIconCollected(e),s&&s!==e){const o=this.getLimitForType(e.type),a=(s.quantity??1)+r;s.quantity=Number.isFinite(o)?Math.min(o,Math.max(1,a)):Math.max(1,a),this.deleteIcon(e)}this.game.forceDraw=!0}}dropSelectedIcon(){for(var e=this.getHead(),t=null;e;){if(e.owner==this.game.player.id&&e.selected){t=e;break}e=e.next}if(!t)return null;const r=t.quantity??1,n={type:t.type,armed:!!t.armed,owner:this.game.player.id,city:this.game.player.city??null,teamId:this.game.player.city??null};return r>1?(t.quantity=r-1,t.selected=!0):this.deleteIcon(t),n.type===Ot&&(r>1?(t.armed=n.armed,this.game.player.bombsArmed=t.armed):this.game.player.bombsArmed=!1),this.game.forceDraw=!0,n}toggleSelected(e){e.selected=!e.selected;for(var t=this.getHead();t;)t.owner==e.owner&&t!=e&&(console.log("setting other icons selected to false"),t.selected=!1),t=t.next;e.type===Ot?(e.armed=e.selected,this.game.player.bombsArmed=e.armed):e.selected&&(this.game.player.bombsArmed=!1)}findIconByLocation(){var e=this.getHead(),t=24;const r=this.game.player?.city??null;for(;e;){const n=e.teamId===null||e.teamId===void 0||e.teamId===r;if(e.owner==null&&n&&e.x>=this.game.player.offset.x-t&&e.x<=this.game.player.offset.x+t&&e.y>=this.game.player.offset.y-t&&e.y<=this.game.player.offset.y+t)return e;e=e.next}return null}findOwnedIconByType(e,t){for(var r=this.getHead();r;){if(r.owner===e&&r.type===t)return r;r=r.next}return null}consumeOwnedIcon(e,t,r=1){if(e==null)return null;const n=this.findOwnedIconByType(e,t);if(!n)return null;const s=Number.isFinite(n.quantity)?n.quantity:parseInt(n.quantity,10)||1,o=Math.max(1,parseInt(r,10)||1);return s<=o?this.deleteIcon(n):n.quantity=s-o,this.game.forceDraw=!0,n}getSelectedIcon(e){for(var t=this.getHead();t;){if(t.owner===e&&t.selected)return t;t=t.next}return null}deleteIcon(e){var t=e.next;return e.next&&(e.next.previous=e.previous),e.previous?e.previous.next=e.next:this.iconListHead=e.next,this.game.player&&this.game.player.id===e.owner&&e.type===Ot&&(this.game.player.bombsArmed=e.armed),t}purgeCityItems(e,t=null){const r=Number.isFinite(t)?Math.floor(t):null,n=Number.isFinite(e)?Math.floor(e):null;let s=0,o=this.getHead();for(;o;){if(!(r===null||o.type===r)){o=o.next;continue}const l=Number.isFinite(o.city)?Math.floor(o.city):Number.isFinite(o.teamId)?Math.floor(o.teamId):null;if(n!==null&&l!==null&&l!==n){o=o.next;continue}o=this.deleteIcon(o),s+=1}return s>0&&(r===Ot&&this.game?.player&&(this.game.player.bombsArmed=!1),this.game.forceDraw=!0),s}getHead(){return this.iconListHead}countUnownedIconsNear(e,t,r,n=48,s=null){let o=0,a=this.getHead();for(;a;){const l=s==null||a.teamId===null||a.teamId===void 0||a.teamId===s;if(a.owner==null&&a.type===r&&l){const u=Math.abs(a.x-e),h=Math.abs(a.y-t);u<=n&&h<=n&&o++}a=a.next}return o}removeUnownedIconsNear(e,t,r,n,s=48,o=null){let a=0,l=this.getHead();for(;l&&a<n;){const u=l.next,h=o==null||l.teamId===null||l.teamId===void 0||l.teamId===o;if(l.owner==null&&l.type===r&&h){const c=Math.abs(l.x-e),f=Math.abs(l.y-t);c<=s&&f<=s&&(this.deleteIcon(l),a++)}l=u}return a}}const UT=new Set([Le,Kt,ve,he]),XT=new Set([Kt,ve,he,Le]),HT=new Set([en,Ms,ni,Ot,te,si,Ls,me]),Wf=new Set([te,Ot,me]),GT=i=>Object.prototype.hasOwnProperty.call(mf,i)?mf[i]:null,YT=i=>Object.prototype.hasOwnProperty.call(vf,i)?vf[i]:null,Yn=(i,e,t)=>{!i||!i.audio||!e||(t&&Number.isFinite(t.x)&&Number.isFinite(t.y)?i.audio.playEffect(e,{position:t}):i.audio.playEffect(e))};class zT{constructor(e){this.game=e,this.itemListHead=null,this.calculateTick=0,this.itemsById=new Map,this.pendingHazards=new Set,this.pendingDefenseIds=new Set,this.socketBound=!1,this.nextLocalId=0,this.nextDefenseId=0,this.validIcons=[Kt,he,ve,Le,te,Ot,me,si],this.validShooters=[Kt,he,ve],this.pendingOrbItems=[],this.game.socketListener&&this.bindSocketEvents(this.game.socketListener)}bindSocketEvents(e){!e||this.socketBound||(this.socketBound=!0,e.on("hazard:spawn",t=>this.onHazardSpawn(t)),e.on("hazard:update",t=>this.onHazardUpdate(t)),e.on("hazard:remove",t=>this.onHazardRemove(t)),e.on("orb:result",t=>this.onOrbResult(t)))}generateHazardId(){return this.nextLocalId+=1,`hazard_${this.game.socketListener?.io?.id??"local"}_${Date.now()}_${this.nextLocalId}`}generateDefenseId(){return this.nextDefenseId+=1,`defense_${this.game.socketListener?.io?.id??"local"}_${Date.now()}_${this.nextDefenseId}`}insertItem(e){this.itemListHead&&(this.itemListHead.previous=e,e.next=this.itemListHead),this.itemListHead=e,this.itemsById.set(e.id,e),this.game.forceDraw=!0}detachItem(e){e&&(e.next&&(e.next.previous=e.previous),e.previous?e.previous.next=e.next:this.itemListHead===e&&(this.itemListHead=e.next),e.next=null,e.previous=null,this.itemsById.delete(e.id))}cycle(){if(this.game.tick>this.calculateTick){this.calculateTick=this.game.tick+200;for(var e=this.getHead();e;)this.validShooters.includes(e.type)&&(this.targetNearestPlayer(e),this.fireBullet(e)),e=e.next}this.processBombs()}fireBullet(e){if(this.validShooters.includes(e.type)&&this.game.tick>e.lastFired&&e.target){e.lastFired=this.game.tick+250;var t=e.angle*3.14/180,r=-(32/6*t),n=Math.sin(e.angle*3.14/180),s=Math.cos(e.angle*3.14/180)*-1,o=e.x+20+n*23,a=e.y+24+s*23;const l=e.ownerId??e.owner??this.game.player.id,u=e.teamId??this.game.player.city??null;this.game.bulletFactory.newBullet(l,o,a,0,r,u,{sourceId:e.id??null,sourceType:this.resolveItemSourceType(e),targetId:e.target??null}),Yn(this.game,this.resolveDefenseShotSound(e),{x:o,y:a}),this.emitItemBulletShot(e,{x:o,y:a,angle:r,team:u})}}useMedkit(){const e=this.game?.player?.id;if(e==null)return!1;if(this.game?.player?.health>=mi)return console.log("Health already full; medkit not consumed."),!1;if(!this.game.iconFactory||typeof this.game.iconFactory.findOwnedIconByType!="function")return!1;const t=this.game.iconFactory.findOwnedIconByType(e,ni);if(!t)return console.log("No MedKit available to use."),!1;const r=t.id??null;return this.game.iconFactory.consumeOwnedIcon(e,ni,1),this.game.player&&(this.game.player.health=mi,this.game.forceDraw=!0),this.game.socketListener&&typeof this.game.socketListener.useItem=="function"&&this.game.socketListener.useItem("medkit",{iconId:r,type:ni}),!0}activateCloak(){const e=this.game?.player?.id;if(e==null||!this.game.iconFactory||typeof this.game.iconFactory.findOwnedIconByType!="function")return!1;const t=this.game.iconFactory.findOwnedIconByType(e,en);if(!t)return console.log("Cloak unavailable."),!1;const n=(this.game.tick||Date.now())+of;this.game.player&&(this.game.player.isCloaked=!0,this.game.player.cloakExpiresAt=n,this.game.forceDraw=!0);const s=this.game.player?.offset;return s&&Number.isFinite(s.x)&&Number.isFinite(s.y)?Yn(this.game,ct.CLOAK,{x:s.x+24,y:s.y+24}):Yn(this.game,ct.CLOAK),this.game.socketListener&&typeof this.game.socketListener.useItem=="function"&&this.game.socketListener.useItem("cloak",{iconId:t.id??null,type:en,duration:of}),!0}freezeCurrentPlayer(e=s_,t="dfg"){if(!this.game||!this.game.player)return;const r=this.game.tick||Date.now();this.game.player.isFrozen=!0,this.game.player.frozenUntil=r+Math.max(0,e),this.game.player.frozenBy=t,this.game.player.isMoving=0,this.game.player.isTurning=0,this.game.forceDraw=!0}triggerDFG(e){!e||e.type!==me||(e.active=!1,e.armed=!1,e.hidden=!0,this.freezeCurrentPlayer(),this.game.forceDraw=!0)}targetNearestPlayer(e){var t=null;const r=e.teamId??null,n=(o,a)=>{if(!o||!o.offset)return;const l=o.city??null;if(!(r!==null&&l===r)){var u=o.offset.x-e.x,h=o.offset.y-e.y,c=Math.sqrt(u*u+h*h);c>400||(!t||c<t.distance)&&(t={id:a,x:o.offset.x,y:o.offset.y,distance:c,team:l})}};if(n(this.game.player,this.game.player.id),Object.keys(this.game.otherPlayers).forEach(o=>{n(this.game.otherPlayers[o],o)}),this.game.rogueTankManager&&Array.isArray(this.game.rogueTankManager.tanks)&&this.game.rogueTankManager.tanks.forEach(o=>{!o||!o.offset||n(o,o.id||`rogue_${o.offset.x}_${o.offset.y}`)}),t){e.target=t.id,e.targetTeam=t.team??null;var s=Math.atan2(t.x-e.x,t.y-e.y);s=Math.ceil(s*180/3.14),t.x>=e.x?e.angle=180-s:t.x<=e.x?e.angle=s*-1+170:e.angle=s}else e.target=null,e.targetTeam=null}ensureItemDurability(e,t=null){if(!e)return;const r=Number.isFinite(t)?t:e.type,n=GT(r);n!=null&&(Number.isFinite(e.maxLife)||(e.maxLife=n),Number.isFinite(e.life)||(e.life=n));const s=YT(r);s!=null&&(Number.isFinite(e.burnThreshold)||(e.burnThreshold=s)),Object.prototype.hasOwnProperty.call(e,"isBurning")||(e.isBurning=!1),Number.isFinite(e.life)&&Number.isFinite(e.burnThreshold)&&Number.isFinite(e.maxLife)&&e.life<e.maxLife&&e.life<=e.burnThreshold&&this.markItemBurning(e)}markItemBurning(e){e&&(e.isBurning||(e.isBurning=!0,e.lifeState="burning",Number.isFinite(e.animation)||(e.animation=1),Number.isFinite(e.animationTick)||(e.animationTick=0)))}isHazardType(e){return Wf.has(e)}shouldRemoveOnHit(e){return HT.has(e)?!0:!UT.has(e)}destroyItem(e,t={}){if(!e)return;const r=Number.isFinite(t.impactX)?t.impactX:e.x,n=Number.isFinite(t.impactY)?t.impactY:e.y;t.spawnExplosion!==!1&&this.spawnExplosion(r,n),this.deleteItem(e,{notifyServer:t.notifyServer,reason:t.reason||"destroyed"}),this.game.forceDraw=!0}handleBulletHit(e,t){if(!e||!t)return{consumed:!1};if(t.sourceId&&e.id&&t.sourceId===e.id)return{consumed:!1};const r=Number.isFinite(t.x)?t.x:e.x,n=Number.isFinite(t.y)?t.y:e.y,s=Number.isFinite(t.damage)?t.damage:5,o={consumed:!0,destroyed:!1,type:e.type};return this.shouldRemoveOnHit(e.type)?(this.destroyItem(e,{impactX:r,impactY:n}),o.destroyed=!0,o):(this.ensureItemDurability(e),Number.isFinite(e.life)?(e.life-=s,e.life<=0?(this.destroyItem(e,{impactX:r,impactY:n}),o.destroyed=!0,o):(Number.isFinite(e.burnThreshold)&&e.life<=e.burnThreshold&&this.markItemBurning(e),this.spawnExplosion(r,n),this.game.forceDraw=!0,o)):(this.destroyItem(e,{impactX:r,impactY:n}),o.destroyed=!0,o))}newItem(e,t,r,n,s={}){if(!this.validIcons.includes(n))return null;let o=null,a=null;if(e&&typeof e=="object"?(o=e.owner??e.id??null,a=e.city??null):e!==void 0&&(o=e),a===null&&o!==null&&(a=this.game.player?.city??null),s.teamId!==void 0&&s.teamId!==null){const E=Number(s.teamId);Number.isFinite(E)&&(a=Math.floor(E))}if(!Number.isFinite(a)&&s.city!==void 0&&s.city!==null){const E=Number(s.city);Number.isFinite(E)&&(a=Math.floor(E))}let l=t,u=r;(n===Ot||n===te)&&(l=Math.floor(t/48)*48,u=Math.floor(r/48)*48);const h=Wf.has(n),c=XT.has(n),f=s.notifyServer!==!1&&h,d=s.notifyServer!==!1&&!h&&c,p=f?this.generateHazardId():d?this.generateDefenseId():null,v=s.id||p||`item_${Date.now()}_${Math.random().toString(16).slice(2)}`,m=e&&typeof e=="object"&&e.armed!==void 0?!!e.armed:this.game.player?.bombsArmed??!1,g={id:v,owner:o,ownerId:o,teamId:a,city:a,x:l,y:u,target:null,targetTeam:null,type:n,lastFired:0,active:n===Ot?m:!0,armed:n===Ot?m:!0,detonateTick:s.detonateTick||null,next:null,previous:null,synced:!(f||d)};return g.isDefense=c,this.ensureItemDurability(g,n),this.insertItem(g),c&&!d&&this.pendingDefenseIds.delete(g.id),n===si&&s.notifyServer!==!1&&this.queueOrbDrop(g,{ownerId:o,teamId:a}),f&&this.game.socketListener&&(this.pendingHazards.add(g.id),this.game.socketListener.spawnHazard({id:g.id,type:n,x:g.x,y:g.y,armed:g.active,ownerId:o,teamId:a})),d&&this.game.socketListener&&typeof this.game.socketListener.spawnDefense=="function"&&(this.pendingDefenseIds.add(g.id),this.game.socketListener.spawnDefense({id:g.id,type:n,x:g.x,y:g.y,ownerId:o,teamId:a,cityId:a,angle:g.angle??0})),n===Ot&&this.armBomb(g,g.active,{notifyServer:!1}),g}shouldNotifyServerForItem(e){if(!e||!this.game||!this.game.socketListener||typeof this.game.socketListener.sendBulletShot!="function")return!1;const t=this.game.player?.id??null;if(!t)return!1;const r=e.ownerId??e.owner??null;return e.isDefense||r==null?!0:r===t}resolveItemSourceType(e){return e?e.type===Kt?"turret":e.type===he?"plasma":e.type===ve?"sleeper":null:null}resolveDefenseShotSound(e){return e&&(e.type===Kt||e.type===he||e.type===ve)?ct.TURRET:ct.LASER}resolveItemTeam(e,t=null){if(!e)return t;const r=e.teamId??e.city??null;return Number.isFinite(r)?r:Number.isFinite(t)?t:this.game.player?.city??null}emitItemBulletShot(e,t){if(!this.shouldNotifyServerForItem(e))return;const r=this.game.socketListener;if(!r)return;const n=this.game.player?.id??null;if(!n)return;const s={shooter:n,x:t?.x??e.x,y:t?.y??e.y,type:t?.type??0,angle:t?.angle??0,team:this.resolveItemTeam(e,t?.team??null),sourceId:e.id??null,sourceType:this.resolveItemSourceType(e)||void 0,targetId:e.target??null};r.sendBulletShot(s)}deleteItem(e,t={}){if(!e)return null;const r=t.notifyServer!==!1,n=e.next;if(Array.isArray(this.pendingOrbItems)){const s=this.pendingOrbItems.indexOf(e);s!==-1&&this.pendingOrbItems.splice(s,1)}if(r&&this.isHazardType(e.type)&&this.game.socketListener&&typeof this.game.socketListener.removeHazard=="function")try{this.game.socketListener.removeHazard(e.id)}catch(s){console.debug("Failed to notify server about hazard removal",s)}if(r&&e.isDefense&&this.game.socketListener&&typeof this.game.socketListener.removeDefense=="function")try{this.game.socketListener.removeDefense(e.id)}catch(s){console.debug("Failed to notify server about defense removal",s)}return this.detachItem(e),this.pendingHazards.delete(e.id),this.pendingDefenseIds&&this.pendingDefenseIds.delete(e.id),n}processBombs(){}armBomb(e,t,r={}){!e||e.type!==Ot||(e.active=t,e.armed=t,r.notifyServer!==!1&&this.game.socketListener&&e.id&&this.game.socketListener.updateHazard({id:e.id,armed:!!t}))}detonateBomb(e,t={}){const r=t.notifyServer!==void 0?!!t.notifyServer:!0,n=Math.floor((e.x+24)/48),s=Math.floor((e.y+24)/48);console.log(`Bomb detonated at tile ${n}, ${s}`);let o=this.deleteItem(e,{notifyServer:r}),a=this.getHead();for(;a;){const u=a.next,h=Math.floor((a.x+24)/48),c=Math.floor((a.y+24)/48);Math.abs(h-n)<=lf&&Math.abs(c-s)<=lf&&this.deleteItem(a,{notifyServer:r}),a=u}let l=this.game.buildingFactory.getHead();for(;l;){const u=Math.floor(l.x)-n,h=Math.floor(l.y)-s;if(Math.abs(u)<=af&&Math.abs(h)<=af){if(l.type===Fe){l=l.next;continue}l=this.game.buildingFactory.deleteBuilding(l,r);continue}l=l.next}return this.damagePlayersInRadius(n,s),this.game.forceDraw=!0,o}damagePlayersInRadius(){}queueOrbDrop(e,t={}){if(!e||!this.game||!this.game.socketListener)return;const r=this.game.player?.id??null,n=t.ownerId??e.ownerId??r;if(!r||n!==r)return;Array.isArray(this.pendingOrbItems)||(this.pendingOrbItems=[]),this.pendingOrbItems.push(e),e.pendingOrbCheck=!0;const s={id:e.id,x:e.x,y:e.y,ownerId:n,city:t.teamId??e.teamId??this.game.player?.city??null,type:si};this.game.socketListener.sendOrbDrop(s)}triggerMine(e){!e||e.type!==te||(e.active=!1,e.armed=!1,e.hidden=!0,this.game.forceDraw=!0)}onHazardSpawn(e){if(!e||!e.id)return;let t=this.itemsById.get(e.id);if(!t){const r=this.resolveItemType(e.type);if(t=this.newItem(null,e.x,e.y,r,{id:e.id,notifyServer:!1,detonateTick:e.detonateAt?e.detonateAt:null}),!t)return}this.applyHazardState(t,e),t.synced=!0,this.pendingHazards.delete(e.id)}onHazardUpdate(e){if(!e||!e.id)return;const t=this.itemsById.get(e.id);if(!t){this.onHazardSpawn(e);return}this.applyHazardState(t,e)}onHazardRemove(e){if(!e||!e.id)return;const t=this.itemsById.get(e.id);if(t){if(e.reason==="bomb_detonated"&&this.spawnExplosion(e.x??t.x,e.y??t.y),e.reason==="dfg_triggered"&&e.triggeredBy){const r=this.game.player?.id;e.triggeredBy===r&&this.freezeCurrentPlayer()}this.deleteItem(t,{notifyServer:!1}),this.game.forceDraw=!0}}onOrbResult(e){if(!Array.isArray(this.pendingOrbItems)||!this.pendingOrbItems.length)return;const t=this.pendingOrbItems.shift();!t||(t.pendingOrbCheck=!1,(e||{}).status!=="detonated")||(this.spawnExplosion(t.x,t.y),this.deleteItem(t,{notifyServer:!1}),this.game.forceDraw=!0)}applyHazardState(e,t){if(e.x=this.toFiniteNumber(t.x,e.x),e.y=this.toFiniteNumber(t.y,e.y),t.active!==void 0&&(e.active=!!t.active),t.armed!==void 0&&(e.armed=!!t.armed),t.detonateAt&&(e.detonateTick=t.detonateAt),t.life!==void 0){const r=this.toFiniteNumber(t.life,e.life);Number.isFinite(r)&&(e.life=r)}if(t.revealedAt!==void 0){const r=this.toFiniteNumber(t.revealedAt,e.revealedAt??null);e.revealedAt=Number.isFinite(r)?r:null}t.triggeredBy!==void 0&&(e.triggeredBy=t.triggeredBy??null),t.triggeredTeam!==void 0&&(e.triggeredTeam=t.triggeredTeam??null),this.ensureItemDurability(e)}resolveItemType(e){return e==="mine"||e===te||e===4?te:e==="bomb"||e===Ot||e===3?Ot:e==="dfg"||e===me||e===7?me:te}spawnExplosion(e,t){!this.game||!Array.isArray(this.game.explosions)||(this.game.explosions.push({x:e,y:t,frame:0,nextFrameTick:null,variant:"small"}),Yn(this.game,ct.EXPLOSION,{x:e,y:t}))}toFiniteNumber(e,t){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const r=Number(e);if(Number.isFinite(r))return r}return t}getHead(){return this.itemListHead}getItemById(e){return e&&this.itemsById.get(e)||null}removeItemById(e,t={}){const r=this.getItemById(e);return r?(this.deleteItem(r,t),!0):!1}}const pt=48,Ct=pt/2,zn=8,VT=2,qT=2,Kf=18,$T=32,jT=5e3,WT=1300,KT=2200,ZT=.55,JT=2800,Vn=pt*10,Zf=6,Jf=9e3,QT=4500,tI=2600,eI=1200,Qf=pt*7,rI=24e4,iI=pt*7,Zr=pt*11,td=pt*13,nI=pt*7,sI=20,oI=6e4,aI=6e4,ed=Object.freeze([Math.PI/4,-Math.PI/4,Math.PI/2,-Math.PI/2]),Al=pt*2.5,tr=(i,e=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const t=Number(i);if(Number.isFinite(t))return t}return e},qn=(i,e,t,r)=>{const n=i-t,s=e-r;return n*n+s*s},lI=i=>{const e=-i/16*Math.PI;return{dx:Math.sin(e),dy:Math.cos(e)}},Ia=(i,e,t=0)=>{if(!Number.isFinite(i)||!Number.isFinite(e)||Math.abs(i)<1e-4&&Math.abs(e)<1e-4)return t;const r=Math.sqrt(i*i+e*e);if(r<1e-4)return t;const n=i/r,s=e/r,o=Math.atan2(-n,-s);let a=Math.round(-o/Math.PI*16);return a%=32,a<0&&(a+=32),a},Cl=(i,e)=>{const t=Math.sqrt(i*i+e*e);return t<1e-4?{dx:0,dy:0}:{dx:i/t,dy:e/t}},uI=(i,e)=>{if(!i)return{dx:0,dy:0};const t=Math.cos(e),r=Math.sin(e),n=i.dx*t-i.dy*r,s=i.dx*r+i.dy*t;return Cl(n,s)},hI=(i,e,t,r,n=Al)=>{const s=t-i,o=r-e;let a="",l="";return Math.abs(s)>n&&(a=s>0?"east":"west"),Math.abs(o)>n&&(l=o>0?"south":"north"),a&&l?`${l}-${a}`:l||a||""};class cI{constructor(e){this.game=e,this.tanks=[],this.nextId=1,this.nextSpawnCheck=0,this.instancePrefix=`local_${Math.random().toString(16).slice(-6)}`,this.nextAllowedSpawnTime=0,this.cityRadiusCache=new Map}getCallsignRegistry(){return this.game?.callsignRegistry||null}assignCallsign(e){const t=this.getCallsignRegistry();if(!t)return null;try{return t.assign(e)}catch{return null}}releaseCallsign(e){const t=this.getCallsignRegistry();if(t)try{t.release(e)}catch{}}sanitizeIdComponent(e){return!e||typeof e!="string"?null:e.replace(/[^a-zA-Z0-9_-]/g,"")}getClientInstanceId(){const e=this.game?.socketListener?.io?.id,t=this.sanitizeIdComponent(e);return t&&t.length?t:this.instancePrefix}createTankId(){const t=`rogue_${this.getClientInstanceId()}_${this.nextId}`;return this.nextId+=1,t}emitTankShot(e,t,r,n){const s=this.game?.socketListener;if(!s||typeof s.sendBulletShot!="function")return;const o=this.game.player?.id??null;o&&s.sendBulletShot({shooter:o,x:t,y:r,type:0,angle:-n,team:null,sourceId:e?.id??null,sourceType:"rogue_tank",targetId:typeof e?.target=="object"?e.target.id??null:null})}update(){if(!this.game||!this.game.buildingFactory)return;const e=this.game.tick||Date.now();e>=this.nextSpawnCheck&&(this.nextSpawnCheck=e+jT,this.evaluateSpawns(e)),this.updateTanks(e)}evaluateSpawns(e){const t=Number.isFinite(e)?e:this.game.tick||Date.now(),r=this.game.cities||[];if(!r.length)return;let n=Math.max(0,VT-this.tanks.length);n!==0&&(this.tanks.length===0&&this.nextAllowedSpawnTime>0&&t<this.nextAllowedSpawnTime||r.forEach((s,o)=>{if(!s||n<=0)return;const a=this.game.buildingFactory.countBuildingsForCity(o);if(a<Kf)return;const l=this.tanks.filter(f=>f.targetCityId===o),u=a>=$T?2:1,h=Math.min(u,qT),c=Math.min(n,h-l.length);for(let f=0;f<c;f+=1)if(this.spawnTankNearCity(s,o,t)&&(n-=1,n<=0))return}))}updateTanks(e){for(let t=this.tanks.length-1;t>=0;t-=1){const r=this.tanks[t];if(!r){this.tanks.splice(t,1);continue}if(e-r.spawnedAt>rI||!this.cityStillValid(r.targetCityId)){this.removeTankAtIndex(t);continue}this.refreshTarget(r,e),this.updateMovement(r,e),this.tryShoot(r,e),this.tryDropBomb(r,e),this.updateBombs(r,e)}}cityStillValid(e){return this.game.cities?.[e]?this.game.buildingFactory.countBuildingsForCity(e)>=Kf-3:!1}spawnTankNearCity(e,t,r){const n=tr(e?.x,0),s=tr(e?.y,0),o=n+pt*1.5,a=s+pt*1.5,l=td,u=td+nI;for(let h=0;h<sI;h+=1){const c=Math.random()*Math.PI*2,f=l+Math.random()*(u-l);let d=o+Math.cos(c)*f,p=a+Math.sin(c)*f;if(d=Math.max(Ct,Math.min(512*pt-Ct,d)),p=Math.max(Ct,Math.min(512*pt-Ct,p)),this.isBlocked(d,p))continue;const v=this.createTankId(),m=Number.isFinite(r)?r:this.game.tick||Date.now(),g=this.getCityEngageRadius(t,m),E={id:v,offset:{x:d,y:p},lastSafeOffset:{x:d,y:p},direction:Math.floor(Math.random()*32),isMoving:0,targetCityId:t,target:null,nextDecisionAt:m+250+Math.random()*250,nextTargetRefresh:m+Math.random()*500,fireCooldown:m+1400+Math.random()*900,bombCooldown:m+3800+Math.random()*2200,activeBombs:[],spawnedAt:m,city:-1,health:20,cachedVector:null,notifiedAttack:!1,engageRadius:g,nextRadiusRefresh:m+5e3};return E.callsign=this.assignCallsign(v)||`Rogue ${this.nextId}`,this.tanks.push(E),this.game.forceDraw=!0,!0}return!1}getCityCenter(e){const t=this.game.cities?.[e];if(!t)return null;const r=tr(t.x,0)+pt*1.5,n=tr(t.y,0)+pt*1.5;return{x:r,y:n}}refreshTarget(e,t){if(t<e.nextTargetRefresh)return;e.nextTargetRefresh=t+KT+Math.random()*1200;const r=this.getCityCenter(e.targetCityId);if(r){(!Number.isFinite(e.engageRadius)||t>=(e.nextRadiusRefresh||0))&&(e.engageRadius=this.getCityEngageRadius(e.targetCityId,t),e.nextRadiusRefresh=t+5e3);const o=Number.isFinite(e.engageRadius)?e.engageRadius:Zr;if(qn(e.offset.x+Ct,e.offset.y+Ct,r.x,r.y)>o*o){e.target={kind:"point",x:r.x,y:r.y};return}this.notifyCityUnderAttack(e,e.targetCityId,r,o)}const n=this.pickNearestTurret(e);if(n){e.target=n;return}const s=this.pickWanderPoint(e.targetCityId);e.target=s}pickNearestTurret(e){const t=this.game.itemFactory;if(!t)return null;let r=t.getHead(),n=null;const s=Vn*Vn*1.3;for(;r;){if(r.type===Kt||r.type===he){const o=qn(r.x+Ct,r.y+Ct,e.offset.x+Ct,e.offset.y+Ct);o<s&&(!n||o<n.distanceSq)&&(n={kind:"item",id:r.id,x:r.x+Ct,y:r.y+Ct,distanceSq:o})}r=r.next}return n}pickWanderPoint(e){const t=this.game.cities?.[e],r=tr(t?.x,0)+pt*1.5,n=tr(t?.y,0)+pt*1.5,s=Math.random()*Math.PI*2,o=pt*2+Math.random()*iI;return{kind:"point",x:r+Math.cos(s)*o,y:n+Math.sin(s)*o}}updateMovement(e,t){if(t<e.nextDecisionAt){this.applyMovement(e,t,e.cachedVector)||(e.nextDecisionAt=t);return}e.nextDecisionAt=t+WT+Math.random()*900;const r=this.resolveTargetPosition(e.target);if(!r){e.cachedVector=null,e.isMoving=0;return}const n=r.x-(e.offset.x+Ct),s=r.y-(e.offset.y+Ct);if(n*n+s*s<pt*pt*2.5){e.cachedVector=null,e.isMoving=0;return}const a=Cl(n,s),l=(Math.random()-.5)*.4,u=Cl(a.dx+l,a.dy+l);e.cachedVector=u,e.direction=Ia(u.dx,u.dy,e.direction),this.applyMovement(e,t,u)||(e.nextDecisionAt=t+400+Math.random()*300)}applyMovement(e,t,r){if(!r||!Number.isFinite(r.dx)||!Number.isFinite(r.dy)||Math.abs(r.dx)<1e-4&&Math.abs(r.dy)<1e-4)return e.isMoving=0,!1;const s=Math.min(this.game.timePassed||0,60)*yl*ZT;if(s<=0)return!1;if(this.tryStep(e,r,s))return e.isMoving=1,!0;const o=this.findAlternateVector(e,r,s);return o&&this.tryStep(e,o,s)?(e.cachedVector=o,e.direction=Ia(o.dx,o.dy,e.direction),e.isMoving=1,!0):(e.isMoving=0,e.cachedVector=null,e.nextDecisionAt=Math.min(e.nextDecisionAt||t+400,t+450+Math.random()*250),!1)}tryStep(e,t,r){if(!t)return!1;const n=e.offset.x+t.dx*r,s=e.offset.y+t.dy*r;return this.isBlocked(n,s)?!1:(e.offset.x=n,e.offset.y=s,e.lastSafeOffset={x:n,y:s},!0)}findAlternateVector(e,t,r){if(!t)return null;for(let n=0;n<ed.length;n+=1){const s=uI(t,ed[n]);if(!s||Math.abs(s.dx)<1e-4&&Math.abs(s.dy)<1e-4)continue;const o=e.offset.x+s.dx*r,a=e.offset.y+s.dy*r;if(!this.isBlocked(o,a))return s}return null}resolveTargetPosition(e){if(!e)return null;if(e.kind==="item"&&e.id){const t=this.game.itemFactory?.itemsById?.get(e.id);return t?(e.x=t.x+Ct,e.y=t.y+Ct,e):null}return e}tryShoot(e,t){if(t<e.fireCooldown)return;const r=this.resolveTargetPosition(e.target);if(!r||qn(e.offset.x+Ct,e.offset.y+Ct,r.x,r.y)>Vn*Vn)return;const s=Math.floor(Math.random()*Zf-Zf/2),o=r.x-(e.offset.x+Ct),a=r.y-(e.offset.y+Ct);let l=Ia(o,a,e.direction);l=(l+s)%32,l<0&&(l+=32);const u=lI(l),h=e.offset.x+Ct+u.dx*30,c=e.offset.y+Ct+u.dy*30;this.game.bulletFactory.newBullet(e.id,h,c,0,-l,null),this.emitTankShot(e,h,c,l),e.fireCooldown=t+JT+Math.random()*800}tryDropBomb(e,t){if(t<e.bombCooldown)return;const r=this.game.cities?.[e.targetCityId];if(!r)return;const n=tr(r.x,0)+pt*1.5,s=tr(r.y,0)+pt*1.5;if(qn(e.offset.x+Ct,e.offset.y+Ct,n,s)>Qf*Qf)return;const a=this.game.itemFactory?.newItem({id:e.id,city:null,armed:!0},e.offset.x,e.offset.y,Ot,{notifyServer:!1});if(!a){e.bombCooldown=t+Jf;return}a.active=!0,a.armed=!0;const l={item:a,detonateAt:t+tI+Math.random()*eI};e.activeBombs.push(l),e.bombCooldown=t+Jf+Math.random()*QT,this.game.forceDraw=!0}updateBombs(e,t){if(!Array.isArray(e.activeBombs)||!e.activeBombs.length)return;const r=[];for(let n=0;n<e.activeBombs.length;n+=1){const s=e.activeBombs[n];if(!(!s||!s.item)){if(t>=s.detonateAt){this.game.itemFactory.spawnExplosion(s.item.x,s.item.y),this.game.itemFactory.detonateBomb(s.item,{notifyServer:!1});continue}r.push(s)}}e.activeBombs=r}isBlocked(e,t){const r={x:e+zn,y:t+zn,w:pt-zn*2,h:pt-zn*2};return!!(this.hitsEdges(r)||this.hitsBlockingTile(r)||this.hitsBuilding(r)||this.hitsItem(r))}hitsEdges(e){return e.x<0||e.y<0||e.x+e.w>512*pt||e.y+e.h>512*pt}hitsBlockingTile(e){const t=this.game.map;if(!Array.isArray(t)||!t.length)return!1;const r=Math.floor(e.x/pt),n=Math.floor((e.x+e.w)/pt),s=Math.floor(e.y/pt),o=Math.floor((e.y+e.h)/pt),a=(l,u)=>{try{return t[l][u]!==0&&t[l][u]!==3}catch{return!0}};return a(r,s)||a(r,o)||a(n,s)||a(n,o)}hitsBuilding(e){let t=this.game.buildingFactory.getHead();for(;t;){const r={x:t.x*pt,y:t.y*pt,w:pt*3,h:pt*3};if($e(e,r))return!0;t=t.next}return!1}hitsItem(e){let t=this.game.itemFactory.getHead();for(;t;){const r={x:t.x,y:t.y,w:pt,h:pt};if($e(e,r))return!0;t=t.next}return!1}resolveBulletKillDetails(e){const t={killerId:null,killerCallsign:null,sourceType:e&&e.sourceType?String(e.sourceType).toLowerCase():null,hazardType:null};if(!e)return t;const r=[e.sourceId,e.shooter];for(let n=0;n<r.length;n+=1){const s=r[n];if(s==null)continue;const o=`${s}`;t.killerId=o;const a=typeof this.game?.resolveCallsign=="function"?this.game.resolveCallsign(o):null;if(a){t.killerCallsign=a;break}}return typeof this.game?.describeKillSource=="function"?t.killerLabel=this.game.describeKillSource(t):t.killerCallsign?t.killerLabel=t.killerCallsign:t.killerLabel="Unknown Forces",t}announceRogueDeath(e,t){if(!e||typeof this.game?.notify!="function")return;const r=e.callsign||(typeof this.game?.resolveCallsign=="function"?this.game.resolveCallsign(e.id):null)||"Rogue Tank";let n=t?.killerLabel;t&&t.killerId&&`${t.killerId}`==`${e.id}`&&(n="Self-Inflicted"),(!n||!n.trim().length)&&typeof this.game?.describeKillSource=="function"&&(n=this.game.describeKillSource(t||{})),(!n||!n.trim().length)&&(n="Unknown Forces"),this.game.notify({title:"Elimination",message:`${r} killed by ${n}.`,variant:"warn",timeout:5200})}handleBulletCollision(e,t){if(!t||e.shooter&&e.shooter===t.id)return;const r=Number.isFinite(e.damage)?e.damage:5;if(t.health-=r,t.health<=0){const n=this.resolveBulletKillDetails(e);this.spawnTankExplosion(t),this.announceRogueDeath(t,n),this.removeTank(t)}}spawnTankExplosion(e){Array.isArray(this.game.explosions)&&this.game.explosions.push({x:e.offset.x,y:e.offset.y,frame:0,nextFrameTick:(this.game.tick||Date.now())+75,variant:"small"})}removeTank(e){const t=this.tanks.indexOf(e);t!==-1&&this.removeTankAtIndex(t)}removeTankAtIndex(e){const[t]=this.tanks.splice(e,1);t&&Array.isArray(t.activeBombs)&&t.activeBombs.forEach(r=>{!r||!r.item||this.game.itemFactory.deleteItem(r.item)}),this.tanks.length===0&&this.scheduleNextSpawn(),t&&this.releaseCallsign(t.id),this.game.forceDraw=!0}scheduleNextSpawn(){const e=this.game.tick||Date.now(),t=oI+Math.random()*aI;this.nextAllowedSpawnTime=e+t}notifyCityUnderAttack(e,t,r,n){if(!e||e.notifiedAttack)return;const s=this.game?.notify;if(typeof s!="function")return;const o=Ft(t),a=hI(r?.x??0,r?.y??0,e.offset?.x??0,e.offset?.y??0,Math.max(Al,(n||Al)*.25)),l=a?`Rogue tank assaulting ${o} from the ${a}.`:`Rogue tank assaulting ${o}.`;s({title:"Rogue Assault",message:l,variant:"warn",timeout:6500}),e.notifiedAttack=!0}getCityEngageRadius(e,t){const r=Number.isFinite(e)?e:parseInt(e,10);if(!Number.isFinite(r))return Zr;const n=Number.isFinite(t)?t:this.game.tick||Date.now(),s=this.cityRadiusCache.get(r);if(s&&n-s.timestamp<4e3)return s.radius;const o=this.computeCityEngageRadius(r);return this.cityRadiusCache.set(r,{radius:o,timestamp:n}),o}computeCityEngageRadius(e){if(!this.game?.buildingFactory||typeof this.game.buildingFactory.measureCityLayout!="function")return Zr;const t=this.game.buildingFactory.measureCityLayout(e);if(!t)return Zr;const r=Number.isFinite(t.maxRadiusSq)&&t.maxRadiusSq>0?Math.sqrt(t.maxRadiusSq):0;return!Number.isFinite(r)||r<=0?Zr:Math.max(Zr,r+pt*4)}}const Re=Object.create(null);Re.open="0";Re.close="1";Re.ping="2";Re.pong="3";Re.message="4";Re.upgrade="5";Re.noop="6";const ss=Object.create(null);Object.keys(Re).forEach(i=>{ss[Re[i]]=i});const Pl={type:"error",data:"parser error"},Om=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Fm=typeof ArrayBuffer=="function",Rm=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i&&i.buffer instanceof ArrayBuffer,Uu=({type:i,data:e},t,r)=>Om&&e instanceof Blob?t?r(e):rd(e,r):Fm&&(e instanceof ArrayBuffer||Rm(e))?t?r(e):rd(new Blob([e]),r):r(Re[i]+(e||"")),rd=(i,e)=>{const t=new FileReader;return t.onload=function(){const r=t.result.split(",")[1];e("b"+(r||""))},t.readAsDataURL(i)};function id(i){return i instanceof Uint8Array?i:i instanceof ArrayBuffer?new Uint8Array(i):new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}let Ea;function fI(i,e){if(Om&&i.data instanceof Blob)return i.data.arrayBuffer().then(id).then(e);if(Fm&&(i.data instanceof ArrayBuffer||Rm(i.data)))return e(id(i.data));Uu(i,!1,t=>{Ea||(Ea=new TextEncoder),e(Ea.encode(t))})}const nd="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Yi=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let i=0;i<nd.length;i++)Yi[nd.charCodeAt(i)]=i;const dI=i=>{let e=i.length*.75,t=i.length,r,n=0,s,o,a,l;i[i.length-1]==="="&&(e--,i[i.length-2]==="="&&e--);const u=new ArrayBuffer(e),h=new Uint8Array(u);for(r=0;r<t;r+=4)s=Yi[i.charCodeAt(r)],o=Yi[i.charCodeAt(r+1)],a=Yi[i.charCodeAt(r+2)],l=Yi[i.charCodeAt(r+3)],h[n++]=s<<2|o>>4,h[n++]=(o&15)<<4|a>>2,h[n++]=(a&3)<<6|l&63;return u},pI=typeof ArrayBuffer=="function",Xu=(i,e)=>{if(typeof i!="string")return{type:"message",data:Mm(i,e)};const t=i.charAt(0);return t==="b"?{type:"message",data:yI(i.substring(1),e)}:ss[t]?i.length>1?{type:ss[t],data:i.substring(1)}:{type:ss[t]}:Pl},yI=(i,e)=>{if(pI){const t=dI(i);return Mm(t,e)}else return{base64:!0,data:i}},Mm=(i,e)=>{switch(e){case"blob":return i instanceof Blob?i:new Blob([i]);case"arraybuffer":default:return i instanceof ArrayBuffer?i:i.buffer}},Lm="",mI=(i,e)=>{const t=i.length,r=new Array(t);let n=0;i.forEach((s,o)=>{Uu(s,!1,a=>{r[o]=a,++n===t&&e(r.join(Lm))})})},vI=(i,e)=>{const t=i.split(Lm),r=[];for(let n=0;n<t.length;n++){const s=Xu(t[n],e);if(r.push(s),s.type==="error")break}return r};function gI(){return new TransformStream({transform(i,e){fI(i,t=>{const r=t.length;let n;if(r<126)n=new Uint8Array(1),new DataView(n.buffer).setUint8(0,r);else if(r<65536){n=new Uint8Array(3);const s=new DataView(n.buffer);s.setUint8(0,126),s.setUint16(1,r)}else{n=new Uint8Array(9);const s=new DataView(n.buffer);s.setUint8(0,127),s.setBigUint64(1,BigInt(r))}i.data&&typeof i.data!="string"&&(n[0]|=128),e.enqueue(n),e.enqueue(t)})}})}let Sa;function $n(i){return i.reduce((e,t)=>e+t.length,0)}function jn(i,e){if(i[0].length===e)return i.shift();const t=new Uint8Array(e);let r=0;for(let n=0;n<e;n++)t[n]=i[0][r++],r===i[0].length&&(i.shift(),r=0);return i.length&&r<i[0].length&&(i[0]=i[0].slice(r)),t}function bI(i,e){Sa||(Sa=new TextDecoder);const t=[];let r=0,n=-1,s=!1;return new TransformStream({transform(o,a){for(t.push(o);;){if(r===0){if($n(t)<1)break;const l=jn(t,1);s=(l[0]&128)===128,n=l[0]&127,n<126?r=3:n===126?r=1:r=2}else if(r===1){if($n(t)<2)break;const l=jn(t,2);n=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),r=3}else if(r===2){if($n(t)<8)break;const l=jn(t,8),u=new DataView(l.buffer,l.byteOffset,l.length),h=u.getUint32(0);if(h>Math.pow(2,21)-1){a.enqueue(Pl);break}n=h*Math.pow(2,32)+u.getUint32(4),r=3}else{if($n(t)<n)break;const l=jn(t,n);a.enqueue(Xu(s?l:Sa.decode(l),e)),r=0}if(n===0||n>i){a.enqueue(Pl);break}}}})}const Nm=4;function Bt(i){if(i)return _I(i)}function _I(i){for(var e in Bt.prototype)i[e]=Bt.prototype[e];return i}Bt.prototype.on=Bt.prototype.addEventListener=function(i,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+i]=this._callbacks["$"+i]||[]).push(e),this};Bt.prototype.once=function(i,e){function t(){this.off(i,t),e.apply(this,arguments)}return t.fn=e,this.on(i,t),this};Bt.prototype.off=Bt.prototype.removeListener=Bt.prototype.removeAllListeners=Bt.prototype.removeEventListener=function(i,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+i];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+i],this;for(var r,n=0;n<t.length;n++)if(r=t[n],r===e||r.fn===e){t.splice(n,1);break}return t.length===0&&delete this._callbacks["$"+i],this};Bt.prototype.emit=function(i){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+i],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(t){t=t.slice(0);for(var r=0,n=t.length;r<n;++r)t[r].apply(this,e)}return this};Bt.prototype.emitReserved=Bt.prototype.emit;Bt.prototype.listeners=function(i){return this._callbacks=this._callbacks||{},this._callbacks["$"+i]||[]};Bt.prototype.hasListeners=function(i){return!!this.listeners(i).length};const ks=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0),pe=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),xI="arraybuffer";function Bm(i,...e){return e.reduce((t,r)=>(i.hasOwnProperty(r)&&(t[r]=i[r]),t),{})}const wI=pe.setTimeout,TI=pe.clearTimeout;function Us(i,e){e.useNativeTimers?(i.setTimeoutFn=wI.bind(pe),i.clearTimeoutFn=TI.bind(pe)):(i.setTimeoutFn=pe.setTimeout.bind(pe),i.clearTimeoutFn=pe.clearTimeout.bind(pe))}const II=1.33;function EI(i){return typeof i=="string"?SI(i):Math.ceil((i.byteLength||i.size)*II)}function SI(i){let e=0,t=0;for(let r=0,n=i.length;r<n;r++)e=i.charCodeAt(r),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(r++,t+=4);return t}function Dm(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function AI(i){let e="";for(let t in i)i.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(i[t]));return e}function CI(i){let e={},t=i.split("&");for(let r=0,n=t.length;r<n;r++){let s=t[r].split("=");e[decodeURIComponent(s[0])]=decodeURIComponent(s[1])}return e}class PI extends Error{constructor(e,t,r){super(e),this.description=t,this.context=r,this.type="TransportError"}}class Hu extends Bt{constructor(e){super(),this.writable=!1,Us(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,r){return super.emitReserved("error",new PI(e,t,r)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Xu(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=AI(e);return t.length?"?"+t:""}}class OI extends Hu{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let r=0;this._polling&&(r++,this.once("pollComplete",function(){--r||t()})),this.writable||(r++,this.once("drain",function(){--r||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=r=>{if(this.readyState==="opening"&&r.type==="open"&&this.onOpen(),r.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(r)};vI(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,mI(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Dm()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let km=!1;try{km=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const FI=km;function RI(){}class MI extends OI{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let r=location.port;r||(r=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}}doWrite(e,t){const r=this.request({method:"POST",data:e});r.on("success",t),r.on("error",(n,s)=>{this.onError("xhr post error",n,s)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,r)=>{this.onError("xhr poll error",t,r)}),this.pollXhr=e}}class Ce extends Bt{constructor(e,t,r){super(),this.createRequest=e,Us(this,r),this._opts=r,this._method=r.method||"GET",this._uri=t,this._data=r.data!==void 0?r.data:null,this._create()}_create(){var e;const t=Bm(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const r=this._xhr=this.createRequest(t);try{r.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){r.setDisableHeaderCheck&&r.setDisableHeaderCheck(!0);for(let n in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(n)&&r.setRequestHeader(n,this._opts.extraHeaders[n])}}catch{}if(this._method==="POST")try{r.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{r.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(r),"withCredentials"in r&&(r.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(r.timeout=this._opts.requestTimeout),r.onreadystatechange=()=>{var n;r.readyState===3&&((n=this._opts.cookieJar)===null||n===void 0||n.parseCookies(r.getResponseHeader("set-cookie"))),r.readyState===4&&(r.status===200||r.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof r.status=="number"?r.status:0)},0))},r.send(this._data)}catch(n){this.setTimeoutFn(()=>{this._onError(n)},0);return}typeof document<"u"&&(this._index=Ce.requestsCount++,Ce.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=RI,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Ce.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Ce.requestsCount=0;Ce.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",sd);else if(typeof addEventListener=="function"){const i="onpagehide"in pe?"pagehide":"unload";addEventListener(i,sd,!1)}}function sd(){for(let i in Ce.requests)Ce.requests.hasOwnProperty(i)&&Ce.requests[i].abort()}const LI=(function(){const i=Um({xdomain:!1});return i&&i.responseType!==null})();class NI extends MI{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=LI&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new Ce(Um,this.uri(),e)}}function Um(i){const e=i.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||FI))return new XMLHttpRequest}catch{}if(!e)try{return new pe[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Xm=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class BI extends Hu{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,r=Xm?{}:Bm(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(r.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,r)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;Uu(r,this.supportsBinary,s=>{try{this.doWrite(r,s)}catch{}n&&ks(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Dm()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Aa=pe.WebSocket||pe.MozWebSocket;class DI extends BI{createSocket(e,t,r){return Xm?new Aa(e,t,r):t?new Aa(e,t):new Aa(e)}doWrite(e,t){this.ws.send(t)}}class kI extends Hu{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=bI(Number.MAX_SAFE_INTEGER,this.socket.binaryType),r=e.readable.pipeThrough(t).getReader(),n=gI();n.readable.pipeTo(e.writable),this._writer=n.writable.getWriter();const s=()=>{r.read().then(({done:a,value:l})=>{a||(this.onPacket(l),s())}).catch(a=>{})};s();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const r=e[t],n=t===e.length-1;this._writer.write(r).then(()=>{n&&ks(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const UI={websocket:DI,webtransport:kI,polling:NI},XI=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,HI=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Ol(i){if(i.length>8e3)throw"URI too long";const e=i,t=i.indexOf("["),r=i.indexOf("]");t!=-1&&r!=-1&&(i=i.substring(0,t)+i.substring(t,r).replace(/:/g,";")+i.substring(r,i.length));let n=XI.exec(i||""),s={},o=14;for(;o--;)s[HI[o]]=n[o]||"";return t!=-1&&r!=-1&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=GI(s,s.path),s.queryKey=YI(s,s.query),s}function GI(i,e){const t=/\/{2,9}/g,r=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&r.splice(0,1),e.slice(-1)=="/"&&r.splice(r.length-1,1),r}function YI(i,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(r,n,s){n&&(t[n]=s)}),t}const Fl=typeof addEventListener=="function"&&typeof removeEventListener=="function",os=[];Fl&&addEventListener("offline",()=>{os.forEach(i=>i())},!1);class ur extends Bt{constructor(e,t){if(super(),this.binaryType=xI,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const r=Ol(e);t.hostname=r.host,t.secure=r.protocol==="https"||r.protocol==="wss",t.port=r.port,r.query&&(t.query=r.query)}else t.host&&(t.hostname=Ol(t.host).host);Us(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(r=>{const n=r.prototype.name;this.transports.push(n),this._transportsByName[n]=r}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=CI(this.opts.query)),Fl&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},os.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Nm,t.transport=e,this.id&&(t.sid=this.id);const r=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](r)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&ur.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",ur.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let r=0;r<this.writeBuffer.length;r++){const n=this.writeBuffer[r].data;if(n&&(t+=EI(n)),r>0&&t>this._maxPayload)return this.writeBuffer.slice(0,r);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,ks(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,r){return this._sendPacket("message",e,t,r),this}send(e,t,r){return this._sendPacket("message",e,t,r),this}_sendPacket(e,t,r,n){if(typeof t=="function"&&(n=t,t=void 0),typeof r=="function"&&(n=r,r=null),this.readyState==="closing"||this.readyState==="closed")return;r=r||{},r.compress=r.compress!==!1;const s={type:e,data:t,options:r};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},r=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?r():e()}):this.upgrading?r():e()),this}_onError(e){if(ur.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Fl&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const r=os.indexOf(this._offlineEventListener);r!==-1&&os.splice(r,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}ur.protocol=Nm;class zI extends ur{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),r=!1;ur.priorWebsocketSuccess=!1;const n=()=>{r||(t.send([{type:"ping",data:"probe"}]),t.once("packet",c=>{if(!r)if(c.type==="pong"&&c.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;ur.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{r||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=t.name,this.emitReserved("upgradeError",f)}}))};function s(){r||(r=!0,h(),t.close(),t=null)}const o=c=>{const f=new Error("probe error: "+c);f.transport=t.name,s(),this.emitReserved("upgradeError",f)};function a(){o("transport closed")}function l(){o("socket closed")}function u(c){t&&c.name!==t.name&&s()}const h=()=>{t.removeListener("open",n),t.removeListener("error",o),t.removeListener("close",a),this.off("close",l),this.off("upgrading",u)};t.once("open",n),t.once("error",o),t.once("close",a),this.once("close",l),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{r||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let r=0;r<e.length;r++)~this.transports.indexOf(e[r])&&t.push(e[r]);return t}}let VI=class extends zI{constructor(e,t={}){const r=typeof e=="object"?e:t;(!r.transports||r.transports&&typeof r.transports[0]=="string")&&(r.transports=(r.transports||["polling","websocket","webtransport"]).map(n=>UI[n]).filter(n=>!!n)),super(e,r)}};function qI(i,e="",t){let r=i;t=t||typeof location<"u"&&location,i==null&&(i=t.protocol+"//"+t.host),typeof i=="string"&&(i.charAt(0)==="/"&&(i.charAt(1)==="/"?i=t.protocol+i:i=t.host+i),/^(https?|wss?):\/\//.test(i)||(typeof t<"u"?i=t.protocol+"//"+i:i="https://"+i),r=Ol(i)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=r.host.indexOf(":")!==-1?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(t&&t.port===r.port?"":":"+r.port),r}const $I=typeof ArrayBuffer=="function",jI=i=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(i):i.buffer instanceof ArrayBuffer,Hm=Object.prototype.toString,WI=typeof Blob=="function"||typeof Blob<"u"&&Hm.call(Blob)==="[object BlobConstructor]",KI=typeof File=="function"||typeof File<"u"&&Hm.call(File)==="[object FileConstructor]";function Gu(i){return $I&&(i instanceof ArrayBuffer||jI(i))||WI&&i instanceof Blob||KI&&i instanceof File}function as(i,e){if(!i||typeof i!="object")return!1;if(Array.isArray(i)){for(let t=0,r=i.length;t<r;t++)if(as(i[t]))return!0;return!1}if(Gu(i))return!0;if(i.toJSON&&typeof i.toJSON=="function"&&arguments.length===1)return as(i.toJSON(),!0);for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)&&as(i[t]))return!0;return!1}function ZI(i){const e=[],t=i.data,r=i;return r.data=Rl(t,e),r.attachments=e.length,{packet:r,buffers:e}}function Rl(i,e){if(!i)return i;if(Gu(i)){const t={_placeholder:!0,num:e.length};return e.push(i),t}else if(Array.isArray(i)){const t=new Array(i.length);for(let r=0;r<i.length;r++)t[r]=Rl(i[r],e);return t}else if(typeof i=="object"&&!(i instanceof Date)){const t={};for(const r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=Rl(i[r],e));return t}return i}function JI(i,e){return i.data=Ml(i.data,e),delete i.attachments,i}function Ml(i,e){if(!i)return i;if(i&&i._placeholder===!0){if(typeof i.num=="number"&&i.num>=0&&i.num<e.length)return e[i.num];throw new Error("illegal attachments")}else if(Array.isArray(i))for(let t=0;t<i.length;t++)i[t]=Ml(i[t],e);else if(typeof i=="object")for(const t in i)Object.prototype.hasOwnProperty.call(i,t)&&(i[t]=Ml(i[t],e));return i}const QI=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],tE=5;var yt;(function(i){i[i.CONNECT=0]="CONNECT",i[i.DISCONNECT=1]="DISCONNECT",i[i.EVENT=2]="EVENT",i[i.ACK=3]="ACK",i[i.CONNECT_ERROR=4]="CONNECT_ERROR",i[i.BINARY_EVENT=5]="BINARY_EVENT",i[i.BINARY_ACK=6]="BINARY_ACK"})(yt||(yt={}));class eE{constructor(e){this.replacer=e}encode(e){return(e.type===yt.EVENT||e.type===yt.ACK)&&as(e)?this.encodeAsBinary({type:e.type===yt.EVENT?yt.BINARY_EVENT:yt.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===yt.BINARY_EVENT||e.type===yt.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=ZI(e),r=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(r),n}}function od(i){return Object.prototype.toString.call(i)==="[object Object]"}class Yu extends Bt{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const r=t.type===yt.BINARY_EVENT;r||t.type===yt.BINARY_ACK?(t.type=r?yt.EVENT:yt.ACK,this.reconstructor=new rE(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(Gu(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const r={type:Number(e.charAt(0))};if(yt[r.type]===void 0)throw new Error("unknown packet type "+r.type);if(r.type===yt.BINARY_EVENT||r.type===yt.BINARY_ACK){const s=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(s,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");r.attachments=Number(o)}if(e.charAt(t+1)==="/"){const s=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););r.nsp=e.substring(s,t)}else r.nsp="/";const n=e.charAt(t+1);if(n!==""&&Number(n)==n){const s=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}r.id=Number(e.substring(s,t+1))}if(e.charAt(++t)){const s=this.tryParse(e.substr(t));if(Yu.isPayloadValid(r.type,s))r.data=s;else throw new Error("invalid payload")}return r}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case yt.CONNECT:return od(t);case yt.DISCONNECT:return t===void 0;case yt.CONNECT_ERROR:return typeof t=="string"||od(t);case yt.EVENT:case yt.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&QI.indexOf(t[0])===-1);case yt.ACK:case yt.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class rE{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=JI(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const iE=Object.freeze(Object.defineProperty({__proto__:null,Decoder:Yu,Encoder:eE,get PacketType(){return yt},protocol:tE},Symbol.toStringTag,{value:"Module"}));function we(i,e,t){return i.on(e,t),function(){i.off(e,t)}}const nE=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Gm extends Bt{constructor(e,t,r){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,r&&r.auth&&(this.auth=r.auth),this._opts=Object.assign({},r),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[we(e,"open",this.onopen.bind(this)),we(e,"packet",this.onpacket.bind(this)),we(e,"error",this.onerror.bind(this)),we(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var r,n,s;if(nE.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:yt.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const h=this.ids++,c=t.pop();this._registerAckCallback(h,c),o.id=h}const a=(n=(r=this.io.engine)===null||r===void 0?void 0:r.transport)===null||n===void 0?void 0:n.writable,l=this.connected&&!(!((s=this.io.engine)===null||s===void 0)&&s._hasPingExpired());return this.flags.volatile&&!a||(l?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var r;const n=(r=this.flags.timeout)!==null&&r!==void 0?r:this._opts.ackTimeout;if(n===void 0){this.acks[e]=t;return}const s=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);t.call(this,new Error("operation has timed out"))},n),o=(...a)=>{this.io.clearTimeoutFn(s),t.apply(this,a)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((r,n)=>{const s=(o,a)=>o?n(o):r(a);s.withError=!0,t.push(s),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const r={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((n,...s)=>r!==this._queue[0]?void 0:(n!==null?r.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(n)):(this._queue.shift(),t&&t(null,...s)),r.pending=!1,this._drainQueue())),this._queue.push(r),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:yt.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(r=>String(r.id)===e)){const r=this.acks[e];delete this.acks[e],r.withError&&r.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case yt.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case yt.EVENT:case yt.BINARY_EVENT:this.onevent(e);break;case yt.ACK:case yt.BINARY_ACK:this.onack(e);break;case yt.DISCONNECT:this.ondisconnect();break;case yt.CONNECT_ERROR:this.destroy();const r=new Error(e.data.message);r.data=e.data.data,this.emitReserved("connect_error",r);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const r of t)r.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let r=!1;return function(...n){r||(r=!0,t.packet({type:yt.ACK,id:e,data:n}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:yt.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let r=0;r<t.length;r++)if(e===t[r])return t.splice(r,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const r of t)r.apply(this,e.data)}}}function Ai(i){i=i||{},this.ms=i.min||100,this.max=i.max||1e4,this.factor=i.factor||2,this.jitter=i.jitter>0&&i.jitter<=1?i.jitter:0,this.attempts=0}Ai.prototype.duration=function(){var i=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*i);i=(Math.floor(e*10)&1)==0?i-t:i+t}return Math.min(i,this.max)|0};Ai.prototype.reset=function(){this.attempts=0};Ai.prototype.setMin=function(i){this.ms=i};Ai.prototype.setMax=function(i){this.max=i};Ai.prototype.setJitter=function(i){this.jitter=i};class Ll extends Bt{constructor(e,t){var r;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,Us(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((r=t.randomizationFactor)!==null&&r!==void 0?r:.5),this.backoff=new Ai({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const n=t.parser||iE;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new VI(this.uri,this.opts);const t=this.engine,r=this;this._readyState="opening",this.skipReconnect=!1;const n=we(t,"open",function(){r.onopen(),e&&e()}),s=a=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",a),e?e(a):this.maybeReconnectOnOpen()},o=we(t,"error",s);if(this._timeout!==!1){const a=this._timeout,l=this.setTimeoutFn(()=>{n(),s(new Error("timeout")),t.close()},a);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(n),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(we(e,"ping",this.onping.bind(this)),we(e,"data",this.ondata.bind(this)),we(e,"error",this.onerror.bind(this)),we(e,"close",this.onclose.bind(this)),we(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){ks(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let r=this.nsps[e];return r?this._autoConnect&&!r.active&&r.connect():(r=new Gm(this,e,t),this.nsps[e]=r),r}_destroy(e){const t=Object.keys(this.nsps);for(const r of t)if(this.nsps[r].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let r=0;r<t.length;r++)this.engine.write(t[r],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var r;this.cleanup(),(r=this.engine)===null||r===void 0||r.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const r=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(n=>{n?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",n)):e.onreconnect()}))},t);this.opts.autoUnref&&r.unref(),this.subs.push(()=>{this.clearTimeoutFn(r)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Di={};function ls(i,e){typeof i=="object"&&(e=i,i=void 0),e=e||{};const t=qI(i,e.path||"/socket.io"),r=t.source,n=t.id,s=t.path,o=Di[n]&&s in Di[n].nsps,a=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return a?l=new Ll(r,e):(Di[n]||(Di[n]=new Ll(r,e)),l=Di[n]),t.query&&!e.query&&(e.query=t.queryKey),l.socket(t.path,e)}Object.assign(ls,{Manager:Ll,Socket:Gm,io:ls,connect:ls});var Ca={exports:{}};/*!
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */var ad;function sE(){return ad||(ad=1,(function(i,e){(function(t){var r=Object.hasOwnProperty,n=Array.isArray?Array.isArray:function(b){return Object.prototype.toString.call(b)==="[object Array]"},s=10,o=typeof process=="object"&&typeof process.nextTick=="function",a=typeof Symbol=="function",l=typeof Reflect=="object",u=typeof setImmediate=="function",h=u?setImmediate:setTimeout,c=a?l&&typeof Reflect.ownKeys=="function"?Reflect.ownKeys:function(y){var b=Object.getOwnPropertyNames(y);return b.push.apply(b,Object.getOwnPropertySymbols(y)),b}:Object.keys;function f(){this._events={},this._conf&&d.call(this,this._conf)}function d(y){y&&(this._conf=y,y.delimiter&&(this.delimiter=y.delimiter),y.maxListeners!==t&&(this._maxListeners=y.maxListeners),y.wildcard&&(this.wildcard=y.wildcard),y.newListener&&(this._newListener=y.newListener),y.removeListener&&(this._removeListener=y.removeListener),y.verboseMemoryLeak&&(this.verboseMemoryLeak=y.verboseMemoryLeak),y.ignoreErrors&&(this.ignoreErrors=y.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function p(y,b){var x="(node) warning: possible EventEmitter memory leak detected. "+y+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(x+=" Event name: "+b+"."),typeof process<"u"&&process.emitWarning){var T=new Error(x);T.name="MaxListenersExceededWarning",T.emitter=this,T.count=y,process.emitWarning(T)}else console.error(x),console.trace&&console.trace()}var v=function(y,b,x){var T=arguments.length;switch(T){case 0:return[];case 1:return[y];case 2:return[y,b];case 3:return[y,b,x];default:for(var S=new Array(T);T--;)S[T]=arguments[T];return S}};function m(y,b){for(var x={},T,S=y.length,P=0,L=0;L<S;L++)T=y[L],x[T]=L<P?b[L]:t;return x}function g(y,b,x){this._emitter=y,this._target=b,this._listeners={},this._listenersCount=0;var T,S;if((x.on||x.off)&&(T=x.on,S=x.off),b.addEventListener?(T=b.addEventListener,S=b.removeEventListener):b.addListener?(T=b.addListener,S=b.removeListener):b.on&&(T=b.on,S=b.off),!T&&!S)throw Error("target does not implement any known event API");if(typeof T!="function")throw TypeError("on method must be a function");if(typeof S!="function")throw TypeError("off method must be a function");this._on=T,this._off=S;var P=y._observers;P?P.push(this):y._observers=[this]}Object.assign(g.prototype,{subscribe:function(y,b,x){var T=this,S=this._target,P=this._emitter,L=this._listeners,B=function(){var k=v.apply(null,arguments),U={data:k,name:b,original:y};if(x){var q=x.call(S,U);q!==!1&&P.emit.apply(P,[U.name].concat(k));return}P.emit.apply(P,[b].concat(k))};if(L[y])throw Error("Event '"+y+"' is already listening");this._listenersCount++,P._newListener&&P._removeListener&&!T._onNewListener?(this._onNewListener=function(k){k===b&&L[y]===null&&(L[y]=B,T._on.call(S,y,B))},P.on("newListener",this._onNewListener),this._onRemoveListener=function(k){k===b&&!P.hasListeners(k)&&L[y]&&(L[y]=null,T._off.call(S,y,B))},L[y]=null,P.on("removeListener",this._onRemoveListener)):(L[y]=B,T._on.call(S,y,B))},unsubscribe:function(y){var b=this,x=this._listeners,T=this._emitter,S,P,L=this._off,B=this._target,k;if(y&&typeof y!="string")throw TypeError("event must be a string");function U(){b._onNewListener&&(T.off("newListener",b._onNewListener),T.off("removeListener",b._onRemoveListener),b._onNewListener=null,b._onRemoveListener=null);var q=H.call(T,b);T._observers.splice(q,1)}if(y){if(S=x[y],!S)return;L.call(B,y,S),delete x[y],--this._listenersCount||U()}else{for(P=c(x),k=P.length;k-- >0;)y=P[k],L.call(B,y,x[y]);this._listeners={},this._listenersCount=0,U()}}});function E(y,b,x,T){var S=Object.assign({},b);if(!y)return S;if(typeof y!="object")throw TypeError("options must be an object");var P=Object.keys(y),L=P.length,B,k,U;function q(z){throw Error('Invalid "'+B+'" option value'+(z?". Reason: "+z:""))}for(var W=0;W<L;W++){if(B=P[W],!r.call(b,B))throw Error('Unknown "'+B+'" option');k=y[B],k!==t&&(U=x[B],S[B]=U?U(k,q):k)}return S}function I(y,b){return(typeof y!="function"||!y.hasOwnProperty("prototype"))&&b("value must be a constructor"),y}function M(y){var b="value must be type of "+y.join("|"),x=y.length,T=y[0],S=y[1];return x===1?function(P,L){if(typeof P===T)return P;L(b)}:x===2?function(P,L){var B=typeof P;if(B===T||B===S)return P;L(b)}:function(P,L){for(var B=typeof P,k=x;k-- >0;)if(B===y[k])return P;L(b)}}var _=M(["function"]),F=M(["object","function"]);function C(y,b,x){var T,S,P=0,L,B=new y(function(k,U,q){x=E(x,{timeout:0,overload:!1},{timeout:function(j,it){return j*=1,(typeof j!="number"||j<0||!Number.isFinite(j))&&it("timeout must be a positive number"),j}}),T=!x.overload&&typeof y.prototype.cancel=="function"&&typeof q=="function";function W(){S&&(S=null),P&&(clearTimeout(P),P=0)}var z=function(j){W(),k(j)},Z=function(j){W(),U(j)};T?b(z,Z,q):(S=[function(j){Z(j||Error("canceled"))}],b(z,Z,function(j){if(L)throw Error("Unable to subscribe on cancel event asynchronously");if(typeof j!="function")throw TypeError("onCancel callback must be a function");S.push(j)}),L=!0),x.timeout>0&&(P=setTimeout(function(){var j=Error("timeout");j.code="ETIMEDOUT",P=0,B.cancel(j),U(j)},x.timeout))});return T||(B.cancel=function(k){if(S){for(var U=S.length,q=1;q<U;q++)S[q](k);S[0](k),S=null}}),B}function H(y){var b=this._observers;if(!b)return-1;for(var x=b.length,T=0;T<x;T++)if(b[T]._target===y)return T;return-1}function R(y,b,x,T,S){if(!x)return null;if(T===0){var P=typeof b;if(P==="string"){var L,B,k=0,U=0,q=this.delimiter,W=q.length;if((B=b.indexOf(q))!==-1){L=new Array(5);do L[k++]=b.slice(U,B),U=B+W;while((B=b.indexOf(q,U))!==-1);L[k++]=b.slice(U),b=L,S=k}else b=[b],S=1}else P==="object"?S=b.length:(b=[b],S=1)}var z=null,Z,j,it,at,et,rt=b[T],wt=b[T+1],xt,At;if(T===S)x._listeners&&(typeof x._listeners=="function"?(y&&y.push(x._listeners),z=[x]):(y&&y.push.apply(y,x._listeners),z=[x]));else if(rt==="*"){for(xt=c(x),B=xt.length;B-- >0;)Z=xt[B],Z!=="_listeners"&&(At=R(y,b,x[Z],T+1,S),At&&(z?z.push.apply(z,At):z=At));return z}else if(rt==="**"){for(et=T+1===S||T+2===S&&wt==="*",et&&x._listeners&&(z=R(y,b,x,S,S)),xt=c(x),B=xt.length;B-- >0;)Z=xt[B],Z!=="_listeners"&&(Z==="*"||Z==="**"?(x[Z]._listeners&&!et&&(At=R(y,b,x[Z],S,S),At&&(z?z.push.apply(z,At):z=At)),At=R(y,b,x[Z],T,S)):Z===wt?At=R(y,b,x[Z],T+2,S):At=R(y,b,x[Z],T,S),At&&(z?z.push.apply(z,At):z=At));return z}else x[rt]&&(z=R(y,b,x[rt],T+1,S));if(j=x["*"],j&&R(y,b,j,T+1,S),it=x["**"],it)if(T<S)for(it._listeners&&R(y,b,it,S,S),xt=c(it),B=xt.length;B-- >0;)Z=xt[B],Z!=="_listeners"&&(Z===wt?R(y,b,it[Z],T+2,S):Z===rt?R(y,b,it[Z],T+1,S):(at={},at[Z]=it[Z],R(y,b,{"**":at},T+1,S)));else it._listeners?R(y,b,it,S,S):it["*"]&&it["*"]._listeners&&R(y,b,it["*"],S,S);return z}function N(y,b,x){var T=0,S=0,P,L=this.delimiter,B=L.length,k;if(typeof y=="string")if((P=y.indexOf(L))!==-1){k=new Array(5);do k[T++]=y.slice(S,P),S=P+B;while((P=y.indexOf(L,S))!==-1);k[T++]=y.slice(S)}else k=[y],T=1;else k=y,T=y.length;if(T>1){for(P=0;P+1<T;P++)if(k[P]==="**"&&k[P+1]==="**")return}var U=this.listenerTree,q;for(P=0;P<T;P++)if(q=k[P],U=U[q]||(U[q]={}),P===T-1)return U._listeners?(typeof U._listeners=="function"&&(U._listeners=[U._listeners]),x?U._listeners.unshift(b):U._listeners.push(b),!U._listeners.warned&&this._maxListeners>0&&U._listeners.length>this._maxListeners&&(U._listeners.warned=!0,p.call(this,U._listeners.length,q))):U._listeners=b,!0;return!0}function Y(y,b,x,T){for(var S=c(y),P=S.length,L,B,k,U=y._listeners,q;P-- >0;)B=S[P],L=y[B],B==="_listeners"?k=x:k=x?x.concat(B):[B],q=T||typeof B=="symbol",U&&b.push(q?k:k.join(this.delimiter)),typeof L=="object"&&Y.call(this,L,b,k,q);return b}function D(y){for(var b=c(y),x=b.length,T,S,P;x-- >0;)S=b[x],T=y[S],T&&(P=!0,S!=="_listeners"&&!D(T)&&delete y[S]);return P}function J(y,b,x){this.emitter=y,this.event=b,this.listener=x}J.prototype.off=function(){return this.emitter.off(this.event,this.listener),this};function Q(y,b,x){if(x===!0)S=!0;else if(x===!1)T=!0;else{if(!x||typeof x!="object")throw TypeError("options should be an object or true");var T=x.async,S=x.promisify,P=x.nextTick,L=x.objectify}if(T||P||S){var B=b,k=b._origin||b;if(P&&!o)throw Error("process.nextTick is not supported");S===t&&(S=b.constructor.name==="AsyncFunction"),b=function(){var U=arguments,q=this,W=this.event;return S?P?Promise.resolve():new Promise(function(z){h(z)}).then(function(){return q.event=W,B.apply(q,U)}):(P?process.nextTick:h)(function(){q.event=W,B.apply(q,U)})},b._async=!0,b._origin=k}return[b,L?new J(this,y,b):this]}function V(y){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,d.call(this,y)}V.EventEmitter2=V,V.prototype.listenTo=function(y,b,x){if(typeof y!="object")throw TypeError("target musts be an object");var T=this;x=E(x,{on:t,off:t,reducers:t},{on:_,off:_,reducers:F});function S(P){if(typeof P!="object")throw TypeError("events must be an object");var L=x.reducers,B=H.call(T,y),k;B===-1?k=new g(T,y,x):k=T._observers[B];for(var U=c(P),q=U.length,W,z=typeof L=="function",Z=0;Z<q;Z++)W=U[Z],k.subscribe(W,P[W]||W,z?L:L&&L[W])}return n(b)?S(m(b)):S(typeof b=="string"?m(b.split(/\s+/)):b),this},V.prototype.stopListeningTo=function(y,b){var x=this._observers;if(!x)return!1;var T=x.length,S,P=!1;if(y&&typeof y!="object")throw TypeError("target should be an object");for(;T-- >0;)S=x[T],(!y||S._target===y)&&(S.unsubscribe(b),P=!0);return P},V.prototype.delimiter=".",V.prototype.setMaxListeners=function(y){y!==t&&(this._maxListeners=y,this._conf||(this._conf={}),this._conf.maxListeners=y)},V.prototype.getMaxListeners=function(){return this._maxListeners},V.prototype.event="",V.prototype.once=function(y,b,x){return this._once(y,b,!1,x)},V.prototype.prependOnceListener=function(y,b,x){return this._once(y,b,!0,x)},V.prototype._once=function(y,b,x,T){return this._many(y,1,b,x,T)},V.prototype.many=function(y,b,x,T){return this._many(y,b,x,!1,T)},V.prototype.prependMany=function(y,b,x,T){return this._many(y,b,x,!0,T)},V.prototype._many=function(y,b,x,T,S){var P=this;if(typeof x!="function")throw new Error("many only accepts instances of Function");function L(){return--b===0&&P.off(y,L),x.apply(this,arguments)}return L._origin=x,this._on(y,L,T,S)},V.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||f.call(this);var y=arguments[0],b,x=this.wildcard,T,S,P,L,B;if(y==="newListener"&&!this._newListener&&!this._events.newListener)return!1;if(x&&(b=y,y!=="newListener"&&y!=="removeListener"&&typeof y=="object")){if(S=y.length,a){for(P=0;P<S;P++)if(typeof y[P]=="symbol"){B=!0;break}}B||(y=y.join(this.delimiter))}var k=arguments.length,U;if(this._all&&this._all.length)for(U=this._all.slice(),P=0,S=U.length;P<S;P++)switch(this.event=y,k){case 1:U[P].call(this,y);break;case 2:U[P].call(this,y,arguments[1]);break;case 3:U[P].call(this,y,arguments[1],arguments[2]);break;default:U[P].apply(this,arguments)}if(x)U=[],R.call(this,U,b,this.listenerTree,0,S);else if(U=this._events[y],typeof U=="function"){switch(this.event=y,k){case 1:U.call(this);break;case 2:U.call(this,arguments[1]);break;case 3:U.call(this,arguments[1],arguments[2]);break;default:for(T=new Array(k-1),L=1;L<k;L++)T[L-1]=arguments[L];U.apply(this,T)}return!0}else U&&(U=U.slice());if(U&&U.length){if(k>3)for(T=new Array(k-1),L=1;L<k;L++)T[L-1]=arguments[L];for(P=0,S=U.length;P<S;P++)switch(this.event=y,k){case 1:U[P].call(this);break;case 2:U[P].call(this,arguments[1]);break;case 3:U[P].call(this,arguments[1],arguments[2]);break;default:U[P].apply(this,T)}return!0}else if(!this.ignoreErrors&&!this._all&&y==="error")throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},V.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||f.call(this);var y=arguments[0],b=this.wildcard,x,T,S,P,L,B;if(y==="newListener"&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(b&&(x=y,y!=="newListener"&&y!=="removeListener"&&typeof y=="object")){if(P=y.length,a){for(L=0;L<P;L++)if(typeof y[L]=="symbol"){T=!0;break}}T||(y=y.join(this.delimiter))}var k=[],U=arguments.length,q;if(this._all)for(L=0,P=this._all.length;L<P;L++)switch(this.event=y,U){case 1:k.push(this._all[L].call(this,y));break;case 2:k.push(this._all[L].call(this,y,arguments[1]));break;case 3:k.push(this._all[L].call(this,y,arguments[1],arguments[2]));break;default:k.push(this._all[L].apply(this,arguments))}if(b?(q=[],R.call(this,q,x,this.listenerTree,0)):q=this._events[y],typeof q=="function")switch(this.event=y,U){case 1:k.push(q.call(this));break;case 2:k.push(q.call(this,arguments[1]));break;case 3:k.push(q.call(this,arguments[1],arguments[2]));break;default:for(S=new Array(U-1),B=1;B<U;B++)S[B-1]=arguments[B];k.push(q.apply(this,S))}else if(q&&q.length){if(q=q.slice(),U>3)for(S=new Array(U-1),B=1;B<U;B++)S[B-1]=arguments[B];for(L=0,P=q.length;L<P;L++)switch(this.event=y,U){case 1:k.push(q[L].call(this));break;case 2:k.push(q[L].call(this,arguments[1]));break;case 3:k.push(q[L].call(this,arguments[1],arguments[2]));break;default:k.push(q[L].apply(this,S))}}else if(!this.ignoreErrors&&!this._all&&y==="error")return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(k)},V.prototype.on=function(y,b,x){return this._on(y,b,!1,x)},V.prototype.prependListener=function(y,b,x){return this._on(y,b,!0,x)},V.prototype.onAny=function(y){return this._onAny(y,!1)},V.prototype.prependAny=function(y){return this._onAny(y,!0)},V.prototype.addListener=V.prototype.on,V.prototype._onAny=function(y,b){if(typeof y!="function")throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),b?this._all.unshift(y):this._all.push(y),this},V.prototype._on=function(y,b,x,T){if(typeof y=="function")return this._onAny(y,b),this;if(typeof b!="function")throw new Error("on only accepts instances of Function");this._events||f.call(this);var S=this,P;return T!==t&&(P=Q.call(this,y,b,T),b=P[0],S=P[1]),this._newListener&&this.emit("newListener",y,b),this.wildcard?(N.call(this,y,b,x),S):(this._events[y]?(typeof this._events[y]=="function"&&(this._events[y]=[this._events[y]]),x?this._events[y].unshift(b):this._events[y].push(b),!this._events[y].warned&&this._maxListeners>0&&this._events[y].length>this._maxListeners&&(this._events[y].warned=!0,p.call(this,this._events[y].length,y))):this._events[y]=b,S)},V.prototype.off=function(y,b){if(typeof b!="function")throw new Error("removeListener only takes instances of Function");var x,T=[];if(this.wildcard){var S=typeof y=="string"?y.split(this.delimiter):y.slice();if(T=R.call(this,null,S,this.listenerTree,0),!T)return this}else{if(!this._events[y])return this;x=this._events[y],T.push({_listeners:x})}for(var P=0;P<T.length;P++){var L=T[P];if(x=L._listeners,n(x)){for(var B=-1,k=0,U=x.length;k<U;k++)if(x[k]===b||x[k].listener&&x[k].listener===b||x[k]._origin&&x[k]._origin===b){B=k;break}if(B<0)continue;return this.wildcard?L._listeners.splice(B,1):this._events[y].splice(B,1),x.length===0&&(this.wildcard?delete L._listeners:delete this._events[y]),this._removeListener&&this.emit("removeListener",y,b),this}else(x===b||x.listener&&x.listener===b||x._origin&&x._origin===b)&&(this.wildcard?delete L._listeners:delete this._events[y],this._removeListener&&this.emit("removeListener",y,b))}return this.listenerTree&&D(this.listenerTree),this},V.prototype.offAny=function(y){var b=0,x=0,T;if(y&&this._all&&this._all.length>0){for(T=this._all,b=0,x=T.length;b<x;b++)if(y===T[b])return T.splice(b,1),this._removeListener&&this.emit("removeListenerAny",y),this}else{if(T=this._all,this._removeListener)for(b=0,x=T.length;b<x;b++)this.emit("removeListenerAny",T[b]);this._all=[]}return this},V.prototype.removeListener=V.prototype.off,V.prototype.removeAllListeners=function(y){if(y===t)return!this._events||f.call(this),this;if(this.wildcard){var b=R.call(this,null,y,this.listenerTree,0),x,T;if(!b)return this;for(T=0;T<b.length;T++)x=b[T],x._listeners=null;this.listenerTree&&D(this.listenerTree)}else this._events&&(this._events[y]=null);return this},V.prototype.listeners=function(y){var b=this._events,x,T,S,P,L;if(y===t){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!b)return[];for(x=c(b),P=x.length,S=[];P-- >0;)T=b[x[P]],typeof T=="function"?S.push(T):S.push.apply(S,T);return S}else{if(this.wildcard){if(L=this.listenerTree,!L)return[];var B=[],k=typeof y=="string"?y.split(this.delimiter):y.slice();return R.call(this,B,k,L,0),B}return b?(T=b[y],T?typeof T=="function"?[T]:T:[]):[]}},V.prototype.eventNames=function(y){var b=this._events;return this.wildcard?Y.call(this,this.listenerTree,[],null,y):b?c(b):[]},V.prototype.listenerCount=function(y){return this.listeners(y).length},V.prototype.hasListeners=function(y){if(this.wildcard){var b=[],x=typeof y=="string"?y.split(this.delimiter):y.slice();return R.call(this,b,x,this.listenerTree,0),b.length>0}var T=this._events,S=this._all;return!!(S&&S.length||T&&(y===t?c(T).length:T[y]))},V.prototype.listenersAny=function(){return this._all?this._all:[]},V.prototype.waitFor=function(y,b){var x=this,T=typeof b;return T==="number"?b={timeout:b}:T==="function"&&(b={filter:b}),b=E(b,{timeout:0,filter:t,handleError:!1,Promise,overload:!1},{filter:_,Promise:I}),C(b.Promise,function(S,P,L){function B(){var k=b.filter;if(!(k&&!k.apply(x,arguments)))if(x.off(y,B),b.handleError){var U=arguments[0];U?P(U):S(v.apply(null,arguments).slice(1))}else S(v.apply(null,arguments))}L(function(){x.off(y,B)}),x._on(y,B,!1)},{timeout:b.timeout,overload:b.overload})};function A(y,b,x){x=E(x,{Promise,timeout:0,overload:!1},{Promise:I});var T=x.Promise;return C(T,function(S,P,L){var B;if(typeof y.addEventListener=="function"){B=function(){S(v.apply(null,arguments))},L(function(){y.removeEventListener(b,B)}),y.addEventListener(b,B,{once:!0});return}var k=function(){U&&y.removeListener("error",U),S(v.apply(null,arguments))},U;b!=="error"&&(U=function(q){y.removeListener(b,k),P(q)},y.once("error",U)),L(function(){U&&y.removeListener("error",U),y.removeListener(b,k)}),y.once(b,k)},{timeout:x.timeout,overload:x.overload})}var O=V.prototype;Object.defineProperties(V,{defaultMaxListeners:{get:function(){return O._maxListeners},set:function(y){if(typeof y!="number"||y<0||Number.isNaN(y))throw TypeError("n must be a non-negative number");O._maxListeners=y},enumerable:!0},once:{value:A,writable:!0,configurable:!0}}),Object.defineProperties(O,{_maxListeners:{value:s,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}}),i.exports=V})()})(Ca)),Ca.exports}var oE=sE();const ld=240,aE=/[\u0000-\u001F\u007F]/g,lE="team",Pa=700;class uE extends oE.EventEmitter2{constructor(e){super(),this.game=e,this.sequenceCounter=0,this.lastServerSequence=0,this.localShotCache=new Map,this.on("bot:debug",t=>{Xx(t)})}listen(){this.io=ls("http://localhost:8021",{transports:["websocket"]}),this.io.on("connect",()=>{console.log("connected"),this.sequenceCounter=0,this.lastServerSequence=0,this.emit("connected"),this.requestLobbySnapshot(),this.game&&this.game.identityManager&&typeof this.game.identityManager.handleSocketConnected=="function"&&this.game.identityManager.handleSocketConnected()}),this.io.on("connect_error",e=>{console.error("socket connect_error",e?.message??e)}),this.io.on("disconnect",e=>{console.warn("socket disconnected",e),this.lastServerSequence=0,this.emit("disconnected",e)}),this.io.on("chat:message",e=>{const t=this.safeParse(e);this.emit("chat:message",t)}),this.io.on("chat:history",e=>{const t=this.safeParse(e);this.emit("chat:history",t)}),this.io.on("chat:rate_limit",e=>{const t=this.safeParse(e);this.emit("chat:rate_limit",t)}),this.io.on("lobby:snapshot",e=>{const t=this.safeParse(e);this.emit("lobby:snapshot",t)}),this.io.on("lobby:update",e=>{const t=this.safeParse(e);this.emit("lobby:update",t)}),this.io.on("identity:ack",e=>{const t=this.safeParse(e);this.emit("identity:ack",t)}),this.io.on("lobby:assignment",e=>{const t=this.safeParse(e);t&&this.game&&this.game.player&&(t.city!==void 0&&t.city!==null&&(this.game.player.city=this.toFiniteNumber(t.city,this.game.player.city??0)),t.role&&(this.game.player.isMayor=t.role==="mayor")),this.emit("lobby:assignment",t)}),this.io.on("lobby:denied",e=>{const t=this.safeParse(e);this.emit("lobby:denied",t)}),this.io.on("enter_game",e=>{const t=this.normalisePlayerPayload(e);t&&this.applyPlayerUpdate(t,{source:"enter_game"})}),this.io.on("player",e=>{const t=this.normalisePlayerPayload(e);t&&this.applyPlayerUpdate(t,{source:"player"})}),this.io.on("players:snapshot",e=>{const t=this.safeParse(e);Array.isArray(t)&&t.forEach(r=>{const n=this.normalisePlayerPayload(r);n&&this.applyPlayerUpdate(n,{source:"snapshot"})})}),this.io.on("player:removed",e=>{const t=this.safeParse(e);!t||!t.id||this.io?.id&&t.id===this.io.id||delete this.game.otherPlayers[t.id]}),this.io.on("player:rejected",e=>{const t=this.safeParse(e);if(t&&(Array.isArray(t.reasons)&&t.reasons.length&&console.warn("Authoritative server rejected player update",t.reasons),t.player)){const r=this.normalisePlayerPayload(t.player);if(!r)return;this.applyPlayerUpdate(r,{source:"rejected"})}}),this.io.on("bullet_shot",e=>{const t=this.safeParse(e);if(!t)return;const r={sourceId:t.sourceId??null,sourceType:t.sourceType??null,targetId:t.targetId??null};if(t.damage!==void 0){const n=Number(t.damage);Number.isFinite(n)&&(r.damage=n)}this.game.bulletFactory.newBullet(t.shooter,t.x,t.y,t.type,t.angle,t.team??null,r),this.shouldSuppressShotSound(t)||this.playBulletShotSound(t)}),this.io.on("new_icon",e=>{const t=typeof e=="string"?JSON.parse(e):e;if(!t)return;const r=t.ownerId??t.owner??null;this.game.iconFactory.newIcon(r,t.x,t.y,t.type,{sourceBuildingId:t.buildingId??t.sourceBuildingId??null,city:t.cityId??null,teamId:t.teamId??t.cityId??null,quantity:t.quantity??1,armed:!!t.armed})}),this.io.on("factory:purge",e=>{const t=this.safeParse(e);if(!t||!this.game||!this.game.iconFactory)return;const r=this.toFiniteNumber(t.itemType,null),n=this.toFiniteNumber(t.cityId,null);this.game.iconFactory.purgeCityItems(n,r)}),this.io.on("new_building",e=>{try{const t=typeof e=="string"?JSON.parse(e):e;t&&(t.type=Number(t.type),t.population=t.population||0,t.ownerId=t.ownerId||t.owner||null,t.attachedHouseId=t.attachedHouseId??null,t.city=t.city??0,t.itemsLeft=t.itemsLeft||0,t.smokeActive=!!t.smokeActive,t.smokeFrame=t.smokeFrame||0),this.emit("building:new",t)}catch(t){console.warn("Failed to parse new_building payload",t)}}),this.io.on("population:update",e=>{try{const t=typeof e=="string"?JSON.parse(e):e;t&&(t.type=Number(t.type),t.population=t.population||0,t.attachedHouseId=t.attachedHouseId??null,t.city=t.city??0,t.smokeActive=!!t.smokeActive,t.smokeFrame=t.smokeFrame||0,t.itemsLeft=t.itemsLeft||0),this.emit("population:update",t)}catch(t){console.warn("Failed to parse population update",t)}}),this.io.on("city:finance",e=>{try{const t=typeof e=="string"?JSON.parse(e):e;t&&this.emit("city:finance",t)}catch(t){console.warn("Failed to parse finance update",t)}}),this.io.on("city:info",e=>{const t=this.safeParse(e);!t||typeof t!="object"||(t.cityId===void 0&&t.city!==void 0?t.cityId=this.toFiniteNumber(t.city,t.city):t.cityId!==void 0&&(t.cityId=this.toFiniteNumber(t.cityId,t.cityId)),this.emit("city:info",t))}),this.io.on("city:defenses",e=>{const t=this.safeParse(e);if(!t||t.cityId===void 0)return;const r=this.toFiniteNumber(t.cityId,t.cityId);if(r==null)return;const n=Array.isArray(t.items)?t.items:[];this.game&&typeof this.game.applyDefenseSnapshot=="function"&&this.game.applyDefenseSnapshot(r,n)}),this.io.on("city:defenses:clear",e=>{const t=this.safeParse(e);if(!t||t.cityId===void 0)return;const r=this.toFiniteNumber(t.cityId,t.cityId);r!=null&&this.game&&typeof this.game.clearDefenseItems=="function"&&this.game.clearDefenseItems(r)}),this.io.on("build:denied",e=>{try{const t=typeof e=="string"?JSON.parse(e):e;t&&this.emit("build:denied",t)}catch(t){console.warn("Failed to parse build denied payload",t)}}),this.io.on("demolish_building",e=>{try{const t=typeof e=="string"?JSON.parse(e):e;t&&t.id&&this.game.buildingFactory?.removeBuildingById&&this.game.buildingFactory.removeBuildingById(t.id)}catch(t){console.warn("Failed to handle demolish payload",t)}}),this.io.on("demolish:denied",e=>{const t=this.safeParse(e);this.game.buildingFactory?.handleDemolishDenied&&this.game.buildingFactory.handleDemolishDenied(t)}),this.io.on("player:health",e=>{const t=this.safeParse(e);!t||!t.id||this.applyHealthUpdate(t)}),this.io.on("player:dead",e=>{const t=this.safeParse(e);!t||!t.id||(this.emit("player:dead",t),this.applyHealthUpdate({id:t.id,health:0,source:t.reason}))}),this.io.on("player:status",e=>{const t=this.safeParse(e);!t||!t.id||this.applyStatusUpdate(t)}),this.io.on("hazard:spawn",e=>{const t=this.normaliseHazardPayload(e);t&&this.emit("hazard:spawn",t)}),this.io.on("hazard:update",e=>{const t=this.normaliseHazardPayload(e);t&&this.emit("hazard:update",t)}),this.io.on("hazard:remove",e=>{const t=this.normaliseHazardPayload(e);t&&this.emit("hazard:remove",t)}),this.io.on("orb:result",e=>{const t=this.safeParse(e);this.emit("orb:result",t)}),this.io.on("city:orbed",e=>{const t=this.safeParse(e);t&&this.handleCityOrbedAudio(t),this.emit("city:orbed",t)}),this.io.on("lobby:evicted",e=>{const t=this.safeParse(e);this.emit("lobby:evicted",t)})}sendNewBuilding(e){this.io&&!this.io.disconnected&&this.io.emit("new_building",JSON.stringify(e))}sendDemolishBuilding(e){!this.io||this.io.disconnected||!e||this.io.emit("demolish_building",JSON.stringify({id:e}))}requestCityInfo(e){if(!this.io||this.io.disconnected)return;const t=this.toFiniteNumber(e,null);if(!Number.isFinite(t))return;const r=Math.max(0,Math.floor(t));this.io.emit("city:inspect",JSON.stringify({city:r}))}sendBulletShot(e){e&&this.markLocalShot(e),this.io&&!this.io.disconnected&&this.io.emit("bullet_shot",JSON.stringify(e))}enterGame(e={}){if(console.log("Telling server we've entered the game"),this.io&&!this.io.disconnected){this.sequenceCounter=0,this.game.player.sequence=0;const t=this.createPlayerPayload(),r=this.buildEntryAssignment(e);return Object.assign(t,r),this.io.emit("enter_game",JSON.stringify(t)),this.io.id}return null}requestLobbySnapshot(){this.io&&!this.io.disconnected&&this.io.emit("lobby:refresh")}buildEntryAssignment(e){if(!e||typeof e!="object")return{};const t={},r={};let n=!1;if(e.city!==void 0&&e.city!==null){const s=this.toFiniteNumber(e.city,null);if(Number.isFinite(s)){const o=Math.max(0,Math.floor(s));t.requestedCity=o,r.city=o,r.cityId=o,n=!0}}if(e.role){const s=`${e.role}`.trim().toLowerCase();(s==="mayor"||s==="recruit"||s==="auto")&&(t.requestedRole=s,r.role=s,n=!0)}return e.auto===!0?t.autoAssign=!0:e.auto===!1&&(t.autoAssign=!1),n&&(t.assignment=r),t}cycle(){if(this.io&&!this.io.disconnected){this.sequenceCounter+=1,this.game.player.sequence=this.sequenceCounter;const e=this.createPlayerPayload();this.io.emit("player",JSON.stringify(e))}}spawnHazard(e){!this.io||this.io.disconnected||this.io.emit("hazard:spawn",JSON.stringify(e))}useItem(e,t={}){if(!this.io||this.io.disconnected||!e)return;const r=Object.assign({},t,{type:e});this.io.emit("item:use",JSON.stringify(r))}updateHazard(e){!this.io||this.io.disconnected||this.io.emit("hazard:arm",JSON.stringify(e))}removeHazard(e){!this.io||this.io.disconnected||!e||this.io.emit("hazard:remove",JSON.stringify({id:e}))}spawnDefense(e){if(!this.io||this.io.disconnected||!e)return;const t=typeof e=="string"?e:JSON.stringify(e);this.io.emit("defense:spawn",t)}removeDefense(e){if(!this.io||this.io.disconnected||!e)return;const t=typeof e=="object"?e.id??null:e;t&&this.io.emit("defense:remove",JSON.stringify({id:t}))}collectFactoryItem(e){if(!this.io||this.io.disconnected||!e)return;const t=typeof e=="string"?e:JSON.stringify(e);this.io.emit("factory:collect",t)}sendOrbDrop(e){if(!this.io||this.io.disconnected||e===null||e===void 0)return;const t=typeof e=="string"?e:JSON.stringify(e);this.io.emit("orb:drop",t)}sendIdentityUpdate(e){if(!this.io||this.io.disconnected)return;const t={};e&&e.id?(t.identity={id:e.id},e.name&&(t.identity.name=e.name)):t.identity=null,this.io.emit("identity:update",JSON.stringify(t))}createPlayerPayload(){const e=this.game.player,t=Number.isFinite(e.isMoving)?e.isMoving:Number(e.isMoving),r=Number.isFinite(t)?Math.max(-1,Math.min(1,t)):0,n=Number.isFinite(e.isTurning)?e.isTurning:Number(e.isTurning),s=Number.isFinite(n)?Math.max(-1,Math.min(1,Math.round(n))):0,o={id:e.id,city:e.city,isMayor:e.isMayor,health:e.health,direction:(Math.round(e.direction)%32+32)%32,isTurning:s,isMoving:r,bombsArmed:!!e.bombsArmed,isCloaked:!!e.isCloaked,cloakExpiresAt:e.cloakExpiresAt??0,isFrozen:!!e.isFrozen,frozenUntil:e.frozenUntil??0,sequence:e.sequence,offset:{x:e.offset?.x??0,y:e.offset?.y??0}};return this.game&&this.game.identity&&this.game.identity.id&&(o.identity={id:this.game.identity.id}),this.game&&this.game.identity&&this.game.identity.name&&(o.callsign=this.game.identity.name),o}applyPlayerUpdate(e,t={}){if(!e||!e.id)return;const r=this.io?.id;if(r&&e.id===r){this.syncLocalPlayer(e,t);return}const n=this.game.otherPlayers[e.id];if(n&&n.sequence!==void 0&&e.sequence!==void 0&&e.sequence<=n.sequence)return;const s=n?Object.assign({},n,e):Object.assign({},e);!s.callsign&&n&&n.callsign&&(s.callsign=n.callsign),!s.userId&&n&&n.userId&&(s.userId=n.userId),this.game.otherPlayers[e.id]=s}syncLocalPlayer(e,t={}){if(!e||!this.game||!this.game.player)return;const r=this.game.player;if(e.sequence!==void 0&&e.sequence<this.lastServerSequence&&this.lastServerSequence!==0){const l=Math.abs(e.offset.x-r.offset.x),u=Math.abs(e.offset.y-r.offset.y),h=96;if(l<h&&u<h)return}e.sequence!==void 0&&(this.lastServerSequence=Math.max(this.lastServerSequence,e.sequence)),r.id=e.id??r.id,typeof e.callsign=="string"&&e.callsign.trim().length&&(r.callsign=e.callsign.trim()),typeof e.userId=="string"&&e.userId.trim().length&&(r.userId=e.userId.trim());const n=Number.isFinite(r.city)?r.city:null,s=this.toFiniteNumber(e.city,r.city),o=n!==s;if(e.offset&&typeof e.offset=="object"){const l=this.toFiniteNumber(e.offset.x,r.offset.x),u=this.toFiniteNumber(e.offset.y,r.offset.y),h=l-r.offset.x,c=u-r.offset.y,f=h*h+c*c,d=9216,p=.1;f>d?(r.offset.x=l,r.offset.y=u):(r.offset.x+=h*p,r.offset.y+=c*p),r.lastSafeOffset&&(r.lastSafeOffset.x=r.offset.x,r.lastSafeOffset.y=r.offset.y)}if(r.city=s,o){const l=Ns(s);if(l)r.offset.x=l.x,r.offset.y=l.y;else{const u=this.game.cities?.[s];u&&(r.offset.x=u.x+48,r.offset.y=u.y+100)}r.lastSafeOffset&&(r.lastSafeOffset.x=r.offset.x,r.lastSafeOffset.y=r.offset.y)}if(r.isMayor=!!e.isMayor,r.health=this.toFiniteNumber(e.health,r.health),e.isCloaked!==void 0&&(r.isCloaked=!!e.isCloaked),e.cloakExpiresAt!==void 0){const l=this.toFiniteNumber(e.cloakExpiresAt,r.cloakExpiresAt??0);r.cloakExpiresAt=Number.isFinite(l)?Math.max(0,l):0}if(e.isFrozen!==void 0&&(r.isFrozen=!!e.isFrozen),e.frozenUntil!==void 0){const l=this.toFiniteNumber(e.frozenUntil,r.frozenUntil??0);r.frozenUntil=Number.isFinite(l)?Math.max(0,l):0,(!r.isFrozen||r.frozenUntil===0)&&(r.frozenBy=null)}const a=Math.round(this.toFiniteNumber(e.direction,r.direction));if(Number.isFinite(a)){const l=(a%32+32)%32,u=Number.isFinite(r.direction)?(Math.round(r.direction)%32+32)%32:l;Math.min(Math.abs(l-u),32-Math.abs(l-u))>4&&(r.direction=l)}if(e.sequence!==void 0&&(r.sequence=e.sequence),this.game&&typeof this.game.updateOrbHint=="function"){const l=t&&t.source==="enter_game";this.game.updateOrbHint({force:l})}}normalisePlayerPayload(e){const t=this.safeParse(e);if(!t||typeof t!="object")return null;const r=Object.assign({},t);if(!r.id)if(e&&e.id)r.id=e.id;else return null;const n=r.offset&&typeof r.offset=="object"?r.offset:{};r.offset={x:this.toFiniteNumber(n.x,0),y:this.toFiniteNumber(n.y,0)},r.city=this.toFiniteNumber(r.city,0),r.isMayor=!!r.isMayor;const s=this.toFiniteNumber(r.health,this.game?.player?.health??0);r.health=Number.isFinite(s)?Math.max(0,s):0;const o=this.toFiniteNumber(r.direction,0);Number.isFinite(o)?r.direction=(Math.round(o)%32+32)%32:r.direction=0;const a=this.toFiniteNumber(r.isTurning,0);r.isTurning=Math.max(-1,Math.min(1,Math.round(Number.isFinite(a)?a:0)));const l=this.toFiniteNumber(r.isMoving,0);Number.isFinite(l)?l>1?r.isMoving=1:l<-1?r.isMoving=-1:r.isMoving=l:r.isMoving=0,r.sequence=Math.max(0,Math.round(this.toFiniteNumber(r.sequence,0))),r.isCloaked=!!r.isCloaked;const u=this.toFiniteNumber(r.cloakExpiresAt,r.isCloaked?r.cloakExpiresAt??0:0);r.cloakExpiresAt=Number.isFinite(u)?Math.max(0,u):0,r.isFrozen=!!r.isFrozen;const h=this.toFiniteNumber(r.frozenUntil,r.isFrozen?r.frozenUntil??0:0);if(r.frozenUntil=Number.isFinite(h)?Math.max(0,h):0,r.isFrozen?r.frozenBy=r.frozenBy??null:r.frozenBy=null,typeof r.callsign=="string"){const c=r.callsign.trim();c.length?r.callsign=c:delete r.callsign}if(r.userId!==void 0&&r.userId!==null){const c=String(r.userId).trim();c.length?r.userId=c:delete r.userId}return r}normaliseHazardPayload(e){const t=this.safeParse(e);return!t||typeof t!="object"||!t.id?null:{id:t.id,type:t.type,x:this.toFiniteNumber(t.x,0),y:this.toFiniteNumber(t.y,0),ownerId:t.ownerId??null,teamId:t.teamId??null,active:!!t.active,armed:!!t.armed,detonateAt:t.detonateAt??null,reason:t.reason??null,revealedAt:t.revealedAt??null,triggeredBy:t.triggeredBy??null,triggeredTeam:t.triggeredTeam??null}}applyHealthUpdate(e){const t=this.toFiniteNumber(e.health,null);if(!e.id||t===null)return;const r=this.io?.id;if(r&&e.id===r){const n=Number.isFinite(this.game.player?.health)?this.game.player.health:t,s=Math.max(0,t);this.game.player&&(this.game.player.health=s,s<=0&&(this.game.player.engineLoopActive=!1)),this.game.audio&&(s<=0&&n>0?(this.game.audio.playEffect(ct.DIE,{volume:.8}),this.game.audio.setLoopState(ct.ENGINE,!1)):s<n&&this.game.audio.playEffect(ct.HIT,{volume:.7}));return}this.game.otherPlayers[e.id]||(this.game.otherPlayers[e.id]={id:e.id}),this.game.otherPlayers[e.id].health=Math.max(0,t)}applyStatusUpdate(e){const t=this.io?.id,r=t&&e.id===t?this.game.player:this.game.otherPlayers[e.id]??(this.game.otherPlayers[e.id]={id:e.id});if(r){if(e.isCloaked!==void 0&&(r.isCloaked=!!e.isCloaked),e.cloakExpiresAt!==void 0){const n=this.toFiniteNumber(e.cloakExpiresAt,r.cloakExpiresAt??0);r.cloakExpiresAt=Number.isFinite(n)?Math.max(0,n):0}if(e.isFrozen!==void 0&&(r.isFrozen=!!e.isFrozen,r.isFrozen||(r.frozenBy=null)),e.frozenUntil!==void 0){const n=this.toFiniteNumber(e.frozenUntil,r.frozenUntil??0);r.frozenUntil=Number.isFinite(n)?Math.max(0,n):0}e.frozenBy!==void 0&&e.frozenBy!==null&&(r.frozenBy=e.frozenBy),t&&e.id===t&&(this.game.forceDraw=!0)}}playBulletShotSound(e){if(!this.game||!this.game.audio)return;const t=this.resolveShotSoundId(e);if(!t)return;const r=this.toFiniteNumber(e?.x,null),n=this.toFiniteNumber(e?.y,null);Number.isFinite(r)&&Number.isFinite(n)?this.game.audio.playEffect(t,{position:{x:r,y:n}}):this.game.audio.playEffect(t)}resolveShotSoundId(e){const t=this.toFiniteNumber(e?.type,0);if(t===1)return ct.ROCKET;if(t===3)return ct.FLARE;const r=typeof e?.sourceType=="string"?e.sourceType.toLowerCase():null;return r&&(r==="turret"||r==="plasma"||r==="sleeper")?ct.TURRET:ct.LASER}markLocalShot(e){if(!e)return;this.localShotCache||(this.localShotCache=new Map);const t=Date.now();e.shooter&&this.localShotCache.set(`shooter:${e.shooter}`,t),e.sourceId&&this.localShotCache.set(`source:${e.sourceId}`,t),this.pruneLocalShots(t)}pruneLocalShots(e=Date.now()){if(!this.localShotCache)return;const t=e-Pa;this.localShotCache.forEach((r,n)=>{r<t&&this.localShotCache.delete(n)})}shouldSuppressShotSound(e){if(!e||!this.localShotCache)return!1;const t=Date.now();if(this.pruneLocalShots(t),e.shooter){const r=`shooter:${e.shooter}`,n=this.localShotCache.get(r);if(n&&t-n<Pa)return!0}if(e.sourceId){const r=`source:${e.sourceId}`,n=this.localShotCache.get(r);if(n&&t-n<Pa)return!0}return!1}handleCityOrbedAudio(e){if(!e||!this.game||!this.game.audio)return;const t=this.toFiniteNumber(this.game.player?.city,null);if(t===null)return;const r=this.toFiniteNumber(e.targetCity,null),n=this.toFiniteNumber(e.attackerCity,null);if(Number.isFinite(r)&&t===r){this.game.audio.playEffect(ct.DIE),this.game.audio.setLoopState(ct.ENGINE,!1),this.game.player&&(this.game.player.engineLoopActive=!1);return}Number.isFinite(n)&&t===n&&this.game.audio.playEffect(ct.SCREECH)}sendChatMessage(e={}){if(!this.io||!this.io.connected)return!1;const t=this.normaliseOutgoingChatPayload(e);return t?(this.io.emit("chat:message",JSON.stringify(t)),!0):!1}normaliseOutgoingChatPayload(e){if(!e||typeof e!="object")return null;const t=this.normaliseChatScope(e.scope),r=this.sanitiseChatText(e.message??e.text??"");return r?{scope:t,message:r}:null}normaliseChatScope(e){if(typeof e=="string"){const t=e.trim().toLowerCase();if(t==="global"||t==="all")return"global";if(t==="team"||t==="city")return"team"}return lE}sanitiseChatText(e){if(e==null)return"";let t=String(e);return t=t.replace(aE,""),t=t.replace(/\s+/g," ").trim(),t.length?(t.length>ld&&(t=t.slice(0,ld)),t):""}safeParse(e){if(e==null)return null;if(typeof e!="string")return e;try{return JSON.parse(e)}catch(t){return console.warn("Failed to parse payload from server",t),null}}toFiniteNumber(e,t){if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"){const r=Number(e);if(Number.isFinite(r))return r}return t!==void 0?t:0}}var Wt=new $.Container;let $i=null,ji=null;const ud=new $.Point;function hE(i){var e=s=>{s.stopPropagation(),console.log("Setting is demolishing to true"),i.isDemolishing=!0,i.stage.cursor="demolish",i.interactionLayer&&(i.interactionLayer.cursor="demolish")},t=new $.Texture(i.textures.buildingIcons.baseTexture,new $.Rectangle(208,0,16,16)),r=new $.Sprite(t);r.x=i.buildMenuOffset.x-16,r.y=i.buildMenuOffset.y,r.interactive=!0,r.iconType=13,r.on("mousedown",e);var n=new $.Text("Demolish building",{fontSize:12,fill:16777215});n.x=i.buildMenuOffset.x,n.y=i.buildMenuOffset.y,n.interactive=!0,n.on("mousedown",e),Wt.addChild(r),Wt.addChild(n)}const Nl=i=>{ji&&i.interactionLayer&&(i.interactionLayer.off("pointermove",ji),ji=null),$i&&($i.destroy(),$i=null),i.isBuilding=!1,i.isDragging=!1,i.showBuildMenu=!1,Wt.visible=!1,i.interactionLayer&&(i.interactionLayer.cursor="cursor")},Bl=(i,e,t)=>{Nl(i),i.isBuilding=e,i.isDragging=!0,i.showBuildMenu=!1,Wt.visible=!1;const r=new $.Texture(i.textures.buildings.baseTexture,new $.Rectangle(0,parseInt(i.isBuilding/100)*144,144,144)),n=new $.Sprite(r);n.alpha=.5,n.interactive=!1,n.buttonMode=!1,i.stage.addChild(n),$i=n;const s=o=>{let a;if(o&&o.global)a=o.global;else if(i.app&&i.app.renderer&&i.app.renderer.plugins&&i.app.renderer.plugins.interaction){const u=i.app.renderer.plugins.interaction,h=u.pointer||u.mouse;h&&h.global&&(a=h.global)}if(!a)return;ud.copyFrom(a);const l=n.parent.toLocal(ud);n.position.copyFrom(l)};i.interactionLayer&&(ji=o=>s(o.data),i.interactionLayer.on("pointermove",ji),i.interactionLayer.cursor="pointer"),s(t)},Ym=i=>{if(!i||!i.stage)return;const e=Number.isFinite(i?.player?.city)?i.player.city:null,r=(e!==null&&Array.isArray(i?.cities)?i.cities[e]:null)?.canBuild;if(!r){Nl(i),Wt.visible=!1,Wt.parent||i.stage.addChild(Wt);return}if(i.forceDraw){Wt.removeChildren();var n=Object.keys(r),s=1;n.forEach(a=>{r[a]==sr&&s++});var o=new $.Graphics;o.lineStyle(2,0,0),o.beginFill(0,1),o.drawRect(i.buildMenuOffset.x,i.buildMenuOffset.y,180,s*16),o.endFill(),Wt.addChild(o),hE(i),s=1,n.forEach((a,l)=>{if(r[a]==sr){var u=or[a].TYPE,h=p=>{p.stopPropagation(),Bl(i,u,p.data)},c=new $.Texture(i.textures.buildingIcons.baseTexture,new $.Rectangle(or[a].ICON*16,0,16,16)),f=new $.Sprite(c);f.x=i.buildMenuOffset.x-16,f.y=i.buildMenuOffset.y+s*16,f.interactive=!0,f.iconType=or[a].IMAGE,f.on("mousedown",h);var d=new $.Text(or[a].LABEL,{fontSize:12,fill:16777215});d.x=i.buildMenuOffset.x,d.y=i.buildMenuOffset.y+s*16,d.interactive=!0,d.on("mousedown",h),Wt.addChild(f),Wt.addChild(d),s++}}),Wt.visible=!1}Wt.parent||i.stage.addChild(Wt),i.clearGhostBuilding=()=>Nl(i),i.startGhostBuilding=(a,l)=>Bl(i,a,l)};function cE(i){i.isBuilding&&!$i&&Bl(i,i.isBuilding,null)}const fE=i=>{!i.isDragging&&!i.isDemolishing&&(Wt.visible=i.showBuildMenu),cE(i)};var hd=0,dE=function(i,e){for(var t=i.getHead(),r=1920,n=[];t;)t.x>e.offset.x-r&&t.x<e.offset.x+r&&t.y>e.offset.y-r&&t.y<e.offset.y+r&&n.push(t),t=t.next;return n},Dl=(i,e,t,r,n)=>{const s=i.textures.imageTurretBase?.baseTexture;if(!s)return;const o=Math.max(0,Math.min(2,(t.type??Kt)-Kt)),a=Number.isFinite(t?.maxLife)?t.maxLife:null,l=Number.isFinite(t?.life)?t.life:null,u=Number.isFinite(t?.burnThreshold)?t.burnThreshold:null;let h=0;if(a&&l!==null&&l<a){const p=l/a;p<=0||u!==null&&l<=u?h=2:p<=.66&&(h=1)}else t?.isBurning&&(h=2);h=Math.max(0,Math.min(2,h));const c=new $.Texture(s,new $.Rectangle(h*48,o*48,48,48));e.addFrame(c,t.x-i.player.offset.x+r,t.y-i.player.offset.y+n);let f=0;Number.isFinite(t.angle)&&(f=parseInt(t.angle/22.5+1,10)),(f>=16||f<0)&&(f=0);var d=new $.Texture(i.textures.imageTurretHead.baseTexture,new $.Rectangle(f*48,(t.type-9)*48,48,48));e.addFrame(d,t.x-i.player.offset.x+r,t.y-i.player.offset.y+n)},pE=(i,e,t,r,n)=>{const s=t.city??t.teamId??null,o=i.player?.city??null;if(!(t.active&&s!==null&&s!==o)){var a=new $.Texture(i.textures.imageItems.baseTexture,new $.Rectangle(te*32,0,32,32)),l=t.x-i.player.offset.x+r+8,u=t.y-i.player.offset.y+n+8;e.addFrame(a,l,u)}},yE=(i,e,t,r,n)=>{const s=t.city??t.teamId??null,o=i.player?.city??null;if(t.active&&s!==null&&s!==o)return;const a=i.textures.imageItems?.baseTexture;if(!a)return;const l=new $.Texture(a,new $.Rectangle(me*48,42,48,48)),u=t.x-i.player.offset.x+r,h=t.y-i.player.offset.y+n;e.addFrame(l,u,h)},mE=(i,e,t,r,n)=>{const s=i.textures.imageItems?.baseTexture;if(!s)return;const a=!!t.active?new $.Rectangle(144,91,48,48):new $.Rectangle(Ot*48,42,48,48),l=new $.Texture(s,a),u=t.x-i.player.offset.x+r,h=t.y-i.player.offset.y+n;e.addFrame(l,u,h)};const vE=(i,e,t,r,n)=>{const s=i.textures.imageItems?.baseTexture;if(!s)return;const o=new $.Texture(s,new $.Rectangle(Le*48,42,48,48)),a=t.x-i.player.offset.x+r,l=t.y-i.player.offset.y+n;e.addFrame(o,a,l)},gE=(i,e,t,r,n)=>{const s=t.city??t.teamId??null,o=i.player?.city??null;!(s===null||o===null||s===o)&&!t.target||Dl(i,e,t,r,n)},bE=(i,e,t,r,n)=>{const s=i.textures.imageItems?.baseTexture;if(!s)return;const o=t.type*48,a=new $.Texture(s,new $.Rectangle(o,42,48,48)),l=t.x-i.player.offset.x+r,u=t.y-i.player.offset.y+n;e.addFrame(a,l,u)},_E={[Kt]:Dl,[he]:Dl,[ve]:gE,[Le]:vE,[te]:pE,[me]:yE,[Ot]:mE},zm=(i,e)=>{var t=Math.floor(i.player.offset.x%48),r=Math.floor(i.player.offset.y%48);if(i.tick>hd){hd=i.tick+200,e.clear();var n=dE(i.itemFactory,i.player);n.forEach((s,o)=>{switch(s.type){default:{const a=_E[s.type];a?a(i,e,s,t,r):bE(i,e,s,t,r);break}}}),e.position.set(i.player.defaultOffset.x+i.player.offset.x-t,i.player.defaultOffset.y+i.player.offset.y-r)}e.pivot.set(i.player.offset.x,i.player.offset.y)};var xE=function(i,e){for(var t=i.getHead(),r=1920,n=[];t;)t.owner==null&&t.x>e.offset.x-r&&t.x<e.offset.x+r&&t.y>e.offset.y-r&&t.y<e.offset.y+r&&n.push(t),t=t.next;return console.log(n),n};const Vm=(i,e)=>{var t=Math.floor(i.player.offset.x%32),r=Math.floor(i.player.offset.y%32);if(i.forceDraw){e.clear();var n=xE(i.iconFactory,i.player);n.forEach((s,o)=>{console.log(i.player.offset.x-s.x);var a=new $.Texture(i.textures.imageItems.baseTexture,new $.Rectangle(s.type*32,0,32,32));e.addFrame(a,s.x-i.player.offset.x+t,s.y-i.player.offset.y+r)}),e.position.set(i.player.defaultOffset.x+i.player.offset.x-t,i.player.defaultOffset.y+i.player.offset.y-r)}e.pivot.set(i.player.offset.x,i.player.offset.y)},qm=48,cd=qm/2,fd=qm*1.5,wE={[gu]:{x:7,y:267},[Ms]:{x:42,y:267},[ni]:{x:77,y:267},[Ot]:{x:7,y:302},[te]:{x:42,y:302},[si]:{x:77,y:302},[Ls]:{x:7,y:337},[me]:{x:42,y:337},[Le]:{x:77,y:337},[Kt]:{x:7,y:372},[ve]:{x:42,y:372},[he]:{x:77,y:372},[en]:{x:112,y:267}},TE=(i,e,t)=>wE[i]??{x:e,y:t},IE=[{key:"staff",offsetX:145,y:268,width:45,height:20,handler:i=>i?.showStaffSummary&&i.showStaffSummary()},{key:"map",offsetX:145,y:290,width:45,height:20,handler:i=>i?.toggleMapOverlay&&i.toggleMapOverlay()},{key:"info",offsetX:145,y:312,width:45,height:20,handler:i=>i?.showPlayerCityInfo&&i.showPlayerCityInfo()},{key:"points",offsetX:145,y:334,width:45,height:20,handler:i=>i?.showPointsSummary&&i.showPointsSummary()},{key:"options",offsetX:145,y:356,width:45,height:20,handler:i=>i?.openOptionsPanel&&i.openOptionsPanel()},{key:"help",offsetX:145,y:378,width:45,height:20,handler:i=>i?.showHelpMessage&&i.showHelpMessage()},{key:"build",offsetX:126,y:400,width:64,height:22,handler:i=>i?.toggleBuildMenuFromPanel&&i.toggleBuildMenuFromPanel()},{key:"exit",offsetX:150,y:576,width:42,height:18,handler:i=>i?.requestExitToLobby&&i.requestExitToLobby()}],EE=(i,e)=>{if(!i||!e)return;const t=i.maxMapX||0;IE.forEach(r=>{const n=new $.Graphics;n.beginFill(16777215,.001),n.drawRect(t+r.offsetX,r.y,r.width,r.height),n.endFill(),n.interactive=!0,n.buttonMode=!0,n.cursor="pointer",n.on("pointertap",s=>{s.stopPropagation(),typeof r.handler=="function"&&r.handler(i)}),e.addChild(n)})},SE=i=>{const e=Number.isFinite(i)?i:parseInt(i,10)||0;try{return e.toLocaleString("en-US")}catch{return`${e}`}},AE=i=>{if(!i)return 0;if(typeof i.grossIncome=="number"&&Number.isFinite(i.grossIncome))return i.grossIncome;const e=Number(i.income||0),t=Number(i.itemProduction||0)+Number(i.research||0)+Number(i.hospital||0)+Number(i.construction||0);return e-t},dd="__radarState",CE=2,oi=2,pd="__homeArrowState",Oa=40,$m=5,jm=160,Vt=(i,e=null)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const t=Number(i);if(Number.isFinite(t))return t}return e},Wn=(i,e)=>!i||!i.baseTexture?null:new $.Texture(i.baseTexture,new $.Rectangle(e*oi,0,oi,oi)),PE=i=>{if(!i||!i.textures)return null;const e=i.textures.imgRadarColors;if(!e)return null;const t={neutral:Wn(e,0),admin:Wn(e,1),enemy:Wn(e,2),ally:Wn(e,3)},r=i.textures.imgMiniMapColors;return r&&r.baseTexture&&(t.dead=new $.Texture(r.baseTexture,new $.Rectangle(15*oi,0,oi,oi))),t},yd=i=>{const e=i?.textures?.imgArrows;if(!e||!e.baseTexture)return[];const t=[];for(let r=0;r<8;r+=1){const n=new $.Rectangle(r*Oa,0,Oa,Oa);t.push(new $.Texture(e.baseTexture,n))}return t},OE=(i,e)=>{if(!i||!e||!i.textures?.imgArrows)return null;let t=e[pd];if(!t){const r=yd(i);if(!r.length)return null;const n=new $.Container;n.name="home-arrow",n.position.set((i.maxMapX||0)+$m,jm);const s=new $.Sprite(r[0]);return n.addChild(s),e.addChild(n),t={container:n,sprite:s,textures:r,lastIndex:-1},e[pd]=t,t}return(!t.container.parent||t.container.parent!==e)&&e.addChild(t.container),(!Array.isArray(t.textures)||t.textures.length!==8)&&(t.textures=yd(i),t.sprite&&t.textures.length&&(t.sprite.texture=t.textures[0],t.lastIndex=-1)),t},FE=(i,e)=>{const t=OE(i,e);if(!t||!t.sprite)return;const r=t.container;r.position.set((i.maxMapX||0)+$m,jm);const n=i?.player,s=n?.offset,o=Vt(n?.city,null);if(!s||o===null){r.visible=!1;return}const a=i.cities?.[o];if(!a){r.visible=!1;return}const l=Vt(a.x,null),u=Vt(a.y,null),h=Vt(s.x,null),c=Vt(s.y,null);if(!Number.isFinite(l)||!Number.isFinite(u)||!Number.isFinite(h)||!Number.isFinite(c)){r.visible=!1;return}const f=l+fd,d=u+fd,p=h+cd,v=c+cd,m=f-p,g=d-v;if(Math.abs(m)<1&&Math.abs(g)<1){r.visible=!1;return}const E=Math.atan2(-g,m);let I=Math.round(E/(Math.PI/4));I=(I%8+8)%8;const M=t.textures;if(!M||!M[I]){r.visible=!1;return}t.lastIndex!==I&&(t.sprite.texture=M[I],t.lastIndex=I),r.visible=!0},RE=(i,e)=>{if(!i||!e||!i.textures||!i.textures.imgRadarColors)return null;let t=e[dd];if(!t){const h=new $.Container;h.name="radar-container";const c=new $.Container;c.name="radar-points",h.addChild(c),t={container:h,pointsLayer:c,pool:[],spriteScale:CE,textures:null,bounds:null},e[dd]=t}if(t.textures||(t.textures=PE(i)),!t.textures)return null;const r=i.maxMapX||0,{offsetX:n,offsetY:s,width:o,height:a}=Jb,l=r+n,u=s;return t.bounds={left:l,top:u,right:l+o,bottom:u+a,width:o,height:a},t.container.position.set(l,u),(!t.container.parent||t.container.parent!==e)&&e.addChild(t.container),t},ME=(i,e)=>{if(!i||!e||!e.pointsLayer||!e.textures)return;const t=i.player;if(!t||!t.offset){e.pointsLayer.visible=!1;return}const r=Vt(t.offset.x,null),n=Vt(t.offset.y,null);if(!Number.isFinite(r)||!Number.isFinite(n)){e.pointsLayer.visible=!1;return}const s=e.bounds;if(!s){e.pointsLayer.visible=!1;return}const o=e.pool,a=e.textures,l=(i.maxMapX||0)+Kb,u=Zb,h=Wb,c=Vt(t.city,null),f=Number.isFinite(c);let d=0;const p=(E,I,M)=>{let _=o[d];_||(_=new $.Sprite(E),_.anchor.set(.5),_.scale.set(e.spriteScale,e.spriteScale),e.pointsLayer.addChild(_),o[d]=_),_.texture!==E&&(_.texture=E),_.visible=!0,_.position.set(I-s.left,M-s.top),d+=1},v=(E,I,M,_,F,C,H)=>{const R=E-r,N=I-n;if(Math.abs(R)>h||Math.abs(N)>h)return;const Y=l+(R-Qb)/sf,D=u+(N-t_)/sf;if(Y<s.left||Y>s.right||D<s.top||D>s.bottom)return;let J=a.enemy;if(H!=="rogue"){const Q=Number.isFinite(M)?M:null;F||f&&Q!==null&&Q===c?J=a.ally||a.neutral||J:C&&a.admin?J=a.admin:Q===null&&a.neutral&&(J=a.neutral)}Number.isFinite(_)&&_<=0&&a.dead&&(J=a.dead),J&&p(J,Y,D)};t.isCloaked||v(r,n,c,Vt(t.health,null),!0,!1,"player");const m=i.otherPlayers;if(m)for(const E in m){if(!Object.prototype.hasOwnProperty.call(m,E))continue;const I=m[E];if(!I||!I.offset||I.isCloaked)continue;const M=Vt(I.offset.x,null),_=Vt(I.offset.y,null);!Number.isFinite(M)||!Number.isFinite(_)||v(M,_,Vt(I.city,null),Vt(I.health,null),!1,!!I.isAdmin,"player")}const g=i.rogueTankManager;if(g&&Array.isArray(g.tanks)){const E=g.tanks;for(let I=0;I<E.length;I+=1){const M=E[I];if(!M||!M.offset)continue;const _=Vt(M.offset.x,null),F=Vt(M.offset.y,null);!Number.isFinite(_)||!Number.isFinite(F)||v(_,F,null,Vt(M.health,null),!1,!1,"rogue")}}for(let E=d;E<o.length;E+=1){const I=o[E];I&&(I.visible=!1)}e.pointsLayer.visible=d>0};var LE=(i,e)=>{var t=new $.Sprite(i.textures.interfaceTop);t.x=i.maxMapX,t.y=0,e.addChild(t);var r=new $.Sprite(i.textures.interfaceBottom);r.x=i.maxMapX,r.y=430,e.addChild(r)},NE=(i,e)=>{if(!i.player.isMayor)return;const t=i.player.city??0,r=i.cities?.[t];if(!r)return;const n=i.textures.imgMoneyBox;if(n){const u=new $.Sprite(n);u.x=i.maxMapX+2,u.y=224,e.addChild(u)}const s=AE(r),o=s<0?"imgMoneyDown":"imgMoneyUp",a=i.textures[o];if(a){const u=new $.Sprite(a);u.x=i.maxMapX+8,u.y=225,e.addChild(u)}const l=new $.Text(SE(r.cash??0),{fontFamily:"Arial",fontSize:13,fontWeight:"bold",fill:s<0?15158332:3066993,stroke:0,strokeThickness:1});l.x=i.maxMapX+24,l.y=226,e.addChild(l)},BE=(i,e)=>{for(var t=i.iconFactory.getHead(),r=0,n=0;t;){if(t.owner==i.player.id){let l=t.type*32,u=0;t.type===Ot&&t.armed&&(l=152,u=89);var s=new $.Texture(i.textures.imageItems.baseTexture,new $.Rectangle(l,u,32,32)),o=new $.Sprite(s);const h=TE(t.type,7,267);if(r=i.maxMapX+h.x,n=h.y,t.selected){var a=new $.Sprite(i.textures.imageInventorySelection);a.x=r,a.y=n,e.addChild(a)}o.x=r,o.y=n,o.interactive=!0,o.buttonMode=!0;const c=t;o.on("mousedown",d=>{console.log("selecting item"),d.stopPropagation(),console.log("selecting item"),i.iconFactory.toggleSelected(c),i.forceDraw=!0}),e.addChild(o);const f=t.quantity??1;if(f>1){const d=new $.Text(`${f}`,{fontFamily:"Arial",fontSize:12,fill:16777215,fontWeight:"bold",stroke:0,strokeThickness:3});d.x=r+22,d.y=n+12,e.addChild(d)}}t=t.next}};const DE=(i,e)=>{if(!i||!e)return;const t=i.panelState||{},r=t.heading||"",n=Array.isArray(t.lines)?t.lines:[];if(!r&&!n.length)return;const s=i.maxMapX+12;let o=465;if(r){const l=new $.Text(r,{fontFamily:"Arial",fontSize:14,fontWeight:"bold",fill:16044095,stroke:0,strokeThickness:2});l.x=s,l.y=o,e.addChild(l),o+=15}const a={fontFamily:"Arial",fontSize:12,fill:16645886,stroke:0,strokeThickness:2};n.forEach(l=>{if(l==null){o+=15;return}const u=new $.Text(`${l}`,a);u.x=s,u.y=o,e.addChild(u),o+=15})};var kE=(i,e)=>{var t=i.player.health/mi,r=new $.Texture(i.textures.health.baseTexture,new $.Rectangle(0,0,38,t*87)),n=new $.Sprite(r);n.anchor={x:1,y:1},n.x=i.maxMapX+175,n.y=247,e.addChild(n)};const Wm=(i,e)=>{i.forceDraw&&(e.removeChildren(),LE(i,e),NE(i,e),kE(i,e),BE(i,e),DE(i,e),EE(i,e));const t=RE(i,e);ME(i,t),FE(i,e)};class UE{constructor(e){this.game=e,this.socketListener=null,this.lastSnapshot=null,this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.visible=!1,this.inGame=!1,this.identityManager=null,this.identityBusy=!1,this.identityFormVisible=!1,this.identityInput=null,this.identityForm=null,this.identitySummary=null,this.identityToggle=null,this.identityFeedback=null,this.identitySave=null,this.identityCancel=null,this.identitySignOut=null,this.googleContainer=null,this.googleButtonTarget=null,this.googleFeedback=null,this.googleScriptPromise=null,this.googleInitialized=!1,this.googleBusy=!1,this.onLobbySnapshot=t=>this.updateSnapshot(t),this.onLobbyUpdate=t=>this.updateSnapshot(t),this.onLobbyAssignment=t=>this.handleAssignment(t),this.onLobbyDenied=t=>this.handleDenial(t),this.onSocketConnected=()=>this.handleConnected(),this.onSocketDisconnected=t=>this.handleDisconnected(t),this.onLobbyEvicted=t=>this.handleEviction(t),this.injectStyles(),this.createOverlay(),this.show(),this.setStatus("Connecting to lobby...")}injectStyles(){if(document.getElementById("lobby-overlay-styles"))return;const e=document.createElement("style");e.id="lobby-overlay-styles",e.textContent=`
            .lobby-overlay {
                position: fixed;
                inset: 0;
                display: none;
                align-items: center;
                justify-content: center;
                background: rgba(8, 10, 16, 0.85);
                z-index: 9999;
                pointer-events: auto;
            }
            .lobby-overlay.visible {
                display: flex;
            }
            .lobby-panel {
                background: #131722;
                border: 1px solid #2a3140;
                border-radius: 8px;
                width: min(620px, 92vw);
                max-height: 86vh;
                padding: 24px 28px;
                color: #f5f7ff;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                box-shadow: 0 12px 32px rgba(0, 0, 0, 0.55);
                display: flex;
                flex-direction: column;
                gap: 20px;
            }
            .lobby-header {
                display: flex;
                flex-direction: column;
                gap: 4px;
            }
            .lobby-title {
                font-size: 24px;
                font-weight: 600;
                margin: 0;
            }
            .lobby-subtitle {
                font-size: 14px;
                color: #b3b9c9;
                margin: 0;
            }
            .lobby-city-list {
                flex: 1;
                overflow-y: auto;
                padding-right: 6px;
                display: flex;
                flex-direction: column;
                gap: 12px;
            }
            .lobby-city-empty {
                color: #b3b9c9;
                font-size: 14px;
                text-align: center;
                padding: 24px 0;
            }
            .lobby-city-row {
                display: flex;
                justify-content: space-between;
                align-items: center;
                background: rgba(22, 27, 38, 0.85);
                border: 1px solid rgba(53, 63, 83, 0.8);
                border-radius: 6px;
                padding: 12px 16px;
                gap: 16px;
            }
            .lobby-city-row.waiting {
                border-color: #5c9eff;
                box-shadow: 0 0 0 1px rgba(92, 158, 255, 0.35);
            }
            .lobby-city-info {
                display: flex;
                flex-direction: column;
                gap: 6px;
                min-width: 0;
            }
            .lobby-city-name {
                font-size: 16px;
                font-weight: 600;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .lobby-city-meta {
                font-size: 13px;
                color: #9aa3b8;
            }
            .lobby-city-actions {
                display: flex;
                gap: 8px;
            }
            .lobby-btn {
                background: #1f2534;
                color: #e1e6f6;
                border: 1px solid #384156;
                border-radius: 4px;
                padding: 8px 14px;
                font-size: 13px;
                cursor: pointer;
                transition: background 0.15s, border-color 0.15s, transform 0.15s;
            }
            .lobby-btn--secondary {
                background: #181d2a;
                border-color: #2f374a;
                color: #d4daec;
            }
            .lobby-btn:hover:not(:disabled) {
                background: #2a3245;
                border-color: #4f5d7c;
            }
            .lobby-btn--secondary:hover:not(:disabled) {
                background: #232b3d;
                border-color: #42506d;
            }
            .lobby-btn:active:not(:disabled) {
                transform: translateY(1px);
            }
            .lobby-btn:disabled {
                opacity: 0.45;
                cursor: default;
            }
            .lobby-actions {
                display: flex;
                justify-content: space-between;
                align-items: center;
                gap: 12px;
                flex-wrap: wrap;
            }
            .lobby-action-group {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }
            .lobby-identity {
                display: flex;
                flex-direction: column;
                gap: 6px;
                align-items: flex-end;
                min-width: 220px;
            }
            .lobby-identity-summary {
                font-size: 13px;
                color: #9aa3b8;
                text-align: right;
            }
            .lobby-identity-form {
                display: none;
                flex-direction: column;
                gap: 8px;
                width: 100%;
            }
            .lobby-identity-form.visible {
                display: flex;
            }
            .lobby-identity-controls {
                display: flex;
                gap: 8px;
                justify-content: flex-end;
                flex-wrap: wrap;
            }
            .lobby-identity-signout {
                color: #f6b6b6;
            }
            .lobby-identity-signout:hover:not(:disabled) {
                background: #2c1b1b;
                border-color: #6b2a2a;
                color: #ffd6d6;
            }
            .lobby-google {
                display: none;
                flex-direction: column;
                gap: 6px;
                align-items: flex-end;
                width: 100%;
            }
            .lobby-google.visible {
                display: flex;
            }
            .lobby-google.busy {
                opacity: 0.6;
                pointer-events: none;
            }
            .lobby-google-button > div {
                display: inline-flex;
            }
            .lobby-google-feedback {
                font-size: 12px;
                color: #9aa3b8;
                text-align: right;
                min-height: 16px;
            }
            .lobby-google-feedback[data-type="error"] {
                color: #ff8484;
            }
            .lobby-google-feedback[data-type="success"] {
                color: #7fe3a0;
            }
            .lobby-identity-input {
                width: 100%;
                padding: 8px 10px;
                border: 1px solid #384156;
                border-radius: 4px;
                background: #0f131d;
                color: #e1e6f6;
                font-size: 13px;
            }
            .lobby-identity-input:focus {
                outline: none;
                border-color: #5c9eff;
                box-shadow: 0 0 0 1px rgba(92, 158, 255, 0.25);
            }
            .lobby-identity-actions {
                display: flex;
                gap: 8px;
                justify-content: flex-end;
            }
            .lobby-identity-feedback {
                font-size: 12px;
                min-height: 16px;
                color: #9aa3b8;
                text-align: right;
            }
            .lobby-identity-feedback[data-type="error"] {
                color: #ff8080;
            }
            .lobby-identity-feedback[data-type="success"] {
                color: #7be17d;
            }
            .lobby-status {
                font-size: 13px;
                color: #b3b9c9;
                min-height: 18px;
            }
            .lobby-status[data-type="error"] {
                color: #ff8080;
            }
            .lobby-status[data-type="warn"] {
                color: #ffc977;
            }
            .lobby-status[data-type="success"] {
                color: #7be17d;
            }
        `,document.head.appendChild(e)}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="lobby-overlay";const e=document.createElement("div");e.className="lobby-panel";const t=document.createElement("div");t.className="lobby-header";const r=document.createElement("h1");r.className="lobby-title",r.textContent="City Lobby";const n=document.createElement("p");n.className="lobby-subtitle",n.textContent="Choose a city to join as mayor or recruit. Everyone starts at the same time.",t.appendChild(r),t.appendChild(n),this.cityListContainer=document.createElement("div"),this.cityListContainer.className="lobby-city-list";const s=document.createElement("div");s.className="lobby-actions";const o=document.createElement("div");o.className="lobby-action-group",this.autoButton=document.createElement("button"),this.autoButton.type="button",this.autoButton.className="lobby-btn",this.autoButton.textContent="Auto Assign",this.autoButton.addEventListener("click",()=>this.handleAutoJoin()),this.refreshButton=document.createElement("button"),this.refreshButton.type="button",this.refreshButton.className="lobby-btn",this.refreshButton.textContent="Refresh",this.refreshButton.addEventListener("click",()=>this.requestSnapshot()),o.appendChild(this.autoButton),o.appendChild(this.refreshButton),s.appendChild(o);const a=document.createElement("div");a.className="lobby-identity",this.identitySummary=document.createElement("div"),this.identitySummary.className="lobby-identity-summary",this.identitySummary.textContent="Playing as Guest";const l=document.createElement("div");l.className="lobby-identity-controls",this.identityToggle=document.createElement("button"),this.identityToggle.type="button",this.identityToggle.className="lobby-btn lobby-btn--secondary",this.identityToggle.textContent="Set display name",this.identityToggle.addEventListener("click",()=>this.toggleIdentityForm(!0)),this.identitySignOut=document.createElement("button"),this.identitySignOut.type="button",this.identitySignOut.className="lobby-btn lobby-btn--secondary lobby-identity-signout",this.identitySignOut.textContent="Sign out",this.identitySignOut.style.display="none",this.identitySignOut.addEventListener("click",()=>this.handleIdentitySignOut()),l.appendChild(this.identityToggle),l.appendChild(this.identitySignOut),this.googleContainer=document.createElement("div"),this.googleContainer.className="lobby-google",this.googleButtonTarget=document.createElement("div"),this.googleButtonTarget.className="lobby-google-button",this.googleFeedback=document.createElement("div"),this.googleFeedback.className="lobby-google-feedback",this.googleFeedback.dataset.type="info",this.googleFeedback.textContent="",this.googleContainer.appendChild(this.googleButtonTarget),this.googleContainer.appendChild(this.googleFeedback),this.identityForm=document.createElement("form"),this.identityForm.className="lobby-identity-form",this.identityForm.addEventListener("submit",h=>{h.preventDefault(),this.handleIdentitySubmit()}),this.identityInput=document.createElement("input"),this.identityInput.type="text",this.identityInput.maxLength=32,this.identityInput.autocomplete="off",this.identityInput.placeholder="Enter display name",this.identityInput.className="lobby-identity-input";const u=document.createElement("div");u.className="lobby-identity-actions",this.identitySave=document.createElement("button"),this.identitySave.type="submit",this.identitySave.className="lobby-btn",this.identitySave.textContent="Save",this.identityCancel=document.createElement("button"),this.identityCancel.type="button",this.identityCancel.className="lobby-btn lobby-btn--secondary",this.identityCancel.textContent="Cancel",this.identityCancel.addEventListener("click",()=>this.toggleIdentityForm(!1)),u.appendChild(this.identitySave),u.appendChild(this.identityCancel),this.identityFeedback=document.createElement("div"),this.identityFeedback.className="lobby-identity-feedback",this.identityFeedback.dataset.type="info",this.identityForm.appendChild(this.identityInput),this.identityForm.appendChild(u),this.identityForm.appendChild(this.identityFeedback),a.appendChild(this.identitySummary),a.appendChild(l),a.appendChild(this.googleContainer),a.appendChild(this.identityForm),s.appendChild(a),this.statusNode=document.createElement("div"),this.statusNode.className="lobby-status",this.statusNode.dataset.type="info",e.appendChild(t),e.appendChild(this.cityListContainer),e.appendChild(s),e.appendChild(this.statusNode),this.overlay.appendChild(e),document.body.appendChild(this.overlay)}attachSocket(e){e&&this.socketListener!==e&&(this.socketListener&&(this.socketListener.off("lobby:snapshot",this.onLobbySnapshot),this.socketListener.off("lobby:update",this.onLobbyUpdate),this.socketListener.off("lobby:assignment",this.onLobbyAssignment),this.socketListener.off("lobby:denied",this.onLobbyDenied),this.socketListener.off("connected",this.onSocketConnected),this.socketListener.off("disconnected",this.onSocketDisconnected),this.socketListener.off("lobby:evicted",this.onLobbyEvicted)),this.socketListener=e,e.on("lobby:snapshot",this.onLobbySnapshot),e.on("lobby:update",this.onLobbyUpdate),e.on("lobby:assignment",this.onLobbyAssignment),e.on("lobby:denied",this.onLobbyDenied),e.on("connected",this.onSocketConnected),e.on("disconnected",this.onSocketDisconnected),e.on("lobby:evicted",this.onLobbyEvicted))}attachIdentityManager(e){if(this.identityManager=e||null,this.configureGoogleIdentity(),this.identityManager&&typeof this.identityManager.getIdentity=="function"){const t=this.identityManager.getIdentity();this.updateIdentityDisplay(t)}else this.updateIdentityDisplay(null)}updateIdentityDisplay(e){const t=e&&typeof e.name=="string"?e.name.trim():"",r=this.identityManager,n=!!(r&&typeof r.isGoogleAuthEnabled=="function"&&r.isGoogleAuthEnabled()),s=!!(e&&e.provider==="google");if(this.identitySummary&&(s&&t.length?this.identitySummary.textContent=`Signed in as ${t}`:t.length?this.identitySummary.textContent=`Playing as ${t}`:n?this.identitySummary.textContent="Register with Google or set a display name to continue.":this.identitySummary.textContent="Set a display name to appear to other players."),this.identityToggle){let a="Set display name";t.length&&(a="Update name"),this.identityToggle.textContent=a,this.identityToggle.disabled=this.identityFormVisible||this.identityBusy}const o=!!(e&&e.id);this.identitySignOut&&(this.identitySignOut.style.display=o?"inline-flex":"none",this.identitySignOut.disabled=this.identityBusy||!o),this.identityInput&&!this.identityFormVisible&&(this.identityInput.value=t),this.updateGoogleDisplay(e)}configureGoogleIdentity(){if(!this.googleContainer)return;const e=this.identityManager;if(!!!(e&&typeof e.isGoogleAuthEnabled=="function"&&e.isGoogleAuthEnabled())){this.googleContainer.classList.remove("visible"),this.setGoogleFeedback("","info"),this.refreshGoogleInteractivity();return}this.googleContainer.classList.add("visible"),this.ensureGoogleClient(),this.refreshGoogleInteractivity()}ensureGoogleClient(){if(typeof window>"u")return;if(window.google&&window.google.accounts&&window.google.accounts.id?window.google.accounts.id:null){this.initializeGoogleButton();return}if(this.googleScriptPromise){this.googleScriptPromise.then(()=>this.initializeGoogleButton()).catch(t=>{this.setGoogleFeedback(t?.message||"Google sign-in unavailable.","error")});return}this.googleScriptPromise=new Promise((t,r)=>{const n=document.querySelector("script[data-google-identity]");if(n){const o=()=>t(window.google),a=()=>r(new Error("Failed to load Google identity script."));n.addEventListener("load",o,{once:!0}),n.addEventListener("error",a,{once:!0});return}const s=document.createElement("script");s.src="https://accounts.google.com/gsi/client",s.async=!0,s.defer=!0,s.dataset.googleIdentity="true",s.onload=()=>t(window.google),s.onerror=()=>r(new Error("Failed to load Google identity script.")),document.head.appendChild(s)}),this.googleScriptPromise.then(()=>this.initializeGoogleButton()).catch(t=>{this.setGoogleFeedback(t?.message||"Google sign-in unavailable.","error")})}initializeGoogleButton(){if(!this.googleContainer)return;const e=this.identityManager;if(!e||typeof e.getGoogleClientId!="function"){this.setGoogleFeedback("Google sign-in unavailable.","error");return}const t=e.getGoogleClientId();if(!t){this.setGoogleFeedback("Google sign-in is not configured.","error");return}if(typeof window>"u"||!window.google||!window.google.accounts||!window.google.accounts.id){this.setGoogleFeedback("Google sign-in unavailable.","error");return}this.googleInitialized||(window.google.accounts.id.initialize({client_id:t,callback:n=>this.handleGoogleCredential(n)}),this.googleInitialized=!0),this.googleButtonTarget&&(this.googleButtonTarget.innerHTML="",window.google.accounts.id.renderButton(this.googleButtonTarget,{theme:"outline",size:"medium",text:"signup_with",width:240}));const r=e&&typeof e.getIdentity=="function"?e.getIdentity():null;r&&r.provider==="google"?this.setGoogleFeedback("Registered with Google.","success"):!this.googleBusy&&!this.identityBusy&&!this.identityFormVisible&&this.setGoogleFeedback("Register with Google to save your progress.","info")}async handleGoogleCredential(e){if(!e||typeof e.credential!="string"){this.setGoogleFeedback("Unable to read Google response.","error");return}if(!this.identityManager||typeof this.identityManager.authenticateWithGoogle!="function"){this.setGoogleFeedback("Google sign-in unavailable.","error");return}this.setGoogleBusy(!0),this.setGoogleFeedback("Registering with Google...","info");try{const t=await this.identityManager.authenticateWithGoogle(e.credential);this.updateIdentityDisplay(t),this.setStatus(`Signed in as ${t.name} via Google.`,{type:"success"}),this.setGoogleFeedback("Registered with Google.","success")}catch(t){const r=t&&t.message?t.message:"Google sign-in failed.";this.setGoogleFeedback(r,"error")}finally{this.setGoogleBusy(!1)}}handleIdentitySignOut(){!this.identityManager||typeof this.identityManager.clearIdentity!="function"||(this.identityManager.clearIdentity(),this.updateIdentityDisplay(null),this.showIdentityFeedback("You are playing as a guest.","info"),this.setStatus("Playing as guest.",{type:"info"}))}setGoogleFeedback(e,t="info"){this.googleFeedback&&(this.googleFeedback.textContent=e||"",this.googleFeedback.dataset.type=t||"info")}setGoogleBusy(e){this.googleBusy=!!e,this.refreshGoogleInteractivity()}refreshGoogleInteractivity(){if(!this.googleContainer)return;this.googleBusy||this.identityBusy||this.identityFormVisible?this.googleContainer.classList.add("busy"):this.googleContainer.classList.remove("busy")}updateGoogleDisplay(e){if(!this.googleContainer)return;const t=this.identityManager;if(!!!(t&&typeof t.isGoogleAuthEnabled=="function"&&t.isGoogleAuthEnabled())){this.googleContainer.classList.remove("visible"),this.setGoogleFeedback("","info"),this.refreshGoogleInteractivity();return}if(this.googleContainer.classList.add("visible"),!this.googleInitialized){this.ensureGoogleClient();return}e&&e.provider==="google"?this.setGoogleFeedback("Registered with Google.","success"):!this.googleBusy&&!this.identityBusy&&!this.identityFormVisible&&this.setGoogleFeedback("Register with Google to save your progress.","info")}toggleIdentityForm(e){if(!this.identityForm)return;const t=typeof e=="boolean"?e:!this.identityFormVisible;if(this.identityFormVisible=t,t){if(this.identityForm.classList.add("visible"),this.identityToggle&&(this.identityToggle.disabled=!0),this.identityInput){const r=this.identityManager&&typeof this.identityManager.getIdentity=="function"?this.identityManager.getIdentity():null,n=r&&r.name?r.name:this.identityInput.value;this.identityInput.value=n||"",this.identityInput.disabled=!1,setTimeout(()=>{this.identityInput&&(this.identityInput.focus(),this.identityInput.select())},0)}this.showIdentityFeedback("","info")}else this.identityForm.classList.remove("visible"),this.identityInput&&(this.identityInput.disabled=!1),this.identityToggle&&(this.identityToggle.disabled=this.identityBusy),this.identityBusy||this.showIdentityFeedback("","info");this.refreshGoogleInteractivity()}setIdentityBusy(e){if(this.identityBusy=!!e,this.identityInput&&(this.identityInput.disabled=this.identityBusy),this.identitySave&&(this.identitySave.disabled=this.identityBusy),this.identityCancel&&(this.identityCancel.disabled=this.identityBusy),this.identityToggle&&(this.identityToggle.disabled=this.identityBusy||this.identityFormVisible),this.identitySignOut){const t=this.identityManager&&typeof this.identityManager.getIdentity=="function"?this.identityManager.getIdentity():null,r=!!(t&&t.id);this.identitySignOut.disabled=this.identityBusy||!r}this.refreshGoogleInteractivity()}showIdentityFeedback(e,t="info"){this.identityFeedback&&(this.identityFeedback.textContent=e||"",this.identityFeedback.dataset.type=t||"info")}async handleIdentitySubmit(){if(this.identityBusy)return;const e=this.identityInput?this.identityInput.value:"",t=typeof e=="string"?e.trim():"";if(!t.length){this.showIdentityFeedback("Please enter a name.","error"),this.identityInput&&this.identityInput.focus();return}if(!this.identityManager||typeof this.identityManager.saveName!="function"){this.showIdentityFeedback("Registration is currently unavailable.","error");return}this.setIdentityBusy(!0),this.showIdentityFeedback("Saving...","info");try{const r=await this.identityManager.saveName(t);this.showIdentityFeedback("Name saved.","success"),this.updateIdentityDisplay(r),this.toggleIdentityForm(!1),this.setStatus(`Registered as ${r.name}.`,{type:"success"})}catch(r){const n=r&&r.message?r.message:"Unable to save name.";this.showIdentityFeedback(n,"error")}finally{this.setIdentityBusy(!1),this.identityFormVisible||this.showIdentityFeedback("","info")}}show(){this.overlay&&this.overlay.classList.add("visible"),this.visible=!0,this.identityManager&&typeof this.identityManager.getIdentity=="function"&&this.updateIdentityDisplay(this.identityManager.getIdentity()),this.game?.music&&typeof this.game.music.playLobby=="function"&&!this.inGame&&this.game.music.playLobby()}hide(){this.overlay&&this.overlay.classList.remove("visible"),this.visible=!1,this.identityFormVisible&&this.toggleIdentityForm(!1),this.game?.music&&typeof this.game.music.stop=="function"&&this.game.music.stop()}isInGame(){return this.inGame}setStatus(e,t={}){if(!this.statusNode)return;const r=t.type||"info";this.statusNode.dataset.type=r,this.statusNode.textContent=e||""}updateSnapshot(e){let t=e;if(t){if(typeof t=="string")try{t=JSON.parse(t)}catch(r){console.warn("Failed to parse lobby snapshot",r);return}!t||!Array.isArray(t.cities)||(this.lastSnapshot=t,this.renderCityList(),this.waiting||!t.cities.some(n=>n.openMayor||n.openRecruits>0)&&this.visible&&this.setStatus("All cities are currently full. Please wait for an opening.",{type:"warn"}))}}renderCityList(){if(!this.cityListContainer)return;if(this.cityListContainer.innerHTML="",!this.lastSnapshot||!Array.isArray(this.lastSnapshot.cities)||!this.lastSnapshot.cities.length){const t=document.createElement("div");t.className="lobby-city-empty",t.textContent="Waiting for available cities...",this.cityListContainer.appendChild(t);return}[...this.lastSnapshot.cities].sort((t,r)=>{const n=Number.isFinite(t?.id)?t.id:0,s=Number.isFinite(r?.id)?r.id:0;return n-s}).forEach(t=>{const r=document.createElement("div");r.className="lobby-city-row",r.dataset.cityId=t.id,this.waiting&&this.waitingCity===t.id&&r.classList.add("waiting");const n=document.createElement("div");n.className="lobby-city-info";const s=document.createElement("div");s.className="lobby-city-name",s.textContent=t.name||`City ${t.id}`;const o=t.openMayor?"(open)":t.mayorLabel||"(unknown)",a=Number.isFinite(t.capacity)?t.capacity:1+(t.maxRecruits??3),l=Number.isFinite(t.playerCount)?t.playerCount:0,u=document.createElement("div");u.className="lobby-city-meta";const h=[`Mayor: ${o}`,`Players: ${l}/${a}`],c=Number.isFinite(t.score)?t.score:Number(t.score);Number.isFinite(c)&&h.push(`Score: ${c}`);const f=Number.isFinite(t.orbs)?t.orbs:Number(t.orbs);Number.isFinite(f)&&h.push(`Orbs: ${f}`),u.textContent=h.join("  "),n.appendChild(s),n.appendChild(u);const d=document.createElement("div");d.className="lobby-city-actions";const p=document.createElement("button");p.type="button",p.className="lobby-btn",p.textContent="Mayor",p.disabled=!t.openMayor||this.waiting,p.addEventListener("click",()=>this.handleJoin(t.id,"mayor"));const v=document.createElement("button");v.type="button",v.className="lobby-btn",v.textContent="Recruit";const m=Number.isFinite(t.openRecruits)?t.openRecruits>0:!!t.hasRecruitVacancy;v.disabled=!m||this.waiting,v.addEventListener("click",()=>this.handleJoin(t.id,"recruit")),d.appendChild(p),d.appendChild(v),r.appendChild(n),r.appendChild(d),this.cityListContainer.appendChild(r)}),this.autoButton&&(this.autoButton.disabled=this.waiting),this.refreshButton&&(this.refreshButton.disabled=this.waiting)}handleJoin(e,t){if(this.waiting)return;if(!this.socketListener||this.socketListener.io&&this.socketListener.io.disconnected){this.setStatus("Cannot join right now. Connection unavailable.",{type:"error"});return}this.waiting=!0,this.waitingCity=e,this.waitingRole=t,this.setStatus(`Requesting ${t==="mayor"?"mayor":"recruit"} slot in city ${e}...`),this.renderCityList();const r=this.socketListener.enterGame({city:e,role:t});r&&(this.game.player.id=r)}handleAutoJoin(){if(this.waiting)return;if(!this.socketListener||this.socketListener.io&&this.socketListener.io.disconnected){this.setStatus("Cannot join right now. Connection unavailable.",{type:"error"});return}this.waiting=!0,this.waitingCity=null,this.waitingRole=null,this.setStatus("Requesting automatic assignment..."),this.renderCityList();const e=this.socketListener.enterGame({auto:!0});e&&(this.game.player.id=e)}handleAssignment(e){this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.inGame=!0,this.setStatus("Assignment confirmed. Entering city...",{type:"success"}),this.renderCityList(),this.hide()}handleEviction(e){this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.inGame=!1;const t=typeof e?.reason=="string"?e.reason:"orb",r=Number.isFinite(e?.city)?Number(e.city):null,n=Number.isFinite(e?.attackerCity)?Number(e.attackerCity):null,s=Number.isFinite(e?.points)?Number(e.points):null,o=r!==null?Ft(r):"your city",a=n!==null?Ft(n):null,l=[];t==="death"?a?l.push(`${a} eliminated you.`):l.push("You were eliminated in combat."):a?l.push(`${a} destroyed ${o}.`):l.push(`An enemy orb destroyed ${o}.`),t!=="death"&&s!==null&&s>0&&l.push(`They earned ${s} points.`),this.show(),this.setStatus(l.join(" "),{type:"error"}),this.renderCityList(),this.requestSnapshot()}handleDenial(e){this.waiting=!1,this.inGame=!1;const t=e?.requestedCity,r=e?.reason==="cities_full"?"All cities are currently full. Please try again in a moment.":"Selected slot was unavailable. Please choose a different option.",n=e?.reason==="cities_full"?"warn":"error";t!=null?this.waitingCity=t:this.waitingCity=null,this.waitingRole=null,this.setStatus(r,{type:n}),this.renderCityList(),this.requestSnapshot()}handleConnected(){this.inGame=!1,this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.show(),this.setStatus("Connected. Choose a city to enter.",{type:"info"}),this.requestSnapshot()}handleDisconnected(e){this.inGame=!1,this.waiting=!1,this.waitingCity=null,this.waitingRole=null,this.show();const t=e?`Connection lost (${e}). Reconnecting...`:"Connection lost. Reconnecting...";this.setStatus(t,{type:"error"})}requestSnapshot(){this.socketListener&&typeof this.socketListener.requestLobbySnapshot=="function"&&this.socketListener.requestLobbySnapshot()}}class XE{constructor(e={}){this.maxVisible=Number.isFinite(e.maxVisible)?Math.max(1,e.maxVisible):5,this.defaultTimeout=Number.isFinite(e.timeout)?e.timeout:5e3,this.notifications=new Set,this.injectStyles(),this.container=this.createContainer()}injectStyles(){if(typeof document>"u"||document.getElementById("battlecity-toast-styles"))return;const e=document.createElement("style");e.id="battlecity-toast-styles",e.textContent=`
            #battlecity-toast-container {
                position: fixed;
                inset: auto 24px 24px auto;
                display: flex;
                flex-direction: column;
                justify-content: flex-end;
                gap: 12px;
                width: min(340px, 92vw);
                z-index: 1200;
                pointer-events: none;
            }
            .battlecity-toast {
                background: rgba(16, 20, 32, 0.92);
                border-radius: 12px;
                border: 1px solid rgba(82, 104, 176, 0.35);
                box-shadow: 0 18px 40px rgba(5, 9, 20, 0.55);
                padding: 12px 16px 12px 18px;
                display: flex;
                flex-direction: column;
                gap: 6px;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                color: #ecf2ff;
                pointer-events: auto;
                cursor: pointer;
                opacity: 0;
                transform: translateY(8px);
                transition: opacity 160ms ease, transform 160ms ease;
            }
            .battlecity-toast[data-visible="true"] {
                opacity: 1;
                transform: translateY(0);
            }
            .battlecity-toast__title {
                font-weight: 600;
                letter-spacing: 0.3px;
                font-size: 14px;
            }
            .battlecity-toast__body {
                font-size: 13px;
                line-height: 1.45;
                opacity: 0.9;
            }
            .battlecity-toast[data-variant="success"] {
                border-color: rgba(82, 176, 125, 0.5);
            }
            .battlecity-toast[data-variant="warn"] {
                border-color: rgba(220, 156, 72, 0.5);
            }
            .battlecity-toast[data-variant="error"] {
                border-color: rgba(220, 92, 92, 0.5);
            }
        `,document.head.appendChild(e)}createContainer(){if(typeof document>"u")return null;let e=document.getElementById("battlecity-toast-container");return e||(e=document.createElement("div"),e.id="battlecity-toast-container",document.body.appendChild(e)),e}normaliseMessage(e){return e==null?"":Array.isArray(e)?e.filter(t=>t!=null).map(t=>`${t}`).join(" "):`${e}`}notify(e={}){if(!this.container)return null;const t=e.title?`${e.title}`:"",r=this.normaliseMessage(e.message),n=e.variant||e.level||"info",s=Number.isFinite(e.timeout)?e.timeout:this.defaultTimeout;for(;this.notifications.size>=this.maxVisible;){const l=this.notifications.values().next().value;if(!l)break;this.dismiss(l)}const o=document.createElement("div");if(o.className="battlecity-toast",o.dataset.variant=n,t){const l=document.createElement("div");l.className="battlecity-toast__title",l.textContent=t,o.appendChild(l)}if(r){const l=document.createElement("div");l.className="battlecity-toast__body",l.textContent=r,o.appendChild(l)}const a=()=>this.dismiss(o);return o.addEventListener("click",a),this.container.appendChild(o),this.notifications.add(o),requestAnimationFrame(()=>{o.dataset.visible="true"}),s>0&&(o.__battlecityTimeout=window.setTimeout(()=>this.dismiss(o),s)),o}dismiss(e){!e||!this.notifications.has(e)||(this.notifications.delete(e),e.dataset.visible="false",e.__battlecityTimeout&&window.clearTimeout(e.__battlecityTimeout),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},180))}clear(){Array.from(this.notifications).forEach(e=>this.dismiss(e))}}const md=["Iron Vanguard","Steel Warden","Brass Rampart","Cobalt Siege","Obsidian Bastion","Chrome Juggernaut","Granite Lancer","Carbon Phalanx","Titan Howl","Copper Barrage","Lead Avalanche","Onyx Hammer","Nickel Sentry","Tungsten Brawler","Graphite Sabre","Mercury Raptor","Plasma Maul","Ironclad Echo","Steel Tempest","Rivet Spectre","Bunker Wolf","Siege Lynx","Mortar Hydra","Shrapnel Ghost","Grit Titan","Arc Bastion","Vulcan Aegis","Ferro Talon","Razor Rampart","Blast Cyclops","Warden Basilisk","Forge Kraken","Piston Revenant","Tread Harbinger","Serrated Bulwark","Verdant Mauler","Sable Vanguard","Chrome Gorgon","Thunder Pillar","Siege Rancor","Smokestack Viper","Recoil Behemoth","Ashen Paladin","Slate Raider","Oxide Marauder","Coldfire Titan","Tremor Wraith","Steel Cyclone"],HE=Array.isArray(md)?md.filter(i=>typeof i=="string"&&i.trim().length):[],GE=i=>Number.isFinite(i)?i<10?`0${i}`:`${i}`:"";class YE{constructor(e={}){const t=Array.isArray(e.names)&&e.names.length?e.names:HE;this.names=t.map(r=>`${r}`.trim()),this.cursor=0,this.assigned=new Map,this.usage=new Map}nextBaseName(){if(!this.names.length)return"Rampart";const e=this.names[this.cursor%this.names.length];return this.cursor=(this.cursor+1)%(this.names.length*1e3),e}buildName(e){const t=(this.usage.get(e)||0)+1;return this.usage.set(e,t),t===1?e:`${e}-${GE(t)}`}assign(e,t={}){if(e==null)return this.buildName(this.nextBaseName());const r=`${e}`;if(this.assigned.has(r))return this.assigned.get(r).name;const n=t.baseName||this.nextBaseName(),s=this.buildName(n);return this.assigned.set(r,{name:s,base:n}),s}get(e){if(e==null)return null;const t=this.assigned.get(`${e}`);return t?t.name:null}release(e){if(e==null)return;const t=`${e}`,r=this.assigned.get(t);if(!r)return;const{base:n}=r;if(this.assigned.delete(t),!n)return;const s=this.usage.get(n)||1,o=Math.max(0,s-1);o===0?this.usage.delete(n):this.usage.set(n,o)}}const Ut="battlecity-chat-container",zE=100,Jr={team:"Team",global:"Global"},VE=3500,kl=(i,e=null)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const t=Number(i);if(Number.isFinite(t))return t}return e},qE=(i,e=null)=>{const t=kl(i,e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):e},$E=i=>Number.isFinite(i)?new Date(i).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";class jE{constructor(e={}){this.game=e.game??null,this.defaultScope=e.defaultScope==="global"?"global":"team",this.maxMessages=Number.isFinite(e.maxMessages)?Math.max(1,e.maxMessages):zE,this.messages=[],this.socket=null,this.scope=this.defaultScope,this.statusTimeout=null,this.handleIncomingMessage=t=>this.receiveMessage(t),this.handleHistory=t=>this.applyHistory(t),this.handleRateLimit=t=>this.receiveRateLimit(t),this.handleConnected=()=>this.setConnectionState(!0),this.handleDisconnected=()=>this.setConnectionState(!1),this.injectStyles(),this.container=this.ensureContainer(),this.logElement=this.container?this.container.querySelector(".battlecity-chat__log"):null,this.formElement=this.container?this.container.querySelector(".battlecity-chat__form"):null,this.inputElement=this.container?this.container.querySelector(".battlecity-chat__input"):null,this.scopeElement=this.container?this.container.querySelector(".battlecity-chat__scope"):null,this.statusElement=this.container?this.container.querySelector(".battlecity-chat__status"):null,this.registerDomEvents(),this.setConnectionState(!1)}injectStyles(){if(typeof document>"u"||document.getElementById("battlecity-chat-styles"))return;const e=document.createElement("style");e.id="battlecity-chat-styles",e.textContent=`
            #${Ut} {
                position: fixed;
                left: 18px;
                bottom: 24px;
                width: min(360px, 32vw);
                display: flex;
                flex-direction: column;
                gap: 8px;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                color: #f5f7ff;
                z-index: 1150;
                pointer-events: none;
            }
            #${Ut}[data-connected="false"] .battlecity-chat__input,
            #${Ut}[data-connected="false"] .battlecity-chat__scope {
                opacity: 0.55;
            }
            #${Ut} .battlecity-chat__log {
                background: rgba(10, 16, 34, 0.72);
                border: 1px solid rgba(70, 94, 180, 0.45);
                border-radius: 12px;
                padding: 12px 14px;
                display: flex;
                flex-direction: column;
                gap: 6px;
                max-height: 240px;
                overflow-y: auto;
                pointer-events: auto;
            }
            #${Ut} .battlecity-chat__message {
                display: flex;
                flex-direction: column;
                gap: 2px;
                font-size: 13px;
                line-height: 1.45;
                word-break: break-word;
            }
            #${Ut} .battlecity-chat__messageHeader {
                display: flex;
                gap: 6px;
                align-items: baseline;
                font-size: 12px;
                letter-spacing: 0.2px;
                opacity: 0.8;
            }
            #${Ut} .battlecity-chat__scopeBadge {
                text-transform: uppercase;
                font-weight: 600;
                color: #8fb5ff;
            }
            #${Ut} .battlecity-chat__scopeBadge[data-scope="global"] {
                color: #ffba6b;
            }
            #${Ut} .battlecity-chat__sender {
                font-weight: 600;
                color: #f0f4ff;
            }
            #${Ut} .battlecity-chat__body {
                font-size: 13px;
                letter-spacing: 0.2px;
            }
            #${Ut} .battlecity-chat__form {
                display: flex;
                gap: 6px;
                pointer-events: auto;
            }
            #${Ut} .battlecity-chat__scope {
                appearance: none;
                border: 1px solid rgba(90, 114, 196, 0.6);
                background: rgba(13, 20, 44, 0.9);
                color: #e8eeff;
                border-radius: 10px;
                padding: 6px 10px;
                font-size: 13px;
                font-family: inherit;
                cursor: pointer;
                pointer-events: auto;
            }
            #${Ut} .battlecity-chat__input {
                flex: 1;
                border: 1px solid rgba(90, 114, 196, 0.6);
                background: rgba(18, 26, 52, 0.92);
                color: #f0f6ff;
                border-radius: 10px;
                padding: 8px 12px;
                font-size: 13px;
                font-family: inherit;
                outline: none;
                pointer-events: auto;
            }
            #${Ut} .battlecity-chat__input::placeholder {
                color: rgba(205, 214, 255, 0.65);
            }
            #${Ut} .battlecity-chat__status {
                min-height: 16px;
                font-size: 12px;
                color: #ffd27d;
                letter-spacing: 0.2px;
                opacity: 0;
                transition: opacity 180ms ease;
                pointer-events: none;
            }
            #${Ut} .battlecity-chat__status[data-visible="true"] {
                opacity: 0.85;
            }
        `,document.head.appendChild(e)}ensureContainer(){if(typeof document>"u")return null;let e=document.getElementById(Ut);return e||(e=document.createElement("div"),e.id=Ut,e.innerHTML=`
                <div class="battlecity-chat__log" aria-live="polite"></div>
                <form class="battlecity-chat__form" autocomplete="off">
                    <select class="battlecity-chat__scope" aria-label="Chat scope">
                        <option value="team">Team</option>
                        <option value="global">Global</option>
                    </select>
                    <input class="battlecity-chat__input" type="text" maxlength="240" placeholder="Team chat" />
                </form>
                <div class="battlecity-chat__status" role="status"></div>
            `,document.body.appendChild(e)),e}registerDomEvents(){!this.formElement||!this.inputElement||!this.scopeElement||(this.scopeElement.value=this.scope,this.scopeElement.addEventListener("change",()=>{this.scope=this.scopeElement.value==="global"?"global":"team",this.updatePlaceholder(),this.focusInput()}),this.formElement.addEventListener("submit",e=>{e.preventDefault(),this.submitMessage()}))}bindSocket(e){this.socket&&(this.socket.off("chat:message",this.handleIncomingMessage),this.socket.off("chat:history",this.handleHistory),this.socket.off("chat:rate_limit",this.handleRateLimit),this.socket.off("connected",this.handleConnected),this.socket.off("disconnected",this.handleDisconnected)),this.socket=e,e&&(e.on("chat:message",this.handleIncomingMessage),e.on("chat:history",this.handleHistory),e.on("chat:rate_limit",this.handleRateLimit),e.on("connected",this.handleConnected),e.on("disconnected",this.handleDisconnected))}setConnectionState(e){this.container&&(this.container.dataset.connected=e?"true":"false",this.inputElement&&(this.inputElement.disabled=!e,this.scopeElement&&(this.scopeElement.disabled=!e),this.updatePlaceholder()))}updatePlaceholder(){if(!this.inputElement)return;const e=Jr[this.scope]||Jr.team,t=this.container?.dataset.connected==="true"?`${e} chat`:"Chat offline";this.inputElement.placeholder=t}submitMessage(){if(!this.socket||!this.inputElement)return;const e=this.inputElement.value;if(!e||!e.trim()){this.inputElement.value="";return}this.socket.sendChatMessage({scope:this.scope,message:e})&&(this.inputElement.value="")}focusInput(){!this.inputElement||typeof window>"u"||window.requestAnimationFrame(()=>{this.inputElement&&this.inputElement.focus()})}receiveMessage(e){const t=this.normaliseIncomingMessage(e);t&&(this.messages.push(t),this.messages.length>this.maxMessages&&this.messages.splice(0,this.messages.length-this.maxMessages),this.appendMessage(t))}applyHistory(e){Array.isArray(e)&&(this.messages=e.map(t=>this.normaliseIncomingMessage(t)).filter(Boolean),this.logElement&&(this.logElement.innerHTML="",this.messages.forEach(t=>{this.logElement.appendChild(this.renderMessage(t))}),this.scrollToBottom()))}normaliseIncomingMessage(e){if(!e)return null;const t=typeof e.scope=="string"&&e.scope.toLowerCase()==="global"?"global":"team",r=typeof e.text=="string"?e.text.trim():"";if(!r)return null;const n=kl(e.createdAt,Date.now()),s=e.senderId??null,o=qE(e.senderCity,null),a=this.resolveSenderLabel(e,o);return{id:e.id?String(e.id):`${n}-${Math.random().toString(36).slice(2,6)}`,scope:t,text:r,createdAt:n,senderId:s,senderCity:o,senderLabel:a}}resolveSenderLabel(e,t){if(e&&typeof e.senderDisplay=="string"&&e.senderDisplay.trim().length)return e.senderDisplay.trim();if(e&&typeof e.senderCallsign=="string"&&e.senderCallsign.trim().length)return e.senderCallsign.trim();if(this.game&&typeof this.game.resolveCallsign=="function"&&e?.senderId){const n=this.game.resolveCallsign(e.senderId);if(n)return n}const r=this.resolveCityName(t);if(e?.senderId){const n=String(e.senderId);return n.length<=8?n:`${n.slice(0,4)}${n.slice(-2)}`}return r||"Player"}resolveCityName(e){if(e==null)return null;if(this.game&&Array.isArray(this.game.cities)){const t=this.game.cities[e];if(t){if(typeof t.nameOverride=="string"&&t.nameOverride.trim().length)return t.nameOverride.trim();if(typeof t.name=="string"&&t.name.trim().length)return t.name.trim()}}return Ft(e)}appendMessage(e){if(!this.logElement)return;const t=this.renderMessage(e);this.logElement.appendChild(t),this.scrollToBottom()}renderMessage(e){const t=document.createElement("div");t.className="battlecity-chat__message",t.dataset.scope=e.scope;const r=document.createElement("div");r.className="battlecity-chat__messageHeader";const n=document.createElement("span");if(n.className="battlecity-chat__scopeBadge",n.dataset.scope=e.scope,n.textContent=Jr[e.scope]||Jr.team,r.appendChild(n),e.senderCity!==null&&e.senderCity!==void 0){const l=document.createElement("span");l.className="battlecity-chat__city",l.textContent=this.resolveCityName(e.senderCity),r.appendChild(l)}const s=document.createElement("span");s.className="battlecity-chat__sender",s.textContent=e.senderLabel,r.appendChild(s);const o=$E(e.createdAt);if(o){const l=document.createElement("span");l.className="battlecity-chat__time",l.textContent=o,r.appendChild(l)}const a=document.createElement("div");return a.className="battlecity-chat__body",a.textContent=e.text,t.appendChild(r),t.appendChild(a),t}scrollToBottom(){this.logElement&&(this.logElement.scrollTop=this.logElement.scrollHeight)}receiveRateLimit(e){if(!e)return;const t=e.scope==="global"?"global":"team",r=Jr[t]||Jr.team,n=kl(e.retryAt,Date.now()),s=Math.max(1,Math.ceil((n-Date.now())/1e3)),o=`${r} chat cooling down (${s}s)`;this.showStatus(o),this.game&&typeof this.game.notify=="function"&&this.game.notify({title:"Chat Rate Limit",message:o,variant:"warn",timeout:2400})}showStatus(e){this.statusElement&&(this.statusElement.textContent=e||"",e?(this.statusElement.dataset.visible="true",typeof window<"u"&&(this.statusTimeout&&window.clearTimeout(this.statusTimeout),this.statusTimeout=window.setTimeout(()=>{this.statusElement&&(this.statusElement.dataset.visible="false",this.statusElement.textContent="")},VE))):this.statusElement.dataset.visible="false")}}const Ul={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},WE="battlecity.identity",vd=2,KE=32,ZE=()=>{try{typeof import.meta<"u"}catch{}return null},Fa=()=>{if(typeof window<"u"&&window.location){const i=window.location.protocol==="https:"?"https:":"http:",e=window.location.hostname||"localhost";return`${i}//${e}:8021`}return"http://localhost:8021"},JE=()=>{try{if(typeof import.meta<"u"&&Ul){const i=Ul,e=i.VITE_GOOGLE_CLIENT_IDS||i.VITE_GOOGLE_CLIENT_ID||null;if(e)return String(e)}}catch{}return null},QE=i=>{if(!i||typeof i!="string")return null;const e=i.replace(/\s+/g," ").trim();if(!e.length||e.length<vd)return null;const t=e.replace(/[\u0000-\u001F\u007F]/g,"").slice(0,KE).trim();return t.length<vd?null:t};class t1{constructor(e,t={}){this.game=e,this.identity=null;const r=ZE(),n=t.apiBase||r||Fa();this.apiBase=this._normaliseBase(n),this.storageKey=t.storageKey||WE,this.socketListener=null;const s=JE(),o=Array.isArray(t.googleClientIds)?t.googleClientIds:t.googleClientId||null;this.googleClientIds=this._normaliseClientIds(o)||[],this.googleClientIds.length===0&&(this.googleClientIds=this._normaliseClientIds(s)),this.googleClientId=this.googleClientIds.length?this.googleClientIds[0]:null,this._initialisePromise=null,this.handleSocketConnected=this.handleSocketConnected.bind(this),this.handleIdentityAck=this.handleIdentityAck.bind(this)}_normaliseBase(e){if(!e||typeof e!="string")return Fa();const t=e.trim().replace(/\/$/,"");return t.length?t:Fa()}loadFromStorage(){if(typeof window>"u"||!window.localStorage)return null;try{const e=window.localStorage.getItem(this.storageKey);if(!e)return null;const t=JSON.parse(e);if(!t||typeof t!="object")return null;if(typeof t.id=="string"&&typeof t.name=="string"){const r={id:t.id,name:t.name,provider:typeof t.provider=="string"?t.provider:null,email:typeof t.email=="string"?t.email:null,createdAt:t.createdAt??null,updatedAt:t.updatedAt??null};return this.identity=r,this.applyIdentity(r),r}}catch{window?.localStorage&&window.localStorage.removeItem(this.storageKey)}return null}getIdentity(){return this.identity?Object.assign({},this.identity):null}isGoogleAuthEnabled(){return Array.isArray(this.googleClientIds)&&this.googleClientIds.length>0}getGoogleClientId(){return this.googleClientId}initialise(){return this._initialisePromise?this._initialisePromise:(this._initialisePromise=this._loadRemoteConfig().catch(e=>{throw this._initialisePromise=null,e}),this._initialisePromise)}async saveName(e){const t=QE(e);if(!t)throw new Error("Name must be between 2 and 32 characters.");let r;return this.identity&&this.identity.id?r=await this._request("PUT",`/api/users/${encodeURIComponent(this.identity.id)}`,{name:t},{fallbackMessage:"Unable to save name."}):r=await this._request("POST","/api/users/register",{name:t},{fallbackMessage:"Unable to save name."}),this.identity={id:r.id,name:r.name,provider:r.provider??(this.identity?.provider||"local"),email:r.email??this.identity?.email??null,createdAt:r.createdAt??null,updatedAt:r.updatedAt??null},this._persistIdentity(),this.applyIdentity(this.identity),this.notifySocket(),Object.assign({},this.identity)}async authenticateWithGoogle(e){if(!e||typeof e!="string")throw new Error("Missing Google credential.");const t=await this._request("POST","/api/auth/google",{credential:e},{fallbackMessage:"Google sign-in failed."});return this.identity={id:t.id,name:t.name,provider:t.provider??"google",email:t.email??null,createdAt:t.createdAt??null,updatedAt:t.updatedAt??null},this._persistIdentity(),this.applyIdentity(this.identity),this.notifySocket(),Object.assign({},this.identity)}async refresh(){if(!this.identity||!this.identity.id)return null;try{const e=await this._request("GET",`/api/users/${encodeURIComponent(this.identity.id)}`,void 0,{fallbackMessage:"Unable to refresh identity."});return this.identity={id:e.id,name:e.name,provider:e.provider??this.identity.provider??null,email:e.email??this.identity.email??null,createdAt:e.createdAt??this.identity.createdAt??null,updatedAt:e.updatedAt??Date.now()},this._persistIdentity(),this.applyIdentity(this.identity),Object.assign({},this.identity)}catch{return null}}bindSocket(e){this.socketListener=e,!(!e||typeof e.on!="function")&&(e.on("connected",this.handleSocketConnected),e.on("identity:ack",this.handleIdentityAck))}handleSocketConnected(){this.notifySocket(),this.identity&&this.identity.id&&this.refresh()}handleIdentityAck(e){!e||e.status!=="ok"||e.id&&e.name&&(this.identity={id:e.id,name:e.name,createdAt:this.identity?.createdAt??null,updatedAt:Date.now()},this._persistIdentity(),this.applyIdentity(this.identity))}notifySocket(e=!1){!this.socketListener||typeof this.socketListener.sendIdentityUpdate!="function"||!e&&(!this.identity||!this.identity.id)||this.socketListener.sendIdentityUpdate(this.identity||null)}applyIdentity(e){this.game&&(e?(this.game.identity={id:e.id,name:e.name,provider:e.provider??null,email:e.email??null},this.game.player&&(this.game.player.userId=e.id,this.game.player.callsign=e.name)):(this.game.identity=null,this.game.player&&(this.game.player.userId=null)),this.game.lobby&&typeof this.game.lobby.updateIdentityDisplay=="function"&&this.game.lobby.updateIdentityDisplay(this.game.identity))}clearIdentity(){this.identity=null,this._persistIdentity(),this.applyIdentity(null),this.notifySocket(!0)}async _request(e,t,r,n={}){const s=`${this.apiBase}${t}`,a={method:e,headers:{"Content-Type":"application/json"}};e!=="GET"&&e!=="HEAD"&&r!==void 0&&(a.body=JSON.stringify(r));const l=n&&typeof n.fallbackMessage=="string"?n.fallbackMessage:"Request failed.";let u;try{u=await fetch(s,a)}catch{throw new Error(l)}if(!u.ok){let c=l;try{const f=await u.json();f&&typeof f=="object"&&f.error&&(f.error==="invalid_name"?c="Name must be between 2 and 32 characters.":f.error==="not_found"?c="Registration record not found.":f.error==="invalid_id"?c="Registration identifier was invalid.":f.error==="invalid_credential"?c="Google sign-in could not be verified.":f.error==="audience_mismatch"?c="Google sign-in is not configured for this server.":f.error==="registration_failed"?c="We were unable to save your Google profile.":f.error==="upstream_unavailable"?c="Google services are currently unavailable. Please try again later.":f.error==="missing_credential"&&(c="Google response was missing required data."))}catch{}throw new Error(c)}return u.status===204?null:await u.json()}async _loadRemoteConfig(){let e;try{e=await this._request("GET","/api/identity/config",void 0,{fallbackMessage:"Unable to load identity configuration."})}catch(n){throw n}if(!e||typeof e!="object")return null;const t=e.google||{},r=this._normaliseClientIds(Array.isArray(t.clientIds)&&t.clientIds.length?t.clientIds:t.clientId||[]);return this._areClientIdListsEqual(r,this.googleClientIds)||(this.googleClientIds=r,this.googleClientId=this.googleClientIds.length>0?this.googleClientIds[0]:null,this._notifyGoogleConfigChanged()),e}_notifyGoogleConfigChanged(){if(!this.game||!this.game.lobby)return;const e=this.game.lobby;typeof e.configureGoogleIdentity=="function"&&e.configureGoogleIdentity(),typeof e.updateIdentityDisplay=="function"?e.updateIdentityDisplay(this.getIdentity()):typeof e.updateGoogleDisplay=="function"&&e.updateGoogleDisplay(this.getIdentity())}_persistIdentity(){if(typeof window>"u"||!window.localStorage)return;if(!this.identity){window.localStorage.removeItem(this.storageKey);return}const e={id:this.identity.id,name:this.identity.name,provider:this.identity.provider??null,email:this.identity.email??null,createdAt:this.identity.createdAt??Date.now(),updatedAt:this.identity.updatedAt??Date.now()};window.localStorage.setItem(this.storageKey,JSON.stringify(e))}_normaliseClientIds(e){return e?Array.isArray(e)?e.map(t=>typeof t=="string"?t.trim():"").filter(t=>t.length>0):typeof e=="string"?e.split(/[;,]/).map(t=>t.trim()).filter(t=>t.length>0):[]:[]}_areClientIdListsEqual(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r+=1)if(e[r]!==t[r])return!1;return!0}}const e1=[new URL("/midi/Bc1.mid",import.meta.url).href,new URL("/midi/Bc2.mid",import.meta.url).href,new URL("/midi/Bc3.mid",import.meta.url).href,new URL("/midi/Bc5.mid",import.meta.url).href,new URL("/midi/Bc6.mid",import.meta.url).href,new URL("/midi/Bc8.mid",import.meta.url).href,new URL("/midi/Bc9.mid",import.meta.url).href],gd=new URL("/wav/demo.wav",import.meta.url).href,r1=i=>!Number.isFinite(i)||i<=0?0:Math.floor(Math.random()*i);class i1{constructor(e){this.audioManager=e,this.mediaElement=null,this.mediaSourceNode=null,this.gainNode=null,this.trackList=null,this.currentIndex=0,this.isPlayingLobby=!1,this.onTrackEnded=()=>this.handleTrackEnded()}resolveTrackList(){if(this.trackList)return this.trackList;if(typeof window>"u")return this.trackList=[],this.trackList;const e=document.createElement("audio"),t=e.canPlayType("audio/midi")||e.canPlayType("audio/mid")||e.canPlayType("audio/x-midi");return t&&t.length>0?this.trackList=[...e1]:(console.warn("Browser cannot play MIDI files; falling back to demo loop for lobby music."),this.trackList=gd?[gd]:[]),this.trackList}ensureMediaElement(){if(this.mediaElement||typeof window>"u")return;const e=new Audio;e.preload="auto",e.loop=!1,e.crossOrigin="anonymous",e.addEventListener("ended",this.onTrackEnded),this.mediaElement=e;const t=this.audioManager?.getContext?.();if(t)try{this.mediaSourceNode=t.createMediaElementSource(e),this.gainNode=t.createGain(),this.gainNode.gain.value=.45,this.mediaSourceNode.connect(this.gainNode),this.gainNode.connect(t.destination)}catch(r){console.debug("Failed to connect lobby music to AudioContext",r),this.gainNode=null,this.mediaSourceNode=null,this.mediaElement.volume=.45}else this.mediaElement.volume=.45}async playLobby(){const e=this.resolveTrackList();e.length&&(this.ensureMediaElement(),this.mediaElement&&(this.isPlayingLobby||(this.currentIndex=r1(e.length)),this.isPlayingLobby=!0,await this.startCurrentTrack()))}async startCurrentTrack(){const e=this.resolveTrackList();if(!this.mediaElement||!e.length)return;const t=(this.currentIndex%e.length+e.length)%e.length,r=e[t];if(r){if(this.audioManager&&typeof this.audioManager.resumeContext=="function")try{await this.audioManager.resumeContext()}catch(n){console.debug("Unable to resume AudioContext for lobby music",n)}this.mediaElement.src!==r&&(this.mediaElement.src=r);try{await this.mediaElement.play()}catch(n){console.debug("Lobby music playback blocked",n)}}}handleTrackEnded(){if(!this.isPlayingLobby)return;const e=this.resolveTrackList();e.length&&(this.currentIndex=(this.currentIndex+1)%e.length,this.startCurrentTrack())}stop(){if(this.isPlayingLobby=!1,this.mediaElement){this.mediaElement.pause();try{this.mediaElement.currentTime=0}catch{}}}}const bt=i=>`/${i}`,ws=$.LoaderResource||$.loaders&&$.loaders.Resource,Kn=ws?ws.LOAD_TYPE:{},bd=ws?ws.XHR_RESPONSE_TYPE:{},n1={r:255,g:0,b:255},ri=48,Lr={heading:"Intel",lines:["Right-click a city building to inspect."]},s1=(i,e=n1)=>{if(!i||!i.data||!i.texture)return;const t=i.data,r=t.width,n=t.height,s=document.createElement("canvas");s.width=r,s.height=n;const o=s.getContext("2d");if(!o)return;o.drawImage(t,0,0);const a=o.getImageData(0,0,r,n),l=a.data;for(let h=0;h<l.length;h+=4)l[h]===e.r&&l[h+1]===e.g&&l[h+2]===e.b&&(l[h+3]=0);o.putImageData(a,0,0),i.texture&&i.texture.destroy(!0);const u=$.BaseTexture.from(s);u.alphaMode=$.ALPHA_MODES.NO_PREMULTIPLIED_ALPHA,u.scaleMode=$.SCALE_MODES.NEAREST,i.data=s,i.texture=new $.Texture(u),i.baseTexture=u},ht=(i,e=0)=>{if(typeof i=="number"&&Number.isFinite(i))return i;if(typeof i=="string"){const t=parseInt(i,10);if(!Number.isNaN(t))return t}return e},zt=(i,e=null)=>{const t=ht(i,e);return Number.isFinite(t)?Math.max(0,Math.floor(t)):e},Km=i=>!i||typeof i!="string"?null:i.length<=8?i:`${i.slice(0,4)}...${i.slice(-2)}`;$.utils.isWebGLSupported();var le=new $.Application({width:rs,height:is});le.renderer.plugins.interaction.cursorStyles={demolish:`url(${bt("imgDemolish.png")}), auto`,cursor:`url(${bt("imgCursor.png")}), auto`};document.getElementById("game").appendChild(le.view);var Ts=new Yb;Ts.showPanel(0);document.getElementById("game").appendChild(Ts.dom);var Zm=new $.Container,Xl=new $.Container,Hl=new $.Container,us=null,hs=null,cs=null,fs=null;const Xs=$.Loader.shared,w={map:[],tiles:[],tick:0,lastTick:0,timePassed:0,staticTick:0,textures:[],maxMapX:rs-200,maxMapY:is,maxCities:0,otherPlayers:{},audio:null,showBuildMenu:!1,buildMenuOffset:{x:(rs-200)/2,y:is/2},buildings:{},cities:[],player:{id:-1,city:0,isMayor:!1,health:mi,isTurning:0,timeTurn:0,direction:0,defaultOffset:{x:(rs-200)/2,y:is/2},offset:{x:0,y:0,vx:0,vy:0},bombsArmed:!1,lastSafeOffset:{x:0,y:0},sequence:0,isCloaked:!1,cloakExpiresAt:0,isFrozen:!1,frozenUntil:0,frozenBy:null,callsign:null,userId:null,engineLoopActive:!1},explosions:[],panelState:{heading:Lr.heading,lines:[...Lr.lines]},defenseItems:new Map,identity:null,lobby:null,app:le,stage:le.stage,objectContainer:Zm,commandCenterLabelLayer:Xl,orbHintElement:null,lastOrbHintMessage:"",nextOrbHintUpdate:0,cameraShake:{remaining:0,duration:0,intensity:0,offsetX:0,offsetY:0},gBotDebug:null};w.audio=new J_;w.audio.bindGestureUnlock();w.audio.preloadAll().catch(i=>{console.warn("Audio assets failed to preload",i)});w.music=new i1(w.audio);const Hs=document.createElement("div");Hs.id="orb-hint";const $t=Hs.style;$t.position="fixed";$t.top="24px";$t.right="24px";$t.padding="10px 14px";$t.borderRadius="12px";$t.background="rgba(10, 18, 52, 0.82)";$t.border="1px solid rgba(123, 152, 255, 0.35)";$t.boxShadow="0 18px 36px rgba(0, 0, 0, 0.45)";$t.fontFamily='"Segoe UI", Tahoma, Geneva, Verdana, sans-serif';$t.fontSize="14px";$t.color="#f0f6ff";$t.letterSpacing="0.3px";$t.maxWidth="320px";$t.zIndex="1000";$t.pointerEvents="none";$t.display="none";document.body.appendChild(Hs);w.orbHintElement=Hs;qb(w);w.lastOrbHintMessage="";w.callsignRegistry=new YE;w.notificationManager=new XE;w.notify=i=>w.notificationManager?w.notificationManager.notify(i):null;w.chatManager=new jE({game:w});w.identityManager=new t1(w);w.identityManager.loadFromStorage();w.resolveCallsign=i=>{if(i==null)return null;const e=`${i}`,t=w.player&&w.player.id!==void 0?`${w.player.id}`:null;if(t&&e===t)return w.player?.callsign||null;const r=w.otherPlayers?w.otherPlayers[e]:null;if(r&&typeof r.callsign=="string"&&r.callsign.trim().length)return r.callsign;if(w.callsignRegistry&&typeof w.callsignRegistry.get=="function"){const n=w.callsignRegistry.get(e);if(n)return n}return null};w.describeKillSource=(i={})=>{if(!i)return"System Hazard";if(i.killerCallsign)return i.killerCallsign;const e=Number.isFinite(i.killerCity)?Math.max(0,Math.floor(i.killerCity)):null,r=(()=>{if(e===null)return null;const o=Array.isArray(w.cities)?w.cities[e]:null;if(o&&typeof o=="object"){if(typeof o.nameOverride=="string"&&o.nameOverride.trim().length)return o.nameOverride.trim();if(typeof o.name=="string"&&o.name.trim().length)return o.name.trim()}return Ft(e)})(),n=i.sourceType?String(i.sourceType).toLowerCase():null;if(n)switch(n){case"turret":return`${r||"City"} Turret`;case"plasma":case"plasma_cannon":return`${r||"City"} Plasma Cannon`;case"sleeper":return`${r||"City"} Sleeper Turret`;case"rogue_tank":return"Rogue Tank";case"fake_recruit":case"city_recruit":return`${r||"City"} Recruit`}const s=i.hazardType?String(i.hazardType).toLowerCase():null;if(s)switch(s){case"mine":return`${r||"City"} Mine`;case"bomb":return`${r||"City"} Bomb`;case"dfg":case"dfg_field":return`${r||"City"} DFG Field`}return"System Hazard"};w.cityFinanceFlags=new Map;w.mapOverlayActive=!1;const o1=(i,e,t=ri)=>{let r="",n="";return Math.abs(i)>t&&(r=i>0?"east":"west"),Math.abs(e)>t&&(n=e>0?"south":"north"),r&&n?`${n}-${r}`:n||r||"nearby"},a1=i=>!i||typeof i!="string"?"":i.split("-").map(e=>e&&e.charAt(0).toUpperCase()+e.slice(1)).join("-"),l1=i=>{if(!i)return null;const e=Number.isFinite(i.x)?i.x:ri*ht(i.tileX,0),t=Number.isFinite(i.y)?i.y:ri*ht(i.tileY,0);return{x:e+1.5*ri,y:t+1*ri}},u1=(i,e)=>i&&typeof i.name=="string"&&i.name.trim().length?i.name:Ft(e),h1=Object.values(or||{}).reduce((i,e)=>(!e||e.TYPE===void 0||(i[e.TYPE]=e.LABEL),i),{}),c1=(i,e)=>{const t={totalPopulation:0,totalBuildings:0,staffedBuildings:0,houses:0,labels:new Map};if(!i||!i.buildingFactory||typeof i.buildingFactory.getHead!="function")return t;let r=i.buildingFactory.getHead();for(;r;){if(zt(r.city,null)===e){t.totalBuildings+=1;const s=ht(r.population,0),o=Number.isFinite(s)?Math.max(0,s):0;t.totalPopulation+=o,o>0&&(t.staffedBuildings+=1);const a=h1[r.type]||"Structure";t.labels.has(a)||t.labels.set(a,{count:0,population:0});const l=t.labels.get(a);l.count+=1,l.population+=o,a.toLowerCase().includes("house")&&(t.houses+=1)}r=r.next}return t};w.updateOrbHint=(i={})=>{const{force:e=!1}=i,t=w.orbHintElement;if(!t)return;const r=w.lobby;if(!(r&&typeof r.isInGame=="function"?r.isInGame():!1)){t.style.display!=="none"&&(t.style.display="none",w.lastOrbHintMessage="");return}const s=w.player,o=s?.offset,a=ht(o?.x,NaN),l=ht(o?.y,NaN);if(!Number.isFinite(a)||!Number.isFinite(l)){t.style.display!=="none"&&(t.style.display="none",w.lastOrbHintMessage="");return}const u=zt(s?.city,null);let h=null;(Array.isArray(w.cities)?w.cities:[]).forEach((d,p)=>{if(!d||p===u||!d.isOrbable)return;const v=l1(d);if(!v)return;const m=v.x-a,g=v.y-l,E=m*m+g*g;Number.isFinite(E)&&(!h||E<h.distanceSq)&&(h={city:d,index:p,dx:m,dy:g,distanceSq:E})});let f;if(!h)f="No orbable cities detected yet.";else{const d=u1(h.city,h.index),p=a1(o1(h.dx,h.dy)),v=Math.sqrt(h.distanceSq),m=Math.round(v/ri),g=m>1?` (~${m} tiles)`:"";f=`Nearest orbable city: ${d}  ${p}${g}`}!e&&f===w.lastOrbHintMessage||(t.textContent=f||"",t.style.display=f?"block":"none",w.lastOrbHintMessage=f||"")};w.updateOrbHint({force:!0});w.clearDefenseItems=i=>{const e=zt(i,null);if(e===null)return;const t=w.defenseItems.get(e);Array.isArray(t)&&w.itemFactory&&typeof w.itemFactory.removeItemById=="function"&&t.forEach(r=>{w.itemFactory.removeItemById(r,{notifyServer:!1})}),w.defenseItems.delete(e),w.forceDraw=!0};w.applyDefenseSnapshot=(i,e)=>{const t=zt(i,null);if(t===null||!w.itemFactory||typeof w.itemFactory.newItem!="function"||(w.clearDefenseItems(t),!Array.isArray(e)||!e.length))return;const r=[];e.forEach((n,s)=>{const o=ht(n?.type,null),a=ht(n?.x,null),l=ht(n?.y,null);if(!Number.isFinite(o)||!Number.isFinite(a)||!Number.isFinite(l))return;const u=ht(n?.teamId,t),h=typeof n?.id=="string"&&n.id.length>0?n.id:`defense_${t}_${s}`;typeof w.itemFactory.removeItemById=="function"&&w.itemFactory.removeItemById(h,{notifyServer:!1});const f={id:typeof n?.ownerId=="string"&&n.ownerId.length>0?n.ownerId:`fake_city_${t}`,city:t},d=w.itemFactory.newItem(f,a,l,o,{id:h,notifyServer:!1,teamId:u,city:u});if(d){if(d.isDefense=!0,n?.angle!==void 0){const p=ht(n.angle,null);Number.isFinite(p)&&(d.angle=p)}r.push(d.id)}}),r.length&&(w.defenseItems.set(t,r),w.forceDraw=!0)};const on=i=>{const e=i&&typeof i.heading=="string"?i.heading:"",t=i&&Array.isArray(i.lines)?i.lines:[],r=[];t.forEach(n=>{if(n==null)return;const s=`${n}`;r.push(s)}),w.panelState={heading:e,lines:r},w.forceDraw=!0},f1=i=>{const e=zt(i,null);if(e===null)return null;let t=0,r=null;zt(w.player&&w.player.city,null)===e&&(t+=1,w.player&&w.player.isMayor&&(r=w.player.id||r)),Object.keys(w.otherPlayers||{}).forEach(a=>{const l=w.otherPlayers[a];l&&zt(l.city,null)===e&&(t+=1,!r&&l.isMayor&&(r=l.id||null))});const s=w.buildingFactory,o=s&&typeof s.countBuildingsForCity=="function"?s.countBuildingsForCity(e):0;return{cityId:e,playerCount:t,buildingCount:o,mayorId:r,mayorLabel:r?Km(r):null}},d1=(i,e={})=>{const t=zt(i,null);if(t===null)return{heading:Lr.heading,lines:[...Lr.lines]};const r=f1(t)||{playerCount:0,buildingCount:0,mayorId:null,mayorLabel:null},n=w.cities?.[t],s=e.cityName||n?.name||Ft(t),o=e.mayorLabel||r.mayorLabel,a=e.mayorId!==void 0?e.mayorId:r.mayorId,l=o||Km(a)||"(unknown)",u=Number.isFinite(e.playerCount)?e.playerCount:r.playerCount,h=Number.isFinite(e.buildingCount)?e.buildingCount:r.buildingCount,c=[`Mayor:   ${l}`,`Players: ${u}`,`Size:    ${h} building${h===1?"":"s"}`];if(e.score!==void 0){const f=Number.isFinite(e.score)?e.score:ht(e.score,0);c.push(`Score:   ${f} pts`)}if(e.isOrbable&&e.orbPoints!==void 0){const f=Number.isFinite(e.orbPoints)?e.orbPoints:ht(e.orbPoints,0);c.push(`Bounty:  ${f} points`)}if(e.isOrbable&&e.orbs!==void 0){const f=Number.isFinite(e.orbs)?e.orbs:ht(e.orbs,0);c.push(`Orbs:    ${f}`)}if(e.uptimeInMinutes!==void 0&&e.uptimeInMinutes!==null){const f=Number.isFinite(e.uptimeInMinutes)?e.uptimeInMinutes:ht(e.uptimeInMinutes,0);if(Number.isFinite(f)&&f>0){const d=Math.floor(f/60),p=f%60;c.push(`Uptime:  ${d}h ${p}m`)}}return{heading:s,lines:c}};w.setPanelMessage=i=>{if(!i){on(Lr);return}on(i)};w.clearPanelMessage=()=>{w.mapOverlayActive=!1,on(Lr)};w.showCityInfo=(i,e={})=>{let t=e||{},r=i;i&&typeof i=="object"&&!Array.isArray(i)&&(t=i,i.cityId!==void 0?r=i.cityId:i.city!==void 0&&(r=i.city));const n=zt(r,null);if(n===null){on(Lr);return}const s=d1(n,t||{});on(s)};w.showStaffSummary=()=>{const i=zt(w.player&&w.player.city,null);if(i===null){w.notify&&w.notify({title:"Staff Overview",message:"Join a city to view staffing information.",variant:"warn"});return}const e=c1(w,i),t=Ft(i),r=[`Population: ${e.totalPopulation}`,`Buildings: ${e.totalBuildings}`,`Staffed:   ${e.staffedBuildings}`];e.houses>0&&r.push(`Housing:  ${e.houses}`);const n=Array.from(e.labels.entries()).filter(([,s])=>s.population>0).sort((s,o)=>o[1].population-s[1].population).slice(0,3);n.length?n.forEach(([s,o])=>{r.push(`${s}: ${o.population}`)}):r.push("Factories need staff before production begins."),w.setPanelMessage({heading:`${t} Staff`,lines:r}),w.notify&&w.notify({title:"Staff Overview",message:`${t}: ${e.totalPopulation} population across ${e.totalBuildings} structures.`,variant:"info",timeout:4600}),w.forceDraw=!0};w.toggleMapOverlay=()=>{w.mapOverlayActive=!w.mapOverlayActive,w.mapOverlayActive?(w.setPanelMessage({heading:"Tactical Map",lines:["Full-screen map is still under construction.","Use the radar and right-click inspections for intel.","Notifications highlight city threats in real time."]}),w.notify&&w.notify({title:"Tactical Map",message:"Radar and notifications provide situational awareness until the full map returns.",variant:"info",timeout:5200})):w.clearPanelMessage(),w.forceDraw=!0};w.showPlayerCityInfo=()=>{const i=zt(w.player&&w.player.city,null);if(i===null){w.notify&&w.notify({title:"City Intel",message:"Join a city to view local intel.",variant:"warn"});return}w.showCityInfo(i),w.notify&&w.notify({title:"City Intel",message:`Showing intel for ${Ft(i)} in the panel.`,variant:"info",timeout:3600})};w.showPointsSummary=()=>{const i=zt(w.player&&w.player.city,null);if(i===null){w.notify&&w.notify({title:"Points Overview",message:"Join a city to review point totals.",variant:"warn"});return}const e=w.cities?.[i]||{},t=ht(e.score,0),r=ht(e.orbs,0),n=ht(e.orbPoints,0),s=[`City score: ${t}`,`Orbs fired: ${r}`,`Orb bounty: ${n}`,"Monthly leaderboards will surface in a future patch."];w.setPanelMessage({heading:`${Ft(i)} Points`,lines:s}),w.notify&&w.notify({title:"Points Overview",message:`${Ft(i)} currently holds ${t} points.`,variant:"info",timeout:4e3}),w.forceDraw=!0};w.openOptionsPanel=()=>{w.setPanelMessage({heading:"Options (Preview)",lines:["In-game configuration UI is still on the roadmap.","Use the lobby overlay to change cities or roles.","See AGENTS.md for developer setup and tweaks."]}),w.notify&&w.notify({title:"Options",message:"Configuration controls are coming soon. The panel lists available workarounds.",variant:"warn"}),w.forceDraw=!0};w.showHelpMessage=()=>{w.setPanelMessage({heading:"Help",lines:["Movement: WASD / Arrow keys","Fire: SHIFT    Drop item: Space    Arm bomb: B","Medkit: H    Cloak: C    DFG freeze: use from inventory","Right-click structures for city intel and build options."]}),w.notify&&w.notify({title:"Help",message:"Core controls and tips are listed in the panel. GameRules.md tracks full mechanics.",variant:"info",timeout:6e3}),w.forceDraw=!0};w.toggleBuildMenuFromPanel=()=>{w.showBuildMenu=!w.showBuildMenu,w.notify&&w.notify({title:"Build Menu",message:w.showBuildMenu?"Select a blueprint to place or choose Demolish.":"Build menu hidden.",variant:"info",timeout:3600}),w.forceDraw=!0};w.requestExitToLobby=()=>{w.lobby&&typeof w.lobby.show=="function"&&(w.lobby.show(),w.lobby.setStatus("Lobby opened. Choose a city slot or wait for the next match.",{type:"info"})),w.notify&&w.notify({title:"Exit to Lobby",message:"The lobby overlay is open. Session hand-off will improve in a future build.",variant:"warn"})};w.clearPanelMessage();w.bulletFactory=new DT(w);w.buildingFactory=new ET(w);w.socketListener=new uE(w);w.chatManager&&w.chatManager.bindSocket(w.socketListener);w.identityManager&&w.identityManager.bindSocket(w.socketListener);w.lobby=new UE(w);w.lobby.attachSocket(w.socketListener);w.identityManager&&(w.lobby.attachIdentityManager(w.identityManager),w.lobby.updateIdentityDisplay(w.identityManager.getIdentity()),typeof w.identityManager.initialise=="function"&&w.identityManager.initialise().catch(i=>{console.warn("[identity] Failed to initialise identity manager:",i?.message||i)}));w.iconFactory=new kT(w);w.itemFactory=new zT(w);w.rogueTankManager=new cI(w);const p1=[{name:"imgTanks",url:bt("imgTanks.png")},{name:"imgGround",url:bt("skins/BattleCityDX/imgGround.png")},{name:"imgLava",url:bt("skins/BattleCityDX/imgLava.png")},{name:"imgRocks",url:bt("skins/BattleCityDX/imgRocks.png")},{name:"imgBullets",url:bt("skins/BattleCityDX/imgBullets.png")},{name:"imgInterfaceTop",url:bt("skins/BattleCityDX/imgInterface.png")},{name:"imgInterfaceBottom",url:bt("skins/BattleCityDX/imgInterfaceBottom.png")},{name:"imgHealth",url:bt("skins/BattleCityDX/imgHealth.png")},{name:"imgBuildings",url:bt("skins/BattleCityDX/imgBuildings.png")},{name:"imgBuildIcons",url:bt("imgBuildIcons.png")},{name:"imgItems",url:bt("imgItems.png")},{name:"imgInventorySelection",url:bt("imgInventorySelection.png")},{name:"imgArrows",url:bt("imgArrows.png")},{name:"imgArrowsRed",url:bt("imgArrowsRed.png")},{name:"imgRadarColors",url:bt("imgRadarColors.png")},{name:"imgMiniMapColors",url:bt("imgMiniMapColors.png")},{name:"imgPopulation",url:bt("imgPopulation.png")},{name:"imgBlackNumbers",url:bt("imgBlackNumbers.png")},{name:"imgMoneyBox",url:bt("skins/BattleCity3.1/imgMoneyBox.png")},{name:"imgMoneyUp",url:bt("skins/BattleCity3.1/imgMoneyUp.png")},{name:"imgMoneyDown",url:bt("skins/BattleCity3.1/imgMoneyDown.png")},{name:"imgTurretBase",url:bt("skins/BattleCityDX/imgTurretBase.png")},{name:"imgTurretHead",url:bt("skins/BattleCityDX/imgTurretHead.png")},{name:"imgSmoke",url:bt("imgSmoke.png")},{name:"imgLEExplosion",url:bt("imgLExplosion.png")},{name:"imgSExplosion",url:bt("imgSExplosion.png")},{name:"mapData",url:bt("map.dat"),loadType:Kn.XHR!==void 0?Kn.XHR:1,xhrType:bd.BUFFER||"arraybuffer"},{name:"cityDemo",url:bt("cities/Balkh/demo.city"),loadType:Kn.XHR!==void 0?Kn.XHR:1,xhrType:bd.TEXT||"text"}];Xs.add(p1);Xs.onProgress.add(y1);Xs.load(m1);function y1(i,e){e&&console.log("loading: "+e.url),console.log("progress: "+i.progress+"%")}function m1(){console.log("loaded");const i=Xs.resources;var e=i.mapData.data;U_(w,e),V_(w);const t=Ns(w.player.city);t?(w.player.offset.x=t.x,w.player.offset.y=t.y):w.cities[w.player.city]?(w.player.offset.x=w.cities[w.player.city].x+48,w.player.offset.y=w.cities[w.player.city].y+100):(w.player.offset.x=0,w.player.offset.y=0),w.player.lastSafeOffset={x:w.player.offset.x,y:w.player.offset.y},[i.imgGround,i.imgLava,i.imgRocks,i.imgBuildings,i.imgBuildIcons,i.imgItems,i.imgInventorySelection,i.imgArrows,i.imgArrowsRed,i.imgInterfaceTop,i.imgInterfaceBottom,i.imgRadarColors,i.imgMiniMapColors,i.imgTurretBase,i.imgTurretHead,i.imgPopulation,i.imgBlackNumbers,i.imgMoneyBox,i.imgMoneyUp,i.imgMoneyDown,i.imgSmoke,i.imgLEExplosion,i.imgSExplosion].forEach(n=>s1(n)),w.textures.groundTexture=i.imgGround.texture,w.textures.tankTexture=i.imgTanks.texture,w.textures.rockTexture=i.imgRocks.texture,w.textures.lavaTexture=i.imgLava.texture,w.textures.bulletTexture=i.imgBullets.texture,w.textures.interfaceTop=i.imgInterfaceTop.texture,w.textures.interfaceBottom=i.imgInterfaceBottom.texture,w.textures.imgRadarColors=i.imgRadarColors.texture,w.textures.imgMiniMapColors=i.imgMiniMapColors.texture,w.textures.health=i.imgHealth.texture,w.textures.buildings=i.imgBuildings.texture,w.textures.buildingIcons=i.imgBuildIcons.texture,w.textures.imageIcons=i.imgItems.texture,w.textures.imageItems=i.imgItems.texture,w.textures.imageInventorySelection=i.imgInventorySelection.texture,w.textures.imgArrows=i.imgArrows.texture,w.textures.imgArrowsRed=i.imgArrowsRed.texture,w.textures.imageTurretBase=i.imgTurretBase.texture,w.textures.imageTurretHead=i.imgTurretHead.texture,w.textures.population=i.imgPopulation.texture,w.textures.blackNumbers=i.imgBlackNumbers.texture,w.textures.imgMoneyBox=i.imgMoneyBox.texture,w.textures.imgMoneyUp=i.imgMoneyUp.texture,w.textures.imgMoneyDown=i.imgMoneyDown.texture,w.textures.smoke=i.imgSmoke.texture,w.textures.imageLEExplosion=i.imgLEExplosion.texture,w.textures.imgLEExplosion=i.imgLEExplosion.texture,w.textures.imageSExplosion=i.imgSExplosion.texture,cx(w),fx(w),w.socketListener.listen(),w.itemFactory.bindSocketEvents(w.socketListener),w.socketListener.on("connected",()=>{console.log("Connected to server")}),w.socketListener.on("population:update",n=>{w.buildingFactory.applyPopulationUpdate(n)}),w.socketListener.on("building:new",n=>{n&&(w.buildingFactory.newBuilding(n.ownerId||null,n.x,n.y,n.type,{notifyServer:!1,id:n.id,population:n.population||0,attachedHouseId:n.attachedHouseId||null,city:n.city??0,itemsLeft:n.itemsLeft||0,updateCity:!1}),w.forceDraw=!0)}),w.socketListener.on("city:finance",n=>{let s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch(f){console.warn("Failed to parse finance payload",f);return}if(!s)return;const o=s.id??s.city;if(o==null)return;const a=ht(o,0);w.cities[a]||(w.cities[a]={id:a,canBuild:{},cash:0,income:0,itemProduction:0,research:0,hospital:0,construction:0,grossIncome:0});const l=w.cities[a],u=w.cityFinanceFlags.get(a)||{};l.cash=ht(s.cash,l.cash??0),l.income=ht(s.income,0),l.itemProduction=ht(s.itemProduction,0),l.research=ht(s.research,0),l.hospital=ht(s.hospital,0),l.construction=ht(s.construction,0),s.grossIncome!==void 0?l.grossIncome=ht(s.grossIncome,l.grossIncome??0):l.grossIncome=l.income-(l.itemProduction+l.research+l.hospital+l.construction),s.orbPoints!==void 0&&(l.orbPoints=ht(s.orbPoints,l.orbPoints??0)),s.score!==void 0&&(l.score=ht(s.score,l.score??0)),s.orbs!==void 0&&(l.orbs=ht(s.orbs,l.orbs??0)),s.isOrbable!==void 0&&(l.isOrbable=!!s.isOrbable),s.currentBuildings!==void 0&&(l.currentBuildings=ht(s.currentBuildings,l.currentBuildings??0)),s.maxBuildings!==void 0&&(l.maxBuildings=ht(s.maxBuildings,l.maxBuildings??0)),l.updatedAt=s.updatedAt?ht(s.updatedAt,Date.now()):Date.now();const h=zt(w.player&&w.player.city,null),c={orbable:!!l.isOrbable,negativeIncome:l.grossIncome<0,cashZero:l.cash<=0,cashLow:l.cash>0&&l.cash<Hi};if(w.cityFinanceFlags.set(a,c),h===a&&w.notify){const f=Ft(a);c.cashZero&&!u.cashZero?w.notify({title:"City Treasury Empty",message:`${f} has run out of cash. Income ticks are needed before building again.`,variant:"error"}):c.negativeIncome&&!u.negativeIncome&&w.notify({title:"Income Shortfall",message:`${f} is spending more than it earns. Consider staffing houses or pausing construction.`,variant:"warn",timeout:5200}),c.orbable&&!u.orbable&&w.notify({title:"City Orbable",message:`${f} can now be destroyed by an enemy orb. Strengthen defenses.`,variant:"warn",timeout:5200})}typeof w.updateOrbHint=="function"&&w.updateOrbHint({force:!0}),w.forceDraw=!0}),w.socketListener.on("city:info",n=>{n&&w.showCityInfo(n)}),w.socketListener.on("orb:result",n=>{if(n){if(n.status==="detonated"){const s=n.targetCity!==void 0&&n.targetCity!==null?Ft(n.targetCity):"Enemy city",o=ht(n.points,0),a=[`Destroyed ${s}.`,o>0?`Awarded ${o} points.`:null].filter(Boolean);if(w.setPanelMessage({heading:"Orb Successful",lines:a}),w.notify){const l=[`${s} destroyed.`];o>0&&l.push(`+${o} points.`),w.notify({title:"Orb Detonated",message:l.join(" "),variant:"success",timeout:5400})}w.forceDraw=!0;return}if(n.status==="idle"||n.status==="rejected"){let s="The orb failed to trigger.";n.reason==="not_orbable"?s="Target city is not orbable yet.":n.reason==="no_target"&&(s="An orb must land on an enemy command center."),w.setPanelMessage({heading:"Orb Inert",lines:[s]}),w.notify&&w.notify({title:"Orb Failed",message:s,variant:"warn",timeout:4200}),w.forceDraw=!0}}}),w.socketListener.on("city:orbed",n=>{if(!n)return;$b(w,{duration:900,intensity:7});const s=Ft(n.attackerCity),o=Ft(n.targetCity),a=ht(n.points,0),l=[`${s} destroyed ${o}.`,a>0?`They earned ${a} points.`:null].filter(Boolean);if(w.setPanelMessage({heading:"City Destroyed",lines:l}),w.notify){const u=[`${s} eliminated ${o}.`];a>0&&u.push(`+${a} points.`),w.notify({title:"City Destroyed",message:u.join(" "),variant:n.targetCity===zt(w.player&&w.player.city,null)?"error":"warn",timeout:5600})}if(Number.isFinite(n.targetCity)&&w.cities?.[n.targetCity]){const u=w.cities[n.targetCity];u.orbPoints=0,u.isOrbable=!1,u.currentBuildings=ht(u.currentBuildings,1),u.maxBuildings=Math.max(1,ht(u.maxBuildings,1)),u.updatedAt=Date.now()}w.forceDraw=!0}),w.socketListener.on("lobby:evicted",n=>{w.player&&(w.player.city=null,w.player.isMayor=!1);let s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch{s={}}if(w.notify&&s){const o=typeof s.reason=="string"?s.reason:"orb",a=zt(s.city,null),l=zt(s.attackerCity,null),u=a!==null?Ft(a):"your city",h=l!==null?Ft(l):null,c={death:"error",orb:"error"},f=[];o==="death"?f.push(h?`${h} eliminated you.`:"You were destroyed in combat."):h?f.push(`${h} destroyed ${u}.`):f.push(`${u} was destroyed.`),Number.isFinite(s.points)&&s.points>0&&f.push(`They earned ${s.points} points.`),w.notify({title:"Evicted",message:f.join(" "),variant:c[o]||"warn",timeout:5600})}w.lobby&&typeof w.lobby.handleEviction=="function"&&w.lobby.handleEviction(n),w.forceDraw=!0}),w.socketListener.on("player:dead",n=>{if(!n||!w.notify)return;let s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch(Y){console.warn("Failed to parse player:dead payload",Y);return}if(!s||!s.id)return;const o=s.reason&&typeof s.reason=="object"?s.reason:{},l=`${s.id}`,u=w.socketListener?.io?.id?`${w.socketListener.io.id}`:null,h=u&&l===u,c=s.sourceType??o.sourceType??null,f=s.hazardType??o.type??null,d=ht(s.killerCity,null),p=ht(o.teamId,null),v=ht(s.teamId,null),m=Number.isFinite(d)?Math.max(0,Math.floor(d)):Number.isFinite(p)?Math.max(0,Math.floor(p)):null,g=Number.isFinite(p)?Math.max(0,Math.floor(p)):Number.isFinite(v)?Math.max(0,Math.floor(v)):m,E=s.killerId??o.sourceId??o.shooterId??o.emitterId??o.ownerId??null,I=E!=null?`${E}`:null,M=h?w.player:w.otherPlayers?.[l]||null,_=zt(M?.city??o.cityId??o.teamId??null,null);let F=s.callsign||w.resolveCallsign(l)||(h?"Your Tank":null);F||(F=_!==null?`${Ft(_)} Tank`:"Unknown Tank");const C=s.killerCallsign||w.resolveCallsign(I);let H=s.killerLabel&&typeof s.killerLabel=="string"?s.killerLabel:null;H||(H=w.describeKillSource({killerCallsign:C,killerCity:m,teamId:g,sourceType:c,hazardType:f})),I&&l===I&&(H="Self-Inflicted"),(!H||!H.trim().length)&&(H="Unknown Forces");const R=h?"error":"warn",N=`${F} killed by ${H}.`;w.notify({title:"Elimination",message:N,variant:R,timeout:5200})}),w.socketListener.on("build:denied",n=>{let s=n;if(typeof n=="string")try{s=JSON.parse(n)}catch(o){console.warn("Failed to parse build denied payload",o);return}s&&w.buildingFactory.handleBuildDenied(s)}),us=new $.tilemap.CompositeRectTileLayer(0,w.textures.groundTexture,!0),hs=new $.Container,cs=new $.tilemap.CompositeRectTileLayer(0,w.textures.imageItems,!0),fs=new $.tilemap.CompositeRectTileLayer(0,null,!0),Xl.removeChildren(),w.commandCenterLabelCache&&typeof w.commandCenterLabelCache.clear=="function"&&w.commandCenterLabelCache.clear(),le.stage.addChild(us),le.stage.addChild(hs),le.stage.addChild(fs),le.stage.addChild(cs),le.stage.addChild(Xl),le.stage.addChild(Zm),le.stage.addChild(Hl),w.gBotDebug=new $.Graphics,le.stage.addChild(w.gBotDebug),Ym(w),w.forceDraw=!0,Sy(w,us),Fy(w,hs),Vm(w,cs),zm(w,fs),Wm(w,Hl),w.forceDraw=!1,Jm()}var ki=0,_d=0;function Jm(){Ts.begin(),w.lastTick=w.tick,w.tick=new Date().getTime(),w.timePassed=w.tick-w.lastTick;const i=jb(w,w.timePassed);if(w.stage){const e=Number.isFinite(i.x)?i.x:0,t=Number.isFinite(i.y)?i.y:0;(w.stage.position.x!==e||w.stage.position.y!==t)&&w.stage.position.set(e,t)}if(w.bulletFactory.cycle(),(!w.lobby||w.lobby.isInGame())&&w.socketListener.cycle(),w.itemFactory.cycle(),w.rogueTankManager&&w.rogueTankManager.update(),Ym(w),Sy(w,us),Fy(w,hs),zm(w,fs),Ux(w),fE(w),Vm(w,cs),Wm(w,Hl),w.gBotDebug.clear(),Hx(w,w.gBotDebug),ux(w),typeof w.updateOrbHint=="function"){const e=Number.isFinite(w.nextOrbHintUpdate)?w.nextOrbHintUpdate:0;(!e||w.tick>=e)&&(w.updateOrbHint(),w.nextOrbHintUpdate=w.tick+500)}le.renderer.plugins.tilemap.tileAnim[0]=ki*144,w.forceDraw=!1,Ts.end(),requestAnimationFrame(Jm),w.tick>_d&&(_d=w.tick+300,ki=ki+1,ki>=3&&(ki=0))}
