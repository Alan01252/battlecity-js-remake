{"version":3,"file":"pixi-tilemap.js","sourceRoot":"","sources":["../src/CanvasTileRenderer.ts","../src/CompositeRectTileLayer.ts","../src/GraphicsLayer.ts","../src/RectTileLayer.ts","../src/RectTileShader.ts","../src/shaderGenerator.ts","../src/SquareTileShader.ts","../src/TileRenderer.ts","../src/ZLayer.ts"],"names":[],"mappings":"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","sourcesContent":["module PIXI.tilemap {\r\n    export class CanvasTileRenderer {\r\n        renderer: PIXI.CanvasRenderer;\r\n        tileAnim = [0, 0];\r\n        dontUseTransform = false;\r\n\r\n        constructor(renderer: PIXI.CanvasRenderer) {\r\n            this.renderer = renderer;\r\n            this.tileAnim = [0, 0];\r\n        }\r\n    }\r\n\r\n    PIXI.CanvasRenderer.registerPlugin('tilemap', CanvasTileRenderer);\r\n}\r\n\r\n","/// <reference types=\"pixi.js\" />\r\n\r\nmodule PIXI.tilemap {\r\n    export class CompositeRectTileLayer extends PIXI.Container {\r\n        constructor(zIndex?: number, bitmaps?: Array<Texture>, useSquare?: boolean, texPerChild?: number) {\r\n            super();\r\n            this.initialize.apply(this, arguments);\r\n        }\r\n\r\n        updateTransform() {\r\n            super.displayObjectUpdateTransform()\r\n        }\r\n\r\n        z: number;\r\n        zIndex: number;\r\n        useSquare: boolean;\r\n        shadowColor = new Float32Array([0.0, 0.0, 0.0, 0.5]);\r\n        texPerChild: number;\r\n        modificationMarker = 0;\r\n        _globalMat: PIXI.Matrix = null;\r\n        _tempScale: Array<number> = null;\r\n\r\n        initialize(zIndex?: number, bitmaps?: Array<Texture>, useSquare?: boolean, texPerChild?: number) {\r\n            this.z = this.zIndex = zIndex;\r\n            this.useSquare = useSquare;\r\n            this.texPerChild = texPerChild || 16;\r\n            if (bitmaps) {\r\n                this.setBitmaps(bitmaps);\r\n            }\r\n        }\r\n\r\n        setBitmaps(bitmaps: Array<Texture>) {\r\n            var texPerChild = this.texPerChild;\r\n            var len1 = this.children.length;\r\n            var len2 = Math.ceil(bitmaps.length / texPerChild);\r\n            var i: number;\r\n            for (i = 0; i < len1; i++) {\r\n                (this.children[i] as RectTileLayer).textures = bitmaps.slice(i * texPerChild, (i + 1) * texPerChild);\r\n            }\r\n            for (i = len1; i < len2; i++) {\r\n                this.addChild(new RectTileLayer(this.zIndex, bitmaps.slice(i * texPerChild, (i + 1) * texPerChild)));\r\n            }\r\n        }\r\n\r\n        clear() {\r\n            for (var i = 0; i < this.children.length; i++)\r\n                (this.children[i] as RectTileLayer).clear();\r\n            this.modificationMarker = 0;\r\n        }\r\n\r\n        addRect(num: number, u: number, v: number, x: number, y: number, tileWidth: number, tileHeight: number) {\r\n            if (this.children[num] && (this.children[num] as RectTileLayer).textures)\r\n                (this.children[num] as RectTileLayer).addRect(0, u, v, x, y, tileWidth, tileHeight);\r\n        }\r\n\r\n        addFrame(texture_: PIXI.Texture | String, x: number, y: number) {\r\n            var texture : PIXI.Texture;\r\n            if (typeof texture_ === \"string\") {\r\n                texture = PIXI.Texture.fromImage(texture_);\r\n            } else {\r\n                texture = texture_ as PIXI.Texture\r\n            }\r\n\r\n            var children = this.children;\r\n            var layer : RectTileLayer = null, ind = 0;\r\n            for (var i = 0; i < children.length; i++) {\r\n                var child = children[i] as RectTileLayer;\r\n                var tex = child.textures;\r\n                for (var j = 0; j < tex.length; j++) {\r\n                    if (tex[j].baseTexture == texture.baseTexture) {\r\n                        layer = child;\r\n                        ind = j;\r\n                        break;\r\n                    }\r\n                }\r\n                if (layer) {\r\n                    break;\r\n                }\r\n            }\r\n            if (!layer) {\r\n                for (i = 0; i < children.length; i++) {\r\n                    var child = children[i] as RectTileLayer;\r\n                    if (child.textures.length < 16) {\r\n                        layer = child;\r\n                        ind = child.textures.length;\r\n                        child.textures.push(texture);\r\n                    }\r\n                }\r\n                if (!layer) {\r\n                    children.push(layer = new RectTileLayer(this.zIndex, texture));\r\n                    ind = 0;\r\n                }\r\n            }\r\n            layer.addRect(ind, texture.frame.x, texture.frame.y, x, y, texture.frame.width, texture.frame.height);\r\n            return true;\r\n        };\r\n\r\n        renderCanvas(renderer: CanvasRenderer) {\r\n            if (!renderer.plugins.tilemap.dontUseTransform) {\r\n                var wt = this.worldTransform;\r\n                renderer.context.setTransform(\r\n                    wt.a,\r\n                    wt.b,\r\n                    wt.c,\r\n                    wt.d,\r\n                    wt.tx * renderer.resolution,\r\n                    wt.ty * renderer.resolution\r\n                );\r\n            }\r\n            var layers = this.children;\r\n            for (var i = 0; i < layers.length; i++)\r\n                layers[i].renderCanvas(renderer);\r\n        };\r\n\r\n        renderWebGL(renderer: WebGLRenderer) {\r\n            var gl = renderer.gl;\r\n            var shader = renderer.plugins.tilemap.getShader(this.useSquare);\r\n            renderer.setObjectRenderer(renderer.plugins.tilemap);\r\n            renderer.bindShader(shader);\r\n            //TODO: dont create new array, please\r\n            this._globalMat = this._globalMat || new PIXI.Matrix();\r\n            renderer._activeRenderTarget.projectionMatrix.copy(this._globalMat).append(this.worldTransform);\r\n            shader.uniforms.projectionMatrix = this._globalMat.toArray(true);\r\n            shader.uniforms.shadowColor = this.shadowColor;\r\n            if (this.useSquare) {\r\n                var tempScale = this._tempScale = (this._tempScale || [0, 0]);\r\n                tempScale[0] = this._globalMat.a >= 0 ? 1 : -1;\r\n                tempScale[1] = this._globalMat.d < 0 ? 1 : -1;\r\n                var ps = shader.uniforms.pointScale = tempScale;\r\n                shader.uniforms.projectionScale = Math.abs(this.worldTransform.a) * renderer.resolution;\r\n            }\r\n            var af = shader.uniforms.animationFrame = renderer.plugins.tilemap.tileAnim;\r\n            //shader.syncUniform(shader.uniforms.animationFrame);\r\n            var layers = this.children;\r\n            for (var i = 0; i < layers.length; i++)\r\n                (layers[i] as RectTileLayer).renderWebGL(renderer, this.useSquare);\r\n        }\r\n\r\n        isModified(anim: boolean) {\r\n            var layers = this.children;\r\n            if (this.modificationMarker != layers.length) {\r\n                return true;\r\n            }\r\n            for (var i = 0; i < layers.length; i++) {\r\n                const layer = layers[i] as RectTileLayer;\r\n                if (layer.modificationMarker != layer.pointsBuf.length ||\r\n                    anim && layer.hasAnim) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        }\r\n\r\n        clearModify() {\r\n            var layers = this.children;\r\n            this.modificationMarker = layers.length;\r\n            for (var i = 0; i < layers.length; i++) {\r\n                const layer = layers[i] as RectTileLayer;\r\n                layer.modificationMarker = layer.pointsBuf.length;\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n","module PIXI.tilemap {\r\n\r\n    class GraphicsLayer extends PIXI.Graphics {\r\n        z: number;\r\n        zIndex: number;\r\n\r\n        constructor(zIndex: number) {\r\n            super();\r\n            this.z = this.zIndex = zIndex;\r\n        }\r\n\r\n        renderCanvas(renderer: PIXI.CanvasRenderer) {\r\n            var wt : PIXI.Matrix = null;\r\n            if (renderer.plugins.tilemap.dontUseTransform) {\r\n                wt = this.transform.worldTransform;\r\n                this.transform.worldTransform = PIXI.Matrix.IDENTITY;\r\n            }\r\n            renderer.plugins.graphics.render(this);\r\n            if (renderer.plugins.tilemap.dontUseTransform) {\r\n                this.transform.worldTransform = wt;\r\n            }\r\n            renderer.context.globalAlpha = 1.0;\r\n        }\r\n\r\n        renderWebGL(renderer: WebGLRenderer) {\r\n            if (!this._webGL[renderer.CONTEXT_UID])\r\n                this.dirty = true;\r\n            super.renderWebGL(renderer)\r\n        }\r\n\r\n        isModified(anim: boolean): boolean {\r\n            return false;\r\n        }\r\n\r\n        clearModify() {\r\n        }\r\n    }\r\n\r\n}\r\n","module PIXI.tilemap {\r\n\r\n    export class RectTileLayer extends PIXI.Container {\r\n        constructor(zIndex: number, texture: PIXI.Texture | Array<PIXI.Texture>) {\r\n            super();\r\n            this.initialize(zIndex, texture);\r\n        }\r\n\r\n        textures: Array<Texture>;\r\n        z = 0;\r\n        zIndex = 0;\r\n        pointsBuf : Array<number> = [];\r\n        _tempSize = new Float32Array([0, 0]);\r\n        _tempTexSize = 1;\r\n        modificationMarker = 0;\r\n        hasAnim = false;\r\n\r\n        initialize(zIndex : number, textures: PIXI.Texture | Array<PIXI.Texture>) {\r\n            if (!textures) {\r\n                textures = [];\r\n            } else if (!(textures instanceof Array) && (textures as PIXI.Texture).baseTexture) {\r\n                textures = [textures as PIXI.Texture];\r\n            }\r\n            this.textures = textures as Array<PIXI.Texture>;\r\n            this.z = this.zIndex = zIndex;\r\n            this.visible = false;\r\n        }\r\n\r\n        clear() {\r\n            this.pointsBuf.length = 0;\r\n            this.modificationMarker = 0;\r\n            this.hasAnim = false;\r\n        }\r\n\r\n        renderCanvas(renderer: CanvasRenderer) {\r\n            if (this.textures.length === 0) return;\r\n            var points = this.pointsBuf;\r\n            renderer.context.fillStyle = '#000000';\r\n            for (var i = 0, n = points.length; i < n; i += 9) {\r\n                var x1 = points[i], y1 = points[i + 1];\r\n                var x2 = points[i + 2], y2 = points[i + 3];\r\n                var w = points[i + 4];\r\n                var h = points[i + 5];\r\n                x1 += points[i + 6] * renderer.plugins.tilemap.tileAnim[0];\r\n                y1 += points[i + 7] * renderer.plugins.tilemap.tileAnim[1];\r\n                var textureId = points[i + 8];\r\n                if (textureId >= 0) {\r\n                    renderer.context.drawImage(this.textures[textureId].baseTexture.source, x1, y1, w, h, x2, y2, w, h);\r\n                } else {\r\n                    renderer.context.globalAlpha = 0.5;\r\n                    renderer.context.fillRect(x2, y2, w, h);\r\n                    renderer.context.globalAlpha = 1;\r\n                }\r\n            }\r\n        }\r\n\r\n        addRect(textureId: number, u: number, v: number, x: number, y: number, tileWidth: number, tileHeight: number, animX: number = 0, animY: number = 0) {\r\n            var pb = this.pointsBuf;\r\n            this.hasAnim = this.hasAnim || animX > 0 || animY > 0;\r\n            if (tileWidth == tileHeight) {\r\n                pb.push(u);\r\n                pb.push(v);\r\n                pb.push(x);\r\n                pb.push(y);\r\n                pb.push(tileWidth);\r\n                pb.push(tileHeight);\r\n                pb.push(animX | 0);\r\n                pb.push(animY | 0);\r\n                pb.push(textureId);\r\n            } else {\r\n                var i: number;\r\n                if (tileWidth % tileHeight === 0) {\r\n                    //horizontal line on squares\r\n                    for (i = 0; i < tileWidth / tileHeight; i++) {\r\n                        pb.push(u + i * tileHeight);\r\n                        pb.push(v);\r\n                        pb.push(x + i * tileHeight);\r\n                        pb.push(y);\r\n                        pb.push(tileHeight);\r\n                        pb.push(tileHeight);\r\n                        pb.push(animX | 0);\r\n                        pb.push(animY | 0);\r\n                        pb.push(textureId);\r\n                    }\r\n                } else if (tileHeight % tileWidth === 0) {\r\n                    //vertical line on squares\r\n                    for (i = 0; i < tileHeight / tileWidth; i++) {\r\n                        pb.push(u);\r\n                        pb.push(v + i * tileWidth);\r\n                        pb.push(x);\r\n                        pb.push(y + i * tileWidth);\r\n                        pb.push(tileWidth);\r\n                        pb.push(tileWidth);\r\n                        pb.push(animX | 0);\r\n                        pb.push(animY | 0);\r\n                        pb.push(textureId);\r\n                    }\r\n                } else {\r\n                    //ok, ok, lets use rectangle. but its not working with square shader yet\r\n                    pb.push(u);\r\n                    pb.push(v);\r\n                    pb.push(x);\r\n                    pb.push(y);\r\n                    pb.push(tileWidth);\r\n                    pb.push(tileHeight);\r\n                    pb.push(animX | 0);\r\n                    pb.push(animY | 0);\r\n                    pb.push(textureId);\r\n                }\r\n            }\r\n        };\r\n\r\n        vbId = 0;\r\n        vbBuffer : ArrayBuffer = null;\r\n        vbArray : Float32Array = null;\r\n        vbInts : Uint32Array = null;\r\n\r\n        renderWebGL(renderer: WebGLRenderer, useSquare: boolean = false) {\r\n            var points = this.pointsBuf;\r\n            if (points.length === 0) return;\r\n            var rectsCount = points.length / 9;\r\n            var tile = renderer.plugins.tilemap;\r\n            var gl = renderer.gl;\r\n            if (!useSquare) {\r\n                tile.checkIndexBuffer(rectsCount);\r\n            }\r\n\r\n            var shader = tile.getShader(useSquare);\r\n            var textures = this.textures;\r\n            if (textures.length === 0) return;\r\n            var len = textures.length;\r\n            if (this._tempTexSize < shader.maxTextures) {\r\n                this._tempTexSize = shader.maxTextures;\r\n                this._tempSize = new Float32Array(2 * shader.maxTextures);\r\n            }\r\n            // var samplerSize = this._tempSize;\r\n            for (var i = 0; i < len; i++) {\r\n                if (!textures[i] || !textures[i].valid) return;\r\n                var texture = textures[i].baseTexture;\r\n                // samplerSize[i * 2] = 1.0 / texture.width;\r\n                // samplerSize[i * 2 + 1] = 1.0 / texture.height;\r\n            }\r\n            tile.bindTextures(renderer, shader, textures);\r\n            // shader.uniforms.uSamplerSize = samplerSize;\r\n            //lost context! recover!\r\n            var vb = tile.getVb(this.vbId);\r\n            if (!vb) {\r\n                vb = tile.createVb(useSquare);\r\n                this.vbId = vb.id;\r\n                this.vbBuffer = null;\r\n                this.modificationMarker = 0;\r\n            }\r\n            var vao = vb.vao;\r\n            renderer.bindVao(vao);\r\n            var vertexBuf = vb.vb as glCore.GLBuffer;\r\n            //if layer was changed, re-upload vertices\r\n            vertexBuf.bind();\r\n            var vertices = rectsCount * shader.vertPerQuad;\r\n            if (vertices === 0) return;\r\n            if (this.modificationMarker != vertices) {\r\n                this.modificationMarker = vertices;\r\n                var vs = shader.stride * vertices;\r\n                if (!this.vbBuffer || this.vbBuffer.byteLength < vs) {\r\n                    //!@#$ happens, need resize\r\n                    var bk = shader.stride;\r\n                    while (bk < vs) {\r\n                        bk *= 2;\r\n                    }\r\n                    this.vbBuffer = new ArrayBuffer(bk);\r\n                    this.vbArray = new Float32Array(this.vbBuffer);\r\n                    this.vbInts = new Uint32Array(this.vbBuffer);\r\n                    vertexBuf.upload(this.vbBuffer, 0, true);\r\n                }\r\n\r\n                var arr = this.vbArray, ints = this.vbInts;\r\n                //upload vertices!\r\n                var sz = 0;\r\n                //var tint = 0xffffffff;\r\n                var textureId: number, shiftU: number, shiftV: number;\r\n                if (useSquare) {\r\n                    for (i = 0; i < points.length; i += 9) {\r\n                        textureId = (points[i + 8] >> 2);\r\n                        shiftU = 1024 * (points[i + 8] & 1);\r\n                        shiftV = 1024 * ((points[i + 8] >> 1) & 1);\r\n                        arr[sz++] = points[i + 2];\r\n                        arr[sz++] = points[i + 3];\r\n                        arr[sz++] = points[i + 0] + shiftU;\r\n                        arr[sz++] = points[i + 1] + shiftV;\r\n                        arr[sz++] = points[i + 4];\r\n                        arr[sz++] = points[i + 6];\r\n                        arr[sz++] = points[i + 7];\r\n                        arr[sz++] = textureId;\r\n                    }\r\n                } else {\r\n                    //var tint = 0xffffffff;\r\n                    var tint = -1;\r\n                    for (i = 0; i < points.length; i += 9) {\r\n                        var eps = 0.5;\r\n                        textureId = (points[i + 8] >> 2);\r\n                        shiftU = 1024 * (points[i + 8] & 1);\r\n                        shiftV = 1024 * ((points[i + 8] >> 1) & 1);\r\n                        var x = points[i + 2], y = points[i + 3];\r\n                        var w = points[i + 4], h = points[i + 5];\r\n                        var u = points[i] + shiftU, v = points[i + 1] + shiftV;\r\n                        var animX = points[i + 6], animY = points[i + 7];\r\n                        arr[sz++] = x;\r\n                        arr[sz++] = y;\r\n                        arr[sz++] = u;\r\n                        arr[sz++] = v;\r\n                        arr[sz++] = u + eps;\r\n                        arr[sz++] = v + eps;\r\n                        arr[sz++] = u + w - eps;\r\n                        arr[sz++] = v + h - eps;\r\n                        arr[sz++] = animX;\r\n                        arr[sz++] = animY;\r\n                        arr[sz++] = textureId;\r\n                        arr[sz++] = x + w;\r\n                        arr[sz++] = y;\r\n                        arr[sz++] = u + w;\r\n                        arr[sz++] = v;\r\n                        arr[sz++] = u + eps;\r\n                        arr[sz++] = v + eps;\r\n                        arr[sz++] = u + w - eps;\r\n                        arr[sz++] = v + h - eps;\r\n                        arr[sz++] = animX;\r\n                        arr[sz++] = animY;\r\n                        arr[sz++] = textureId;\r\n                        arr[sz++] = x + w;\r\n                        arr[sz++] = y + h;\r\n                        arr[sz++] = u + w;\r\n                        arr[sz++] = v + h;\r\n                        arr[sz++] = u + eps;\r\n                        arr[sz++] = v + eps;\r\n                        arr[sz++] = u + w - eps;\r\n                        arr[sz++] = v + h - eps;\r\n                        arr[sz++] = animX;\r\n                        arr[sz++] = animY;\r\n                        arr[sz++] = textureId;\r\n                        arr[sz++] = x;\r\n                        arr[sz++] = y + h;\r\n                        arr[sz++] = u;\r\n                        arr[sz++] = v + h;\r\n                        arr[sz++] = u + eps;\r\n                        arr[sz++] = v + eps;\r\n                        arr[sz++] = u + w - eps;\r\n                        arr[sz++] = v + h - eps;\r\n                        arr[sz++] = animX;\r\n                        arr[sz++] = animY;\r\n                        arr[sz++] = textureId;\r\n                    }\r\n                }\r\n                // if (vs > this.vbArray.length/2 ) {\r\n                vertexBuf.upload(arr, 0, true);\r\n                // } else {\r\n                //     var view = arr.subarray(0, vs);\r\n                //     vb.upload(view, 0);\r\n                // }\r\n            }\r\n            if (useSquare)\r\n                gl.drawArrays(gl.POINTS, 0, vertices);\r\n            else\r\n                gl.drawElements(gl.TRIANGLES, rectsCount * 6, gl.UNSIGNED_SHORT, 0);\r\n        }\r\n    }\r\n\r\n}\r\n","module PIXI.tilemap {\r\n\r\n    import GLBuffer = PIXI.glCore.GLBuffer;\r\n    import VertexArrayObject = PIXI.glCore.VertexArrayObject;\r\n    var rectShaderFrag = `varying vec2 vTextureCoord;\r\nvarying vec4 vFrame;\r\nvarying float vTextureId;\r\nuniform vec4 shadowColor;\r\nuniform sampler2D uSamplers[%count%];\r\nuniform vec2 uSamplerSize[%count%];\r\n\r\nvoid main(void){\r\n   vec2 textureCoord = clamp(vTextureCoord, vFrame.xy, vFrame.zw);\r\n   float textureId = floor(vTextureId + 0.5);\r\n\r\n   vec4 color;\r\n   %forloop%\r\n   gl_FragColor = color;\r\n}`;\r\n\r\n    var rectShaderVert = `\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec4 aFrame;\r\nattribute vec2 aAnim;\r\nattribute float aTextureId;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform vec2 animationFrame;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying float vTextureId;\r\nvarying vec4 vFrame;\r\n\r\nvoid main(void){\r\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n   vec2 anim = aAnim * animationFrame;\r\n   vTextureCoord = aTextureCoord + anim;\r\n   vFrame = aFrame + vec4(anim, anim);\r\n   vTextureId = aTextureId;\r\n}\r\n`;\r\n\r\n    export abstract class TilemapShader extends PIXI.Shader {\r\n        maxTextures = 0;\r\n        indexBuffer: GLBuffer;\r\n        constructor(gl: WebGLRenderingContext, maxTextures: number, shaderVert: string, shaderFrag: string) {\r\n            super(gl,\r\n                shaderVert,\r\n                shaderFrag\r\n            );\r\n            this.maxTextures = maxTextures;\r\n            shaderGenerator.fillSamplers(this, this.maxTextures);\r\n        }\r\n\r\n        abstract createVao(renderer : WebGLRenderer, vb: GLBuffer) : VertexArrayObject;\r\n    }\r\n\r\n    export class RectTileShader extends TilemapShader {\r\n        vertSize = 11;\r\n        vertPerQuad = 4;\r\n        stride = this.vertSize * 4;\r\n\r\n        constructor(gl: WebGLRenderingContext, maxTextures: number) {\r\n            super(gl,\r\n                maxTextures,\r\n                rectShaderVert,\r\n                shaderGenerator.generateFragmentSrc(maxTextures, rectShaderFrag)\r\n            );\r\n            shaderGenerator.fillSamplers(this, this.maxTextures);\r\n        }\r\n\r\n        createVao(renderer : WebGLRenderer, vb: GLBuffer) {\r\n            var gl = renderer.gl;\r\n            return renderer.createVao()\r\n                .addIndex(this.indexBuffer)\r\n                .addAttribute(vb, this.attributes.aVertexPosition, gl.FLOAT, false, this.stride, 0)\r\n                .addAttribute(vb, this.attributes.aTextureCoord, gl.FLOAT, false, this.stride, 2 * 4)\r\n                .addAttribute(vb, this.attributes.aFrame, gl.FLOAT, false, this.stride, 4 * 4)\r\n                .addAttribute(vb, this.attributes.aAnim, gl.FLOAT, false, this.stride, 8 * 4)\r\n                .addAttribute(vb, this.attributes.aTextureId, gl.FLOAT, false, this.stride, 10 * 4);\r\n        }\r\n    }\r\n}\r\n","module PIXI.tilemap.shaderGenerator {\r\n    export function fillSamplers(shader: TilemapShader, maxTextures: number) {\r\n        var sampleValues : Array<number> = [];\r\n        for (var i = 0; i < maxTextures; i++)\r\n        {\r\n            sampleValues[i] = i;\r\n        }\r\n        shader.bind();\r\n        shader.uniforms.uSamplers = sampleValues;\r\n\r\n        var samplerSize : Array<number> = [];\r\n        for (i = 0; i < maxTextures; i++) {\r\n            samplerSize.push(1.0 / 2048);\r\n            samplerSize.push(1.0 / 2048);\r\n        }\r\n        shader.uniforms.uSamplerSize = samplerSize;\r\n    }\r\n\r\n    export function generateFragmentSrc(maxTextures: number, fragmentSrc: string) {\r\n        return fragmentSrc.replace(/%count%/gi, maxTextures + \"\")\r\n            .replace(/%forloop%/gi, this.generateSampleSrc(maxTextures));\r\n    }\r\n\r\n    export function generateSampleSrc(maxTextures: number) {\r\n        var src = '';\r\n\r\n        src += '\\n';\r\n        src += '\\n';\r\n\r\n        src += 'if(vTextureId <= -1.0) {';\r\n        src += '\\n\\tcolor = shadowColor;';\r\n        src += '\\n}';\r\n\r\n        for (var i = 0; i < maxTextures; i++)\r\n        {\r\n            src += '\\nelse ';\r\n\r\n            if(i < maxTextures-1)\r\n            {\r\n                src += 'if(textureId == ' + i + '.0)';\r\n            }\r\n\r\n            src += '\\n{';\r\n            src += '\\n\\tcolor = texture2D(uSamplers['+i+'], textureCoord * uSamplerSize['+i+']);';\r\n            src += '\\n}';\r\n        }\r\n\r\n        src += '\\n';\r\n        src += '\\n';\r\n\r\n        return src;\r\n    }\r\n}\r\n","module PIXI.tilemap {\r\n\r\n    import GLBuffer = PIXI.glCore.GLBuffer;\r\n    import VertexArrayObject = PIXI.glCore.VertexArrayObject;\r\n\r\n    var squareShaderVert = `\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\nattribute vec2 aAnim;\r\nattribute float aTextureId;\r\nattribute float aSize;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform vec2 samplerSize;\r\nuniform vec2 animationFrame;\r\nuniform float projectionScale;\r\n\r\nvarying vec2 vTextureCoord;\r\nvarying float vSize;\r\nvarying float vTextureId;\r\n\r\nvoid main(void){\r\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition + aSize * 0.5, 1.0)).xy, 0.0, 1.0);\r\n   gl_PointSize = aSize * projectionScale;\r\n   vTextureCoord = aTextureCoord + aAnim * animationFrame;\r\n   vTextureId = aTextureId;\r\n   vSize = aSize;\r\n}\r\n`;\r\n\r\n    var squareShaderFrag = `\r\nvarying vec2 vTextureCoord;\r\nvarying float vSize;\r\nvarying float vTextureId;\r\n\r\nuniform vec4 shadowColor;\r\nuniform sampler2D uSamplers[%count%];\r\nuniform vec2 uSamplerSize[%count%];\r\nuniform vec2 pointScale;\r\n\r\nvoid main(void){\r\n   float margin = 0.5 / vSize;\r\n   vec2 pointCoord = (gl_PointCoord - 0.5) * pointScale + 0.5;\r\n   vec2 clamped = vec2(clamp(pointCoord.x, margin, 1.0 - margin), clamp(pointCoord.y, margin, 1.0 - margin));\r\n   vec2 textureCoord = pointCoord * vSize + vTextureCoord;\r\n   float textureId = vTextureId;\r\n   vec4 color;\r\n   %forloop%\r\n   gl_FragColor = color;\r\n}\r\n\r\n`;\r\n\r\n    export class SquareTileShader extends TilemapShader {\r\n        vertSize = 8;\r\n        vertPerQuad = 1;\r\n        stride = this.vertSize * 4;\r\n\r\n        constructor(gl: WebGLRenderingContext, maxTextures: number) {\r\n            super(gl,\r\n                maxTextures,\r\n                squareShaderVert,\r\n                shaderGenerator.generateFragmentSrc(maxTextures, squareShaderFrag)\r\n            );\r\n            this.maxTextures = maxTextures;\r\n            shaderGenerator.fillSamplers(this, this.maxTextures);\r\n        }\r\n\r\n        indexBuffer: GLBuffer;\r\n\r\n        createVao(renderer: WebGLRenderer, vb: GLBuffer): VertexArrayObject {\r\n            var gl = renderer.gl;\r\n            return renderer.createVao()\r\n                .addIndex(this.indexBuffer)\r\n                .addAttribute(vb, this.attributes.aVertexPosition, gl.FLOAT, false, this.stride, 0)\r\n                .addAttribute(vb, this.attributes.aTextureCoord, gl.FLOAT, false, this.stride, 2 * 4)\r\n                .addAttribute(vb, this.attributes.aSize, gl.FLOAT, false, this.stride, 4 * 4)\r\n                .addAttribute(vb, this.attributes.aAnim, gl.FLOAT, false, this.stride, 5 * 4)\r\n                .addAttribute(vb, this.attributes.aTextureId, gl.FLOAT, false, this.stride, 7 * 4);\r\n        };\r\n    }\r\n}","module PIXI.tilemap {\r\n    import glCore = PIXI.glCore;\r\n    function _hackSubImage(tex: glCore.GLTexture, sprite: PIXI.Sprite) {\r\n        var gl = tex.gl;\r\n        var baseTex = sprite.texture.baseTexture;\r\n        gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, 1);\r\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, sprite.position.x, sprite.position.y, tex.format, tex.type, baseTex.source as HTMLImageElement);\r\n    }\r\n\r\n    /*\r\n     * Renderer for square and rectangle tiles.\r\n     * Squares cannot be rotated, skewed.\r\n     * For container with squares, scale.x must be equals to scale.y, matrix.a to matrix.d\r\n     * Rectangles do not care about that.\r\n     *\r\n     * @class\r\n     * @memberof PIXI.tilemap\r\n     * @extends PIXI.ObjectRenderer\r\n     * @param renderer {PIXI.WebGLRenderer} The renderer this sprite batch works for.\r\n     */\r\n\r\n    export class TileRenderer extends PIXI.ObjectRenderer {\r\n\r\n        static vbAutoincrement = 0;\r\n        static SCALE_MODE = PIXI.SCALE_MODES.LINEAR;\r\n\r\n        renderer: WebGLRenderer;\r\n        gl: WebGLRenderingContext;\r\n        vbs :  { [key: string]: any; } = {};\r\n        indices = new Uint16Array(0);\r\n        indexBuffer : glCore.GLBuffer;\r\n        lastTimeCheck = 0;\r\n        tileAnim = [0, 0];\r\n        maxTextures = 4;\r\n        texLoc : Array<number> = [];\r\n\r\n        rectShader: RectTileShader;\r\n        squareShader: SquareTileShader;\r\n        boundSprites: Array<Array<PIXI.Sprite>>;\r\n        glTextures: Array<PIXI.RenderTexture>;\r\n\r\n        constructor(renderer: WebGLRenderer) {\r\n            super(renderer)\r\n        }\r\n\r\n        onContextChange() {\r\n            var gl = this.renderer.gl;\r\n            var maxTextures = this.maxTextures;\r\n            this.rectShader = new RectTileShader(gl, maxTextures);\r\n            this.squareShader = new SquareTileShader(gl, maxTextures);\r\n            this.checkIndexBuffer(2000);\r\n            this.rectShader.indexBuffer = this.indexBuffer;\r\n            this.squareShader.indexBuffer = this.indexBuffer;\r\n            this.vbs = {};\r\n            this.glTextures = [];\r\n            this.boundSprites = [];\r\n            this.initBounds();\r\n        }\r\n\r\n        initBounds() {\r\n            var gl = this.renderer.gl;\r\n            var tempCanvas = document.createElement('canvas');\r\n            tempCanvas.width = 2048;\r\n            tempCanvas.height = 2048;\r\n            // tempCanvas.getContext('2d').clearRect(0, 0, 2048, 2048);\r\n            for (var i = 0; i < this.maxTextures; i++) {\r\n                var rt = PIXI.RenderTexture.create(2048, 2048);\r\n                rt.baseTexture.premultipliedAlpha = true;\r\n                rt.baseTexture.scaleMode = TileRenderer.SCALE_MODE;\r\n                rt.baseTexture.wrapMode = PIXI.WRAP_MODES.CLAMP;\r\n                this.renderer.textureManager.updateTexture(rt);\r\n\r\n                this.glTextures.push(rt);\r\n                var bs : Array<PIXI.Sprite> = [];\r\n                for (var j = 0; j < 4; j++) {\r\n                    var spr = new PIXI.Sprite();\r\n                    spr.position.x = 1024 * (j & 1);\r\n                    spr.position.y = 1024 * (j >> 1);\r\n                    bs.push(spr);\r\n                }\r\n                this.boundSprites.push(bs);\r\n            }\r\n        }\r\n\r\n        bindTextures(renderer: WebGLRenderer, shader: TilemapShader, textures: Array<PIXI.Texture>) {\r\n            var bounds = this.boundSprites;\r\n            var glts = this.glTextures;\r\n            var len = textures.length;\r\n            var maxTextures = this.maxTextures;\r\n            if (len >= 4 * maxTextures) {\r\n                return;\r\n            }\r\n            var i: number;\r\n            for (i = 0; i < len; i++) {\r\n                var texture = textures[i];\r\n                if (!texture || !textures[i].valid) continue;\r\n                var bs = bounds[i >> 2][i & 3];\r\n                if (!bs.texture ||\r\n                    bs.texture.baseTexture !== texture.baseTexture) {\r\n                    bs.texture = texture;\r\n                    var glt = glts[i >> 2];\r\n                    renderer.bindTexture(glt, 0, true);\r\n                    _hackSubImage((glt.baseTexture as any)._glTextures[renderer.CONTEXT_UID], bs);\r\n                }\r\n            }\r\n            this.texLoc.length = 0;\r\n            for (i = 0; i < maxTextures; i++) {\r\n                //remove \"i, true\" after resolving a bug\r\n                this.texLoc.push(renderer.bindTexture(glts[i], i, true))\r\n            }\r\n            shader.uniforms.uSamplers = this.texLoc;\r\n        }\r\n\r\n        checkLeaks() {\r\n            var now = Date.now();\r\n            var old = now - 10000;\r\n            if (this.lastTimeCheck < old ||\r\n                this.lastTimeCheck > now) {\r\n                this.lastTimeCheck = now;\r\n                var vbs = this.vbs;\r\n                for (var key in vbs) {\r\n                    if (vbs[key].lastTimeAccess < old) {\r\n                        this.removeVb(key);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        start() {\r\n            this.renderer.state.setBlendMode(PIXI.BLEND_MODES.NORMAL);\r\n            //sorry, nothing\r\n        }\r\n\r\n        getVb(id: string) {\r\n            this.checkLeaks();\r\n            var vb = this.vbs[id];\r\n            if (vb) {\r\n                vb.lastAccessTime = Date.now();\r\n                return vb;\r\n            }\r\n            return null;\r\n        }\r\n\r\n        createVb(useSquare: boolean) {\r\n            var id = ++TileRenderer.vbAutoincrement;\r\n            var shader = this.getShader(useSquare);\r\n            var gl = this.renderer.gl;\r\n            var vb = PIXI.glCore.GLBuffer.createVertexBuffer(gl, null, gl.STREAM_DRAW);\r\n            var stuff = {\r\n                id: id,\r\n                vb: vb,\r\n                vao: shader.createVao(this.renderer, vb),\r\n                lastTimeAccess: Date.now(),\r\n                useSquare: useSquare,\r\n                shader: shader\r\n            };\r\n            this.vbs[id] = stuff;\r\n            return stuff;\r\n        }\r\n\r\n        removeVb(id: string) {\r\n            if (this.vbs[id]) {\r\n                this.vbs[id].vb.destroy();\r\n                this.vbs[id].vao.destroy();\r\n                delete this.vbs[id];\r\n            }\r\n        }\r\n\r\n        checkIndexBuffer(size: number) {\r\n            // the total number of indices in our array, there are 6 points per quad.\r\n            var totalIndices = size * 6;\r\n            var indices = this.indices;\r\n            if (totalIndices <= indices.length) {\r\n                return;\r\n            }\r\n            var len = indices.length || totalIndices;\r\n            while (len < totalIndices) {\r\n                len <<= 1;\r\n            }\r\n\r\n            indices = new Uint16Array(len);\r\n            this.indices = indices;\r\n\r\n            // fill the indices with the quads to draw\r\n            for (var i = 0, j = 0; i + 5 < indices.length; i += 6, j += 4) {\r\n                indices[i + 0] = j + 0;\r\n                indices[i + 1] = j + 1;\r\n                indices[i + 2] = j + 2;\r\n                indices[i + 3] = j + 0;\r\n                indices[i + 4] = j + 2;\r\n                indices[i + 5] = j + 3;\r\n            }\r\n\r\n            if (this.indexBuffer) {\r\n                this.indexBuffer.upload(indices);\r\n            } else {\r\n                var gl = this.renderer.gl;\r\n                this.indexBuffer = glCore.GLBuffer.createIndexBuffer(gl, this.indices, gl.STATIC_DRAW);\r\n            }\r\n        }\r\n\r\n        getShader(useSquare: boolean) : TilemapShader {\r\n            return useSquare ? this.squareShader : this.rectShader;\r\n        }\r\n\r\n        destroy() {\r\n            super.destroy();\r\n            this.rectShader.destroy();\r\n            this.squareShader.destroy();\r\n            this.rectShader = null;\r\n            this.squareShader = null;\r\n        };\r\n    }\r\n\r\n    PIXI.WebGLRenderer.registerPlugin('tilemap', TileRenderer);\r\n\r\n}\r\n","module PIXI.tilemap {\r\n\r\n    export class ZLayer extends PIXI.Container {\r\n        constructor(tilemap: PIXI.Container, zIndex: number) {\r\n            super();\r\n            this.tilemap = tilemap;\r\n            this.z = zIndex;\r\n        }\r\n\r\n        tilemap: any;\r\n        z: number;\r\n        zIndex: number;\r\n        _previousLayers: number;\r\n        canvasBuffer: HTMLCanvasElement;\r\n        _tempRender: PIXI.CanvasRenderer;\r\n        _lastAnimationFrame: number = -1;\r\n        layerTransform: PIXI.Matrix;\r\n\r\n        clear() {\r\n            var layers = this.children as Array<CompositeRectTileLayer>;\r\n            for (var i = 0; i < layers.length; i++)\r\n                layers[i].clear();\r\n            this._previousLayers = 0;\r\n        }\r\n\r\n        cacheIfDirty() {\r\n            var tilemap: any = this.tilemap;\r\n            var layers = this.children as Array<CompositeRectTileLayer>;\r\n            var modified = this._previousLayers != layers.length;\r\n            this._previousLayers = layers.length;\r\n            var buf = this.canvasBuffer;\r\n            var tempRender = this._tempRender;\r\n            if (!buf) {\r\n                buf = this.canvasBuffer = document.createElement('canvas');\r\n                tempRender = this._tempRender = new PIXI.CanvasRenderer(100, 100, {view: buf});\r\n                tempRender.context = tempRender.rootContext;\r\n                tempRender.plugins.tilemap.dontUseTransform = true;\r\n            }\r\n            if (buf.width != tilemap._layerWidth ||\r\n                buf.height != tilemap._layerHeight) {\r\n                buf.width = tilemap._layerWidth;\r\n                buf.height = tilemap._layerHeight;\r\n                modified = true;\r\n            }\r\n            var i: number;\r\n            if (!modified) {\r\n                for (i = 0; i < layers.length; i++) {\r\n                    if (layers[i].isModified(this._lastAnimationFrame != tilemap.animationFrame)) {\r\n                        modified = true;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            this._lastAnimationFrame = tilemap.animationFrame;\r\n            if (modified) {\r\n                if (tilemap._hackRenderer) {\r\n                    tilemap._hackRenderer(tempRender);\r\n                }\r\n                tempRender.context.clearRect(0, 0, buf.width, buf.height);\r\n                for (i = 0; i < layers.length; i++) {\r\n                    layers[i].clearModify();\r\n                    layers[i].renderCanvas(tempRender);\r\n                }\r\n            }\r\n            this.layerTransform = this.worldTransform;\r\n            for (i = 0; i < layers.length; i++) {\r\n                this.layerTransform = layers[i].worldTransform;\r\n                break;\r\n            }\r\n        };\r\n\r\n        renderCanvas(renderer: PIXI.CanvasRenderer) {\r\n            this.cacheIfDirty();\r\n            var wt = this.layerTransform;\r\n            renderer.context.setTransform(\r\n                wt.a,\r\n                wt.b,\r\n                wt.c,\r\n                wt.d,\r\n                wt.tx * renderer.resolution,\r\n                wt.ty * renderer.resolution\r\n            );\r\n            var tilemap = this.tilemap;\r\n            renderer.context.drawImage(this.canvasBuffer, 0, 0);\r\n        };\r\n    }\r\n}\r\n"]}